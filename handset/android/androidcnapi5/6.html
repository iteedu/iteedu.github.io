<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->


<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->





        
<div class=WordSection6 style='layout-grid:15.6pt'><br clear=all
style='page-break-before:always'>

<p class=MsoNormal align=center style='text-align:center'><a name=aidl><b>Android Interface Definition Language(AIDL)</b></a></p>





<p class=MsoNormal align=center style='text-align:center'>版本：Android 2.3 r1</p>

<p class=MsoNormal align=left style='text-align:left'><b>原文</b></p>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; http://developer.android.com/guide/developing/tools/aidl.html&nbsp;
(注意：3.0 r1 以后移到Appendix下)</p>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;</p>

<p class=MsoNormal align=left style='text-align:left'><b>使用</b><b>AIDL</b><b>设计远程接口</b><b>(Designing
a Remote Interface Using AIDL)</b></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'>由于每个应用程序都运行在自己的进程空间，并且可以从应用程序UI运行另一个服务进程，而且经常会在不同的进程间传递对象。在Android平台，一个进程通常不能访问另一个进程的内存空间，所以要想对话，需要将对象分解成操作系统可以理解的基本单元，并且有序的通过进程边界。</p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'>通过代码来实现这个数据传输过程是冗长乏味的，Android提供了AIDL工具来处理这项工作。</p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'>AIDL (Android Interface Definition Language)是一种IDL 语言，用于生成可以在Android设备上两个进程之间进行进程间通信(IPC)的代码。如果在一个进程中（例如Activity）要调用另一个进程中（例如Service）对象的操作，就可以使用AIDL生成可序列化的参数。</p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'>AIDL IPC机制是面向接口的，像COM或Corba一样，但是更加轻量级。它是使用代理类在客户端和实现端传递数据。</p>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;</p>

<p class=MsoNormal align=center style='text-align:center'><b>使用</b><b>AIDL</b><b>实现</b><b>IPC(Implementing
IPC Using AIDL)</b></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'>使用AIDL实现IPC服务的步骤是：</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
创建.aidl文件-该文件（YourInterface.aidl）定义了客户端可用的方法和数据的接口。</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
在makefile文件中加入.aidl文件-（Eclipse中的ADT插件提供管理功能）Android包括名为AIDL的编译器，位于tools/文件夹。</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
实现接口-AIDL编译器从AIDL接口文件中利用Java语言创建接口，该接口有一个继承的命名为Stub的内部抽象类（并且实现了一些IPC调用的附加方法），要做的就是创建一个继承于YourInterface.Stub的类并且实现在.aidl文件中声明的方法。</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
向客户端公开接口-如果是编写服务，应该继承Service并且重载Service.onBind(Intent) 以返回实现了接口的对象实例</p>

<p class=MsoNormal align=left style='margin-left:21.0pt;text-align:left'>&nbsp;</p>

<p class=MsoNormal align=left style='text-align:left'><b>创建</b><b>.aidl</b><b>文件</b><b>(Create
an .aidl File)</b></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'>AIDL使用简单的语法来声明接口，描述其方法以及方法的参数和返回值。这些参数和返回值可以是任何类型，甚至是其他AIDL生成的接口。重要的是必须导入所有非内置类型，哪怕是这些类型是在与接口相同的包中。下面是AIDL能支持的数据类型：</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>l&nbsp; Java编程语言的主要类型 (int, boolean等) — 不需要 import 语句。</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>l&nbsp; 以下的类 (不需要import 语句):</p>

<p class=MsoNormal align=left style='margin-left:63.0pt;text-align:left;
text-indent:-21.0pt'><strong>n&nbsp; </strong><strong>String</strong></p>

<p class=MsoNormal align=left style='margin-left:63.0pt;text-align:left;
text-indent:-21.0pt'>n&nbsp; <strong>List</strong> -列表中的所有元素必须是在此列出的类型，包括其他AIDL生成的接口和可打包类型。List可以像一般的类（例如List&lt;String&gt;）那样使用，另一边接收的具体类一般是一个ArrayList，这些方法会使用List接口。</p>

<p class=MsoNormal align=left style='margin-left:63.0pt;text-align:left;
text-indent:-21.0pt'>n&nbsp; <strong>Map</strong> - Map中的所有元素必须是在此列出的类型，包括其他AIDL生成的接口和可打包类型。一般的maps（例如Map&lt;String,Integer&gt;）不被支持，另一边接收的具体类一般是一个HashMap，这些方法会使用Map接口。</p>

<p class=MsoNormal align=left style='margin-left:63.0pt;text-align:left;
text-indent:-21.0pt'>n&nbsp; <strong>CharSequence</strong> -该类是被TextView和其他控件对象使用的字符序列。</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>l&nbsp; 通常引引用方式传递的其他AIDL生成的接口，必须要import 语句声明</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>l&nbsp; 实现了Parcelable protocol 以及按值传递的自定义类，必须要import 语句声明。</p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'>以下是基本的AIDL语法：</p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><img border=0 width=554 height=384
src="images/image004.jpg"></p>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;</p>

<p class=MsoNormal align=left style='text-align:left'><b>实现接口</b><b>(Implementing the Interface)</b></p>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AIDL生成了与.aidl文件同名的接口，如果使用Eclipse插件，AIDL会做为编译过程的一部分自动运行（不需要先运行AIDL再编译项目），如果没有插件，就要先运行AIDL。</p>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 生成的接口包含一个名为Stub的抽象的内部类，该类声明了所有.aidl中描述的方法，Stub还定义了少量的辅助方法，尤其是asInterface()，通过它或以获得IBinder（当applicationContext.bindService()成功调用时传递到客户端的onServiceConnected()）并且返回用于调用IPC方法的接口实例，更多细节参见Calling
an IPC Method。</p>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 要实现自己的接口，就从YourInterface.Stub类继承，然后实现相关的方法（可以创建.aidl文件然后实现stub方法而不用在中间编译，Android编译过程会在.java文件之前处理.aidl文件）。</p>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这个例子实现了对IRemoteService接口的调用，这里使用了匿名对象并且只有一个getPid()接口。<img border=0 width=543
height=114 src="images/image005.png"></p>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这里是实现接口的几条说明：</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>l&nbsp; 不会有返回给调用方的异常</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>l&nbsp; 默认IPC调用是同步的。如果已知IPC服务端会花费很多毫秒才能完成，那就不要在Activity或View线程中调用，否则会引起应用程序挂起（Android可能会显示“应用程序未响应”对话框），可以试着在独立的线程中调用。</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>l&nbsp; AIDL接口中只支持方法，不能声明静态成员。</p>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;</p>

<p class=MsoNormal align=left style='text-align:left'><b>向客户端暴露接口</b><b>(Exposing Your Interface to Clients)</b></p>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在完成了接口的实现后需要向客户端暴露接口了，也就是发布服务，实现的方法是继承 Service，然后实现以Service.onBind(Intent)返回一个实现了接口的类对象。下面的代码片断表示了暴露IRemoteService接口给客户端的方式。</p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:11.9pt;margin-right:0cm'><pre style='background:
#FAFAFA;border:none;padding:0cm'>public class RemoteService extends Service {</pre><pre
style='background:#FAFAFA;border:none;padding:0cm'>...</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>@Override</pre><pre style='text-indent:14.25pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; public IBinder onBind(Intent intent) {</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // Select the interface to return. &nbsp;If your service only implements</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // a single interface, you can just return it here without checking</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // the Intent.</pre><pre style='text-indent:14.25pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; if (IRemoteService.class.getName().equals(intent.getAction())) {</pre><pre style='text-indent:14.25pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return mBinder;</pre><pre style='text-indent:14.25pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; }</pre><pre style='text-indent:14.25pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; if (ISecondary.class.getName().equals(intent.getAction())) {</pre><pre style='text-indent:14.25pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return mSecondaryBinder;</pre><pre style='text-indent:14.25pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; }</pre><pre style='text-indent:14.25pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; return null;</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; }</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre style='text-indent:14.25pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; /**</pre><pre style='text-indent:14.25pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp;* The IRemoteInterface is defined through IDL</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp;*/</pre><pre style='text-indent:
14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; private final IRemoteService.Stub mBinder = new IRemoteService.Stub() {</pre><pre style='text-indent:14.25pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; public void registerCallback(IRemoteServiceCallback cb) {</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (cb != null) mCallbacks.register(cb);</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; }</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; public void unregisterCallback(IRemoteServiceCallback cb) {</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (cb != null) mCallbacks.unregister(cb);</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; }</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; };</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre style='text-indent:14.25pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; /**</pre><pre style='text-indent:14.25pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp;* A secondary interface to the service.</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp;*/</pre><pre style='text-indent:
14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; private final ISecondary.Stub mSecondaryBinder = new ISecondary.Stub() {</pre><pre style='text-indent:14.25pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; public int getPid() {</pre><pre style='text-indent:14.25pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return Process.myPid();</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; }</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; public void basicTypes(int anInt, long aLong, boolean aBoolean,</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float aFloat, double aDouble, String aString) {</pre><pre style='text-indent:14.25pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; }</pre><pre style='text-indent:14.25pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; };</pre><pre style='text-indent:14.25pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre
style='text-indent:14.25pt;background:#FAFAFA;border:none;padding:0cm'>}</pre></div>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;</p>

<p class=MsoNormal align=left style='text-align:left'><b>使用可打包接口传递参数</b><b>Pass by value Parameters using Parcelables</b></p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'>如果有类想要能过AIDL在进程之间传递，这一想法是可以实现的，必须确保这个类在IPC的两端的有效性，通常的情形是与一个启动的服务通信。</p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'>这里列出了使类能够支持Parcelable的4个步骤：【译者注：原文为5，但列表为4项，疑为作者笔误】</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
使该类实现Parcelabel接口。</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
实现public
void writeToParcel(Parcel out) 方法，以便可以将对象的当前状态写入包装对象中。</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
增加名为CREATOR的构造器到类中，并实现Parcelable.Creator接口。</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
最后，但同样重要的是，创建AIDL文件声明这个可打包的类（见下文），如果使用的是自定义的编译过程，那么不要编译此AIDL文件，它像C语言的头文件一样不需要编译。</p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'>AIDL会使用这些方法的成员序列化和反序列化对象。</p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'>这个例子演示了如何让Rect类实现Parcelable接口。</p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 8.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:11.9pt;margin-right:0cm'><pre style='background:
#FAFAFA;border:none;padding:0cm'>import android.os.Parcel;</pre><pre
style='background:#FAFAFA;border:none;padding:0cm'>import android.os.Parcelable;</pre><pre style='background:#FAFAFA;border:none;
padding:0cm'>public final class Rect implements Parcelable {</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>public int left;</pre><pre style='text-indent:25.5pt;background:
#FAFAFA;border:none;padding:0cm'>public int top;</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>public int right;</pre><pre style='text-indent:25.5pt;background:
#FAFAFA;border:none;padding:0cm'>public int bottom;</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre style='text-indent:25.5pt;
background:#FAFAFA;border:none;padding:0cm'>public static final Parcelable.Creator&lt;Rect&gt; CREATOR = new Parcelable.Creator&lt;Rect&gt;() {</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp;public Rect createFromParcel(Parcel in) {</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp;return new Rect(in);</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp;}</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre style='text-indent:25.5pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; public Rect[] newArray(int size) {</pre><pre style='text-indent:25.5pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return new Rect[size];</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; }</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; };</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre style='text-indent:25.5pt;
background:#FAFAFA;border:none;padding:0cm'>public Rect() {</pre><pre style='text-indent:25.5pt;background:
#FAFAFA;border:none;padding:0cm'>}</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre style='text-indent:25.5pt;
background:#FAFAFA;border:none;padding:0cm'>private Rect(Parcel in) {</pre><pre style='text-indent:25.5pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp;readFromParcel(in);</pre><pre style='text-indent:25.5pt;background:
#FAFAFA;border:none;padding:0cm'>}</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre style='text-indent:25.5pt;
background:#FAFAFA;border:none;padding:0cm'>public void writeToParcel(Parcel out) {</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; out.writeInt(left);</pre><pre style='text-indent:25.5pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; out.writeInt(top);</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; out.writeInt(right);</pre><pre style='text-indent:25.5pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; out.writeInt(bottom);</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>}</pre><pre style='text-indent:25.5pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>public void readFromParcel(Parcel in) {</pre><pre style='text-indent:25.5pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; left = in.readInt();</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; top = in.readInt();</pre><pre style='text-indent:25.5pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; right = in.readInt();</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; bottom = in.readInt();</pre><pre style='text-indent:25.5pt;
background:#FAFAFA;border:none;padding:0cm'>}</pre><pre
style='text-indent:25.5pt;background:#FAFAFA;border:none;padding:0cm'>}</pre></div>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这个是Rect.aidl文件。</p>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img
border=0 width=475 height=98
src="images/image006.png"></p>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 序列化Rect类的工作相当简单，对可打包的其他类型的数据可以参见Parcel类。</p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'><b>警告</b>：不要忘了对从其他进程接收到的数据进行安全检查。在上面的例子中，rect要从数据包中读取4个数值，需要确认无论调用方想要做什么，这些数值都是在可接受的范围之内。想要了解更多的关于保持应用程序安全的内容，可参见
Security
and Permissions。</p>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;</p>

<p class=MsoNormal align=left style='text-align:left'><b>调用</b><b>IPC</b><b>方法</b><b>(Calling
an IPC Method)</b></p>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这里给出了调用远端接口的步骤：</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
声明.aidl文件中定义的接口类型的变量。</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
实现ServiceConnection</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
调用Context.bindService()，传递ServiceConnection的实现</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
在ServiceConnection.onServiceConnected()方法中会接收到IBinder对象，调用YourInterfaceName.Stub.asInterface((IBinder)service)将返回值转换为YourInterface类型</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>5.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
调用接口中定义的方法。应该总是捕获连接被打断时抛出的DeadObjectException异常，这是远端方法唯一的异常。</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>6.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
调用Context.unbindService()断开连接</p>

<p class=MsoNormal align=left style='text-align:left;text-indent:21.0pt'>这里是几个调用IPC服务的提示：</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>l&nbsp; 对象是在进程间进行引用计数</p>

<p class=MsoNormal align=left style='margin-left:42.0pt;text-align:left;
text-indent:-21.0pt'>l&nbsp; 可以发送匿名对象作为方法参数</p>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 以下是演示调用AIDL创建的服务，可以在ApiDemos项目中获取远程服务的示例。</p>

<div style='border:solid #CCCCCC 1.0pt;padding:8.0pt 7.0pt 8.0pt 8.0pt;
background:#FAFAFA;margin-left:12.0pt;margin-right:0cm'><pre style='text-indent:
24.0pt;background:#FAFAFA;border:none;padding:0cm'>public static class Binding extends Activity {<br>
<br>
</pre><pre style='text-indent:24.0pt;background:#FAFAFA;border:none;
padding:0cm'>/** The primary interface we will be calling on the service. */</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>IRemoteService mService = null;</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>/** Another interface we use on the service. */</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>ISecondary mSecondaryService = null;</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>Button mKillButton;</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>TextView mCallbackText;</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>private boolean mIsBound;</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>/**</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>* Standard initialization of this activity. &nbsp;Set up the UI, then wait</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>* for the user to poke it before doing anything.</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>*/</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>@Override</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>protected void onCreate(Bundle savedInstanceState) {</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; super.onCreate(savedInstanceState);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; setContentView(R.layout.remote_service_binding);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; // Watch for button clicks.</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; Button button = (Button)findViewById(R.id.bind);</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; button.setOnClickListener(mBindListener);</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; button = (Button)findViewById(R.id.unbind);</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; button.setOnClickListener(mUnbindListener);</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; mKillButton = (Button)findViewById(R.id.kill);</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; mKillButton.setOnClickListener(mKillListener);</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; mKillButton.setEnabled(false); </pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre style='text-indent:24.0pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; mCallbackText = (TextView)findViewById(R.id.callback);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp;mCallbackText.setText(&quot;Not attached.&quot;);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>}</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre style='text-indent:24.0pt;
background:#FAFAFA;border:none;padding:0cm'>/**</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; * Class for interacting with the main interface of the service.</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; */</pre><pre style='text-indent:24.0pt;
background:#FAFAFA;border:none;padding:0cm'>private ServiceConnection mConnection = new ServiceConnection() {</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp;public void onServiceConnected(ComponentName className, IBinder service) {</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // This is called when the connection with the service has been</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // established, giving us the service object we can use to</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // interact with the service. &nbsp;We are communicating with our</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // service through an IDL interface, so get a client-side</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // representation of that from the raw service object.</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; mService = IRemoteService.Stub.asInterface(service);</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; mKillButton.setEnabled(true);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; mCallbackText.setText(&quot;Attached.&quot;);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'> </pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // We want to monitor the service for as long as we are</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // connected to it.</pre><pre style='text-indent:
24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; try {</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mService.registerCallback(mCallback);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; } catch (RemoteException e) {</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // In this case the service has crashed before we could even</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // do anything with it; we can count on soon being</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // disconnected (and then reconnected if it can be restarted)</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // so there is no need to do anything here.</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; }</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre style='text-indent:24.0pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp;// As part of the sample, tell the user what happened.</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp;Toast.makeText(Binding.this, R.string.remote_service_connected,</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Toast.LENGTH_SHORT).show();</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; }</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre style='text-indent:24.0pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; public void onServiceDisconnected(ComponentName className) {</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // This is called when the connection with the service has been</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // unexpectedly disconnected -- that is, its process crashed.</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; mService = null;</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; mKillButton.setEnabled(false);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; mCallbackText.setText(&quot;Disconnected.&quot;);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // As part of the sample, tell the user what happened.</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; Toast.makeText(Binding.this, R.string.remote_service_disconnected,</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Toast.LENGTH_SHORT).show();</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; }</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>};</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>/**</pre><pre style='text-indent:24.0pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; * Class for interacting with the secondary interface of the service.</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; */</pre><pre style='text-indent:24.0pt;
background:#FAFAFA;border:none;padding:0cm'>private ServiceConnection mSecondaryConnection = new ServiceConnection() {</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp;public void onServiceConnected(ComponentName className, IBinder service) {</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // Connecting to a secondary interface is the same as any</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // other interface.</pre><pre style='text-indent:
24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; mSecondaryService = ISecondary.Stub.asInterface(service);</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; mKillButton.setEnabled(true);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; }</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; public void onServiceDisconnected(ComponentName className) {</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; mSecondaryService = null;</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; mKillButton.setEnabled(false);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; }</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>};</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre style='text-indent:24.0pt;
background:#FAFAFA;border:none;padding:0cm'>private OnClickListener mBindListener = new OnClickListener() {</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp;public void onClick(View v) {</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // Establish a couple connections with the service, binding</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // by interface names. &nbsp;This allows other applications to be</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // installed that replace the remote service by implementing</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; // the same interface.</pre><pre style='text-indent:
24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp;bindService(new Intent(IRemoteService.class.getName()),</pre><pre style='text-indent:24.0pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mConnection, Context.BIND_AUTO_CREATE);</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bindService(new Intent(ISecondary.class.getName()),</pre><pre style='text-indent:24.0pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mSecondaryConnection, Context.BIND_AUTO_CREATE);</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; mIsBound = true;</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; mCallbackText.setText(&quot;Binding.&quot;);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; }</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>};</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre style='text-indent:24.0pt;
background:#FAFAFA;border:none;padding:0cm'>private OnClickListener mUnbindListener = new OnClickListener() {</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; public void onClick(View v) {</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp;if (mIsBound) {</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // If we have received the service, and hence registered with</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // it, then now is the time to unregister.</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (mService != null) {</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mService.unregisterCallback(mCallback);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (RemoteException e) {</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // There is nothing special we need to do if the service</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // has crashed.</pre><pre style='text-indent:24.0pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Detach our existing connection.</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unbindService(mConnection);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unbindService(mSecondaryConnection);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mKillButton.setEnabled(false);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mIsBound = false;</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mCallbackText.setText(&quot;Unbinding.&quot;);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp;}</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp;}</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>};</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre style='text-indent:24.0pt;
background:#FAFAFA;border:none;padding:0cm'>private OnClickListener mKillListener = new OnClickListener() {</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; public void onClick(View v) {</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// To kill the process hosting our service, we need to know its</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// PID. &nbsp;Conveniently our service has a call that will return</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// to us that information.</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (mSecondaryService != null) {</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int pid = mSecondaryService.getPid();</pre><pre style='text-indent:24.0pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Note that, though this API allows us to request to</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // kill any process based on its PID, the kernel will</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // still impose standard restrictions on which PIDs you</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // are actually able to kill. &nbsp;Typically this means only</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // the process running your application and any additional</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // processes created by that app as shown here; packages</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // sharing a common UID will also be able to kill each</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // other's processes.</pre><pre style='text-indent:
24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Process.killProcess(pid);<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mCallbackText.setText(&quot;Killed service process.&quot;);</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } catch (RemoteException ex) {</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Recover gracefully from the process hosting the</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // server dying.</pre><pre style='text-indent:
24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Just for purposes of the sample, put up a notification.</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Toast.makeText(Binding.this,</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;R.string.remote_call_failed,</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Toast.LENGTH_SHORT).show();</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; }</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; };</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>// ----------------------------------------------------------------------</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;// Code showing how to deal with callbacks.</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;// ----------------------------------------------------------------------</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp;</pre><pre style='text-indent:24.0pt;
background:#FAFAFA;border:none;padding:0cm'>/**</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; * This implementation is used to receive callbacks from the remote</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; * service.</pre><pre style='text-indent:
24.0pt;background:#FAFAFA;border:none;padding:0cm'>*/</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>private IRemoteServiceCallback mCallback = new IRemoteServiceCallback.Stub() {</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp;/**</pre><pre style='text-indent:24.0pt;
background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp;* This is called by the remote service regularly to tell us about</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp;* new values. &nbsp;Note that IPC calls are dispatched through a thread</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp;* pool running in each process, so the code executing here will</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp;* NOT be running in our main thread like most other things -- so,</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp;* to update the UI, we need to use a Handler to hop over there.</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; */</pre><pre style='text-indent:
24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp;public void valueChanged(int value) {</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp;mHandler.sendMessage(mHandler.obtainMessage(BUMP_MSG, value, 0));</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp;}</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>};</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>private static final int BUMP_MSG = 1;</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>private Handler mHandler = new Handler() {</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp;@Override public void handleMessage(Message msg) {</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp;switch (msg.what) {</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;case BUMP_MSG:</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mCallbackText.setText(&quot;Received from service: &quot; + msg.arg1);</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;break;</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;default:</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;super.handleMessage(msg);</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp; &nbsp; &nbsp; }</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>&nbsp; &nbsp;}</pre><pre
style='text-indent:24.0pt;background:#FAFAFA;border:none;padding:0cm'>};</pre><pre style='text-indent:24.0pt;background:
#FAFAFA;border:none;padding:0cm'>}</pre></div>

<p class=MsoNormal align=left style='text-align:left'>&nbsp;</p>

</div>

<br
clear=all style='page-break-before:auto'>



        



<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->