<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end --><!--end of htmlheader-->

<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->

<!--end of htmlmiddle-->



<div class="g-unit" id="gc-pagecontent">


<div id="jd-content">

<div class="jd-descr">
<h1>Android 应用程序模块: 应用, 任务, 进程, 和线程</h1>

<p>在大多数操作系统里，存在独立的一个1对1的可执行文件（如Windows里的exe文件）， 它可以产生进程，并能和界面图标、应用进行用户交互。但在Android里，这是不固定的，理解将这些分散的部分如何进行组合是非常重要的。</p>
<p>由于Android这种可灵活变通的，在实现一个应用不同部分时你需要理解一些基础技术：</p>
<ul>
<li>
  <p>一个<strong>android 包 </strong> (简称 <strong>.apk</strong> )
，里面包含应用程序的代码以及资源。这是一个应用发布，用户能下载并安装他们设备上的文件。</p>
</li>

<li>
  <p>一个 <strong>任务</strong> ，通常用户能当它为一个“应用程序”来启动：通常在桌面上会有一个图标可以来启动任务，这是一个上层的应用，可以将你的任务切换到前台来。</p>
</li>

<li>
  <p>一个 <strong>进程</strong> 是一个底层的代码运行级别的核心进程。通常.apk包里所有代码运行在一个进程里，一个进程对于一个.apk包；然而, 
进程 标签常用来改变代码运行的位置，可以是
全部的.apk包
或者是独立的
活动,
接收器,
服务, 或者
提供器组件。</p>
</li>
</ul>

<h2 id="Tasks">任务</h2>

<p>记住关键的一点：当用户看到的“应用”，无论实际是如何处理的，它都是一个任务。如果你仅仅通过一些活动来创建一个.apk包，其中有一个肯定是上层入口（通过动作的intent-filter 以及分类<code>android.intent.category.LAUNCHER</code>），然后你的.apk包就创建了一个单独任务，无论你启动哪个活动都会是这个任务的一部分。</p>

<p>一个任务，从使用者的观点，他是一个应用程序；对开发者来讲，它是贯穿活动着任务的一个或者多个视图，或者一个活动栈。当设置Intent.FLAG_ACTIVITY_NEW_TASK标志启动一个活动意图时，任务就被创建了；这个意图被用作任务的根用途，定义区分哪个任务。如果活动启动时没有这个标记将被运行在同一个任务里（除非你的活动以特殊模式被启动，这个后面会讨论）。如果你使用  FLAG_ACTIVITY_NEW_TASK标记并且这个意图的任务已经启动，任务将被切换到前台而不是重新加载。</p>

<p>FLAG_ACTIVITY_NEW_TASK必须小心使用：在用户看来，一个新的应用程序由此启动。如果这不是你期望的，你想要创建一个新的任务。另外，如果用户需要从桌面退出到他原来的地方然后使用同样的意图打开一个新的任务，你需要使用新的任务标记。否则，如果用户在你刚启动的任务里按桌面（HOME）键，而不是退出（BACK）键，你的任务以及任务的活动将被放在桌面程序的后面，没有办法再切换过去。</p>

<h3>任务亲和力（Affinities）</h3>

<p>一些情况下Android需要知道哪个任务的活动附属于一个特殊的任务，即使该任务还没有被启动。这通过任务亲和力来完成，它为任务中一个或多个可能要运行的活动提供一个独一无二的静态名字。默认为活动命名的任务亲和力的名字，就是实现该活动.apk包的名字。这提供一种通用的特性，对用户来说，所有在.apk包里的活动都是单一应用的一部分。</p>

<p>当不带
  Intent.FLAG_ACTIVITY_NEW_TASK 标记启动一个新的活动，任务亲和力对新启动的活动将没有影响作用：它将一直运行在它启动的那个任务里。然而，如果使用NEW_TASK标记，亲和力会检测已经存在的任务是否具有相同的亲和力。如果是，该任务会被切换到前台，新的活动会在任务的最上面被启动。</p>

<p>你可以在你的表现文件里的应用程序标签里为.apk包里所有的活动设置你自己的任务亲和力，当然也可以为单独的活动设置标签。这里有些例子演示如何使用：</p>

<ul>
<li>如果你的.apk包里包含多个用户可启动的上层应用程序，那么你可能想要为每个活动分配不同的亲和力。这里有一个不错的协定，你可以将不同的名字字串加上冒号附加在.apk包名字的后面  。 例如，"com.android.contacts"的亲和力命名可以是"com.android.contacts:Dialer" and
"com.android.contacts:ContactsList"。
</ul>
<li>如果你想替换一个通知，快捷键，或者其它能从外部启动的应用程序的内部活动，你需要在你想替换的活动里明确的设置任务亲和力(taskAffinity)。例如，如果你想替换联系人详细信息浏览界面（用户可以直接操作或者通过快捷方式调用），你需要设置任务亲和力(taskAffinity)为“com.android.contacts”。</li>
</ul>

<h3>启动模式以及启动标记</h3>

<p>你控制活动和任务通信的最主要的方法是通过设置启动模式的属性以及意图相应的标记。这两个参数能以不同的组合来共同控制活动的启动结果，这在相应的文档里有描述。这里我们只描述一些通用的用法以及几种不同的组合方式。</p>

<p>你最通常使用的模式是<code>singleTop</code>（除了默认为<code>standard</code>模式）。这不会对任务产生什么影响；仅仅是防止在栈顶多次启动同一个活动。
<p><code>singleTask</code>模式对任务有一些影响：它能使得活动总是在新的任务里被打开（或者将已经打开的任务切换到前台来）。使用这个模式需要加倍小心该进程是如何和系统其他部分交互的，它可能影响所有的活动。这个模式最好被用于应用程序入口活动的标记中。（支持MAIN活动和LAUNCHER分类）。</p>

<p><code>singleInstance</code>启动模式更加特殊，该模式只能当整个应用只有一个活动时使用。</p>

<p>有一种情况你会经常遇到，其它实体（如搜索管理器SearchManager 或者 通知管理器NotificationManager）会启动你的活动。这种情况下，你需要使用
  Intent.FLAG_ACTIVITY_NEW_TASK 标记，因为活动在任务（这个应用/任务还没有被启动）之外被启动。就像之前描述的一样， 这种情况下标准特性就是当前和任务和新的活动的亲和性匹配的任务将会切换到前台，然后在最顶端启动一个新的活动。当然，你也可以实现其它类型的特性。</p>

<p>一个常用的做法就是将Intent.FLAG_ACTIVITY_CLEAR_TOP 和NEW_TASK一起使用。这样做，如果你的任务已经处于运行中，任务将会被切换到前台来, 在栈里的所有的活动除了根活动，都将被清空，根活动的onNewIntent(Intent) 方法传入意图参数后被调用。当使用这种方法的时候   <code>singleTop</code> 或者 <code>singleTask</code>启动模式经常被使用，这样当前实例会被置入一个新的意图，而不是销毁原先的任务然后启动一个新的实例。</p>
<p>另外你可以使用的一个方法是设置活动的任务亲和力为空字串（表示没有亲和力），然后设置finishOnBackground属性。 如果你想让用户给你提供一个单独的活动描述的通知，倒不如返回到应用的任务里，这个比较管用。要指定这个属性，不管用户使用BACK还是HOME，活动都会结束；如果这个属性没有指定，按HOME键将会导致活动以及任务还留在系统里，并且没有办法返回到该任务里。  </p>
<p>请确保阅读过文档启动模式属性（launchMode attribute）
以及 意图标记（Intent flags） ，关注这些选项的详细信息。</p>

<h2 id="Processes">进程</h2>

<p>在Android中，进程是应用程序的完整实现，而不是用户通常了解的那样。他们主要用途很简单：</p>

<ul>
<li> 提高稳定性和安全性，将不信任或者不稳定的代码移动到其他进程。
<li> 可将多个.apk包运行在同一个进程里减少系统开销。
<li>帮助系统管理资源，将重要的代码放在一个单独的进程里，这样就可以单独销毁应用程序的其他部分。
</ul>

<p>像前面描述的一样，进程的属性被用来控制那些有特殊应用组件运行的进程。注意这个属性不能违反系统安全： 如果两个.apk包不能共享同一个用户ID，却试图运行在通一个进程里，这种情况是不被允许的，事实上系统将会创建两个不同的进程。</p>

<p>请查看<a href="../devel/security.html">安全</a>相关文档以获取更多关于安全限制方面的信息。</p>

<h2 id="Threads">线程</h2>

<p>每个进程包含一个或多个线程。多数情况下，Android 避免在进程里创建多余的线程，除非它创建它自己的线程，我们应保持应用程序的单线程性。 一个重要的结论就是所有呼叫实例, 广播接收器, 以及 服务的实例都是由这个进程里运行的主线程创建的。</p>

<p>注意新的线程<strong>不是</strong>为活动，广播接收器，服务或者内容提供器实例创建：这些应用程序的组件在进程里被实例化（除非另有说明，都在同一个进程处理），实际上是进程的主线程。这说明当系统调用时这些组件（包括服务）不需要进程远距离或者封锁操作（就像网络呼叫或者计算循环），因为这将阻止进程中的所有其他组件。你可以使用标准的HandlerThread
类去对其它线程执行远程操作。</p>

<p>这里有一些关于创建线程规则的例外：</p>

<ul>
<li>
  <p>呼叫IBinder或者IBinder实现的接口，如果该呼叫来自其他进程，你可以通过线程发送的IBinder或者本地进程中的线程池呼叫它们，从进程的主线程呼叫是不可以的。特殊情况下，,呼叫一个服务 的IBinder可以这样处理。（虽然在服务里呼叫方法在主线程里已经完成。）这意味着IBinder接口的实现必须要有一种线程安全的方法，这样任意线程才能同时访问它。</p>
</li>

<li>
  <p>呼叫由正在被调用的线程或者主线程以及IBinder派发的内容提供器 的主方法。被指定的方法在内容提供器的类里有记录。这意味着实现这些方法必须要有一种线程安全的模式，这样任意其它线程同时可以访问它。</p>
</li>

<li>呼叫视图以及由视图里正在运行的线程组成的子类。通常情况下，这会被作为进程的主线程，如果你创建一个线程并显示一个窗口，那么继承的窗口视图将从那个线程里启动。</li>
</ul>

</div>

</div>
</div><!-- end gc-pagecontent -->



<!--start of htmlend-->
<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
