<!--hmt-->
<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end --><!--end of htmlheader-->

<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->

<!--end of htmlmiddle-->



<h1> 5.9.5.8.&nbsp;如何修复表</h1>

            
          
        
        
        <p>本节描述如何对MyISAM表使用myisamchk(扩展名.MYI和.MYD)。</p>
        <p>你还可以(并且应该，如果可能)使用CHECK 
          TABLE和REPAIR 
          TABLE语句来检查和修复MyISAM表。参见<a href="maintenance-schedule.html" title="13.5.2.3. CHECK TABLE Syntax">13.5.2.3节，“CHECK 
          TABLE语法”</a>和<a href="maintenance-schedule.html" title="13.5.2.6. REPAIR TABLE Syntax">13.5.2.6节，“REPAIR 
          TABLE语法”</a>。</p>
        <p>一张损坏的表的症状通常是查询意外中断并且能看到下述错误：</p>
        <ul type="disc">
          <li> <tt >“<i>tbl_name</i>.frm”</tt>被锁定不能更改。</li>
          <li>不能找到文件<tt >“<i>tbl_name</i>.MYI”</tt>（Errcode：<i>nnn</i>）。</li>
          <li>文件意外结束。</li>
          <li>记录文件被毁坏。</li>
          <li>从表处理器得到错误<i>nnn</i>。</li>
        </ul>
        <p>要想得到错误相关的详细信息，你可以运行perror <i> nnn</i>，其中<i>nnn</i>为错误编号。下面的示例显示了如何使用perror来找到最常用错误编号（用表的方式指出问题）的含义：</p>
        <pre>shell&gt; perror 126 127 132 134 135 136 141 144 145
126 = Index file is crashed / Wrong file format
127 = Record-file is crashed
132 = Old database file
134 = Record was already deleted (or record file crashed)
135 = No more room in record file
136 = No more room in index file
141 = Duplicate unique key or constraint on write or update
144 = Table is crashed and last repair failed</pre>
        <p>145 = Table was marked as 
          crashed and should be repaired</p>
        <p>请注意错误135(记录文件中没有更多的空间)和错误136(索引文件中没有更多的空间)不是可以通过简单修复可以修复的错误。在这种情况下，必须使用ALTER 
          TABLE来增加MAX_ROWS和AVG_ROW_LENGTH表选项值：</p>
        <pre>ALTER TABLE <i>tbl_name</i> MAX_ROWS=<i>xxx</i> AVG_ROW_LENGTH=<i>yyy</i>;</pre>
        <p>如果你不知道当前的表的选项值，使用SHOW 
          CREATE TABLE或DESCRIBE来查询。</p>
        <p>对于其它的错误，你必须修复表。myisamchk通常可以检测和修复大多数问题。</p>
        <p>修复过程包括四个阶段，此处将进行描述。开始修复前，应进入数据库目录并检查表文件的许可。在Unix中，确保它们对于运行mysqld的用户可读(你也应可读，因为你需要访问检查的文件)。如果你需要修改文件，你还必须拥有写访问权限。</p>
        <p>用myisamchk修复表的选项的描述参见<a href="myisamchk.html" title="5.9.5. myisamchk — MyISAM Table-Maintenance Utility">5.9.5节，“myisamchk：MyISAM表维护实用工具”</a>的前几节。</p>
        <p>下面几节列出了上述命令失败或你想要使用myisamchk提供的扩展特性等情况的例子。</p>
        <p>如果你要通过命令行来修复表，必须首先停止mysqld服务器。请注意当你在远程服务器上运行mysqladmin 
          shutdown时，mysqladmin返回后，mysqld服务器将仍然运行一会儿，直到停止所有查询并将所有键清空到硬盘上。</p>
        <p> 阶段1：检查你的表</p>
        <p>如果你有很多时间，运行myisamchk 
          *.MYI或myisamchk 
          -e *.MYI。使用-s（沉默）选项禁止不必要的信息。</p>
        <p>如果mysqld服务器处于宕机状态，应使用--update-state选项来告诉myisamchk将表标记为&#39;检查过的&#39;。</p>
        <p> 你必须只修复那些myisamchk报告有错误的表。对这样的表，继续到阶段2。</p>
        <p>如果在检查时，你得到奇怪的错误(例如out 
          of memory错误)，或如果myisamchk崩溃，到阶段3。</p>
        <p> 阶段2：简单安全的修复</p>
        <p>注释：如果想更快地进行修复，当运行myisamchk时，你应将sort_buffer_size和Key_buffer_size变量的值设置为可用内存的大约25%。</p>
        <p>首先，试试myisamchk 
          -r -q <i>tbl_name</i>(-r 
          -q意味着“快速恢复模式”)。这将试图不接触数据文件来修复索引文件。如果数据文件包含它应有的一切内容和指向数据文件内正确地点的删除连接，这应该管用并且表可被修复。开始修复下一张表。否则，执行下列过程：</p>
        <ol start="1" type="1">
          <li>在继续前对数据文件进行备份。 </li>
          <li>使用myisamchk 
            -r <i>tbl_name</i>(-r意味着“恢复模式”)。这将从数据文件中删除不正确的记录和已被删除的记录并重建索引文件。 </li>
          <li>如果前面的步骤失败，使用myisamchk 
            --safe-recover <i>tbl_name</i>。安全恢复模式使用一个老的恢复方法，处理常规恢复模式不行的少数情况(但是更慢)。 </li>
        </ol>
        <p>如果在修复时，你得到奇怪的错误(例如out 
          of memory错误)，或如果myisamchk崩溃，到阶段3。</p>
        <p> 阶段3：困难的修复</p>
        <p> 只有在索引文件的第一个16K块被破坏，或包含不正确的信息，或如果索引文件丢失，你才应该到这个阶段。在这种情况下，需要创建一个新的索引文件。按如下步骤操做：</p>
        <ol start="1" type="1">
          <li>把数据文件移到安全的地方。</li>
          <li>使用表描述文件创建新的(空)数据文件和索引文件：</li>
          <li>shell&gt; mysql <i> db_name</i></li>
          <li>mysql&gt; SET 
            AUTOCOMMIT=1;</li>
          <li>mysql&gt; TRUNCATE 
            TABLE <i>tbl_name</i>;</li>
          <li>mysql&gt; quit</li>
        </ol>
        <p>如果你的MySQL版本没有TRUNCATE 
          TABLE，则使用DELETE 
          FROM <i>tbl_name</i>。</p>
        <ol start="7" type="1">
          <li> 将老的数据文件拷贝到新创建的数据文件之中。（不要只是将老文件移回新文件之中；你要保留一个副本以防某些东西出错。） </li>
        </ol>
        <p>回到阶段2。现在myisamchk 
          -r -q应该工作了。（这不应该是一个无限循环）。</p>
        <p>你还可以使用REPAIR 
          TABLE <i>tbl_name</i> USE_FRM，将自动执行整个程序。</p>
        <p> 阶段4：非常困难的修复 </p>
        <p> 只有.frm描述文件也破坏了，你才应该到达这个阶段。这应该从未发生过，因为在表被创建以后，描述文件就不再改变了。</p>
        <ol start="1" type="1">
          <li>从一个备份恢复描述文件然后回到阶段3。你也可以恢复索引文件然后回到阶段2。对后者，你应该用myisamchk 
            -r启动。</li>
          <li> 如果你没有进行备份但是确切地知道表是怎样创建的，在另一个数据库中创建表的一个拷贝。删除新的数据文件，然后从其他数据库将描述文件和索引文件移到破坏的数据库中。这样提供了新的描述和索引文件，但是让.MYD数据文件独自留下来了。回到阶段2并且尝试重建索引文件。</li>
        </ol>
      
      
        
          
            
              


<!--start of htmlend-->
<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->