<!--hmt-->
<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end --><!--end of htmlheader-->

<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->

<!--end of htmlmiddle-->



<h1> 15.2.3 .&nbsp;InnoDB配置</h1>

            
          
        
        <p> InnoDB存储引擎是默认地被允许的。如果你不想用InnoDB表，你可以添加skip-innodb选项到MySQL选项文件。</p>
        <p>被InnoDB存储引擎管理的两个重要的基于磁盘的资源是InnoDB表空间数据文件和它的日志文件。</p>
        <p>如果你指定无InnoDB配置选项，MySQL将在MySQL数据目录下创建一个名为ibdata1的10MB大小的自动扩展数据文件，以及两个名为ib_logfile0和ib_logfile
          1的5MB大小的日志文件。
        </p>
        <p>注释：InnoDB给MySQL提供具有提交，
          回滚和崩溃恢复能力的事务安全（ACID兼容）存储引擎。如果拟运行的操作系统和硬件不能如广告说的那样运行，InnoDB就不能实现如上能力。许多操作系统或磁盘子系统可能为改善性能而延迟或记录写操作。在一些操作系统上，就是系统调用（fsync()）  
          也要等着，直到所有未写入已被刷新文件的数据在被刷新到稳定内存之前可以确实返回了。因为这个，操作系统崩溃或掉电可能损坏当前提交的数据，或者在最坏的  
          情况，因为写操作已被记录了，甚至破坏了数据库。如果数据完整性对你很重要，你应该在用任何程序于生产中之前做一些&ldquo;pull-the-plug&rdquo;测试。Mac OS X 10.3 及以后版本，InnoDB使用一个特别的fcntl()文件
          刷新方法。在Linux下，建议禁止回写缓存。</p>
        <p>在ATAPI硬盘上，一个类似hdparm -W0 /dev/<i>hda</i>命令可能起作用。小心某些驱动器或者磁盘控制器可能不能禁止回写缓存。
          
        </p>
        <p>注释：要获得好的性能，你应该如下面例子所讨论那样，明确提供InnoDB参数。自然地，你应该编辑设置来适合你的硬件和要求。
          
        </p>
        <p>要建立InnoDB表空间文件，在my.cnf选项文件里的[mysqld]节里使用innodb_data_file_path选项。在Windows上，你可以替代地使用my.ini文件。innodb_data_file_path的值应该为一个或多个
          数据文件规格的列表。如果你命名一个以上的数据文件，用        
          分号(&lsquo;;&rsquo;)分隔它们：
          
        </p>
        <pre>innodb_data_file_path=<i>datafile_spec1</i>[;<i>datafile_spec2</i>]...
</pre>
        <p>例如：把明确创建的具有相同特征的表空间作为默认设置的设置操作如下：
          
        </p>
        <pre>[mysqld]

innodb_data_file_path=ibdata1:10M:autoextend
</pre>
        <p>这个设置配置一个可扩展大小的尺寸为10MB的单独文件，名为ibdata1。没有给出文件的位置，所以默认的是在MySQL的数据目录内。
          
        </p>
        <p>尺寸大小用M或者G后缀来指定说明单位是MB或者GB。</p>
        <p>一个表空间，它在数据目录里包含一个名为ibdata1的固定尺寸50MB的数据文件和一个名为ibdata
          2大小为50MB的自动扩展文件，其可以
            像这样被配置：
            
          
        </p>
        <pre>[mysqld]

innodb_data_file_path=ibdata1:50M;ibdata2:50M:autoextend
</pre>
        <p>一个指定数据文件的完全后缀包括文件名，它的尺寸和数个可选属性：
          
        </p>
        <pre><i>file_name</i>:<i>file_size</i>[:autoextend[:max:<i>max_file_size</i>]]
</pre>
        <p> autoextend属性和后面跟着的属性只可被用来对innodb_data_file_path行里最后一个数据文件。
          
        </p>
        <p>如果你对最后的数据文件指定autoextend选项。如果数据文件耗尽了表空间中的自由空间，InnoDB就扩展数据文件。扩展的幅度是每次8MB。</p>
        <p>如果磁盘已满，你可能想要把其它数据添加到另一个硬盘上。重新配置一个已存在表空间的指令见<a href="adding-and-removing.html" title="15.2.7.&nbsp;Adding and Removing InnoDB Data and Log Files">15.2.7节，“添加和删除InnoDB数据和日志文件&rdquo;</a>。
          
        </p>
        <p>InnoDB并不感知最大文件尺寸，所以要小心文件系统，在那上面最大的文件尺寸是2GB。要为一个自动扩展数据文件指定最大尺寸，请使用max属性。下列配置允许ibdata1涨到极限的500MB：</p>
        <pre>[mysqld]

innodb_data_file_path=ibdata1:10M:autoextend:max:500M
</pre>
        <p>InnoDB默认地在MySQL数据目录创建表空间文件。要明确指定一个位置，请使用innodb_data_home_dir选项。比如，要使用两个名为ibdata1和ibdata2的文件，但是要把他们创建到/ibdata，
          像如下一样配置InnoDB：</p>
        <pre>[mysqld]

innodb_data_home_dir = /ibdata

innodb_data_file_path=ibdata1:50M;ibdata2:50M:autoextend
</pre>
        <p>注释：InnoDB不创建目录，所以在启动服务器之前请确认/ibdata目录的确存在。这对你配置的任何日志文件目录来说也是真实的。使用Unix或DOS的mkdir命令来创建任何必需的目录。</p>
        <p>通过把innodb_data_home_dir的值原原本本地部署到数据文件名，并在需要的地方添加斜杠或反斜杠，InnoDB为每个数据文件形成目录路径。如果innodb_data_home_dir选项根本没有在my.cnf中提到，
          默认值是&ldquo;dot&rdquo;目录 ./，这意思是MySQL数据目录。
          
        </p>
        <p>如果你指定innodb_data_home_dir为一个空字符串，你可以为列在innodb_data_file_path值里的数据文件指定绝对路径。下面的例子等价于前面那个例子：</p>
        <pre>[mysqld]

innodb_data_home_dir =

innodb_data_file_path=/ibdata/ibdata1:50M;/ibdata/ibdata2:50M:autoextend
</pre>
        <p>一个简单的my.cnf例子。假设你有一台配备128MB内存和一个硬盘的计算机。下面的例子显示在my.cnf或my.ini里对InnoDB可能的配置参数，包括autoextend属性。</p>
        <p>这个例子适合大多数在Unix和Windows上，不想分配InnoDB数据文件和日志文件到数个磁盘上的用户。它在MySQL数据目录创建一个自动扩展数据文件ibdata1和两个日志文件ib_logfile0及ib_logfile
          1。同样，InnoD在数据目录里自动创建的小型档案InnoDB日志文件ib_arch_log_0000000000也结束。
            
          
        </p>
        <pre>[mysqld]

# You can write your other MySQL server options here

# ...

# Data files must be able to hold your data and indexes.

# Make sure that you have enough free disk space.

innodb_data_file_path = ibdata1:10M:autoextend

#

# Set buffer pool size to 50-80% of your computer's memory

set-variable = innodb_buffer_pool_size=70M

set-variable = innodb_additional_mem_pool_size=10M

#

# Set the log file size to about 25% of the buffer pool size

set-variable = innodb_log_file_size=20M

set-variable = innodb_log_buffer_size=8M

#

innodb_flush_log_at_trx_commit=1
</pre>
        <p>请确认MySQL服务器有适当的权限在数据目录里创建文件。更一般地，服务器必须对任何它需要创建数据文件或日志文件的目录有访问权限。</p>
        <p>注意，在一些文件系统上，数据文件必需小于2GB。数据文件的合并尺寸必须至少10MB。
          
        </p>
        <p>当你第一次创建一个InnoDB表空间，最好从命令行来启动MySQL服务器。InnoDB然后把数据库创建的信息打印到屏幕，所以你可以看见正在发生什么。比如，在Windows上，如果mysqld-max位于C:\mysql\bin，你可以如下来启动它：</p>
        <pre>C:\&gt; C:\mysql\bin\mysqld-max --console
</pre>
        <p>如果你不发送服务器输出到屏幕上，请检查服务器的错误日志来看在启动过程中InnoDB打印了什么。</p>
        <p>请参阅<a href="innodb-init.html" title="15.2.5.&nbsp;Creating the InnoDB Tablespace">15.2.5节，“创建InnoDB表空间&rdquo;</a>，以获得InnoDB显示的信息看起来应该
          像什么的例子。
          
        </p>
        <p>Windows上如何指定选项?  
          在Windows上选项文件的规则如下：</p>
        
          <p> &middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            只应该创建一个my.cnf或文件。</p>
          <p> &middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            my.cnf文件应该被放在C盘根目录。</p>
          <p> &middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            my.ini文件应该被放置在WINDIR目录；例如C:\WINDOWS或C:\WINNT。你可以在Windows控制台的命令提示符使用SET命令来打印WINDIR的值：
            
          </p>
          <pre>&middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; C:\&gt; SET WINDIR

&middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; windir=C:\WINNT
</pre>
          <p> &middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            如果你的PC在C盘不是启动盘的地方使用启动装载机，你唯一的选择是使用my.ini文件。
            
          </p>
          <p> &middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
            如果你使用安装和配置向导安装的MySQL，my.ini文件被放在MySQL的安装目录。请参阅<a href="" title="2.3.5.14.&nbsp;The Location of the my.ini File">2.3.5.14节，“my.ini文件的位置&rdquo;</a>。
            
          </p>
        
        <p>Unix上在哪里指定选项？ 在Unix上，mysqld从下列文件，如果它们存在的话。以下列的顺序读取选项：
          
        </p>
        
          <p> &middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            /etc/my.cnf
            
          </p>
          <p>全局选项。</p>
          <p> &middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            $MYSQL_HOME/my.cnf
            
          </p>
          <p>服务器专用选项。</p>
          <p> &middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            defaults-extra-file
            
          </p>
          <p> --defaults-extra-file选项指定的文件。</p>
          <p> &middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            ~/.my.cnf
            
          </p>
          <p>用户专用选项。</p>
        
        <p>MYSQL_HOME代表环境变量，它内含着到包含服务器专用my.cnf文件的目录的路径。
          
        </p>
        <p>如果你确信mysqld只从指定文件读取选项，你可以在启动服务器之时在命令行使用--defaults-option作为第一个选项：
          
        </p>
        <pre>mysqld --defaults-file=your_path_to_my_cnf
</pre>
        <p>一个高级的my.cnf例子。假设你有一台Linux计算机，有2GB内存和三个60GB硬盘（在目录路径/, /dr2和/dr3)。下列例子显示
          了在my.cnf里对InnoDB可能的配置参数。</p>
        <pre>[mysqld]

# You can write your other MySQL server options here

# ...

innodb_data_home_dir =

#

# Data files must be able to hold your data and indexes

innodb_data_file_path = /ibdata/ibdata1:2000M;/dr2/ibdata/ibdata2:2000M:autoextend

#

# Set buffer pool size to 50-80% of your computer's memory,

# but make sure on Linux x86 total memory usage is &lt; 2GB

innodb_buffer_pool_size=1G

innodb_additional_mem_pool_size=20M

innodb_log_group_home_dir = /dr3/iblogs

#

innodb_log_files_in_group = 2

#

# Set the log file size to about 25% of the buffer pool size

innodb_log_file_size=250M

innodb_log_buffer_size=8M

#

innodb_flush_log_at_trx_commit=1

innodb_lock_wait_timeout=50

#

# Uncomment the next lines if you want to use them

#innodb_thread_concurrency=5
</pre>
        <p>注意，该例子把两个数据文件放在不同磁盘上。InnoDB开始用第一个数据文件填充表空间。在一些情况下，如果所有数据不被放置在同一物理磁盘上，这样将改善数据库的性能。把日志文件放在与数据文件不同的磁盘上对性能是经常很有好处的。你也可以使用原始磁盘分区（原始设备）作为InnoDB数据文件，这样可以加速I/O。请参阅<a href="innodb-raw-devices.html" title="15.2.14.2.&nbsp;Using Raw Devices for the Tablespace">15.2.14.2节，“为表空间使用原始设备&rdquo;</a>。
          
        </p>
        <p>警告：在32位GNU/Linux x86上,你必须要小心不要设置过高的内存用量。glibc可能允许进程堆积在线程堆栈上发展，它会造成你的服务器崩溃。如果下列表达式的值接近或者超过2GB，系统会面临危机：</p>
        <pre>innodb_buffer_pool_size

+ key_buffer_size

+ max_connections*(sort_buffer_size+read_buffer_size+binlog_cache_size)

+ max_connections*2MB
</pre>
        <p>每个线程使用一个堆栈（通常是2MB，但在MySQL
          AB二进制
          分发版里只有256KB）并且在最坏的情况下也使用sort_buffer_size + read_buffer_size附加内存。
        </p>
        <p>你可以自己编译MySQL，在32位Windows上使用高达64GB物理内存。请参阅<a href="innodb-start.html" title="15.2.4.&nbsp;InnoDB Startup Options">15.2.4节，“InnoDB启动选项&rdquo;</a>里对innodb_buffer_pool_awe_mem_mb的描述。
          
        </p>
        <p>如何调整其它mysqld服务器参数？下列值是典型的，且适用于多数用户：</p>
        <pre>[mysqld]

skip-external-locking

max_connections=200

read_buffer_size=1M

sort_buffer_size=1M

#

# Set key_buffer to 5 - 50% of your RAM depending on how much

# you use MyISAM tables, but keep key_buffer_size + InnoDB

# buffer pool size &lt; 80% of your RAM

key_buffer_size=<i>value</i>
</pre>
      
      
        
          
            
              


<!--start of htmlend-->
<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->