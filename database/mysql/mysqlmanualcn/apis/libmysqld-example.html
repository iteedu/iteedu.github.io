<!--hmt-->
<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end --><!--end of htmlheader-->

<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->

<!--end of htmlmiddle-->



<h1> 25.1.6.&nbsp;嵌入式服务器示例</h1>

          
        
      
      <p>在Linux或FreeBSD系统上，无需更改就能使用下面这两个示例程序。对于其他操作系统，需要进行小的修改，主要是文件路径。设计这两个示例的目的在于，为你提供足够的细节信息，以便理解问题，它们是实际应用程序的必要组成部份。第1个示例十分直观。第2个示例采用了一些错误检查功能，略为复杂。在第1个示例的后面，给出了用于编译程序的命令行条目。在第2个示例的后面，给出了GNUmake文件，该文件可用于编译。</p>
      <p>示例：1 </p>
      <p>test1_libmysqld.c </p>
      <pre>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdarg.h&gt;
#include &quot;mysql.h&quot;
&nbsp;
MYSQL *mysql;
MYSQL_RES *results;
MYSQL_ROW record;
&nbsp;
static char *server_options[] = { &quot;mysql_test&quot;, &quot;--defaults-file=my.cnf&quot; };
int num_elements = sizeof(server_options)/ sizeof(char *);
&nbsp;
static char *server_groups[] = { &quot;libmysqld_server&quot;, &quot;libmysqld_client&quot; };
&nbsp;
int main(void)
{
&nbsp;&nbsp; mysql_server_init(num_elements, server_options, server_groups);
&nbsp;&nbsp; mysql = mysql_init(NULL);
&nbsp;&nbsp; mysql_options(mysql, MYSQL_READ_DEFAULT_GROUP, &quot;libmysqld_client&quot;);
&nbsp;&nbsp; mysql_options(mysql, MYSQL_OPT_USE_EMBEDDED_CONNECTION, NULL);
&nbsp;
&nbsp;&nbsp; mysql_real_connect(mysql, NULL,NULL,NULL, &quot;database1&quot;, 0,NULL,0);
&nbsp;
&nbsp;&nbsp; mysql_query(mysql, &quot;SELECT column1, column2 FROM table1&quot;);
&nbsp;
&nbsp;&nbsp; results = mysql_store_result(mysql);
&nbsp;
&nbsp;&nbsp; while((record = mysql_fetch_row(results))) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf(&quot;%s - %s \n&quot;, record[0], record[1]);
&nbsp;&nbsp; }
&nbsp;
&nbsp;&nbsp; mysql_free_result(results);
&nbsp;&nbsp; mysql_close(mysql);
&nbsp;&nbsp; mysql_server_end();
&nbsp;
&nbsp;&nbsp; return 0;
}</pre>
      <p>下面给出了编译上述程序的命令行命令：</p>
      <pre>gcc test1_libmysqld.c -o test1_libmysqld -lz \
 `/usr/local/mysql/bin/mysql_config --include --libmysqld-libs`</pre>
      <p>示例：2 </p>
      <p>要想检验该示例，创建一个与MySQL源目录同级的test2_libmysqld目录。将test2_libmysqld.c源文件和GNUmakefile保存到该目录，并在test2_libmysqld目录下运行GNU
        make。</p>
      <p>test2_libmysqld.c </p>
      <pre>/*
 * A simple example client, using the embedded MySQL server library
*/
&nbsp;
#include &lt;mysql.h&gt;
#include &lt;stdarg.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
&nbsp;
MYSQL *db_connect(const char *dbname);
void db_disconnect(MYSQL *db);
void db_do_query(MYSQL *db, const char *query);
&nbsp;
const char *server_groups[] = {
&nbsp; &quot;test2_libmysqld_SERVER&quot;, &quot;embedded&quot;, &quot;server&quot;, NULL
};
&nbsp;
int
main(int argc, char **argv)
{
&nbsp; MYSQL *one, *two;
&nbsp;
&nbsp; /* mysql_server_init() must be called before any other mysql
&nbsp;&nbsp; * functions.
&nbsp;&nbsp; *
&nbsp;&nbsp; * You can use mysql_server_init(0, NULL, NULL), and it
&nbsp;&nbsp; * initializes the server using groups = {
&nbsp;&nbsp; *&nbsp;&nbsp; &quot;server&quot;, &quot;embedded&quot;, NULL
&nbsp;&nbsp; *&nbsp; }.
&nbsp;&nbsp; *
&nbsp;&nbsp; * In your $HOME/.my.cnf file, you probably want to put:
&nbsp;
[test2_libmysqld_SERVER]
language = /path/to/source/of/mysql/sql/share/english
&nbsp;
&nbsp;&nbsp; * You could, of course, modify argc and argv before passing
&nbsp;&nbsp; * them to this function.&nbsp; Or you could create new ones in any
&nbsp;&nbsp; * way you like.&nbsp; But all of the arguments in argv (except for
&nbsp;&nbsp; * argv[0], which is the program name) should be valid options
&nbsp;&nbsp; * for the MySQL server.
&nbsp;&nbsp; *
&nbsp;&nbsp; * If you link this client against the normal mysqlclient
&nbsp;&nbsp; * library, this function is just a stub that does nothing.
&nbsp;&nbsp; */
&nbsp; mysql_server_init(argc, argv, (char **)server_groups);
&nbsp;
&nbsp; one = db_connect(&quot;test&quot;);
&nbsp; two = db_connect(NULL);
&nbsp;
&nbsp; db_do_query(one, &quot;SHOW TABLE STATUS&quot;);
&nbsp; db_do_query(two, &quot;SHOW DATABASES&quot;);
&nbsp;
&nbsp; mysql_close(two);
&nbsp; mysql_close(one);
&nbsp;
&nbsp; /* This must be called after all other mysql functions */
&nbsp; mysql_server_end();
&nbsp;
&nbsp; exit(EXIT_SUCCESS);
}
&nbsp;
static void
die(MYSQL *db, char *fmt, ...)
{
&nbsp; va_list ap;
&nbsp; va_start(ap, fmt);
&nbsp; vfprintf(stderr, fmt, ap);
&nbsp; va_end(ap);
&nbsp; (void)putc(&#39;\n&#39;, stderr);
&nbsp; if (db)
&nbsp;&nbsp;&nbsp; db_disconnect(db);
&nbsp; exit(EXIT_FAILURE);
}
&nbsp;
MYSQL *
db_connect(const char *dbname)
{
&nbsp; MYSQL *db = mysql_init(NULL);
&nbsp; if (!db)
&nbsp;&nbsp;&nbsp; die(db, &quot;mysql_init failed: no memory&quot;);
&nbsp; /*
&nbsp;&nbsp; * Notice that the client and server use separate group names.
&nbsp;&nbsp; * This is critical, because the server does not accept the
&nbsp;&nbsp; * client&#39;s options, and vice versa.
&nbsp;&nbsp; */
&nbsp; mysql_options(db, MYSQL_READ_DEFAULT_GROUP, &quot;test2_libmysqld_CLIENT&quot;);
&nbsp; if (!mysql_real_connect(db, NULL, NULL, NULL, dbname, 0, NULL, 0))
&nbsp;&nbsp;&nbsp; die(db, &quot;mysql_real_connect failed: %s&quot;, mysql_error(db));
&nbsp;
&nbsp; return db;
}
&nbsp;
void
db_disconnect(MYSQL *db)
{
&nbsp; mysql_close(db);
}
&nbsp;
void
db_do_query(MYSQL *db, const char *query)
{
&nbsp; if (mysql_query(db, query) != 0)
&nbsp;&nbsp;&nbsp; goto err;
&nbsp;
&nbsp; if (mysql_field_count(db) &gt; 0)
&nbsp; {
&nbsp;&nbsp;&nbsp; MYSQL_RES&nbsp;&nbsp; *res;
&nbsp;&nbsp;&nbsp; MYSQL_ROW&nbsp;&nbsp;&nbsp; row, end_row;
&nbsp;&nbsp;&nbsp; int num_fields;
&nbsp;
&nbsp;&nbsp;&nbsp; if (!(res = mysql_store_result(db)))
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;goto err;
&nbsp;&nbsp;&nbsp; num_fields = mysql_num_fields(res);
&nbsp;&nbsp;&nbsp; while ((row = mysql_fetch_row(res)))
&nbsp;&nbsp;&nbsp; {
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(void)fputs(&quot;&gt;&gt; &quot;, stdout);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (end_row = row + num_fields; row &lt; end_row; ++row)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (void)printf(&quot;%s\t&quot;, row ? (char*)*row : &quot;NULL&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (void)fputc(&#39;\n&#39;, stdout);
&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; (void)fputc(&#39;\n&#39;, stdout);
&nbsp;&nbsp;&nbsp; mysql_free_result(res);
&nbsp; }
&nbsp; else
&nbsp;&nbsp;&nbsp; (void)printf(&quot;Affected rows: %lld\n&quot;, mysql_affected_rows(db));
&nbsp;
&nbsp; return;
&nbsp;
err:
&nbsp; die(db, &quot;db_do_query failed: %s [%s]&quot;, mysql_error(db), query);
}</pre>
      <p>GNUmakefile </p>
      <pre># This assumes the MySQL software is installed in /usr/local/mysql
inc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; := /usr/local/mysql/include/mysql
lib&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; := /usr/local/mysql/lib
&nbsp;
# If you have not installed the MySQL software yet, try this instead
#inc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; := $(HOME)/mysql-5.1/include
#lib&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; := $(HOME)/mysql-5.1/libmysqld
&nbsp;
CC &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= gcc
CPPFLAGS := -I$(inc) -D_THREAD_SAFE -D_REENTRANT
CFLAGS&nbsp;&nbsp; := -g -W -Wall
LDFLAGS&nbsp; := -static
# You can change -lmysqld to -lmysqlclient to use the
# client/server library
LDLIBS&nbsp;&nbsp;&nbsp; = -L$(lib) -lmysqld -lz -lm -lcrypt
&nbsp;
ifneq (,$(shell grep FreeBSD /COPYRIGHT 2&gt;/dev/null))
# FreeBSD
LDFLAGS += -pthread
else
# Assume Linux
LDLIBS += -lpthread
endif
&nbsp;
# This works for simple one-file test programs
sources := $(wildcard *.c)
objects := $(patsubst %c,%o,$(sources))
targets := $(basename $(sources))
&nbsp;
all: $(targets)
&nbsp;
clean:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rm -f $(targets) $(objects) *.core</pre>
    
    
      
        
          
            


<!--start of htmlend-->
<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->