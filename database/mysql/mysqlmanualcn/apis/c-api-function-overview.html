<!--hmt-->
<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end --><!--end of htmlheader-->

<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->

<!--end of htmlmiddle-->



<h1> 25.2.2.&nbsp;C API函数概述</h1>

          
        
      
      
      <p>这里归纳了C API可使用的函数，并在下一节详细介绍了它们。请参见<a href="c-api-functions.html" title="25.2.3. C API Function Descriptions">25.2.3节，“C API函数描述”</a>。</p>
      <table border="1" cellpadding="0" id="table5">
        <tr>
          <td><p> 函数</td>
          <td><p> 描述</td>
        </tr>
        <tr>
          <td><p> mysql_affected_rows()</td>
          <td><p>返回上次UPDATE、DELETE或INSERT查询更改／删除／插入的行数。</td>
        </tr>
        <tr>
          <td><p> mysql_autocommit()</td>
          <td><p>切换 autocommit模式，ON/OFF</td>
        </tr>
        <tr>
          <td><p> mysql_change_user()</td>
          <td><p>更改打开连接上的用户和数据库。</td>
        </tr>
        <tr>
          <td><p> mysql_charset_name()</td>
          <td><p>返回用于连接的默认字符集的名称。</td>
        </tr>
        <tr>
          <td><p> mysql_close()</td>
          <td><p>关闭服务器连接。</td>
        </tr>
        <tr>
          <td><p> mysql_commit()</td>
          <td><p>提交事务。</td>
        </tr>
        <tr>
          <td><p> mysql_connect()</td>
          <td><p>连接到MySQL服务器。该函数已不再被重视，使用mysql_real_connect()取代。</td>
        </tr>
        <tr>
          <td><p> mysql_create_db()</td>
          <td><p>创建数据库。该函数已不再被重视，使用SQL语句CREATE 
              DATABASE取而代之。</td>
        </tr>
        <tr>
          <td><p> mysql_data_seek()</td>
          <td><p>在查询结果集中查找属性行编号。</td>
        </tr>
        <tr>
          <td><p> mysql_debug()</td>
          <td><p>用给定的字符串执行DBUG_PUSH。</td>
        </tr>
        <tr>
          <td><p> mysql_drop_db()</td>
          <td><p>撤销数据库。该函数已不再被重视，使用SQL语句DROP 
              DATABASE取而代之。</td>
        </tr>
        <tr>
          <td><p> mysql_dump_debug_info()</td>
          <td><p>让服务器将调试信息写入日志。</td>
        </tr>
        <tr>
          <td><p> mysql_eof()</td>
          <td><p>确定是否读取了结果集的最后一行。该函数已不再被重视，可以使用mysql_errno()或mysql_error()取而代之。</td>
        </tr>
        <tr>
          <td><p> mysql_errno()</td>
          <td><p>返回上次调用的MySQL函数的错误编号。</td>
        </tr>
        <tr>
          <td><p> mysql_error()</td>
          <td><p>返回上次调用的MySQL函数的错误消息。</td>
        </tr>
        <tr>
          <td><p> mysql_escape_string()</td>
          <td><p>为了用在SQL语句中，对特殊字符进行转义处理。</td>
        </tr>
        <tr>
          <td><p> mysql_fetch_field()</td>
          <td><p>返回下一个表字段的类型。</td>
        </tr>
        <tr>
          <td><p> mysql_fetch_field_direct()</td>
          <td><p>给定字段编号，返回表字段的类型。</td>
        </tr>
        <tr>
          <td><p> mysql_fetch_fields()</td>
          <td><p>返回所有字段结构的数组。</td>
        </tr>
        <tr>
          <td><p> mysql_fetch_lengths()</td>
          <td><p>返回当前行中所有列的长度。</td>
        </tr>
        <tr>
          <td><p> mysql_fetch_row()</td>
          <td><p>从结果集中获取下一行</td>
        </tr>
        <tr>
          <td><p> mysql_field_seek()</td>
          <td><p>将列光标置于指定的列。</td>
        </tr>
        <tr>
          <td><p> mysql_field_count()</td>
          <td><p>返回上次执行语句的结果列的数目。</td>
        </tr>
        <tr>
          <td><p> mysql_field_tell()</td>
          <td><p>返回上次mysql_fetch_field()所使用字段光标的位置。</td>
        </tr>
        <tr>
          <td><p> mysql_free_result()</td>
          <td><p>释放结果集使用的内存。</td>
        </tr>
        <tr>
          <td><p> mysql_get_client_info()</td>
          <td><p>以字符串形式返回客户端版本信息。</td>
        </tr>
        <tr>
          <td><p> mysql_get_client_version()</td>
          <td><p>以整数形式返回客户端版本信息。</td>
        </tr>
        <tr>
          <td><p> mysql_get_host_info()</td>
          <td><p>返回描述连接的字符串。</td>
        </tr>
        <tr>
          <td><p> mysql_get_server_version()</td>
          <td><p>以整数形式返回服务器的版本号。</td>
        </tr>
        <tr>
          <td><p> mysql_get_proto_info()</td>
          <td><p>返回连接所使用的协议版本。</td>
        </tr>
        <tr>
          <td><p> mysql_get_server_info()</td>
          <td><p>返回服务器的版本号。</td>
        </tr>
        <tr>
          <td><p> mysql_info()</td>
          <td><p>返回关于最近所执行查询的信息。</td>
        </tr>
        <tr>
          <td><p> mysql_init()</td>
          <td><p>获取或初始化MYSQL结构。</td>
        </tr>
        <tr>
          <td><p> mysql_insert_id()</td>
          <td><p>返回上一个查询为AUTO_INCREMENT列生成的ID。</td>
        </tr>
        <tr>
          <td><p> mysql_kill()</td>
          <td><p>杀死给定的线程。</td>
        </tr>
        <tr>
          <td><p> mysql_library_end()</td>
          <td><p>最终确定MySQL C API库。</td>
        </tr>
        <tr>
          <td><p> mysql_library_init()</td>
          <td><p>初始化MySQL C API库。</td>
        </tr>
        <tr>
          <td><p> mysql_list_dbs()</td>
          <td><p>返回与简单正则表达式匹配的数据库名称。</td>
        </tr>
        <tr>
          <td><p> mysql_list_fields()</td>
          <td><p>返回与简单正则表达式匹配的字段名称。</td>
        </tr>
        <tr>
          <td><p> mysql_list_processes()</td>
          <td><p>返回当前服务器线程的列表。</td>
        </tr>
        <tr>
          <td><p> mysql_list_tables()</td>
          <td><p>返回与简单正则表达式匹配的表名。</td>
        </tr>
        <tr>
          <td><p> mysql_more_results()</td>
          <td><p>检查是否还存在其他结果。</td>
        </tr>
        <tr>
          <td><p> mysql_next_result()</td>
          <td><p>在多语句执行过程中返回/初始化下一个结果。</td>
        </tr>
        <tr>
          <td><p> mysql_num_fields()</td>
          <td><p>返回结果集中的列数。</td>
        </tr>
        <tr>
          <td><p> mysql_num_rows()</td>
          <td><p>返回结果集中的行数。</td>
        </tr>
        <tr>
          <td><p> mysql_options()</td>
          <td><p>为mysql_connect()设置连接选项。</td>
        </tr>
        <tr>
          <td><p> mysql_ping()</td>
          <td><p>检查与服务器的连接是否工作，如有必要重新连接。</td>
        </tr>
        <tr>
          <td><p> mysql_query()</td>
          <td><p>执行指定为“以Null终结的字符串”的SQL查询。</td>
        </tr>
        <tr>
          <td><p> mysql_real_connect()</td>
          <td><p>连接到MySQL服务器。</td>
        </tr>
        <tr>
          <td><p> mysql_real_escape_string()</td>
          <td><p>考虑到连接的当前字符集，为了在SQL语句中使用，对字符串中的特殊字符进行转义处理。</td>
        </tr>
        <tr>
          <td><p> mysql_real_query()</td>
          <td><p>执行指定为计数字符串的SQL查询。</td>
        </tr>
        <tr>
          <td><p> mysql_refresh()</td>
          <td><p>刷新或复位表和高速缓冲。</td>
        </tr>
        <tr>
          <td><p> mysql_reload()</td>
          <td><p>通知服务器再次加载授权表。</td>
        </tr>
        <tr>
          <td><p> mysql_rollback()</td>
          <td><p>回滚事务。</td>
        </tr>
        <tr>
          <td><p> mysql_row_seek()</td>
          <td><p>使用从mysql_row_tell()返回的值，查找结果集中的行偏移。</td>
        </tr>
        <tr>
          <td><p> mysql_row_tell()</td>
          <td><p>返回行光标位置。</td>
        </tr>
        <tr>
          <td><p> mysql_select_db()</td>
          <td><p>选择数据库。</td>
        </tr>
        <tr>
          <td><p> mysql_server_end()</td>
          <td><p>最终确定嵌入式服务器库。</td>
        </tr>
        <tr>
          <td><p> mysql_server_init()</td>
          <td><p>初始化嵌入式服务器库。</td>
        </tr>
        <tr>
          <td><p> mysql_set_server_option()</td>
          <td><p>为连接设置选项（如多语句）。</td>
        </tr>
        <tr>
          <td><p> mysql_sqlstate()</td>
          <td><p>返回关于上一个错误的SQLSTATE错误代码。</td>
        </tr>
        <tr>
          <td><p> mysql_shutdown()</td>
          <td><p>关闭数据库服务器。</td>
        </tr>
        <tr>
          <td><p> mysql_stat()</td>
          <td><p>以字符串形式返回服务器状态。</td>
        </tr>
        <tr>
          <td><p> mysql_store_result()</td>
          <td><p>检索完整的结果集至客户端。</td>
        </tr>
        <tr>
          <td><p> mysql_thread_id()</td>
          <td><p>返回当前线程ID。</td>
        </tr>
        <tr>
          <td><p> mysql_thread_safe()</td>
          <td><p>如果客户端已编译为线程安全的，返回1。</td>
        </tr>
        <tr>
          <td><p> mysql_use_result()</td>
          <td><p>初始化逐行的结果集检索。</td>
        </tr>
        <tr>
          <td><p> mysql_warning_count()</td>
          <td><p>返回上一个SQL语句的告警数。</td>
        </tr>
      </table>
      <p>与MySQL交互时，应用程序应使用该一般性原则：</p>
      <p> 1.&nbsp;&nbsp;&nbsp;
        通过调用mysql_library_init()，初始化MySQL库。库可以是mysqlclient 
        C客户端库，或mysqld嵌入式服务器库，具体情况取决于应用程序是否与“-libmysqlclient”或“-libmysqld”标志链接。</p>
      <p> 2.&nbsp;&nbsp;&nbsp;
        通过调用mysql_init()初始化连接处理程序，并通过调用mysql_real_connect()连接到服务器。</p>
      <p> 3.&nbsp;&nbsp;&nbsp;
        发出SQL语句并处理其结果。（在下面的讨论中，详细介绍了使用它的方法）。</p>
      <p> 4.&nbsp;&nbsp;&nbsp;
        通过调用mysql_close()，关闭与MySQL服务器的连接。</p>
      <p> 5.&nbsp;&nbsp;&nbsp;
        通过调用mysql_library_end()，结束MySQL库的使用。</p>
      <p>调用mysql_library_init()和mysql_library_end()的目的在于，为MySQL库提供恰当的初始化和结束处理。对于与客户端库链接的应用程序，它们提供了改进的内存管理功能。如果不调用mysql_library_end()，内存块仍将保持分配状态（这不会增加应用程序使用的内存量，但某些内存泄漏检测器将抗议它）。对于与嵌入式服务器链接的应用程序，这些调用会启动并停止服务器。</p>
      <p>mysql_library_init()和mysql_library_end()实际上是#define符号，这类符号使得它们等效于mysql_server_init()和mysql_server_end()，但其名称更清楚地指明，无论应用程序使用的是mysqlclient或mysqld库，启动或结束MySQL库时，应调用它们。对于早期的MySQL版本，可调用mysql_server_init()和mysql_server_end()取而代之。</p>
      <p>如果愿意，可省略对mysql_library_init()的调用，这是因为，必要时，mysql_init()会自动调用它。</p>
      <p>要想连接到服务器，可调用mysql_init()来初始化连接处理程序，然后用该处理程序（以及其他信息，如主机名、用户名和密码）调用mysql_real_connect()。建立连接后，在低于5.0.3版的API中，mysql_real_connect()会将再连接标志（MYSQL结构的一部分）设置为1，或在较新的版本中，将其设置为0。对于该标志，值“1”指明，如果因连接丢失而无法执行语句，放弃之前，会尝试再次连接到服务器。从MySQL 
        5.0.13开始，可以在mysql_options()上使用MYSQL_OPT_RECONNECT选项，以控制再连接行为。完成连接后，调用mysql_close()中止它。</p>
      <p>当连接处于活动状态时，客户端或许会使用mysql_query()或mysql_real_query()向服务器发出SQL查询。两者的差别在于，mysql_query()预期的查询为指定的、由Null终结的字符串，而mysql_real_query()预期的是计数字符串。如果字符串包含二进制数据（其中可能包含Null字节），就必须使用mysql_real_query()。</p>
      <p>对于每个非SELECT查询（例如INSERT、UPDATE、DELETE），通过调用mysql_affected_rows()，可发现有多少行已被改变（影响）。</p>
      <p>对于SELECT查询，能够检索作为结果集的行。注意，某些语句因其返回行，类似与SELECT。包括SHOW、DESCRIBE和EXPLAIN。应按照对待SELECT语句的方式处理它们。</p>
      <p>客户端处理结果集的方式有两种。一种方式是，通过调用mysql_store_result()，一次性地检索整个结果集。该函数能从服务器获得查询返回的所有行，并将它们保存在客户端。第二种方式是针对客户端的，通过调用mysql_use_result()，对“按行”结果集检索进行初始化处理。该函数能初始化检索结果，但不能从服务器获得任何实际行。</p>
      <p>在这两种情况下，均能通过调用mysql_fetch_row()访问行。通过mysql_store_result()，mysql_fetch_row()能够访问以前从服务器获得的行。通过mysql_use_result()，mysql_fetch_row()能够实际地检索来自服务器的行。通过调用mysql_fetch_lengths()，能获得关于各行中数据大小的信息。</p>
      <p>完成结果集操作后，请调用mysql_free_result()释放结果集使用的内存。</p>
      <p>这两种检索机制是互补的。客户端程序应选择最能满足其要求的方法。实际上，客户端最常使用的是mysql_store_result()。</p>
      <p>mysql_store_result()的1个优点在于，由于将行全部提取到了客户端上，你不仅能连续访问行，还能使用mysql_data_seek()或mysql_row_seek()在结果集中向前或向后移动，以更改结果集内当前行的位置。通过调用mysql_num_rows()，还能发现有多少行。另一方面，对于大的结果集，mysql_store_result()所需的内存可能会很大，你很可能遇到内存溢出状况。</p>
      <p>mysql_use_result()的1个优点在于，客户端所需的用于结果集的内存较少，原因在于，一次它仅维护一行（由于分配开销较低，mysql_use_result()能更快）。它的缺点在于，你必须快速处理每一行以避免妨碍服务器，你不能随机访问结果集中的行（只能连续访问行），你不知道结果集中有多少行，直至全部检索了它们为止。不仅如此，即使在检索过程中你判定已找到所寻找的信息，也必须检索所有的行。</p>
      <p>通过API，客户端能够恰当地对查询作出响应（仅在必要时检索行），而无需知道查询是否是SELECT查询。可以在每次mysql_query()或mysql_real_query()后，通过调用mysql_store_result()完成该操作。如果结果集调用成功，查询为SELECT，而且能够读取行。如果结果集调用失败，可调用mysql_field_count()来判断结果是否的确是所预期的。如果mysql_field_count()返回0，查询不返回数据（表明它是INSERT、UPDATE、DELETE等），而且不返回行。如果mysql_field_count()是非0值，查询应返回行，但没有返回行。这表明查询是失败了的SELECT。关于如何实现该操作的示例，请参见关于mysql_field_count()的介绍。</p>
      <p>无论是mysql_store_result()还是mysql_use_result()，均允许你获取关于构成结果集的字段的信息（字段数目，它们的名称和类型等）。通过重复调用mysql_fetch_field()，可以按顺序访问行内的字段信息，或者，通过调用mysql_fetch_field_direct()，能够在行内按字段编号访问字段信息。通过调用mysql_field_seek()，可以改变当前字段的光标位置。对字段光标的设置将影响后续的mysql_fetch_field()调用。此外，你也能通过调用mysql_fetch_fields()，一次性地获得关于字段的所有信息。</p>
      <p>为了检测和通报错误，MySQL提供了使用mysql_errno()和mysql_error()函数访问错误信息的机制。它们能返回关于最近调用的函数的错误代码或错误消息，最近调用的函数可能成功也可能失败，这样，你就能判断错误是在何时出现的，以及错误是什么。
    
    
      
        
          
            


<!--start of htmlend-->
<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->