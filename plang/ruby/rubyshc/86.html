<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->


<div class="lpindex"><a href="index.html">首页</a><a href="85.html"> 上一页</a><a href="87.html"> 下一页</a></div>

<H1>ruby 1.6 特性<!-- RDLabel: "ruby 1.6 特性" --></H1>
<P>ruby version 1.6是稳定版。在该版本中，主要修改了一些bug。</P>
<P>stable-snapshot是稳定版的源代码，且每日更新。</P>
<H2>1.6.8 (2002-12-24) -&gt; stable-snapshot<!-- RDLabel: "1.6.8 (2002-12-24) -> stable-snapshot" --></H2>

2003-01-22: errno<!-- RDLabel: "2003-01-22: errno" --> 

<P>在EAGAIN与EWOULDBLOCK同值的系统中，EWOULDBLOCK消失不见了。现在，这种系统中的EWOULDBLOCK被定义为EAGAIN。(这点与1.6.7不同)</P><pre class="code">p Errno::EAGAIN
p Errno::EWOULDBLOCK

=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   Errno::EAGAIN
   Errno::EWOULDBLOCK

=&gt; ruby 1.6.8 (2002-12-24) [i586-linux]
   Errno::EAGAIN
   -:2: uninitialized constant EWOULDBLOCK at Errno (NameError)

=&gt; ruby 1.6.8 (2003-02-13) [i586-linux]
   Errno::EAGAIN
   Errno::EAGAIN
</PRE>
<H2>1.6.7 (2002-03-01) -&gt; 1.6.8 (2002-12-24)<!-- RDLabel: "1.6.7 (2002-03-01) -> 1.6.8 (2002-12-24)" --></H2>

2002-10-02: Thread (cygwin)<!-- RDLabel: "2002-10-02: Thread (cygwin)" --> 

<P>在Cygwin中，有时无法切换Thread。 [ruby-list:36058], [ruby-list:24637]</P>
2002-10-01: Socket (win)<!-- RDLabel: "2002-10-01: Socket (win)" --> 

<P>好像解决了一个Windows中的socket问题。(从原来的邮件中无法得到具体的问题描述，但好像是：虽然可以用select来进行读入，但返回的是空数组) [ruby-talk:40015], [ruby-win32:366]</P>
2002-09-12: Thread.status (?)<!-- RDLabel: "2002-09-12: Thread.status (?)" --> 

<P>有时用trap捕获信号时却并没有保存线程的状态，导致被信号中断的线程状态混乱[ruby-talk:40337], [ruby-core:00019]</P>
2002-09-11: Queue#pop<!-- RDLabel: "2002-09-11: Queue#pop" --> 

<P>Queue#pop中存在竞争问题[ruby-dev:17223]</P>
2002-09-11: SizedQueue.new<!-- RDLabel: "2002-09-11: SizedQueue.new" --> 

<P>修改了可接受0以下的参数的bug。</P>
2002-09-05: 展开式<!-- RDLabel: "2002-09-05: 展开式" --> 

<P>在stable snapshot中，曾经有一段时间，需要对展开式中引号使用反斜线转义。该变更解决了这个问题。</P><pre class="code">p "#{ "" }"

=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   ""

=&gt; -:1: warning: bad substitution in string
   ruby 1.6.7 (2002-09-12) [i586-linux]
   "#{  }"

=&gt; ruby 1.6.7 (2002-09-25) [i586-linux]
   ""
</PRE>
<P>这并不是1.7之后的backport。在处理注释等对象时，与1.7有所不同。(请参考ruby 1.7 特性的2002-06-24)</P><pre class="code">p "#{ "" # comment }"
=&gt; ruby 1.6.8 (2002-10-04) [i586-linux]
   ""
=&gt; -:1: parse error
   ruby 1.7.3 (2002-10-04) [i586-linux]
</PRE>
SizedQueue#deq, #shift<!-- RDLabel: "SizedQueue#deq, #shift" --> 
SizedQueue#enq<!-- RDLabel: "SizedQueue#enq" --> 

<P>添加(push, pop的别名)。以前尚未定义它们时，调用enq等就会执行超类Queue的enq。</P>
2002-09-11: Tempfile#size<!-- RDLabel: "2002-09-11: Tempfile#size" --> 

<P>添加[ruby-dev:17221]</P>
2002-09-09<!-- RDLabel: "2002-09-09" --> 

<P>在mswin32版和mingw32版的ruby中，从1.6.6版起就有一个bug：ruby的子进程无法接收环境变量。[ruby-dev:18236]</P>
2002-09-03<!-- RDLabel: "2002-09-03" --> 

<P>在使用Bison编译的Ruby中，多次加载库的速度有所提高。(若不使用Bison的话，每次加载时，好像都会显式地执行GC，所以运行速度会下降) [ruby-dev:18145]</P>
2002-08-20 File.expand_path<!-- RDLabel: "2002-08-20 File.expand_path" --> 

<P>Cygwin 1.3.x [ruby-bugs-ja:PR#299]</P><pre class="code">p File.expand_path('file', 'c:/')

=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   /tmp/c:/file
=&gt; ruby 1.6.7 (2002-08-21) [i586-linux]
   c:/file
</PRE>
2002-08-19 Thread (win)<!-- RDLabel: "2002-08-19 Thread (win)" --> 

<P>以前，同时使用Ruby线程和Win32的结构化异常（包括来自Win32 API的callback）的话就会引起故障。现在该bug已被修复。[ruby-win32:273]</P>
2002-08-12 Hash#==<!-- RDLabel: "2002-08-12 Hash#==" --> 

<P>以前，只要两个Hash对象的默认值(default)==的话，它们也就被看作相等。</P><pre class="code">p Hash.new("foo") == Hash.new("bar")

=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   true
=&gt; ruby 1.6.7 (2002-08-21) [i586-linux]
   false
</PRE>
2002-07-11 String#slice!<!-- RDLabel: "2002-07-11 String#slice!" --> 

<P>以前，若指定了范围之外的字符串的话，有时会返回异常。现在统一返回nil。(也就是返回与String#[]或String#slice一样的结果)</P><pre class="code">p "foo".slice!("bar")   # &lt;- 以前此处返回 nil
p "foo".slice!(5,10)

=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   nil
   -:2:in `slice!': index 5 out of string (IndexError)
        from -:2
=&gt; ruby 1.6.7 (2002-08-01) [i586-linux]
   nil
   nil
</PRE>
2002-07-05 String#split<!-- RDLabel: "2002-07-05 String#split" --> 

<P>现在可以给第一个参数指定nil了。[ruby-talk:43513] 此时把$;当作分割字符串。以前，只有省略参数时才能使用$;。</P><pre class="code">$; = ":"
p "a:b:c".split(nil)
=&gt; -:2:in `split': bad separator (ArgumentError)
        from -:2
   ruby 1.6.7 (2002-03-01) [i586-linux]

=&gt; ruby 1.6.7 (2002-07-30) [i586-linux]
   ["a", "b", "c"]
</PRE>
2002-06-15 Dir.glob<!-- RDLabel: "2002-06-15 Dir.glob" --> 

<P>以前，Dir.glob不会匹配已断链的符号连接。</P><pre class="code">File.symlink("foo", "bar")
p Dir.glob("bar")
=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   []
=&gt; ruby 1.6.7 (2002-08-01) [i586-linux]
   ["bar"]
</PRE>
2002-06-13 Hash[]<!-- RDLabel: "2002-06-13 Hash[]" --> 

<P>以前，无法用Hash[]来dup &amp; freeze键字符串。</P><pre class="code">a = "key"
h = Hash[a,"val"]
h.keys[0].upcase!
p a
=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   "KEY"
=&gt; -:3:in `upcase!': can't modify frozen string (TypeError)
        from -:3
   ruby 1.6.7 (2002-08-01) [i586-linux]
</PRE>
2002-06-10 Fixnum#&gt;&gt;, &lt;&lt;<!-- RDLabel: "2002-06-10 Fixnum#>>, <<" --> 

<P>有时对负数进行右移位时，就会变成0。 [ruby-bugs-ja:PR#247]</P>
<P>以负数为参数的左移位(即右移位)中也会出现这种问题。[ruby-bugs-ja:PR#248]</P><pre class="code">p(-1 &gt;&gt; 31)
=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   0
=&gt; ruby 1.6.7 (2002-08-01) [i586-linux]
   -1

p(-1 &lt;&lt; -1)
=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   -2147483649
=&gt; ruby 1.6.7 (2002-08-01) [i586-linux]
   -1
</PRE>
2002-06-05<!-- RDLabel: "2002-06-05" --> 
Math.acosh<!-- RDLabel: "Math.acosh" --> 
Math.asinh<!-- RDLabel: "Math.asinh" --> 
Math.atanh<!-- RDLabel: "Math.atanh" --> 

<P>添加。</P>
2002-06-03<!-- RDLabel: "2002-06-03" --> 
String#[]=<!-- RDLabel: "String#[]=" --> 

<P>若receiver中不包含指定的索引字符串时，直接返回右边部分。</P><pre class="code">foo = "foo"
p foo["bar"] = "baz"
p foo

=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   "baz"
   "foo"
=&gt; -:2:in `[]=': string not matched (IndexError)
        from -:2
   ruby 1.6.7 (2002-07-30) [i586-linux]
</PRE>
2002-06-03 sprintf()<!-- RDLabel: "2002-06-03 sprintf()" --> 

<P>用"%d"把参数变为整数时，使用与Integer相同的规则。</P><pre class="code">p sprintf("%d", nil)

=&gt; -:1:in `sprintf': no implicit conversion from nil (TypeError)
        from -:1
   ruby 1.6.7 (2002-03-01) [i586-linux]

=&gt; ruby 1.6.7 (2002-07-30) [i586-linux]
   "0"
</PRE>
2002-05-23 -* 选项(?)<!-- RDLabel: "2002-05-23 -* 选项(?)" --> 

<P>以前，为了兼顾那些使用</P><pre class="code">#! ruby -*- mode: ruby -*-
</PRE>
<P>这种Emacs'-*-'的脚本，而特别规定：忽略-*以后的部分(将其看作是不进行任何操作的选项)，现在已经取消了这种特别设定。若想设定Emacs的'-*-'时，应该写在第2行。[ruby-dev:17193]</P><pre class="code">ruby '-*' -v
=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]

=&gt; ruby: invalid option -*  (-h will show valid options)
</PRE>
2002-05-22 parsedate<!-- RDLabel: "2002-05-22 parsedate" --> 

<P>版本升级[ruby-dev:17171]</P>
2002-05-22 -T 选项<!-- RDLabel: "2002-05-22 -T 选项" --> 

<P>以前，若在ruby的命令行选项-T后不留空格地添加其他选项时，-T后面的选项将被忽略。现在，-T后面的非数字部分都被看作是选项(与-0选项相同) [ruby-dev:17179]</P><pre class="code">ruby -Tv  # -v が無効 (ruby 1.6.7 (2002-03-01) [i586-linux])

=&gt; ruby: No program input from stdin allowed in tainted mode (SecurityError)

=&gt; ruby 1.6.7 (2002-07-30) [i586-linux]
</PRE>
2002-05-20 IO#close<!-- RDLabel: "2002-05-20 IO#close" --> 

<P>若对双向管道dup进行close_write时，则会引发错误。 [ruby-dev:17155]</P><pre class="code">open("|-","r+") {|f|
  if f
    f.dup.close_write
  else
     sleep 1
  end
}

=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   -:3:in `close_write': closing non-duplex IO for writing (IOError)
        from -:3
        from -:1:in `open'
        from -:1


=&gt; ruby 1.6.7 (2002-07-30) [i586-linux]
</PRE>
2002-05-02 Regexp.quote<!-- RDLabel: "2002-05-02 Regexp.quote" --> 

<P># 已经变为back slash quote。主要是为了能将quote中的正则表达式正确嵌入//x。[ruby-bugs-ja:PR#231]</P><pre class="code">p Regexp.quote("#")

p /a#{Regexp.quote("#")}b/x =~ "ab"

=&gt; -:3: warning: ambiguous first argument; make sure
   ruby 1.6.7 (2002-03-01) [i586-linux]
   "#"
   0

=&gt; -:3: warning: ambiguous first argument; make sure
   ruby 1.6.7 (2002-07-30) [i586-linux]
   "\\#"
   nil
</PRE>
2002-04-29: rb_find_file()<!-- RDLabel: "2002-04-29: rb_find_file()" --> 

<P>在$SAFE &gt;= 4的情况下，若没有指定绝对路径的话，则会引发SecurityError异常。</P>
2002-04-26: Regexp.quote<!-- RDLabel: "2002-04-26: Regexp.quote" --> 

<P>[ruby-bugs-ja:PR#231]</P><pre class="code">p Regexp.quote("\t")

p /a#{Regexp.quote("\t")}b/x =~ "ab"

=&gt; -:3: warning: ambiguous first argument; make sure
   ruby 1.6.7 (2002-03-01) [i586-linux]
   "\t"
   0

=&gt; -:3: warning: ambiguous first argument; make sure
   ruby 1.6.7 (2002-05-04) [i586-linux]
   "\\t"
   nil
</PRE>
2002-04-20: Regexp#inspect<!-- RDLabel: "2002-04-20: Regexp#inspect" --> 

<P>带/x标识的正则表达式对象的inspect把换行变成了\n。[ruby-bugs-ja:PR#225]</P><pre class="code">p /a
        b/x

=&gt; -:1: warning: ambiguous first argument; make sure
   ruby 1.6.7 (2002-03-01) [i586-linux]
   /a\n                b/x

=&gt; -:1: warning: ambiguous first argument; make sure
   ruby 1.7.2 (2002-04-24) [i586-linux]
   /a
                   b/x
</PRE>
2002-04-19: 结束时的相关处理<!-- RDLabel: "2002-04-19: 结束时的相关处理" --> 

<P>以前在下列脚本中，需要发送2次信号才能结束。现在该问题已解决。[ruby-bugs-ja:PR#223]</P><pre class="code">trap(:TERM, "EXIT")

END{
  puts "exit"
}

Thread::start{ Thread::stop }
sleep
</PRE>
2002-04-17: Regexp#inspect<!-- RDLabel: "2002-04-17: Regexp#inspect" --> 

<P>[ruby-bugs-ja:PR#222]</P><pre class="code">p %r{\/}

=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   /\\//

=&gt; ruby 1.6.7 (2002-05-04) [i586-linux]
   /\//
</PRE>
2002-04-15: pack('U')<!-- RDLabel: "2002-04-15: pack('U')" --> 

<P>已经修复了无法使用unpack('U')来还原pack('U')的bug。(unpack按照字符单位进行处理，而并非以前的字节单位) [ruby-bugs-ja:PR#220]</P><pre class="code">p [128].pack("U")
p [128].pack("U").unpack("U")

=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   "\302\200"
   [0]

=&gt; ruby 1.6.7 (2002-05-04) [i586-linux]
   "\302\200"
   [128]
</PRE>
2002-04-11: IO#write<!-- RDLabel: "2002-04-11: IO#write" --> 

<P>检测socket或管道中的EPIPE时，有时会出现失败的情况。[ruby-dev:16849]</P>
2002-04-11: cgi/session.rb (*文档中未出现*)<!-- RDLabel: "2002-04-11: cgi/session.rb    (*文档中未出现*)" --> 

<P>support for multipart form.</P>
2002-04-10: Object#remove_instance_variable<!-- RDLabel: "2002-04-10: Object#remove_instance_variable" --> 

<P>若指定的实例变量尚未定义时，则引发NameError异常。[ruby-bugs-ja:PR#216]</P><pre class="code">Object.new.instance_eval {
  p remove_instance_variable :@foo
}
=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   nil

=&gt; -:2:in `remove_instance_variable': instance variable @foo not defined (NameError)
   ruby 1.6.7 (2002-04-10) [i586-linux]
</PRE>
2002-04-04: Integer#step<!-- RDLabel: "2002-04-04: Integer#step" --> 

<P>以前，若将第二参数设为小于1的数时，它会被看作为0，进而引发错误。</P><pre class="code">1.step(2, 0.1) {|f| p f }

=&gt; -:1:in `step': step cannot be 0 (ArgumentError)
        from -:1
   ruby 1.6.7 (2002-03-01) [i586-linux]

=&gt; ruby 1.6.7 (2002-04-10) [i586-linux]
   1
   1.1
    :
   1.9
</PRE>
2002-04-01: $~<!-- RDLabel: "2002-04-01: $~" --> 

<P>修复了无法将nil赋值给$~的bug。[ruby-dev:16697]</P><pre class="code">/foo/ =~ "foo"
p $~
$~ = nil
p $~
=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   #&lt;MatchData:0x401b1be4&gt;
   -:3: wrong argument type nil (expected Match) (TypeError)
                                          ^^^^^ MatchData的错误
=&gt; ruby 1.6.7 (2002-04-04) [i586-linux]
   #&lt;MatchData:0x401b1c98&gt;
   nil
</PRE>
2002-03-25 BasicSocket.do_not_reverse_lookup<!-- RDLabel: "2002-03-25 BasicSocket.do_not_reverse_lookup" --> 

<P>在$SAFE &gt; 3的情况下，无法设定值。[ruby-dev:16554]</P>
2002-03-23 IO#read<!-- RDLabel: "2002-03-23 IO#read" --> 

<P>修复了File#read等无法读取大小为0的有内容文件(在Linux的/proc文件系统中会发生这种情况)的bug。</P><pre class="code">p File.open("/proc/#$$/cmdline").read

=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   ""

=&gt; ruby 1.6.7 (2002-03-29) [i586-linux]
   "ruby-1.6\000-v\000-"
</PRE>
2002-03-22 module_eval<!-- RDLabel: "2002-03-22 module_eval" --> 

<P>在module_eval的块中，常数和类变量的作用域不再变化。[ruby-dev:17876]</P><pre class="code">class Foo
  FOO = 1
  @@foo = 1
end

FOO = 2
@@foo = 2

Foo.module_eval { p FOO, @@foo }

=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   1
   1

=&gt; ruby 1.6.7 (2002-03-29) [i586-linux]
   2
   2
</PRE>
2002-03-22 net/http.rb<!-- RDLabel: "2002-03-22 net/http.rb" --> 

<P>以前，Net::HTTP.new在不带块的时候返回nil。 [ruby-bugs-ja:PR#214]</P>
<P>一般认为会逐渐取消net/protocol.rb，该bug好像是在调试时不小心种下的。</P>
2002-03-20 File.expand_path<!-- RDLabel: "2002-03-20 File.expand_path" --> 

<P>有时会出现内存释放不彻底的情况。[ruby-bugs:PR#276]</P>
2002-03-18 字符串字面值<!-- RDLabel: "2002-03-18 字符串字面值" --> 

<P>在#{..}等结构中，有时会出现汉字代码处理不全的现象。[ruby-list:34478]</P><pre class="code">#! ruby -Ks
p a = "#{"表"}"
=&gt; -:1: compile error in string expansion (SyntaxError)
   -:1: unterminated string meets end of file
   ruby 1.6.7 (2002-03-15) [i586-linux]
=&gt; ruby 1.6.7 (2002-03-19) [i586-linux]
   "表"

#! ruby -Ks
p %[评价]
=&gt; -:2: parse error
           p %[评价]
                   ^
   ruby 1.6.7 (2002-03-15) [i586-linux]

=&gt; ruby 1.6.7 (2002-03-19) [i586-linux]
   "评价"
</PRE>
2002-03-16 $~<!-- RDLabel: "2002-03-16 $~" --> 

<P>以前，若正则表达式方法没有在内部进行匹配操作时，将不会清除$~ 的状态。[ruby-bugs-ja:PR#208]</P><pre class="code">/foo/ =~ "foo"
/foo/ =~ nil
p $~

/foo/ =~ "foo"
$_ = nil; ~"foo"
p $~

/foo/ =~ "foo"
"foo".index(/bar/, 4)
p $~

/foo/ =~ "foo"
"foo".rindex(/bar/, -4)
p $~

=&gt; ruby 1.6.7 (2002-03-06) [i586-linux]
   #&lt;MatchData:0x401b1be4&gt;
   #&lt;MatchData:0x401b198c&gt;
   #&lt;MatchData:0x401b1644&gt;
   #&lt;MatchData:0x401b1414&gt;
=&gt; ruby 1.6.7 (2002-03-19) [i586-linux]
   nil
   nil
   nil
   nil
</PRE>
2002-03-14 扩展库的autoload<!-- RDLabel: "2002-03-14 扩展库的autoload" --> 

<P>无法对扩展库进行autoload。[ruby-dev:16379]</P><pre class="code">autoload :Fcntl, "fcntl"
require "fcntl"

=&gt; -:2:in `require': uninitialized constant Fcntl (NameError)
        from -:2
   ruby 1.6.7 (2002-03-01) [i586-linux]

=&gt; ruby 1.6.7 (2002-03-15) [i586-linux]
</PRE>
2002-03-13 getopts.rb<!-- RDLabel: "2002-03-13 getopts.rb" --> 

<P>refine. [ruby-dev:16193], [ruby-dev:16213]</P>
2002-03-11 正则表达式中的8进制代码<!-- RDLabel: "2002-03-11 正则表达式中的8进制代码" --> 

<P>以前，在正则表达式中的\nnn形式的8进制表示法中，只有开头是0时，才允许4位数。[ruby-bugs-ja:PR#207]</P><pre class="code">p /\0001/ =~ "\0001"   # equivalent to "\0" + "1"
=&gt; -:1: warning: ambiguous first argument; make sure
   ruby 1.6.7 (2002-03-01) [i586-linux]
   nil
=&gt; -:1: warning: ambiguous first argument; make sure
   ruby 1.6.7 (2002-03-15) [i586-linux]
   0
</PRE>
2002-03-11 trap<!-- RDLabel: "2002-03-11 trap" --> 

<P>[ruby-bugs-ja:PR#206]</P><pre class="code">trap('EXIT','Foo')
=&gt; -:1: [BUG] Segmentation fault
   ruby 1.6.7 (2002-03-01) [i586-linux]
=&gt; ruby 1.6.7 (2002-03-15) [i586-linux]
</PRE>
2002-03-10 方法的返回值<!-- RDLabel: "2002-03-10 方法的返回值" --> 

<P>下列方法的返回值已被修正。[ruby-bugs-ja:PR#205]</P>
<UL>
<LI>each_with_index返回self(以前是nil) 
<LI>Process.setpgrp返回不定值。 
<LI>ljust, rjust, center返回已dup的字符串</LI></UL>
2002-03-08 class variable<!-- RDLabel: "2002-03-08 class variable" --> 

<P>[ruby-talk:35122]</P><pre class="code">class C
  class &lt;&lt; self
    def test
      @@cv = 5
      p @@cv
    end
  end

  test
end
=&gt; -:5:in `test': uninitialized class variable @@cv in C (NameError)
        from -:9
   ruby 1.6.7 (2002-03-01) [i586-linux]

=&gt; ruby 1.6.6 (2001-12-26) [i586-linux]
   5
</PRE>
2002-03-03 Marshal.load<!-- RDLabel: "2002-03-03 Marshal.load" --> 

<P>以前，Marshal.load一直调用1.7的Proc#yield方法。[ruby-dev:16178]</P><pre class="code">Marshal.load(Marshal.dump('foo'), proc {|o| p o})
=&gt; -:1:in `load': undefined method `yield' for #&lt;Proc:0x401b1b30&gt; (NameError)
        from -:1
   ruby 1.6.7 (2002-03-01) [i586-linux]

=&gt; ruby 1.6.6 (2001-12-26) [i586-linux]
   "foo"
</PRE>
<H2>1.6.6 (2001-12-26) -&gt; 1.6.7 (2002-03-01)<!-- RDLabel: "1.6.6 (2001-12-26) -> 1.6.7 (2002-03-01)" --></H2>

2002-02-20 true/false/nil的特殊方法定义<!-- RDLabel: "2002-02-20 true/false/nil的特殊方法定义" --> 

<P>可以通过定义特殊类的方法来为这些伪变量定义特殊方法。</P><pre class="code">class &lt;&lt;true
  def foo
   "foo"
  end
end
p true.foo
=&gt; -:1: no virtual class for true (TypeError)
   ruby 1.6.6 (2001-12-26) [i586-linux]

=&gt; ruby 1.6.7 (2002-03-01) [i586-linux]
   "foo"
</PRE>
time.rb, URI<!-- RDLabel: "time.rb, URI" --> 

<P>已添加。</P>
Ruby/Tk<!-- RDLabel: "Ruby/Tk" --> 

<P>修复bug，增加功能[ruby-dev:16139],[ruby-dev:16153]。</P>
数值字面值的`_'<!-- RDLabel: "数值字面值的`_'" --> 

<P>重新制定`_'的使用规则，统一了String#hex等数值变换方法的行为规则。[rubyist:1018], [ruby-dev:15684], [ruby-dev:15757]</P>
include<!-- RDLabel: "include" --> 

<P>不会递归地对模块进行include操作。</P><pre class="code">module Foo; end
module Bar; include Foo; end
module Foo; include Bar; end

p Foo.ancestors

=&gt; ruby 1.6.6 (2001-12-26) [i586-linux]
   [Foo, Bar, Foo]

=&gt; -:3:in `append_features': cyclic include detected (ArgumentError)
        from -:3:in `include'
        from -:3
   ruby 1.6.6 (2002-01-28) [i586-linux]
</PRE>
方法的返回值<!-- RDLabel: "方法的返回值" --> 

<P>修正了下列方法的返回值。 [ruby-bugs-ja:PR#182], [rubyist:1016]</P>
<UL>
<LI>Hash#default= 返回右边部分(以前返回self)。 
<LI>Dir#pos= 返回右边部分(以前返回self)。 (Dir#seek仍然返回self) 
<LI>Dir.glob 带块时返回nil(以前返回false) 
<LI>IO#close 遇到已关闭的IO则引发IOError。 
<LI>IO#each_byte 返回self(以前返回nil) </LI></UL>
rb_define_module_under()<!-- RDLabel: "rb_define_module_under()" --> 

<P>以前，若C函数 rb_define_module_under()定义模块时遇到了已定义的同名常数的话就会失败。[ruby-talk:30203]</P><pre class="code">Constants = 1
require 'syslog'
p Syslog::Constants

=&gt; -:2:in `require': Syslog::Fixnum is not a module (TypeError)
        from -:2
   ruby 1.6.6 (2001-12-26) [i586-linux]

=&gt; ruby 1.6.6 (2002-01-07) [i586-linux]
   Syslog::Constants
</PRE>
<P>因为这个bug的问题，可能最近就会放出1.6.7[ruby-talk:30387](好像不是这样。因此使用1.6.6的stable-snapshot的用户需要特别注意。因为2002/1/30的下列变更(ChangeLog)</P>
<UL>
<LI>re.c (rb_reg_search): should set regs.allocated. </LI></UL>
<P>的原因，将导致内存不足。2002/2/13以后的修正版解决了这个问题)。</P>
<H2>1.6.5 (2001-09-19) -&gt; 1.6.6 (2001-09-19)<!-- RDLabel: "1.6.5 (2001-09-19) -> 1.6.6 (2001-09-19)" --></H2>

Syslog<!-- RDLabel: "Syslog" --> 

<P>已添加。</P>
CGI<!-- RDLabel: "CGI" --> 

<P>针对Netscape(版本是？)的bug进行了处理 [ruby-list:32089]</P>
Time#localtime<!-- RDLabel: "Time#localtime" --> 
Time#gmtime<!-- RDLabel: "Time#gmtime" --> 

<P>可以调用一次已冻结的Time 对象。</P><pre class="code">t = Time.new.freeze
p t.gmtime
p t.localtime

=&gt; -:2:in `gmtime': can't modify frozen Time (TypeError)
        from -:2
   ruby 1.6.5 (2001-09-19) [i586-linux]

=&gt; ruby 1.6.5 (2001-11-01) [i586-linux]
   Mon Nov 05 18:08:34 UTC 2001
   -:3:in `localtime': can't modify frozen Time (TypeError)
        from -:3
</PRE>
File::SEPARATOR<!-- RDLabel: "File::SEPARATOR" --> 
File::ALT_SEPARATOR<!-- RDLabel: "File::ALT_SEPARATOR" --> 
File::PATH_SEPARATOR<!-- RDLabel: "File::PATH_SEPARATOR" --> 
RUBY_PLATFORM<!-- RDLabel: "RUBY_PLATFORM" --> 
RUBY_RELEASE_DATE<!-- RDLabel: "RUBY_RELEASE_DATE" --> 
RUBY_VERSION<!-- RDLabel: "RUBY_VERSION" --> 

<P>上述各项已变为被freeze的字符串。</P><pre class="code">p File::SEPARATOR.frozen?
p File::ALT_SEPARATOR.frozen?
p File::PATH_SEPARATOR.frozen?

=&gt; ruby 1.6.5 (2001-09-19) [i586-linux]
   false
   false
   false

=&gt; ruby 1.6.5 (2001-11-01) [i586-linux]
   true
   false  # 因为运行环境是Linux，所以ALT_SEPARATOR是nil
   true
</PRE>
Integer[nth]<!-- RDLabel: "Integer[nth]" --> 

<P>以前，若遇到大索引值就会引发异常。 [ruby-bugs-ja:PR#114]</P><pre class="code">p(-1[10000000000])

=&gt; -:1:in `[]': bignum too big to convert into `int' (RangeError)
        from -:1
   ruby 1.6.5 (2001-09-19) [i586-linux]

=&gt; ruby 1.6.5 (2001-11-01) [i586-linux]
   1
</PRE>
<P>不能对整数的负索引返回0。？[ruby-bugs-ja:PR#122]</P><pre class="code">p(-1[-1])

=&gt; ruby 1.6.5 (2001-09-19) [i586-linux]
   1
=&gt; ruby 1.6.5 (2001-11-01) [i586-linux]
   1
</PRE>
Numeric#remainder<!-- RDLabel: "Numeric#remainder" --> 

<P>[ruby-bugs-ja:PR#110]</P><pre class="code">p( 3.remainder(-3))
p(-3.remainder(3))

=&gt; ruby 1.6.5 (2001-09-19) [i586-linux]
   3
   -3
=&gt; ruby 1.6.5 (2001-11-01) [i586-linux]
   0
   0
</PRE>
END { ... }<!-- RDLabel: "END { ... }" --> 

<P>以前，不能运行END块中的END块。 [ruby-bugs-ja:PR#107]</P><pre class="code">END {
  p 1
  END { p 2 }
}

=&gt; ruby 1.6.5 (2001-09-19) [i586-linux]
   1

=&gt; ruby 1.6.5 (2001-11-01) [i586-linux]
   1
   2
</PRE>
String#succ<!-- RDLabel: "String#succ" --> 
<P>[ruby-talk:22557]</P><pre class="code">p "***".succ
p "*".succ
p sprintf("%c", 255).succ
p sprintf("*%c", 255).succ
p sprintf("**%c", 255).succ

=&gt; ruby 1.6.5 (2001-09-19) [i586-linux]
   "**+"
   "\001+"
   "\001\000"
   "\001+\000"
   "*+\000"

=&gt; ruby 1.6.5 (2001-11-01) [i586-linux]
   "**+"
   "+"
   "\001\000"
   "+\000"
   "*+\000"
</PRE>

method_missing<!-- RDLabel: "method_missing" --> 

<P>以前，下列内容被Segmentation Fault。[ruby-dev:14942]</P><pre class="code">Module::constants.each {|c|
  c = eval c
  if c.instance_of?(Class)
    p c
    c.instance_methods.each {|m|
      c.module_eval "undef #{m};"
    }
    c.module_eval {undef initialize}
  end
}

=&gt; ruby 1.6.5 (2001-09-19) [i586-linux]
   NotImplementedError
   MatchData
   Exception
   Numeric
   MatchData
   Segmentation fault

=&gt; ruby 1.6.5 (2001-10-15) [i586-linux]
   MatchData
   NotImplementedError
   FloatDomainError
   LoadError
   Float
   Binding
   SignalException
   Module
   -:6:in `method_missing': stack level too deep (SystemStackError)
</PRE>
%q(...)<!-- RDLabel: "%q(...)" --> 

<P>在使用%表示法的字面值中，不能将英文字母和数字用作切分字符。</P><pre class="code">p %q1..1
</PRE><pre class="code">=&gt; ruby 1.6.5 (2001-10-10) [i586-linux]
   ".."
=&gt; -:1: unknown type of %string
        p %q1..1
             ^
   ruby 1.6.5 (2001-10-15) [i586-linux]
</PRE>
String#=~<!-- RDLabel: "String#=~" --> 

<P>调用String#=~时，若两边都是字面值的话，为了提升速度而禁止进行方法调用。(实际上，此前就曾考虑过这么做，但因为出现了bug而未能禁止方法调用(不是String#=~，而是Regexp#=~))</P><pre class="code">class String
  def =~(arg)
    ["String#=~", self, arg]
  end
end

class Regexp
  def =~(arg)
    ["Regexp#=~", self, arg]
  end
end

p "foo" =~ /foo/
p "foo" =~ Regexp.new("foo")

=&gt; -:2: warning: discarding old =~
   -:8: warning: discarding old =~
   ruby 1.6.5 (2001-09-19) [i586-linux]
   ["Regexp#=~", /foo/, "foo"]
   ["String#=~", "foo", /foo/]

=&gt; -:2: warning: discarding old =~
   -:8: warning: discarding old =~
   ruby 1.6.5 (2001-10-10) [i586-linux]
   0
   ["String#=~", "foo", /foo/]
</PRE>
<P>(<EM>有时会对内部方法进行这种最优化设置，因此可能导致重定义方法无效的情况</EM>，而确切地说，您应该先判断某方法是否已被重定义，然后再选择是否进行最优化)</P>
class 定义<!-- RDLabel: "class 定义" --> 

<P>以前，若显式地使用一个不同的超类来重定义某个已定义的类时，则会忽略指定的超类。[ruby-bugs-ja:PR#87]</P><pre class="code">class A
  p self.id
end
class A &lt; String
  p self.id
  p self.superclass
end

=&gt; ruby 1.6.5 (2001-09-19) [i586-linux]
   537760880
   -:4: warning: already initialized constant A
   537757180
   Object
=&gt; ruby 1.6.5 (2001-10-10) [i586-linux]
   537760960
   -:4: warning: already initialized constant A
   537757200
   String
</PRE>
%w(...)<!-- RDLabel: "%w(...)" --> 

<P>以前，语法解释器会将数组字面值 %w(...)误判为字符串字面值，从而导致下列异常情况。[ruby-bugs-ja:PR#91]</P><pre class="code">%w!a! "b" 
=&gt; -:1: tried to allocate too big memory (NoMemoryError)
   ruby 1.6.5 (2001-09-19) [i586-linux]

=&gt; -:1: parse error
       %w!a! "b" 
                ^
   ruby 1.6.5 (2001-10-10) [i586-linux]
</PRE>
Thread<!-- RDLabel: "Thread" --> 

<P>以前存在下列bug：Thread#status对aborting状态返回"run"，而Thread#priority = val会返回self而不是val。现已解决这些问题。[rubyist:0820], [ruby-dev:14903]</P>
Marshal<!-- RDLabel: "Marshal" --> 

<P>不能dump无名的类／模块。</P><pre class="code">p Marshal.dump(Class.new)

=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   "\004\005c\031#&lt;Class 0lx401a6b44&gt;"

=&gt; -:1:in `dump': can't dump anonymous class #&lt;Class 0lx401ab980&gt; (ArgumentError)
        from -:1
   ruby 1.6.5 (2001-10-05) [i586-linux]
</PRE>
UNIXSocket#addr<!-- RDLabel: "UNIXSocket#addr" --> 

<P>以前，UNIXSocket#addr会返回一些垃圾信息(在BSD中如何呢？)。 [ruby-bugs-ja:PR#85]</P><pre class="code"># server
require 'socket'
File.unlink("/tmp/sss")
sock = UNIXServer.new("/tmp/sss").accept

# client
require 'socket'
sock = UNIXSocket.new("/tmp/sss").addr

=&gt; ["AF_UNIX", "\031((\306\031(\010"]

=&gt; ["AF_UNIX", ""]
</PRE>
???<!-- RDLabel: "???" --> 

<P>[ruby-talk:21722]</P>
<P>class Ptr</P><pre class="code">def initialize(obj) @obj = obj end
def []=() @obj = obj end
def []() @obj end
</PRE>
<P>end module Kernel</P><pre class="code">def _ptr() Ptr.new(self) end
</PRE>
<P>end</P>
<P>def foo(int)</P><pre class="code">int[] += 1
</PRE>
<P>end x = 1._ptr foo(x) puts x[]</P>
<P>=&gt; -:11: [BUG] Segmentation fault</P><pre class="code">ruby 1.6.5 (2001-09-19) [i586-linux]
</PRE>
<P>=&gt; -:11:in `[]=': wrong # of arguments(1 for 0) (ArgumentError)</P><pre class="code">from -:11:in `foo'
from -:14
</PRE><pre class="code">ruby 1.6.5 (2001-10-05) [i586-linux]
</PRE>
Subclass of String and Array<!-- RDLabel: "Subclass of String and Array" --> 

<P>以前，在String, Array的子类中调用某些特定方法时，就会变成String, Array。</P><pre class="code">class Foo &lt; String
end
p Foo.new("").type
p Foo.new("foo")[0,0].type              # String ???
p Foo.new("foo")[1,1].type
p Foo.new("foo").succ.type
p Foo.new("foo").reverse.type
p((Foo.new("foo") * 5).type)
p Foo.new("foo").gsub(/foo/, "bar").type
p Foo.new("foo").sub(/foo/, "bar").type
p Foo.new("foo").ljust(10).type
p Foo.new("foo").rjust(10).type
p Foo.new("foo").center(10).type

=&gt; ruby 1.6.5 (2001-09-19) [i586-linux]
   Foo
   String
   String
   String
   String
   String
   String
   Foo
   String
   String
   String

=&gt; ruby 1.6.5 (2001-10-05) [i586-linux]
   Foo
   String
   Foo
   Foo
   Foo
   Foo
   Foo
   Foo
   Foo
   Foo
   Foo

class Bar &lt; Array
end
bar = Bar.new
p bar.type
p bar.push(1,2,3)
p bar.type
p bar[0,0].type            # =&gt; Array ???
p bar[0,1].type
p ((bar * 5).type)

=&gt; -:9: warning: p (...) interpreted as method call
   ruby 1.6.5 (2001-09-19) [i586-linux]
   Bar
   [1, 2, 3]
   Bar
   Array
   Array
   Array
=&gt; -:9: warning: p (...) interpreted as method call
   ruby 1.6.5 (2001-10-05) [i586-linux]
   Bar
   [1, 2, 3]
   Bar
   Array
   Bar
   Bar
</PRE>
<H2>1.6.4 (2001-06-04) -&gt; 1.6.5 (2001-09-19)<!-- RDLabel: "1.6.4 (2001-06-04) -> 1.6.5 (2001-09-19)" --></H2>

$_, $~, if a..b<!-- RDLabel: "$_, $~, if a..b" --> 

<P>以前，在函数中使用Thread#run时，与该线程共享scope的父线程中的$_, $~会被子线程所覆盖。[ruby-dev:14743]</P><pre class="code">def foo(t)
  t.run
end

t = Thread.start do
  t = $_= "sub"
  loop{Thread.stop;puts "sub:#$_"}
end

$_ = "main"
t.run                   # =&gt; sub:sub
puts "main:#$_"         # =&gt; main:main
foo(t)                  # =&gt; sub:sub
puts "main:#$_"         # =&gt; main:sub
=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   sub:sub
   main:main
   sub:sub
   main:sub
=&gt; ruby 1.6.5 (2001-09-19) [i586-linux]
   sub:sub
   main:main
   sub:sub
   main:main
</PRE>
net/telnet.rb<!-- RDLabel: "net/telnet.rb" --> 

<P>有时，当Net::Telnet连接到特定的端口之后，就失去反应。 [ruby-list:31303]</P>
CGI#header<!-- RDLabel: "CGI#header" --> 

<P>以前，在下述脚本中，TEXT_PLAIN会被改写成"text/plain; charset=iso-8859-1"。 [ruby-dev:14716]</P><pre class="code">require 'cgi'

TEXT_PLAIN = "text/plain"

cgi = CGI.new
print cgi.header("type" =&gt; TEXT_PLAIN,
                 "charset" =&gt; "iso-8859-1")
printf("TEXT_PLAIN: %s\n", TEXT_PLAIN)

=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   Content-Type: text/plain; charset=iso-8859-1
   ^M
   TEXT_PLAIN: text/plain; charset=iso-8859-1
   TEXT_PLAIN: text/plain

=&gt; ruby 1.6.5 (2001-09-19) [i586-linux]
   Content-Type: text/plain; charset=iso-8859-1
   ^M
   TEXT_PLAIN: text/plain
</PRE>
Dir.chdir<!-- RDLabel: "Dir.chdir" --> 

<P>在尚未定义HOME或LOGDIR时，若不带参数地调用Dir.chdir的话，就会引发ArgumentError异常</P>
<P>ENV['HOME'] = nil ENV['LOGDIR'] = nil Dir.chdir =&gt; -:3:in `chdir': Bad address (Errno::EFAULT)</P><pre class="code">from -:3
</PRE><pre class="code">ruby 1.6.4 (2001-08-26) [i586-linux]
</PRE>
<P>=&gt; -:3:in `chdir': HOME/LOGDIR not set (ArgumentError)</P><pre class="code">from -:3
</PRE><pre class="code">ruby 1.6.5 (2001-09-19) [i586-linux]
</PRE>
Dir.glob<!-- RDLabel: "Dir.glob" --> 

<P>以前，下列代码会引起死循环。</P><pre class="code">Dir.mkdir("test?") rescue nil
p Dir.glob("test?/*")
=&gt; ruby 1.6.5 (2001-09-19) [i586-linux]
   []
</PRE>
jcode.rb<!-- RDLabel: "jcode.rb" --> 

<P>修改了若干bug。[ruby-list:31238]</P>

Dir.glob<!-- RDLabel: "Dir.glob" --> 

<P>Dir.glob("*/**/*")会重复返回子目录中的文件。 [ruby-dev:14576]</P><pre class="code">Dir.mkdir('foo') rescue nil
Dir.mkdir('foo/bar') rescue nil
p Dir.glob('*/**/*')

=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   ["foo/bar", "foo/bar"]

=&gt; ruby 1.6.4 (2001-08-26) [i586-linux]
   ["foo/bar"]
</PRE>
UnboundMethod#bind<!-- RDLabel: "UnboundMethod#bind" --> 

<P>无法bind模块的UnboundMethod对象。 [rubyist:0728]</P><pre class="code">module Foo
  def foo
    :foo
  end
end

class Bar
  include Foo
end

m = Foo.instance_method :foo
p m.bind(Bar.new).call

=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   -:12:in `bind': first argument must be an instance of Foo (TypeError)
        from -:12

=&gt; ruby 1.6.4 (2001-08-23) [i586-linux]
   :foo
</PRE>
内部类的替换<!-- RDLabel: "内部类的替换" --> 

<P>对内部类／模块进行赋值时，会出现警告。</P><pre class="code">Array = nil
p Array
=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   nil

=&gt; -:1: warning: already initialized constant Array
   ruby 1.6.4 (2001-08-23) [i586-linux]
   nil
</PRE>
Regexp<!-- RDLabel: "Regexp" --> 

<P>以前，若反向参考中的数字大于括号数量时，则会匹配任何内容。[ruby-list:30975]</P><pre class="code">p /(foo)\2/ =~ "foobar"
=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   0
=&gt; ruby 1.6.4 (2001-08-23) [i586-linux]
   nil
</PRE>
TCPSocket.open<!-- RDLabel: "TCPSocket.open" --> 

<P>修复了Cygwin中TCPSocket.open 时常出错(Errno::EINVAL, EALREADY)的问题。(1.6.4 20010712以后) [ruby-talk:9939], [ruby-talk:16632], [ruby-list:24702], [ruby-list:27805], [ruby-list:30512] 等等</P>
lib/resolv.rb, lib/resolv-replace.rb<!-- RDLabel: "lib/resolv.rb, lib/resolv-replace.rb" --> 

<P>添加。主要是为了在ruby的resolver(DNS解析)和Socket相关的类中使用该库而设立。</P>
<P>在ruby的resovler中，timeout.rb的控制是有效的(即，在域名解析过程中可以进行Thread的切换)</P><pre class="code">require 'resolv'
p Resolv.new.getaddress("www.ruby-lang.org").to_s

=&gt; /usr/local/lib/ruby/1.6/resolv.rb:160: warning: timeout (...) interpreted as method call
   /usr/local/lib/ruby/1.6/resolv.rb:55: warning: instance variable @initialized not initialized
   /usr/local/lib/ruby/1.6/resolv.rb:113: warning: instance variable @initialized not initialized
   /usr/local/lib/ruby/1.6/resolv.rb:392: warning: instance variable @initialized not initialized
   ruby 1.6.4 (2001-08-23) [i586-linux]
   "210.251.121.214"
</PRE>
Digest 模块<!-- RDLabel: "digest.so 模块" --> 

<P>SHA1, MD5被替换成Digest::SHA1, Digest::MD5。 另外，还新增了Digest::SHA256, Digest::SHA384, Digest::SHA512, Digest::RMD160。</P><pre class="code">require 'digest/md5'
include Digest

md = MD5.new
md &lt;&lt; "abc"
puts md

puts MD5.hexdigest("123")
</PRE>
Struct<!-- RDLabel: "Struct" --> 

<P>以前，可以修改已被冻结的结构体对象。另外，当$SAFE = 4时，则禁止进行修改操作。[ruby-talk:19167]</P><pre class="code">cat = Struct.new("Cat", :name, :age, :life)
a = cat.new("cat", 12, 7).freeze
a.name = "dog"
p a
=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   #&lt;Struct::Cat name="dog", age=12, life=7&gt;
=&gt; ruby 1.6.4 (2001-08-06) [i586-linux]
   -:4:in `name=': can't modify frozen Struct (TypeError)
        from -:4

cat = Struct.new("Cat", :name, :age, :life)
a = cat.new("cat", 12, 7)
Thread.new do
   abort_on_exception = true
   $SAFE = 4
   a.life -= 1
end.join
p a.life
=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   6
=&gt; ruby 1.6.4 (2001-08-06) [i586-linux]
   -:6:in `life=': Insecure: can't modify Struct (SecurityError)
        from -:3:in `join'
        from -:3
</PRE>
String#rindex<!-- RDLabel: "String#rindex" --> 

<P>将正则表达式传给rindex时，则会出现bug。[ruby-dev:13843] (该bug出现在1.6.4 版本之后)</P><pre class="code">p "foobar".rindex(/b/)
=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   3

=&gt; ruby 1.6.4 (2001-06-19) [i386-freebsd5.0]
   nil

=&gt; ruby 1.6.4 (2001-08-06) [i586-linux]
   3
</PRE>
require<!-- RDLabel: "内部函数" --> 

<P>以前，若把以~开头的文件名传给require时必须带上扩展名，否则无法进行加载。[ruby-dev:13756]</P><pre class="code">$ echo p __FILE__ &gt; ~/a.rb
$ ruby17 -v -r~/a -e0
ruby 1.7.1 (2001-07-03) [i686-linux]
0: No such file to load -- ~/a (LoadError)
$ ruby16 -v -r~/a -e0
ruby 1.6.4 (2001-07-02) [i686-linux]
0: No such file to load -- ~/a (LoadError)
$ ruby14 -v -r~/a -e0
ruby 1.4.6 (2000-08-16) [i686-linux]
"/home/nobu/a.rb"
</PRE>
String#each_line<!-- RDLabel: "String#each_line" --> 

<P>以前，无法正确传递污染。[ruby-dev:13755]</P><pre class="code">"foo\nbar\n".taint.each_line {|v| p v.tainted?}
=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   false
   true
=&gt; ruby 1.6.4 (2001-08-06) [i586-linux]
   true
   true
</PRE>
NKF::nkf<!-- RDLabel: "NKF::nkf" --> 

<P>以前，无法正确传递污染。[ruby-dev:13754]</P><pre class="code">require 'nkf'
p NKF.nkf("-j", "a".taint).tainted?

=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   false
=&gt; ruby 1.6.4 (2001-08-06) [i586-linux]
   true
</PRE>
ruby -x<!-- RDLabel: "ruby -x" --> 

<P>指定了-x[directory]选项的话，有时会出现尚未执行脚本就已经结束的情况。[ruby-dev:13752]</P>
attr_*<!-- RDLabel: "attr_*" --> 

<P>向accessor传递多余的参数也不会引起错误。 [ruby-dev:13748]</P><pre class="code">class C
  def initialize
    @message = 'ok'
  end
  attr_reader :message
end
puts C.new.message(1,2,3)

=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   ok
=&gt; ruby 1.6.4 (2001-08-06) [i586-linux]
   -:7:in `message': wrong # of arguments(3 for 0) (ArgumentError)
        from -:7
</PRE>
Readline::completion_append_character<!-- RDLabel: "Readline::completion_append_character" --> 
Readline::completion_append_character=<!-- RDLabel: "Readline::completion_append_character=" --> 

<P>添加。GNU Readline库中的rl_completion_append_character变量的accessor。(在GNU readline 2.1之后的版本中才能使用该变量) [ruby-ext:01760]</P>
Socket::Constants<!-- RDLabel: "Socket::Constants" --> 

<P>添加了下列socket相关的常数。</P><pre class="code">SO_PASSCRED
SO_PEERCRED
SO_RCVLOWAT
SO_SNDLOWAT
SO_RCVTIMEO
SO_SNDTIMEO
SO_SECURITY_AUTHENTICATION
SO_SECURITY_ENCRYPTION_TRANSPORT
SO_SECURITY_ENCRYPTION_NETWORK
SO_BINDTODEVICE
SO_ATTACH_FILTER
SO_DETACH_FILTER
SO_PEERNAME
SO_TIMESTAMP
</PRE>
require / $LOAD_PATH<!-- RDLabel: "内部函数 / $LOAD_PATH" --> 

<P>Changed to use a new algorithm to locate a library.</P>
<P>Now when requiring "foo", the following directories are searched for the library in the order listed.</P><pre class="code">$prefix/lib/ruby/site_ruby/$ver/foo.rb
$prefix/lib/ruby/site_ruby/$ver/foo.so
$prefix/lib/ruby/site_ruby/$ver/$arch/foo.rb
$prefix/lib/ruby/site_ruby/$ver/$arch/foo.so
$prefix/lib/ruby/site_ruby/foo.rb
$prefix/lib/ruby/site_ruby/foo.so
$prefix/lib/ruby/$ver/foo.rb
$prefix/lib/ruby/$ver/foo.so
$prefix/lib/ruby/$ver/$arch/foo.rb
$prefix/lib/ruby/$ver/$arch/foo.so
./foo.rb
./foo.so
</PRE>
<P>The previous behavior had a potential security risk because a foo.rb (if exists) in the current directory is located prior to a foo.so in $prefix/lib/ruby/site_ruby/$ver/$arch.</P>
<P>[ruby-bugs:PR#140], [ruby-ext:01778], [ruby-dev:13659]</P>
lib/sync.rb<!-- RDLabel: "lib/sync.rb" --> 
lib/mutex_m.rb<!-- RDLabel: "lib/mutex_m.rb" --> 

<P>Fixed for obj.extend(Sync_m) and obj.extend(Mutex_m).[ruby-dev:13463]</P><pre class="code">$ ruby -v -rsocket -rmutex_m -e 's=TCPSocket.new("localhost",25); s.extend(Mutex_m)'
ruby 1.6.4 (2001-06-04) [i386-linux]
/usr/lib/ruby/1.6/mutex_m.rb:104:in `initialize': wrong # of arguments (0 for 1) (ArgumentError)
        from /usr/lib/ruby/1.6/mutex_m.rb:104:in `initialize'
        from /usr/lib/ruby/1.6/mutex_m.rb:50:in `mu_extended'
        from /usr/lib/ruby/1.6/mutex_m.rb:34:in `extend_object'
        from -e:1:in `extend'
        from -e:1
</PRE>
$SAFE / load<!-- RDLabel: "$SAFE / 内部函数" --> 

<P>以前存在以下bug：在1 &lt;= $SAFE &lt;= 3的情况下，当第二参数为true时，即使指定了被污染的对象名，也能进行load()。现在已经修复该bug。[ruby-dev:13481]</P><pre class="code">$SAFE = 1
filename = "foo"
filename.taint
p load(filename, true)

=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   true

=&gt; ruby 1.6.4 (2001-08-06) [i586-linux]
   -:4:in `load': Insecure operation - load (SecurityError)
        from -:4
</PRE>
Regexp<!-- RDLabel: "Regexp" --> 

<P>以前，只有后者能匹配成功。[ruby-talk:16233]</P><pre class="code">puts "OK 1" if /(.|a)bd/ =~ "cxbd"
puts "OK 2" if /(a|.)bd/ =~ "cxbd"

=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   OK 2
=&gt; ruby 1.6.4 (2001-08-06) [i586-linux]
   OK 1
   OK 2
</PRE>
Marshal<!-- RDLabel: "Marshal" --> 

<P>以前，模块加载时的类型检测中存在错误。修复该错误后，dump format的minor版本号升高1级</P><pre class="code">p Marshal.dump(Object.new).unpack("CC").join(".")
    =&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
       "4.5"
p Marshal.dump(Object.new).unpack("CC").join(".")
    =&gt; ruby 1.6.4 (2001-06-11) [i586-linux]
       "4.6"
</PRE>
$SAFE / def<!-- RDLabel: "$SAFE / def" --> 

<P>虽然doc/NEWS中有下列内容</P><pre class="code">Fixed so defining a new method is allowed under $SAFE == 4, which
previously wasn't.
</PRE>
<P>但实际上是行不通的。</P><pre class="code">$SAFE = 4; def a; end

=&gt; -:1: Insecure operation `(null)' at level 4 (SecurityError)
   ruby 1.6.4 (2001-06-04) [i586-linux]

=&gt; -:1: Insecure: can't define method (SecurityError)
   ruby 1.6.4 (2001-08-06) [i586-linux]
</PRE>
<P>对应的ChangeLog内容如下。</P><pre class="code">Tue Jun  5 15:16:06 2001  Yukihiro Matsumoto  &lt;matz@ruby-lang.org&gt;

        * eval.c (rb_add_method): should not call rb_secure(), for
          last_func may not be set.
</PRE>
<P>差别如下所示。</P><pre class="code">@@ -227,10 +227,7 @@ rb_add_method(klass, mid, node, noex)
     NODE *body;

     if (NIL_P(klass)) klass = rb_cObject;
-    if (klass == rb_cObject) {
-       rb_secure(4);
-    }
-    if (rb_safe_level() &gt;= 4 &amp;&amp; !OBJ_TAINTED(klass)) {
+    if (rb_safe_level() &gt;= 4 &amp;&amp; (klass == rb_cObject || !OBJ_TAINTED(klass))) {
        rb_raise(rb_eSecurityError, "Insecure: can't define method");
     }
     if (OBJ_FROZEN(klass)) rb_error_frozen("class/module");
</PRE>
<P>留作日后调查。</P>
IO#ioctl<!-- RDLabel: "IO#ioctl" --> 

<P>第2参数也可以接受Bignum了(为了覆盖long int的范围)</P>
<H2>1.6.3 (2001-03-19) -&gt; 1.6.4 (2001-06-04)<!-- RDLabel: "1.6.3 (2001-03-19) -> 1.6.4 (2001-06-04)" --></H2>

Hash#replace<!-- RDLabel: "Hash#replace" --> 

<P>以前，在哈希表迭代过程中，若删除某元素后，向其他哈希表中进行replace时，就会Abort。[ruby-dev:13432]</P><pre class="code">h  = { 10 =&gt; 100, 20 =&gt; 200 }
h2 = { }

h.each { |k, v|
  if (k == 10)
    h.delete(10)
    h2.replace(h)  # =&gt; Abort core dumped
  end
}
</PRE>
$SAFE / File::unlink<!-- RDLabel: "$SAFE / File::unlink" --> 

<P>在$SAFE &gt;= 2的环境中，即使参数未被污染也不能使用File.unlink。[ruby-dev:13426]</P><pre class="code">touch foo
ruby -v -e '$SAFE=2;File.unlink("foo")'

=&gt; ruby 1.6.3 (2001-03-19) [i586-linux]
=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   -e:1:in `unlink': Insecure operation `unlink' at level 2 (SecurityError)
           from -e:1
</PRE>
Object#untaint<!-- RDLabel: "Object#untaint" --> 

<P>现在不能对已冻结的对象使用untaint方法。[ruby-dev:13409]</P><pre class="code">a = Object.new
a.taint
a.freeze
a.untaint

=&gt; ruby 1.6.3 (2001-03-19) [i586-linux]
=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   -:4:in `untaint': can't modify frozen object (TypeError)
           from -:4
</PRE>
ruby -T4<!-- RDLabel: "ruby -T4" --> 

<P>指定-T4选项时，因为无法修改ARGV导致程序无法运行。[ruby-dev:13401]</P><pre class="code">touch foo
ruby-1.6.3 -v -T4 foo
=&gt; ruby 1.6.3 (2001-03-19) [i586-linux]
   foo: Insecure: can't modify array (SecurityError)
</PRE>
Regexp<!-- RDLabel: "Regexp" --> 

<P>现在，正则表达式中的 \1 .. \9 总是会被解释为反向参考(以前则不同，若有对应的括号则看作反向参考，若没有的话则看作8进制字符代码)。</P>
<P>在正则表达式中指定8进制字符代码时，请使用形如\001这种3位表示法。</P>
<P>另外，若反向参考中没有对应的括号，或者对应的括号中包含反向参考本身的话，则会引起匹配失败。</P><pre class="code">p /(foo)\2/ =~ "foo\002"
=&gt; ruby 1.6.3 (2001-03-19) [i586-linux]
   0
=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   0
=&gt; ruby 1.6.4 (2001-08-23) [i586-linux]
   nil
</PRE>
<P>(如上所示，1.6.4中仍然有bug。大概是在2001-08-23的时候得到了修正[ruby-list:30975])</P><pre class="code">p /(foo\1)/ =~ "foo"
=&gt; ruby 1.6.3 (2001-03-19) [i586-linux]
   0
=&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
   nil
</PRE>
污染字符串的传播 

<P>下列各项都会返回true。[ruby-dev:13340]</P><pre class="code"># []=
s1 = "abc"
s2 = "cde".taint
s1[0]= s2
p s1.tainted?             # =&gt; false

# crypt
s = "abc".taint
p s.crypt("cd").tainted?  # =&gt; false

# ljust
s = "abc".taint
p s.ljust(10).tainted?    # =&gt; false

# rjust
s = "abc".taint
p s.rjust(10).tainted?    # =&gt; false

# center
s = "abc".taint
p s.center(10).tainted?   # =&gt; false
</PRE>
rb_yield_0()<!-- RDLabel: "rb_yield_0()" --> 

<P>以前在C API中使用yield时，1个参数会被当作只包含1个元素的数组来处理。[ruby-dev:13299]</P><pre class="code">class X
  include Enumerable

  def each(&amp;block)
    block.call(1,2)
    block.call(2,3)
    block.call(3,4)
  end
end

x = X.new
p x.to_a #=&gt; [[1], [2], [3]]

# =&gt; ruby 1.6.3 (2001-03-19) [i586-linux]
     [[1], [2], [3]]

# =&gt; ruby 1.6.4 (2001-06-04) [i586-linux]
     [1, 2, 3]
</PRE>
$SAFE / alias<!-- RDLabel: "$SAFE / alias" --> 

<P>当$SAFE = 4时，不允许全局变量使用别名。 [ruby-dev:13287]</P>
Open3::popen3<!-- RDLabel: "Open3::popen3" --> 

<P>结束的进程不会调用at_exit。 (将exit修正为exit!) [ruby-dev:13170]</P>
SizedQueue#pop<!-- RDLabel: "SizedQueue#pop" --> 

<P>下列代码不会再导致死锁了。[ruby-dev:13169]</P><pre class="code">ruby -r thread -e 'q = SizedQueue.new(1); q.push(1);'\
               -e 'Thread.new{sleep 1; q.pop}; q.push(1);'
</PRE>
SizedQueue#max=<!-- RDLabel: "SizedQueue#max=" --> 

<P>以前当max大于当前值时，则会唤起相应的等待线程。但在该处理过程中存在错误。[ruby-dev:13170]</P>
Queue<!-- RDLabel: "Queue" --> 
SizedQueue<!-- RDLabel: "SizedQueue" --> 

<P>在调用Thread#run时，若线程忽然死亡则会引发ThreadError。现在已经针对这个问题进行了相应的处理。[ruby-dev:13194]</P>
Ctrl-C (Interrupt)失效<!-- RDLabel: "Ctrl-C (Interrupt)失效" --> 

<P>[ruby-dev:13195]</P><pre class="code">th1 = Thread.start {
  begin
    Thread.stop
  ensure
    Thread.pass
    Thread.stop
  end
}
sleep 1
</PRE>
<P>(据我所知，在ruby-1.7.0 (2001-05-17) 以后的版本中解决了这个问题，但1.6好像还不行)</P>
Array#&amp;<!-- RDLabel: "Array#&" --> 
Array#|<!-- RDLabel: "Array#|" --> 
Array#uniq<!-- RDLabel: "Array#uniq" --> 

<P>以前，结果数组中的元素均被冻结，不能修改。[ruby-list:29665]</P><pre class="code">(%w(foo bar) &amp; %w(foo baz))[0].upcase!
=&gt; -:1:in `upcase!': can't modify frozen string (TypeError)

%w(foo bar bar baz).uniq[0].upcase!
=&gt; -:1:in `upcase!': can't modify frozen string (TypeError)
</PRE>
shell.rb<!-- RDLabel: "shell.rb" --> 

<P>shell.rb 0.6被添加到标准库中。(文档在doc目录中)</P>
forwardable.rb<!-- RDLabel: "forwardable.rb" --> 

<P>forwardable.rb 1.1被添加到标准库中。(文档在doc目录中)</P>
irb.rb &amp; irb-tools<!-- RDLabel: "irb.rb & irb-tools" --> 

<P>irb和irb-tools分别升级到0.7.4和0.7.1。</P>
夏令时<!-- RDLabel: "夏令时" --> 

<P>对夏令时的考虑不周(？) [ruby-bugs-ja:PR#46]</P><pre class="code">env TZ=America/Managua ruby -e 'p Time.local(1998,12,1,0,59,59)'
=&gt; Mon Nov 30 01:59:59 EST 1998
env TZ=America/Managua ruby -e 'p Time.local(1998,12,1,0,59,59).tv_sec'   
=&gt; 912409199
</PRE>
SIGINFO<!-- RDLabel: "SIGINFO" --> 

<P>对4.4BSD的SIGINFO信号采取了相应的处理措施。[ruby-bugs-ja:PR#45]</P>
Thread.stop中的SEGV 

<P>有时会在Thread.stop中发生SEGV。[ruby-dev:13189]</P>
rescue 修饰部分<!-- RDLabel: "rescue 修饰部分" --> 

<P>下列代码在1.6.3中会引起parse error，现在已经修复了该bug。[ruby-dev:13073], [ruby-dev:13292]</P><pre class="code">raise "" rescue []
raise "" rescue (p "foo"; true)
raise "" rescue -1
raise "" rescue (-1)
</PRE>
Thread<!-- RDLabel: "Thread" --> 

<P>下列代码不会再引起dead lock了。</P><pre class="code">Thread.start { Thread.stop }
sleep

=&gt; deadlock 0x40199b58: 2:0  - -:1
   deadlock 0x401a2528: 2:4 (main) - -:2
   -:2:in `sleep': Thread: deadlock (fatal)
           from -:2
   ruby 1.6.3 (2001-03-19) [i586-linux]
</PRE>
Module#const_defined?<!-- RDLabel: "Module#const_defined?" --> 
Module#const_get<!-- RDLabel: "Module#const_get" --> 
Module#const_set<!-- RDLabel: "Module#const_set" --> 

<P>以前，这些方法甚至可以访问常数以外的对象。现在已经修正了该bug [ruby-dev:13019]</P>
Marshal.dump<!-- RDLabel: "Marshal.dump" --> 

<P>dump Float时精度由"%.12g"提升到了"%.16g"。 [ruby-list:29349]</P>
Fixnum#[]<!-- RDLabel: "Fixnum#[]" --> 

<P>好像是修正了在sizeof(long) &gt; sizeof(int)这种系统上的bug。</P>
正则表达式<!-- RDLabel: "正则表达式" --> 

<P>修正了2个较少见的bug [ruby-talk:13658], [ruby-talk:13744]</P>
retry<!-- RDLabel: "retry" --> 

<P>在1.6.3中，下列代码不能正常运行[ruby-talk:13957]</P><pre class="code">def WHILE(cond)
  return if not cond
  yield
  retry
end

i=0
WHILE(i&lt;3) {
  print i
  i+=1
}

ruby 1.6.2 (2000-12-25) [i586-linux]
=&gt; 012

ruby 1.6.3 (2001-03-19) [i586-linux]
=&gt; 0

ruby 1.6.4 (2001-05-02) [i586-linux]
=&gt; 012
</PRE>
File::Stat#size<!-- RDLabel: "File::Stat#size" --> 

<P>以前无法正确返回超过1G byte的文件的大小。</P><pre class="code">File.open("/tmp/1GB", "w") {|f|
  f.seek(2**30-1, 0)
  f.puts
  f.flush
  p f.stat.size
}

# =&gt; ruby 1.6.3 (2001-04-03) [i586-linux]
     -1073741824
# =&gt; ruby 1.6.4 (2001-04-19) [i586-linux]
     1073741824
</PRE>
Float#modulo, Float#divmod<!-- RDLabel: "Float#modulo, Float#divmod" --> 

<P>好像修正了一些问题 [ruby-dev:12718]</P>
ObjectSpace#_id2ref<!-- RDLabel: "ObjectSpace#_id2ref" --> 

<P>以前会莫名其妙地返回异常。</P>
malloc的递归调用问题 

<P>当stdio在内部调用malloc()时，会破坏其与Thread的兼容性，因此采取了一些补救措施。(通过使用setvbuf()，来避免调用malloc()) [ruby-dev:12795]</P>
File#flock<!-- RDLabel: "File#flock" --> 

<P>在File#flock锁定之后，有时会抛出Errno::EACCES异常，而并不会返回false(这种情况出现在没有flock()的系统中)</P>
File::Stat.new(filename)<!-- RDLabel: "File::Stat.new(filename)" --> 

<P>添加 [ruby-dev:12803]</P>
Bignum#%的计算错误 

<P>(再次)修正了导致% 计算错误的bug</P><pre class="code">a = 677330545177305025495135714080
b = 14269972710765292560
p a % b  #=&gt; 0
p -a % b #=&gt; 

=&gt; ruby 1.6.3 (2001-04-02) [i386-cygwin]
   0
   14269972710765292560

=&gt; ruby 1.6.4 (2001-04-19) [i586-linux]
   0
   0
</PRE>
Marshal<!-- RDLabel: "Marshal" --> 

<P>将Bignum进行dump -&gt; load操作之后得到的结果往往与原值不同。</P>
<P>在1.6.3版本之后，共进行了3次相关部分的修改。 请使用stable-snapshot的</P><pre class="code">ruby 1.6.3 (2001-03-22)
</PRE>
<P>之后的版本。</P>
Universal Naming Convention(UNC) 的支持(win32)<!-- RDLabel: "Universal Naming Convention(UNC) 的支持(win32)" --> 

<P>UNC 形式的路径名 (//host/share)得到了支持。使用斜线(`/')，而并非反斜线(`\')。 (其实以前就支持的，难道是修正bug了？？)</P>
Dir.glob (win32)<!-- RDLabel: "Dir.glob (win32)" --> 

<P>以前，无法对当前目录(./)进行glob。</P><pre class="code">p Dir["./*.c"]
=&gt; []
</PRE>
<H2>1.6.2 -&gt; 1.6.3 (2001-03-19)<!-- RDLabel: "1.6.2 -> 1.6.3 (2001-03-19)" --></H2>

do .. end 和 { .. }<!-- RDLabel: "do .. end 和 { .. }" --> 

<P>以前的版本认定二者的结合度相同，现在修正了这个bug。</P>
<P>在1.6.0到1.6.2之间的版本中，</P><pre class="code">method v { .. }
method v do .. end
</PRE>
<P>两者之间没有区别。正确的描述详见迭代器部分。</P>
Bignum#% 的计算错误 

<P>修正了导致 % 计算错误的bug</P><pre class="code">ruby-1.6.2 -ve 'p 6800000000%4000000000'
=&gt; ruby 1.6.2 (2000-12-25) [i586-linux]
   -1494967296

ruby-1.6.3 -ve 'p 6800000000%4000000000'
=&gt; ruby 1.6.3 (2001-03-10) [i586-linux]
   2800000000
</PRE>
特殊方法定义<!-- RDLabel: "特殊方法定义" --> 

<P>与通常的方法定义一样，也可以指定rescue, ensure部分</P><pre class="code">obj = Object.new
def obj.foo
rescue
ensure
end
</PRE>
String#count<!-- RDLabel: "String#count" --> 
String#delete<!-- RDLabel: "String#delete" --> 
String#squeeze<!-- RDLabel: "String#squeeze" --> 
String#tr_s<!-- RDLabel: "String#tr_s" --> 

<P>可以用'\-'来表示'-'(tr! 等、bang method也是一样的)。以前，只有字符串开头或末尾的'-'才会被看作是'-'。</P><pre class="code">p "-".tr("a-z",  "+")  # =&gt; "-"
p "-".tr("-az",  "+")  # =&gt; "+"
p "-".tr("az-",  "+")  # =&gt; "+"
p "-".tr('a\-z', "+")  # =&gt; "+" # 请注意单引号字符串
p "-".tr("a\\-z", "+") # =&gt; "+" # 在""中需要使用二个\
</PRE>
Regexp#==<!-- RDLabel: "Regexp#==" --> 

<P>所有选项都相同的话，则被判定为相同。以前，只要汉字代码选项 和 /i (case-insensitive)相同，就被看作是相同。</P>
%q(), %w()<!-- RDLabel: "%q(), %w()" --> 

<P>可以使用反斜线对字面值的末尾字符(`)'等)进行转义。</P>
Dir.glob<!-- RDLabel: "Dir.glob" --> 

<P>"**/"无法找到符号连接了。</P>
String#[]<!-- RDLabel: "String#[]" --> 

<P>现在"a"[1,2]会返回""。</P><pre class="code">p "a"[1,2]
=&gt; ""
</PRE>
<P>这是正确的结果。以前的老版本(1.4.6等)也都是对的。但1.6.0到1.6.2之间的版本则返回nil。</P>
<P>p "a"[2,1]返回nil。</P>
Object#taint<!-- RDLabel: "Object#taint" --> 

<P>无法对freeze的对象进行taint操作</P><pre class="code">obj = Object.new.freeze
obj.taint
=&gt; -:2:in `taint': can't modify frozen object (TypeError)
           from -:2
</PRE>


<div class="rpindex"><a href="87.html"> 下一页</a><a href="85.html"> 上一页</a><a href="index.html">首页</a></div>



<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
