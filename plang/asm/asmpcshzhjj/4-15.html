<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->


  <div  class="lpindex"><a href="index.html">目录</a> <a href="4-14.html">上一页</a> <a href="4-2.html">下一页</a> </div>
  <p>不难看出EXE程序比COM程序要优越，但有一点要说明：DOS调入EXE程序的速度比调入COM程序要慢，因为DOS要做一些额外的工作来保证EXE程序正确地运行。所以对于一些小程序，即使包括代码和数据，也不一定要用EXE程序的形式，采用COM程序的形式会更紧凑。程序PROG9.ASM给出了一个包括数据和代码的COM源程序： </p>
  <pre class="code">code	segment							；代码段开始
	assume	cs:code,ds:code				；通知编译程序CS、DS寄存器均指向代码段
	org	100h							；设置偏移地址为0100H
main	proc	near					；主过程开始
	jmp	start 							；跳过数据区 
			
mess	db 'Hello,World!',0dh,0ah,24h 	；定义一个字符串 
			
start:	mov	dx,offset mess				；程序开始，取得字符串首地址
	mov	ah,09 							；选择DOS API的09功能
	int	21h								；显示字符串
	int	20h								；结束程序，返回操作系统
			
main	endp	main 					；主过程结束
code	ends							；代码段结束
	end 								；进程结束 
</pre>
  <p>这个程序是前面给出的PROG3-B的源程序形式，程序中的&quot;START&quot;是一个标号，它表示了指令&quot;MOV DX，OFFSET   MESS&quot;的地址，值得注意的是它后面多了一个&quot;：&quot;，这个冒号是必须的。将这个程序编译成COM文件后我们可以用DEBUG将代码反汇编出来，和PROG3-B作个对比：</p>
  <pre class="code"> C:\ASM\&gt;DEBUG   PROG9.COM [Enter] 
-u100[Enter]
0A3E:0100		EB10		JMP		0112
0A3E:0102		90			NOP		
0A3E:0103		48			DEC		AX
0A3E:0104		65			DB		65
0A3E:0105		6C			DB		6C
0A3E:0106		6C			DB		6C
0A3E:0107		6F			DB		6F
0A3E:0108 		2C57 		SUB 	AL,57 
0A3E:010A		6F			DB		6F
0A3E:010B		726C		JB		0179
0A3E:010D		64			DB		64
0A3E:010E		210D		AND		[DI],CX
0A3E:0110		0A24		OR		AH,[SI]
0A3E:0112		BA0301		MOV		DX,0103
0A3E:0115		B409		MOV		AH,09
0A3E:0117		CD21		INT		21
0A3E:0119 		CD20		INT 	20
</pre>
  <p>区别是很明显的：字符串本是数据，但DEBUG将它们当成了指令机器码，这是DEBUG不够聪明的地方；最奇怪的是&quot;JMP   0112&quot;下面多了个&quot;NOP&quot;，这又是什么呢？</p>
  <p> &quot;NOP&quot;是一条真正的指令，它不执行任何实际的动作，是一条&quot;空操作&quot;（No   Operation）指令。这就让人有些犯迷糊了，源程序中并没有这个指令，为什么编译后却多了这样一个东西？想搞清这个问题，我们就必须先详细讨论和转移指令有关的&quot;短程、近程与远程&quot;的问题。</p>
  <p>JMP指令究竟被编译成什么样子？观察PROG9的反汇编形式，可以看到JMP   0112的机器码是&quot;EB   10&quot;两个十六进制数。如果&quot;EB&quot;是&quot;JMP&quot;指令对应的机器码，那么&quot;10&quot;又是什么呢？目的地址&quot;0112&quot;又在何处呢？</p>
  <p>如果把目的地址&quot;0112&quot;同指令&quot;NOP&quot;的地址做一次减法，问题就清楚了：<br />
    0112H   -   0102H＝10H</p>
  <p>&quot;10&quot;是目的地址相对&quot;JMP&quot;后面指令所在位置的偏移量，具体的目的地址并不出现在机器码中，而要由CPU自己算出来。这种情况仅限于&quot;短程&quot;和&quot;近程&quot;转移，远程转移时目的地址将以&quot;段：偏移&quot;的形式出现在机器码中。</p>
  <p>对于&quot;短&quot;转移来讲，由于偏移量在－128--＋127之间，使用一个字节即可记录偏移量，所以短转移指令仅占两个字节。而近转移的偏移量要用两个字节记录，整个指令要占三个字节。</p>
  <p>当使用MASM或TASM编译源程序时，编译程序要对源程序作两遍扫描。由于在源程序中未明确给出&quot;JMP&quot;指令是短程还是近程，所以编译程序在第一遍扫描时就默认&quot;JMP&quot;指令是近程的，并在目标程序中为其保留了三个字节空间。然而在第二遍扫描时编译程序算出其偏移量 小于＋127，仅占一个字节，因此，编译程序便自动地将另一个字节置成&quot;90H&quot;，于是在可执行程序中就有了&quot;NOP&quot;指令。</p>
  <p> 如果不想程序中出现&quot;NOP&quot;指令，那么就必须在源程序中明确指出&quot;JMP&quot;指令是&quot;短程&quot;跳转，这只需将第一条指令改写成&quot;JMP   SHORT START&quot;即可，指令中的&quot;SHORT&quot;就是告诉编译程序将此处的&quot;JMP&quot;指令处理为短程转移。 </p>
  <div  class="rpindex"><a href="4-2.html">下一页</a><a href="4-14.html">上一页</a> <a href="index.html">目录</a> </div>


<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
