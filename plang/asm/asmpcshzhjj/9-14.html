<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->


  <div class="lpindex"><a href="index.html">目录</a> <a href="9-13.html">上一页</a> <a href="9-2.html">下一页</a> </div>
  <p>当然，程序中出现的新指令我们还是要先讨论的。</p>
  <p>助记符：NEG（Negate）<br />
    用　途：求一个数的相反数<br />
    格　式：NEG  寄存器</p>
  <p>　NEG  存储单元<br />
    执　行：寄存器或存储单元中原有数据被其相反数代替 </p>
  <p>很多参考书上都把这条指令称为&quot;求补&quot;指令，这个&quot;求补&quot;说得有些含糊，给人的感觉好象是源操作数不是补码形式，可能是原码或反码，执行此指令后源操作数将被其补码代替。其实汇编语言中出现的数都是补码形式，根本不需要再求。所以说这条指令的实际用途是求源操作数的相反数，NEG(-1) = +1，NEG 30 = -30。 </p>
  <p>助记符：JGE  （Jump if Great or Equal）<br />
    用　途：比较两个数，根据比较结果进行转移<br />
    格　式：JGE	目的地址<br />
    执　行：两个数相比较，第一个数大于或等于第二个数时此指令完成转移。 </p>
  <p>这是一个条件转移指令，它类似于指令JAE。如同指令JA与JAE的关系一样，与这个指令沾亲的一条指令就是&quot;JG（Jump if Great）&quot;。而和这一对指令相对立的指令对就是&quot;JL（Jump if Less）&quot;与&quot;JLE&quot;。这一组四条指令与前面见过的指令&quot;JA/JAE&quot;、&quot;JB/JBE&quot;好象如出一辙，大有重复的嫌疑，其实不然，这里面还有些小奥妙。</p>
  <p> 在讨论这组指令的区别之前，我们先编两小段程序： </p>
  <h5>PROG1.ASM</h5>
  <pre class="code">        code  segment
              assume    cs:code,ds:code
              org       100h
        main  proc      near
              jmp       start
       mess1  db        'Great!',0dh,0ah,'$'
       mess2  db        'Less!',0dh,0ah,'$'
      start:
              mov       ah,1
              mov       al,255
              mov       dx,offset mess1
              cmp       al,ah
              ja        outmess
              mov       dx,offset mess2
    outmess:
              mov       ah,09h
              int       21h
              mov       ah,4ch
              int       21h
        main  endp
        code  ends
              end       main
</pre>
  <h5>PROG2.ASM</h5>
  <pre class="code">        code  segment
              assume    cs:code,ds:code
              org       100h
        main  proc      near
              jmp       start
       mess1  db        'Great!',0dh,0ah,'$'
       mess2  db        'Less!',0dh,0ah,'$'
      start:
              mov       ah,1
              mov       al,255
              mov       dx,offset mess1
              cmp       al,ah
              jg        outmess
              mov       dx,offset mess2
    outmess:
              mov       ah,09h
              int       21h
              mov       ah,4ch
              int       21h
        main  endp
        code  ends
              end       main
</pre>
  <p>这两小段程序比较好理解，它将AL寄存器中的数和AH寄存器相比较，如果AL&gt;AH则输出字符串&quot;Great!&quot;，否则输出&quot;Less!&quot;。我们特意在AL寄存器内装入了255，在AH寄存器内装入了1，所以这个程序会毫无疑问地输出&quot;Great!&quot;</p>
  <p>　程序PROG2的结构和PROG1完全相同，只是其中的指令&quot;JA&quot;被换成了&quot;JG&quot;而已。然而就是这一点点变化，却使这个程序输出的结果与PROG1完全不同。本来255是大于1的，而这个程序却输出了&quot;Less!&quot;，难道255反而小于1吗？</p>
  <p> 实际上255的确是小于1的，因为从补码的角度来看255实际是个负数。由此我们可以推测出指令&quot;JA/JB&quot;与&quot;JG/JL&quot;的一个重要的区别：指令&quot;JA/JB&quot;总是将相比较的两个数当成&quot;无符号数&quot;，而指令&quot;JG/JL&quot;则是将相比较的两个数当成&quot;带符号数&quot;。这样的一种特性就要求我们在编写程序时头脑之中要很清楚相比较的两个数是不是带符号的，以便于我们选择下面的条件转移指令。</p>
  <p> 在8086的指令集中有很多条件转移指令，这些指令所判断的标志位各不相同，而且有些指令在形式上还有变化，因此条件转移指令其实是8086汇编语言程序设计中的一个难点。关于标志寄存器与条件转移指令的有关问题我们将在下面一章加以讨论。</p>
  <p> LOVE.ASM程序的核心部分就是LINE子过程，这个子过程用于在两个点之间画直线。与我们讨论的Bresenham算法相比这个子过程在画线之前做了好多额外的计算与判断，这主要是因为实际画线的方向并不都是从左上到右下。</p>
  <p> 假如画线方向是从右上到左下，那么X坐标的增量就不是+1，而是-1。即使所画线的方向是从左上至右下，由于直线的斜率不同，究竟是以X坐标作为循环计数而调整Y坐标，还是以Y坐标作为循环计数调整X坐标也是有区别的。所以实际的Bresenham算法在真正画线之前要对各种不同的画线方向进行一些判断来确定画线时的各项参数。</p>
  <p> 本节至此已经对BIOS提供的绘图功能做了较详细地介绍，同时给出了描绘文字以及绘制直线的算法。BIOS的功能还是很多的，它不仅提供了&quot;画点&quot;功能，同时还提供了&quot;读点&quot;功能，即判断屏幕上某个位置的点的颜色。 </p>
  <p>功能号：0DH<br />
    用　途：取得图形屏幕上指定位置点的颜色<br />
    参　数：CX=指定位置的X坐标<br />
    DX=指定位置的Y坐标<br />
    调　用：INT 10H<br />
    返　回：AL = 所读点的颜色值 </p>
  <p>这个功能好象在电子游戏程序中可以用到，比如编写一个射击游戏，在判断子弹是否击中物体时就可以应用这个功能。下面给出的程序是一个&quot;动画&quot;程序，它先在屏幕上画出一个方框，然后在方框内显示一个作直线运动的白点，当这个白点撞到方框边缘时就会反弹。程序中就是应用了BIOS的读点功能判断彩色点是否&quot;撞到&quot;边框的： </p>
  <h5>PINGPONG.ASM</h5>
  <pre  class="code">        code  segment
              assume    cs:code,ds:code
              org       100h
        main  proc      near
              jmp       start	；跳过数据区
        mess  db        'Press Any Key...',0dh,0ah,'$'
      start:  mov       ax,0004	；设置图形显示模式4
              int       10h
			；画方框上下两条水平线
              mov       cx,10	；上一条水平线位于屏幕第10线
              mov       dx,10
              mov       bx,300	；水平线的长度为300点
              mov       al,1	；水平线颜色为青色
              mov       si,1	；定X方向增量为1
              mov       di,0	；定Y方向增量为0
              call      line	；调用LINE子过程
              mov       dx,190	；下一条水平线位于屏幕第190线
              call      line	；调用LINE子过程
			；画方框左右两条垂直线
              mov       dx,10	；左侧垂直线起点Y坐标
              mov       al,2	；垂直线的颜色为洋红
              mov       bx,180	；垂直线长度为180点
              xchg      si,di	；交换X，Y方向的增量值
              call      line	；调用LINE子过程
              mov       cx,310	；右侧垂直线位于X坐标310处
              call      line	；调用LINE子过程
			
              mov       ah,9	；显示字符串
              mov       dx,offset mess
              int       21h
			
              mov       ah,0	；等待键盘输入
              int       16h
			
              mov       si,1	；X，Y方向的增量值均设为1
              mov       di,1
              mov       cx,56	；起始位置的（X，Y）坐标
              mov       dx,47
      point:
              add       cx,si	；计算新位置的（X，Y）坐标
              add       dx,di
              mov       ah,0dh	；取得新位置处点的颜色
              int       10h
              push      ax	；暂存取得的颜色值
			
              mov       al,3	；在新位置画一个白色的点
              mov       ah,0ch
              int       10h
			
              mov       ah,10	；延迟一段时间
      delay:  mov       bx,0
     delay1:  dec       bx
              jnz       delay1
              dec       ah
              jnz       delay
			
              pop       ax	；利用原来的颜色画一个点
              mov       ah,0ch
              int       10h
			
              cmp       al,2	；这个位置上有洋红色的线通过吗？
              jz        neg_x	；若有洋红色的线，转NEG_X继续
              cmp       al,1	；这个位置上有青色的线通过吗？
              jz        neg_y	；若有青色的线，转NEG_Y继续
              jmp       point	；若此位置没有线通过，转POINT继续画点
      neg_x:
              neg       si	；将X方向的增量改为-1
              jmp       point	；转POINT继续画点
      neg_y:
              neg       di	；将Y方向的增量改为-1
              jmp       point	；转POINT继续
        main  endp
			
        line  proc      near	；画线子程序
              push      ax	；保存寄存器
              push      bx
              push      cx
              push      dx
   lineloop:
              mov       ah,0ch	；在CX-DX指定的位置画点
              int       10h
              add       cx,si	；X，Y坐标分别加上增量值
              add       dx,di
              dec       bx	；线上所有点都画完了吗？
              jnz       lineloop	；若未画完全部点，转LINELOOP继续
			
              pop       dx	；恢复寄存器原值
              pop       cx
              pop       bx
              pop       ax
              ret       ；返回主过程
        line  endp
        code  ends
              end       main
</pre>
  <p>有关这个程序还有几点需要说明的：</p>
  <p> 　　（1）这个程序中LINE子过程并没有使用Bresenham画线算法，原因是程序所需要画的线都是水平或垂直的，采用Bresenham算法画这样的线反而没有效率。<br />
    （2）这个程序使用两种颜色绘制边框水平线是青色，垂直线是品红色。这样做的原因是由于当运动的点遇到水平线反弹时应该变化Y坐标的增量，遇到垂直线反弹时要变化X坐标的增量，所以程序必须有方法区分水平边框和垂直边框。<br />
    （3）这个程序演示了一种生成&quot;动画&quot;的方法，即先在起始位置画出一幅图，延迟一段时间后将其擦除，随后在相邻的位置画出另一幅图，如此循环就能产生动画效果。</p>
  <p> 以上我们给出的绘图程序都是使用CGA提供的彩色组1中的四种色彩，如果大家想看看CGA的另一组彩色，可以使用BIOS提供的一个控制色彩的功能，这就是10H中断的0BH功能： </p>
  <p>功能号：0BH<br />
    用　途：设置当前的彩色组<br />
    参　数：BH=0时，设置背景颜色，其颜色值在BL中定义（用于字符模式）<br />
    BH=1时，BL中的值为调色板号（用于图形模式）<br />
    调　用：INT 10H<br />
    返　回：无 </p>
  <p>利用这个功能将PINGPONG程序修改成&quot;PINGPONG2.ASM&quot;的样子就可以看到彩色组0中的四种 色彩了。从直观上看彩色组0中的四种色彩比彩色组1要漂亮些，而且对比修改前后程序的输出我们还可以看到字符串&quot;Press Any Key…&quot;的颜色总是四种颜色中的最后一种，这也可以算是个小规律吧。至于字符的颜色是否可以改变就需要大家自己去研究了。</p>
  <p> 以上所讨论的内容就是BIOS为我们提供的几个有关图形的功能调用，熟练掌握这些功能有助于我们更深入的学习8086/88汇编语言图形程序的设计方法。不过如我们在第六章中所讲的那样，BIOS功能虽然应用方便，但是它的一个很大的缺点就是调用速度比较慢，不利于编制快速的图形程序。要想编制出高速的图形程序，我们还是需要直接对视频缓冲存储器进行操作，这就是本章第二节所要讨论的内容。 </p>
  <h5>PINGPONG2.ASM</h5>
  <pre class="code">        code  segment
              assume    cs:code,ds:code
              org       100h
        main  proc      near
              jmp       start
        mess  db        'Press Any Key...',0dh,0ah,'$'
      start:  mov       ax,0004
              int       10h
              mov       ah,0bh
              mov       bh,1
              mov       bl,0
              int       10h
；以下同PINGPON	G.ASM</pre>
  <div class="rpindex"> <a href="9-2.html">下一页 </a><a href="9-13.html">上一页</a><a href="index.html">目录</a> </div>


<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
