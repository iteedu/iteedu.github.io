<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->


  <div  class="lpindex"><a href="index.html">目录</a> <a href="6-52.html">上一页</a> <a href="7-1.html">下一章</a> </div>
  <p>相对于键盘缓冲区而言，&quot;键盘状态字&quot;要简单得多，这是一个16位的数据，位于逻辑地址0040H:0017H处，各个位为1时的定义如图6-12所示： </p>
  <p><img src="figures/F6_12.gif"  height="198" /></p>
  <h4>图6-12 键盘状态字</h4>
  <p>键盘状态字的变化可以用DEBUG来观察： </p>
  <pre class="code">C:\ASM\&gt;DEBUG[Enter]
-d40:17 18[Enter]
0040:0010?00-00?..
（按下Caps Lock） 
-d40:17 18[Enter]
0040:0010?40-00?@.
（再按下Scroll Lock） 
-d40:17 18[Enter]
0040:0010?50-00?P.
（再按下Insert） 
-d40:17 18[Enter]
0040:0010?D0-00?..
-d40:17 18[Enter]（按住左Shift不放，再按下Enter键）
0040:0010?D2-00?..
</pre>
  <p>　由实验可知键盘状态字的Bit0－Bit3位反映了开关键的状态，而Bit4－Bit15是动态的，只在各键按下时设置，放开键后便重新发复位了。</p>
  <p> 至此我们已经把键盘输入的情况大概讨论了一便，可以看到一个键由按下直至被应用程序收到大致经过了如图6-13所示的一个过程：</p>
  <p> 通过这一节的学习，大家还可能会发现这样一个现象：我们所关心的一些重要的系统数据好象都放在了0040H段中，前面我们讨论定时的时候也提到过系统时钟计数值也位于40H段内，那么40H段究竟有什么不寻常的地方呢？</p>
  <p> 其实40H段并没有什么不寻常之处，我们知道在启动PC时CPU首先执行ROM内的程序，这段程序用于完成系统的检测以及DOS的启动。这段程序运行时总要保存一些检测结果和一些临时数据，这些数据当然不能放在ROM中，因此BIOS程序就在中断向量表的上面开僻了一块空间专用于保存自己的数据，我们一般称其为BIOS数据区，这便是40H段的由来。本书的附录中列出BIOS数据区的详细内容，需要时大家可以查阅。 </p>
  <p><img src="figures/F6_13.gif"  height="200" /></p>
  <h5>图6-13 按键处理流程</h5>
  <h5>表6-5 16H中断的功能 </h5>
  <table cellspacing="0" cellpadding="0">
    <tr>
      <td>功能号</td>
      <td>用途</td>
      <td>说明</td>
    </tr>
    <tr>
      <td>00</td>
      <td>等待键盘输入字符</td>
      <td>AL=ASCII码</td>
    </tr>
    <tr>
      <td></td>
      <td></td>
      <td>AH=按键扫描码</td>
    </tr>
    <tr>
      <td>01</td>
      <td>从键盘缓冲区内读一个字符</td>
      <td>ZF=0：AL=ASCII码</td>
    </tr>
    <tr>
      <td></td>
      <td></td>
      <td>AH=按键扫描码</td>
    </tr>
    <tr>
      <td></td>
      <td></td>
      <td>ZF=1：缓冲区内无字符</td>
    </tr>
    <tr>
      <td>02</td>
      <td>取键盘状态字低8位</td>
      <td>AL=键盘状态字低8位</td>
    </tr>
  </table>
  <p>根据表6-5可知1号功能用于判断键盘缓冲区是否有字符可供读出，2号功能用于取得键盘状态字的低8位。这两个功能看上去好象不大常用，实际上1号功能还是十分有用的。请考虑编制这样一个程序：打开定时器发出10秒钟的声音（频率不限），在这十秒钟内若Esc键按下则关闭定时器并结束程序，否则10秒钟后停止发声并结束。</p>
  <p> 解决这个问题已不能使用16H中断的0号功能了，因为这个功能在没有键按下时会循环等待，所以程序应用这个功能就不能完成10秒定时发声。怎样才能达到要求？我们可以设想如果能够在键盘的确有键按下时才调用16H中断的0号功能，而在无键按下时去完成定时工作，这样就可解决问题。这里就要用到16H中断的1号功能了。请看BEEP.ASM程序。</p>
  <h5>BEEP.ASM</h5>
  <pre class="code">        code  segment
              assume    cs:code
              org       100h
        main  proc      far
              in        al,61h	；打开定时器发声
              or        al,3
              out       61h,al
			
              mov       ah,0	；取得当前时钟计数
              int       1ah
			
              mov       bx,dx	；当前时钟计数存入BX寄存器
              add       bx,182	；当前时钟计数加182
      delay:
              mov       ah,1	；从键盘缓冲区内取字符
              int       16h
              jz        next	；如键盘缓冲区空则转NEXT
              cmp       ah,1	；如取到字符，判断是Esc键吗？
              jz        exit	；是Esc键转EXIT
       next:
              mov       ah,0	；取得时钟计数
              int       1ah
              cmp       bx,dx	；到时间了吗？
              jnz       delay	；未到时间，转DELAY继续等待
       exit:
              in        al,61h	；停止发声
              and       al,0fch
              out       61h,al
			
              mov       ah,4ch	；结束程序
              int       21h
        main  endp
        code  ends
              end       main
</pre>
  <p>　这个程序没什么难点，无非是在前面讨论的定时算法基础上加入了键盘输入判断，以此来决定何时中断定时而处理键盘输入。到这里我们这一节的内容也就结束了，要注意的是还有一些有关键盘的功能调用是由DOS为我们提供的，这些内容我没有讲解，大家可以自己找资料研究。</p>
  <h4>本章结束语 </h4>
  <p> 在这一章里我们详细地研究了有关显示输出与键盘输入的内容，和其它书籍不同的是我们把BIOS和硬件作为主要研究的对象而忽略了DOS。我这样做是有原因的：</p>
  <p> （1）汇编语言本身就是面向硬件的语言，这就要求我们必须要对系统硬件有十分深入的了解，这样才可能编制出高效快速且色彩丰富的程序来；<br />
    （2）DOS的寿命还有多长现在还是未知数，WINDOWS95已经推出，更新的操作系统还会出现，新的操作系统是不是还保持对DOS的兼容呢？我想即使新的操作系统仍然兼容DOS，使用DOS的功能调用也没有什么优势可言，因此笔者忽略了DOS。况且从形式上看BIOS中断调用与DOS中断调用并无区别，研究DOS的功能调用也并不困难。</p>
  <div class="rpindex"><a href="7-1.html">下一章</a><a href="6-52.html">上一页</a> <a href="index.html">目录</a> </div>


<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
