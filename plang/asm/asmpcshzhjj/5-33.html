<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->


  <div  class="lpindex"><a href="index.html">目录</a> <a href="5-32.html">上一页</a> <a href="5-34.html">下一页</a> </div>
  <p>在实际应用中这个前缀往往采用这样两种形式： </p>
  <p><font face="宋体" lang="ZH-CN" size=3><font size=5>REPE/REPZ-REPNE/REPNZ</p>
  <p>指令中的&quot;E&quot;和&quot;Z&quot;与前面讨论的条件转移指令&quot;JE/JZ&quot;和&quot;JNE/JNZ&quot;中的&quot;E&quot;、&quot;Z&quot;含义相同。REPE的意思就是&quot;Repeat While equal&quot;--相等则重复，NE自然是&quot;Not Equal&quot;了。在前面的程序中我们使用了&quot;REPNZ&quot;作为前缀，因为我们要寻找一个与AL寄存器相等的数据，自然要在&quot;不相等&quot;的情况下重复SCASB指令，而一旦找到相等的数据，即使CX不为0，REP也会停止。这样做可以提高程序的效率，避免无意义的搜索。如果我们要在一串相同的数据中寻找一个与众不同者，那么自然要用&quot;REPE&quot;或&quot;REPZ&quot;作前缀了。 </p>
  <p>　由于SCAS指令的实际动作是将串中的数据与累加器进行比较，&quot;找到&quot;意味着ZF＝1，&quot;找不到&quot;对应ZF＝0，因此我们可以用&quot;JZ/JNZ&quot;指令来检测扫描结果。注意在计算&quot;$&quot;的位置时我们让DI寄存器多减了1，想一想这是为什么。</p>
  <p> 至此我们已经可以在一个串中寻找到一个字节或一个字的数据，下面我们来讨论一个更复杂的问题--如何在一个字符串中找到一个&quot;子字符串&quot;？<br />
    按照前面的习惯，我们先看看一般的解决办法：</p>
  <h5> SCHSTR.ASM </h5>
  <pre class="code">        data  segment
              assume    ds:data
string	db'The sa	me sunshine is presented to all those who love sunshine',0	
substrg	db'sunshi	ne',0	
ascii	db'012345	6789ABCDEF'	
        data  ends
			
        code  segment
              assume    cs:code
        main  proc      far
              mov       ax,data	；初始化DS寄存器指向数据段
              mov       ds,ax
              mov       di,offset string	；DI寄存器指向字符串STRING
   next_str:
              mov       si,offset substrg	；SI寄存器指向待查字符串
              lodsb     ；取得待查字符串的第一个字母
     search:
              cmp       al,byte ptr [di]	；将取到的字符与DI指向的字符进行比较
              jz        nextchar	；若相同则继续比较其余字符
              inc       di	；不相同则DI寄存器指向下一个字符
              cmp       byte ptr [di],0	；DI寄存器已经指向字符串末尾了吗？
              jnz       search	；未到末尾，转SEARCH继续比较
              jmp       exit	；已到末尾，转EXIT结束程序
   nextchar:
              mov       bx,di	；BX寄存器取得字符串指针
   cmp_next:
              cmp       byte ptr [si],0	；已经比完所有字符了吗？
              jz        out_di	；比完所有字符，转OUT_DI输出DI的值
              lodsb     ；取得待查字符串的下一个字母
              inc       bx	；BX中的指针加1，指向下一个字符
              cmp       al,byte ptr [bx]	；比较两个字符
              jz        cmp_next	；两字符相同，转CMP_NEXT比下一个字符
              jmp       continue	；两字符不同，转CONTINUE
     out_di:  mov       ax,di	；DI寄存器中的指针送入AX寄存器
              sub       ax,offset string	；计算待查字符串在源串中的偏移位置
              mov       bx,offset ascii	；BX寄存器指向ASCII表
              mov       cx,4	；输出4个数位
    outloop:  rol       ax,1	；AL寄存器循环左移4位
              rol       ax,1
              rol       ax,1
              rol       ax,1
              push      ax	；暂存AX寄存器
              and       ax,000fh	；保留AX寄存器的低4位
              xlat      ；取得对应的ASCII码
              mov       ah,0eh	；利用10H中断的0EH功能
              int       10h	；输出AL寄存器中的字符
              pop       ax	；取回AX寄存器
              loop      outloop	；处理下一个数位
              mov       ax,0e0dh	；输出回车符
              int       10h
              mov       al,0ah	；输出换行符
              int       10h
   continue:
              inc       di	；DI寄存器指向下一个字符
              jmp       next_str	；转NEXT_STR继续搜索待查串的首字符
       exit:  mov       ah,4ch	；结束程序
              int       21h
              endp
        main  ends
        code  end       main
</pre>
  <p>这个程序首先在给定字符串中寻找子串的第一个字符，找到后将后面的字符与子串进行比较，若后面的字符均相同则输出首字符的偏移量；否则继续在剩余的字符中寻找。找到第一个子串后程序并未结束，而是继续在源字符串中搜索，直至整个字符串全部搜索完毕。不难看出这个程序的结构不很理想，我们用了许多的转移指令，使程序的流程显得比较混乱。那么用串处理指令能否使程序得以简化呢？请看下面的程序：</p>
  <h5> SCHSTR1.ASM</h5>
  <pre class="code">        data  segment
              assume    ds:data
string	db'The sa	me sunshine is presented to all those who love sunshine',0	
substrg	db'sunshi	ne'	
ascii	db'012345	6789ABCDEF'	
        data  ends
			
        code  segment
              assume    cs:code
        main  proc      far
              mov       ax,data	；初始化DS、ES寄存器指向数据段
              mov       ds,ax
              mov       es,ax
              mov       di,offset string	；DI寄存器指向源字符串
  next_char:
              cmp       byte ptr [di],0	；DI寄存器指向源字符串末尾了吗？
              jz        exit	；若DI寄存器已指向末尾则结束程序
              push      di	；暂存DI寄存器
              mov       si,offset substrg	；SI寄存器指向待查字符串
              mov       cx,8	；比较8个字符
        repz  cmpsb     ；将待查字符串与DI指向的8个字符相比
              pop       di	；恢复DI寄存器
              jcxz      out_di	；若8个字符均相同则输出DI寄存器的指针
              inc       di	；DI寄存器指向下一个字符
              jmp       next_char	；转NEXT_CHAR继续比较
     out_di:  mov       ax,di	；DI寄存器中的指针送入AX寄存器
              sub       ax,offset string	；计算待查字符串在源串中的偏移位置
              mov       bx,offset ascii	；BX寄存器指向ASCII表
              mov       cx,4	；输出4个数位
    outloop:  rol       ax,1	；AL寄存器循环左移4位
              rol       ax,1	；暂存AX寄存器
              rol       ax,1
              rol       ax,1
              push      ax
              and       ax,000fh	；保留AX寄存器的低4位
              xlat      ；取得对应的ASCII码
              mov       ah,0eh	；利用10H中断的0EH功能
              int       10h	；输出AL寄存器中的字符
              pop       ax	；取回AX寄存器
              loop      outloop	；处理下一个数位
              mov       ax,0e0dh	；输出回车符
              int       10h
              mov       al,0ah	；输出换行符
              int       10h
              inc       di	；DI寄存器指向下一个字符
              jmp       next_char	；转NEXT_CHAR继续搜索待查串的首字符
       exit:  mov       ah,4ch	；结束程序
              int       21h
        main  endp
        code  ends
              end       main
</pre>
  <p>在这个程序我们又新增了两条指令--CMPS和JCXZ:</p>
  <p>助记符：CMPS（Compare string）<br />
    用　途：比较两个数据串<br />
    格　式：CMPSB（按字节比较）<br />
    CMPSW（按字比较）<br />
    执　行：将位于DS：SI处的数据和位于ES：DI处的数据进行比较操作，并根据比较结果设定标志位，而后SI，DI两寄存器根据DF标志的状态相应增减。</p>
  <p>相信大家对指令末尾的字母&quot;B&quot;和&quot;W&quot;已经有所领悟，不再多说。这条指令的特点是直接对存储器中的数据进行操作，和SCAS指令一样，如果不加REP前缀，那么这个指令也只能对一对数据进行比较，不能比较整串数据。因此在程序中我们使用了REPZ，目的是在两字符相同的情况下继续比较下一个字符。可以想到如果两字符串完全相同，那么这种比较会导致两种后果--ZF＝1且CX＝0。我们完全可以用&quot;JZ/JNZ&quot;指令检测比较的结果，但在上面的程序中我们使用了一条新指令：</p>
  <p>助记符：JCXZ（Jump if cx is zero）<br />
    用　途：根据CX寄存器的情况进行转移<br />
    格　式：JCXZ  目的地址<br />
    执　行：判断CX寄存器情况，若CX＝0则转移到目的地址处执行指令，否则继续执行下面的指令。</p>
  <p>从本质上讲&quot;JCXZ&quot;也是条件转移指令，但它的转移条件有些不寻常，并非受标志寄存器控制，而直接受控于CX寄存器。当然，既然是条件转移指令，它也只能是短程的。和JZ指令不同，它没有转移条件相反的指令，JCXNZ是不存在的。在上面的程序中将JCXZ指令换成JZ指令也是可以的，只不过是取了不同的转移条件罢了。</p>
  <p> 从思路上看这两个程序并无区别，但使用串处理指令的程序要比采用一般方法的程序简捷一些，主要是少了一些易混乱的转移指令。学到这里我们应该对串处理指令的特性有了明确的认识，&quot;串处理&quot;的核心主要在于这样一些硬件：累加器、计数器、DS：SI寄存器组合、ES：DI寄存器组合、DF标志。同时还有一个指令前缀--REP。</p>
  <div  class="rpindex"><a href="5-34.html">下一页</a><a href="5-32.html">上一页</a> <a href="index.html">目录</a> </div>


<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
