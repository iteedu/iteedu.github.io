<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->


  <div  class="lpindex">
    <!导航条>
    <a href="index.html">目录</a> <a href="6-42.html">上一页</a> <a href="6-51.html">下一页</a> </div>
  <h2>6．5 键盘输入 </h2>
  <h4>6.5导航：<a href="6-5.html">第一页</a> <a href="6-51.html">第二页</a> <a href="6-52.html">第三页</a> <a href="6-53.html">第四页</a></h4>
  <p>　我们早已研究了如何通过21H或16H中断调用来取得按键的信息，但我们对这些信息究竟是如何产生的还一无所知，这一节我们就要更细致地讨论这个问题。那么首先我们把上一节留下的问题解决掉。<br />
    我们在前面编制过一个&quot;TESTKEY&quot;程序，下面这个程序是&quot;TESTKEY&quot;的一个升级版本： </p>
  <pre class="code">TESTKEY2	.ASM		
     ESC_KEY  equ       01h	；一个与ESC键有关的常量
        code  segment
              assume    cs:code
              org       100h
        main  proc      far
              jmp       continue	；跳过数据区
       ascii  db        '0123456789ABCDEF'	；十六进制数对应的ASCII码
   continue:
              push      cs	；通过堆栈将CS寄存器送入DS寄存器
              pop       ds
    waitkey:
              mov       ah,0	；等待键盘输入
              int       16h
              call      out_ax	；调用OUT_AX子过程输出AX寄存器的值
              cmp       ah,ESC_KEY	；输入的是ESC键吗？
              jnz       waitkey	；不是ESC键则转WAITKEY继续
              mov       ah,4ch	；结束程序
              int       21h
        main  endp
			
      out_ax  proc      near	；OUT_AX子过程
              push      ax	；暂存AX寄存器
              mov       bx,offset ascii	；BX寄存器指向ASCII表
              mov       cx,0404h	；设置循环计数与移位计数
    outloop:
              rol       ax,cl	；将AX寄存器的高4位移至低4位
              mov       dx,ax	；用DX寄存器暂存移位后的结果
              and       ax,000fh	；保留AX低4位（实际是移位前的高4位）
              xlat      ascii	；取得对应的ASCII码
              mov       ah,0eh	；利用10H中断的0EH功能
              int       10h	；输出一个数字
              mov       ax,dx	；取回DX寄存器中的移位结果
              dec       ch	；循环计数减1
              jnz       outloop	；循环至OUTLOOP继续输出下一个数位
			
              mov       ax,0e0dh	；输出回车符
              int       10h
              mov       al,0ah	；输出换行符
              int       10h
              pop       ax	；恢复AX寄存器
              ret       ；返回
      out_ax  endp
        code  ends
              end       main
</pre>
  <p>这个程序不仅可以显示出按键的ASCII码，还可以显示出16H中断的0号功能在AH寄存器中返回的数据。运行这个程序，会发现AH寄存器中的数据与所按键的ASCII码好象并无关系，比如按下打字键盘上的数字&quot;1&quot;键，可以看到AX寄存器返回的数据是0231H，其中31H是按键的ASCII码；如果按住Shift键再按下数字&quot;1&quot;键，此时AX寄存器返回0221H，21H是&quot;!&quot;的ASCII码，而AH寄存器中的数据竟然没变；如果按下右边数字小键盘上的&quot;1&quot;，就会看到AX寄存器中返回4F31H，31H仍是&quot;1&quot;的ASCII码，而AH寄存器中的数据却变成了4FH。</p>
  <p> 如果我们暂时给AH寄存器中的数据命名为&quot;幻码&quot;的话那么我们现在就可以总结出这样两条规律：</p>
  <p> （1）Shift键可以改变同一按键的ASCII码，但同一键的&quot;幻码&quot;固定不变；<br />
    （2）分在不同键区的同名键具有相同的ASCII码，但具有不同的&quot;幻码&quot;。这个规律是否绝对，我们可以按下其它的键来检验，最后我们可以发现这个规律对于大多数键来讲是正确的，个别的一些键无此规律。</p>
  <p> 　　那么就&quot;幻码&quot;本身而言，各个键所对应的&quot;幻码&quot;有没有什么规律呢？我们再次运行这个程序，然后由&quot;1&quot;至&quot;0&quot;顺次按下打字键区中的数字键，再由左至右顺次按下第一行字母键，看看是否得到了下面的结果：</p>
  <p><img src="figures/F6_10.gif"  height="76" /></p>
  <div class="rpindex"><a href="6-51.html">下一页</a> <a href="6-42.html">上一页</a><a href="index.html">目录</a> </div>


<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
