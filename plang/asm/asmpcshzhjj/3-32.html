<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->


  <div  class="lpindex"><a href="index.html">目录</a> <a href="3-31.html">上一页</a> <a href="3-4.html">下一页 </a> </div>
  <p>通过这一点我们不仅可以比较出CALL与JMP的区别，而且也会发现CALL和INT具有一些相似之处，它也会在堆栈中保存返回地址。在这种情况下，最后一条RET指令的作用也就很清楚了：它会将保存在堆栈中的返回地址弹到IP寄存器中，使得CPU能从子程序正常返回到主程序。是不是这样呢？我们先把这个子程序执行完： </p>
  <pre class="code">-g=10d 128  &quot;128&quot;是断点位置
01100001  此数字是程序所显示出来的
AX=0161 BX=0001 CX=0000 DX=6131 SP=FFFC BP=0000 SI=0000 DI=0000
DS=0A3E ES=0A3E SS=0A3E CS=0A3E IP=0128 NV UP EI PL ZR NA PE CY
0A3E:0128 C3 RET
</pre>
  <p>这里用了G命令一个十分重要的功能──设置断点。如果大家在键入程序时保证没有错误，那么就不必再&quot;单步&quot;执行这个子程序，我们现在急于看到&quot;RET&quot;指令执行的过程，所以我们想使CPU连续执行这一段程序，并且在0128处停下来，因此我们使用&quot;G&quot;命令在0128处设了断点。</p>
  <p> 注意在&quot;＝&quot;后面的第一个地址是CPU开始执行指令的起始地址，空格后的地址才是设断点的位置。我们之所以强调用&quot;G&quot;命令执行程序时要使用等号明确指定起始地址就是为了和断点相区分。有关断点的更多说明将留在后面介绍。现在只需记住断点设在哪里，CPU执行到那个位置时就会停下来并显示出所有寄存器的情况，并等待用户输入新的命令。 </p>
  <p>①   注意内存地址的编排是，低地址在先，高地址在后。因此数据存储于内存中也是高字节在后。 </p>
  <p>我们继续使用&quot;T&quot;命令跟踪RET指令： </p>
  <pre class="code">-t   注意堆栈指针SP寄存器恢复成FFFEH
AX=0161 BX=0001 CX=0000 DX=6131 SP=FFFE BP=0000 SI=0000 I=0000
DS=0A3E ES=0A3E SS=0A3E CS=0A3E IP=0107 NV UP EI PL ZR NA PE CY
0A3E:0107 3C1B CMP AL,1B
</pre>
  <p>可以看到CPU确实返回到0107处执行CMP指令</p>
  <p>前面我们编写过一些程序用RET指令返回DOS，RET为什么会有这样的功能呢？</p>
  <p> 如果在启动DEBUG之后注意观察SP寄存器的初值，就会发现DOS将程序调入内存执行时已事先在堆栈中放入了数据，这个数据就是：</p>
  <pre class="code">-dfffe       DOS预先存于堆栈中的返回地址
0A3E:FFF0    00 00　　　　　　..
</pre>
  <p>当CPU执行RET指令时，这个&quot;0&quot;将被弹到IP寄存器中，也就是说CPU将从CS：0处继续执行指令。那么在CS：0处有没有指令呢？我们可以把CS：0处的指令&quot;反汇编&quot;出来。在&quot;－&quot;后打入&quot;U0&quot;并回车： </p>
  <pre class="code">-u0[Enter]
0A3E:0000		CD20		INT		20
0A3E:0002		FF9F009A	CALL	FAR [BX+9A00]
0A3E:0006		F0			LOCK		
0A3E:0007		FE1D		CALL	FAR [DI]
0A3E:0009		F0			LOCK		
0A3E:000A		4F			DEC		DI
0A3E:000B		038D048A	ADD		CX,[DI+8A04]
......						
</pre>
  <p>当我们用A命令输入指令时，这些指令都被DEBUG编译成机器码。我们要想通过机器码重新获得指令，就必须&quot;Unassembled&quot;（反汇编），这就是命令码&quot;U&quot;的来历。</p>
  <p> 此命令可以将内存中任意位置开始的机器码反汇编成指令，若打入&quot;U100[Enter]&quot;，那么DEBUG将把CS：100处开始的指令显示在屏幕上。<br />
    &quot;反&quot;出来的指令和我们当初输入的指令应该是相同的。那些紧挨着逻辑地址后面的16进制数就是指令编译后的机器码。我们可以大概了解一些常用指令对应的机器码是什么，比如&quot;INT&quot;和&quot;CD&quot;之间的关系。</p>
  <p>反汇编的结果真是不可思意，CS：0处竟然有一条&quot;INT   20&quot;指令。为什么会有这样的一条指令呢？</p>
  <p> 前面已经提到过，在我们的程序之前，DOS保留了256字节的内存空间安排了一些重要的数据，这个&quot;CD   20&quot;就是DOS打的小埋伏。这是因为在DOS正式成为PC机的标准操作系统之前，已有人编写了一个称为&quot;CP/M－86&quot;的操作系统，遗憾的是这个可怜的软件没能竞争DOS。不过 &quot;MicroSoft&quot;还是很重视这个对手的，因此在DOS中特意保留了CP/M的特征，以便于和CP/M－86兼容且易于将那些为CP/M编写的应用程序移植到DOS中。由此便有了这个&quot;CD   20&quot;，也就有了前面的&quot;RET之谜&quot;。</p>
  <p> 讲到此我们对CALL/RET可以说已经有较完整的印象了。不过以上对这两条指令的讨论还是很粗浅的，这里面还有更多的滋味我们还没有尝到，还需要更细致地加以咀嚼。</p>
  <div  class="rpindex"><a href="3-4.html">下一页 </a><a href="3-31.html">上一页</a> <a href="index.html">目录</a> </div>


<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
