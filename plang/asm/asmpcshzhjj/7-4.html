<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->


  <!导航条>
  <div class="lpindex"><a href="index.html">目录</a> <a href="7-31.html">上一页</a> <a href="7-41.html">下一页</a> </div>
  <h2>7．4 FCB完结篇</h2>
  <h4>7.4导航：<a href="7-4.html">第一页</a> <a href="7-41.html">第二页</a></h4>
  <p>这一节我们要讨论有关FCB的一些较为特殊的应用，主要是三个方面的内容：一是应用FCB删除文件和给文件改名；其二是利用扩展FCB访问具有特殊属性的文件。第三是有关&quot;命令行参数&quot;的问题。我们先来讨论第一个问题--删除与改名。 </p>
  <p>功能号：	13H<br />
    用　途：	删除文件<br />
    参　数：	DS:DX--指向未打开的FCB<br />
    调　用：	INT 21H<br />
    返　回：	AL = 0--文件正确删除<br />
    AL = 0FFH--文件未能删除</p>
  <p>功能号：	17H<br />
    用　途：	文件改名<br />
    参　数：	DS:DX--指向特殊的FCB<br />
    调　用：	INT 21H<br />
    返　回：	AL = 0--文件正确改名<br />
    AL = 0FFH--文件未能改名</p>
  <p>这两个功能在应用时应注意这样几点：首先要注意它们所使用的FCB的性质，13H功能要求使用一个未打开的FCB，17H功能使用一个特殊的FCB。下面我们就来看看特殊的FCB是一种什么结构，请看图7-4：</p>
  <p>
    <!导航条>
  </p>
  <p><img src="figures/F7_4.gif"  height="103" /></p>
  <h4>图7-4 特殊的FCB结构</h4>
  <p>可以看到和标准的FCB相比这个新的FCB主要是对偏移11H后作了改进，很显然，既然要改名，总要给出一个新的文件名才行，这个新文件名就填在FCB偏移11H处。第二我们要讨论一下究竟什么文件可以删除。我们平常使用DOS时都知道只读文件或隐含文件是不能删除的，那么使用13H功能删除文件时也要遵守这个规矩。同样，若不使用扩展FCB，那么卷标、子目录也不能用此功能删除，这个功能唯一能删除的就是那些普通的文件。第三，我们平常使用DOS时都知道DEL命令可以一次删除一批文件，也就是使用&quot;*&quot;或&quot;?&quot;，我们习惯上称这两个符号为通配符。13H功能同样支持通配符，也就是说你在FCB中填入的文件名可以是&quot;*.*&quot;或&quot;FILE.???&quot;这样的字符串。当然，使用通配符是有条件的，并非所有的DOS版本都支持通配符，2.1版仅支持&quot;.&quot;，3.0以上版才支持&quot;*&quot;。考虑到现在所使用的DOS版本都在3.3以上，所以大家可以不必判断DOS版本而放心使用通配符。</p>
  <p>下面这两个程序演示了这两个功能的使用方法，对于我们平时编制程序来讲，这两个功能其实并不常用，所以大家对它们的用法有些印象也就可以了，不必深究。 </p>
  <h5>CHANAME.ASM</h5>
  <pRE class="code">        DATA  SEGMENT
              ASSUME    DS:DATA
        FCB1  LABEL     BYTE
      DRIVE1  DB        0	；驱动器号，0：当前 1：A 2：B ...
    OLD_NAME  DB        'CONFIG '	；文件原名
     OLD_EXT  DB        'SYS'	；原扩展名
              DB        5 DUP(0)
    NEW_NAME  DB        'ABCDEFGH'	；新文件名
     NEW_EXT  DB        'LCS'	；新扩展名
         MSG  DB        'OK!!!',0DH,0AH,24H
        DATA  ENDS
			
        CODE  SEGMENT
              ASSUME    CS:CODE
        MAIN  PROC      FAR
              MOV       AX,DATA
              MOV       DS,AX
			
              MOV       AH,17H	；选择DOS的17H功能
              MOV       DX,OFFSET FCB1	；DX指向特殊的FCB
              INT       21H	；将文件改名
              OR        AL,AL	；文件已经改变名字了吗？
              JNZ       ERR_EXIT	；未能找到指定的文件，转ERR_EXIT
			
              MOV       AH,9	；显示"OK！！！"
              MOV       DX,OFFSET MSG
              INT       21H
   ERR_EXIT:
              MOV       AH,4CH	；结束进程
              INT       21H
        MAIN  ENDP
        CODE  ENDS
              END       MAIN
			
DELFILE.ASM			
        DATA  SEGMENT
              ASSUME    DS:DATA
        FCB2  LABEL     BYTE
      DRIVE2  DB        0	；驱动器号，0：当前 1：A 2：B ...
   FILE_NAME  DB        '* '	；文件名
    EXT_NAME  DB        'BAK'	；扩展名
  CUR_BLOCK2  DW        ?	；当前记录块号
   REC_SIZE2  DW        ?	；记录长度
  FILE_SIZE2  DW        2 DUP(?)	；文件长度，由系统填入
  CREA_DATE2  DW        ?	；建立或最后修改的日期，由系统填入
   POSITION2  DB        10 DUP(?)	；保留空间，由系统填入
    CUR_REC2  DB        ?	；当前记录号
    REL_REC2  DW        2 DUP(?)	；相对记录号
         MSG  DB        'OK!!!',0DH,0AH,24H
        DATA  ENDS
			
        CODE  SEGMENT
              ASSUME    CS:CODE
        MAIN  PROC      FAR
              MOV       AX,DATA	；初始化DS寄存器
              MOV       DS,AX
			
              MOV       AH,13H	；选择DOS的13H功能
              MOV       DX,OFFSET FCB2	；DX指向未打开的FCB
              INT       21H	；删除指定的文件
              OR        AL,AL	；文件删除了吗？
              JNZ       ERR_EXIT	；未能找到指定的文件，转ERR_EXIT
			
              MOV       AH,9	；显示"OK！！！"
              MOV       DX,OFFSET MSG
              INT       21H
   ERR_EXIT:
              MOV       AH,4CH	；结束进程
              INT       21H
        MAIN  ENDP
        CODE  ENDS
              END       MAIN
</pre>
  <p>我们要讨论的第二个问题是个比较重要的内容，尽管这部分内容也不常用，但它是FCB文件功能与文件句柄功能的一个最显著的区别。我们知道存在于磁盘上的内容不仅是文件，还有子目录和卷标。即使是文件也有只读、隐含等很多种不同的属性。如何处理这些具有属性的文件，这就要用到扩展的FCB。我们前面讨论过有关文件属性的问题，DOS实际上是用一个字节表示文件属性，这个字节存放在扩展FCB的最后，也就是紧挨着驱动器号前面的那个字节。有关这方面的知识请大家复习一下本章的第二节。我准备通过一个实际程序来说明这个问题，请看例程LABEL.ASM</p>
  <h5>LABEL.ASM</h5>
  <pre class="code">        DATA  SEGMENT
              ASSUME    DS:DATA
     EXT_FCB  LABEL     BYTE
              DB        0FFH	；扩展FCB标志
              DB        5 DUP(0)
              DB        00001000B	；属性字节（磁盘卷标）
      DRIVE2  DB        0	；驱动器号，0：当前 1：A 2：B ...
   FILE_NAME  DB        '* '	；文件名
    EXT_NAME  DB        '* '	；扩展名
              DB        5 DUP(0)
    NEW_NAME  DB        'ABCDEFGHIJK'
			
         MSG  DB        'OK!!!',0DH,0AH,24H
        DATA  ENDS
			
        CODE  SEGMENT
              ASSUME    CS:CODE
        MAIN  PROC      FAR
              MOV       AX,DATA	；初始化DS寄存器
              MOV       DS,AX
              MOV       AH,17H	；选择文件改名功能
              MOV       DX,OFFSET EXT_FCB	；DX指向特殊的FCB
              INT       21H	；修改磁盘卷标
              OR        AL,AL	；改名功能执行正确吗？
              JNZ       ERR_EXIT	；若不正确，转ERR_EXIT
			
              MOV       AH,9	；显示"OK！！！"
              MOV       DX,OFFSET MSG
              INT       21H
   ERR_EXIT:
              MOV       AH,4CH	；结束进程
              INT       21H
        MAIN  ENDP
        CODE  ENDS
              END       MAIN
</pre>
  <p>这个小程序可以将当前盘上的卷标改成&quot;ABCDEFGHIJK&quot;，请注意我们在扩展FCB中定义的属性字节，其Bit3位为1，这说明我们要改名的是磁盘卷标而非其它的文件。如果将属性字节改成10H，则这个程序可以改子目录名。当然，改子目录名时就不能使用&quot;*.*&quot;了。后面我们还要讲文件句柄功能，那些功能也能处理有属性的文件，但它们都不能完成对卷标和子目录名的操作。<br />
  </p>
  <div class="rpindex"> <a href="7-41.html">下一页 </a><a href="7-3.html">上一页</a><a href="index.html">目录</a> </div>


<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
