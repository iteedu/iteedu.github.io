<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->


  <div class="lpindex"><a href="index.html">首页</a><a href="45.html"> 上一页</a><a href="47.html"> 下一页</a></div>
  <h5>【例9.2】</h5>
  <pre class="code">#define OK 100
main()
{
  printf("OK");
  printf("\n");
}
</pre>
  <p>上例中定义宏名OK表示100，但在printf语句中OK被引号括起来，因此不作宏代换。程序的运行结果为：OK这表示把“OK”当字符串处理。</p>
  <p>5) 宏定义允许嵌套，在宏定义的字符串中可以使用已经定义的宏名。在宏展开时由预处理程序层层代换。</p>
  <p>例如：</p>
  <pre class="code">#define PI 3.1415926
#define S PI*y*y /* PI是已定义的宏名*/</pre>
  <p>对语句：</p>
  <pre class="code"> printf(&quot;%f&quot;,S);</pre>
  <p>在宏代换后变为：</p>
  <pre class="code"> printf(&quot;%f&quot;,3.1415926*y*y);</pre>
  <p>6) 习惯上宏名用大写字母表示，以便于与变量区别。但也允许用小写字母。</p>
  <p>7) 可用宏定义表示数据类型，使书写方便。</p>
  <p>例如：</p>
  <pre class="code"> #define STU struct stu</pre>
  <p>在程序中可用STU作变量说明：</p>
  <pre class="code">STU body[5],*p;
#define INTEGER int</pre>
  <p>在程序中即可用INTEGER作整型变量说明：</p>
  <pre class="code"> INTEGER a,b;</pre>
  <p>应注意用宏定义表示数据类型和用typedef定义数据说明符的区别。</p>
  <p>宏定义只是简单的字符串代换，是在预处理完成的，而typedef是在编译时处理的，它不是作简单的代换，而是对类型说明符重新命名。被命名的标识符具有类型定义说明的功能。</p>
  <p>请看下面的例子：</p>
  <pre class="code">#define PIN1 int *
typedef (int *) PIN2;</pre>
  <p>从形式上看这两者相似， 但在实际使用中却不相同。 </p>
  <p>下面用PIN1，PIN2说明变量时就可以看出它们的区别：</p>
  <p>PIN1 a,b;在宏代换后变成:</p>
  <pre class="code"> int *a,b;</pre>
  <p>表示a是指向整型的指针变量，而b是整型变量。</p>
  <p>然而：</p>
  <pre class="code"> PIN2 a,b;</pre>
  <p>表示a,b都是指向整型的指针变量。因为PIN2是一个类型说明符。由这个例子可见，宏定义虽然也可表示数据类型， 但毕竟是作字符代换。在使用时要分外小心，以避出错。</p>
  <p>8) 对“输出格式”作宏定义，可以减少书写麻烦。</p>
  <h5>【例9.3】中就采用了这种方法。</h5>
  <pre class="code">#define P printf
#define D "%d\n"
#define F "%f\n"
main(){
  int a=5, c=8, e=11;
  float b=3.8, d=9.7, f=21.08;
  P(D F,a,b);
  P(D F,c,d);
  P(D F,e,f);
}
</pre>
  <h3>9.2.2 带参宏定义</h3>
  <p> Ｃ语言允许宏带有参数。在宏定义中的参数称为形式参数，在宏调用中的参数称为实际参数。</p>
  <p> 对带参数的宏，在调用中，不仅要宏展开，而且要用实参去代换形参。</p>
  <p>带参宏定义的一般形式为：</p>
  <p> #define 宏名(形参表) 字符串</p>
  <p>在字符串中含有各个形参。</p>
  <p>带参宏调用的一般形式为：</p>
  <p> 宏名(实参表)； </p>
  <p>例如：</p>
  <pre class="code">#define M(y) y*y+3*y /*宏定义*/
……
k=M(5); /*宏调用*/
…… </pre>
  <p>在宏调用时，用实参5去代替形参y，经预处理宏展开后的语句为：</p>
  <pre class="code"> k=5*5+3*5</pre>
  <h5>【例9.4】</h5>
  <pre class="code">#define MAX(a,b) (a>b)?a:b
main(){
int x,y,max;
printf("input two numbers: ");
scanf("%d%d",&x,&y);
max=MAX(x,y);
printf("max=%d\n",max);
}</pre>
  <p>上例程序的第一行进行带参宏定义，用宏名MAX表示条件表达式(a&gt;b)?a:b，形参a,b均出现在条件表达式中。程序第七行max=MAX(x,y)为宏调用，实参x,y，将代换形参a,b。宏展开后该语句为：</p>
  <pre class="code"> max=(x&gt;y)?x:y;</pre>
  <p>用于计算x,y中的大数。</p>
  <p>对于带参的宏定义有以下问题需要说明：</p>
  <h5>1.带参宏定义中，宏名和形参表之间不能有空格出现。</h5>
  <p> 例如把：</p>
  <pre class="code"> #define MAX(a,b) (a&gt;b)?a:b</pre>
  <p>写为：</p>
  <pre class="code"> #define MAX  (a,b)  (a&gt;b)?a:b</pre>
  <p>将被认为是无参宏定义，宏名MAX代表字符串 (a,b) (a&gt;b)?a:b。宏展开时，宏调用语句：</p>
  <pre class="code"> max=MAX(x,y);</pre>
  <p>将变为：</p>
  <pre class="code"> max=(a,b)(a&gt;b)?a:b(x,y);</pre>
  <p>这显然是错误的。</p>
  <h5>2.在带参宏定义中，形式参数不分配内存单元，因此不必作类型定义。而宏调用中的实参有具体的值。要用它们去代换形参，因此必须作类型说明。这是与函数中的情况不同的。在函数中，形参和实参是两个不同的量，各有自己的作用域，调用时要把实参值赋予形参，进行“值传递”。而在带参宏中，只是符号代换，不存在值传递的问题。</h5>
  <h5>3.在宏定义中的形参是标识符，而宏调用中的实参可以是表达式。</h5>
  <h5>【例9.5】</h5>
  <pre class="code">#define SQ(y) (y)*(y)
main(){
int a,sq;
printf("input a number: ");
scanf("%d",&a);
sq=SQ(a+1);
printf("sq=%d\n",sq);
}</pre>
  <p>上例中第一行为宏定义，形参为y。程序第七行宏调用中实参为a+1，是一个表达式，在宏展开时，用a+1代换y，再用(y)*(y) 代换SQ，得到如下语句：</p>
  <pre class="code"> sq=(a+1)*(a+1);</pre>
  <p>这与函数的调用是不同的，函数调用时要把实参表达式的值求出来再赋予形参。而宏代换中对实参表达式不作计算直接地照原样代换。</p>
  <h5>4.在宏定义中，字符串内的形参通常要用括号括起来以避免出错。在上例中的宏定义中(y)*(y)表达式的y都用括号括起来，因此结果是正确的。如果去掉括号，把程序改为以下形式：</h5>
  <h5>【例9.6】</h5>
  <pre class="code">#define SQ(y) y*y
main(){
int a,sq;
printf("input a number: ");
scanf("%d",&a);
sq=SQ(a+1);
printf("sq=%d\n",sq);
}</pre>
  <p>运行结果为：</p>
  <pre class="code">input a number:3
sq=7</pre>
  <p>同样输入3，但结果却是不一样的。问题在哪里呢? 这是由于代换只作符号代换而不作其它处理而造成的。宏代换后将得到以下语句：</p>
  <pre class="code"> sq=a+1*a+1;</pre>
  <p>由于a为3故sq的值为7。这显然与题意相违，因此参数两边的括号是不能少的。即使在参数两边加括号还是不够的，请看下面程序：</p>
  <h5>【例9.7】</h5>
  <pre class="code">#define SQ(y) (y)*(y)
main(){
int a,sq;
printf("input a number: ");
scanf("%d",&a);
sq=160/SQ(a+1);
printf("sq=%d\n",sq);
}</pre>
  <p>本程序与前例相比，只把宏调用语句改为：</p>
  <pre class="code"> sq=160/SQ(a+1);</pre>
  <p>运行本程序如输入值仍为3时，希望结果为10。但实际运行的结果如下：</p>
  <pre class="code">input a number:3
sq=160</pre>
  <p>为什么会得这样的结果呢?分析宏调用语句，在宏代换之后变为：</p>
  <pre class="code"> sq=160/(a+1)*(a+1);</pre>
  <p>a为3时，由于“/”和“*”运算符优先级和结合性相同，则先作160/(3+1)得40，再作40*(3+1)最后得160。为了得到正确答案应在宏定义中的整个字符串外加括号，程序修改如下：</p>
  <h5>【例9.8】</h5>
  <pre class="code">#define SQ(y) ((y)*(y))
main(){
int a,sq;
printf("input a number: ");
scanf("%d",&a);
sq=160/SQ(a+1);
printf("sq=%d\n",sq);
}</pre>
  <p>以上讨论说明，对于宏定义不仅应在参数两侧加括号，也应在整个字符串外加括号。</p>
  <h5>5.带参的宏和带参函数很相似，但有本质上的不同，除上面已谈到的各点外，把同一表达式用函数处理与用宏处理两者的结果有可能是不同的。</h5>
  <div class="rpindex"><a href="47.html"> 下一页</a><a href="45.html"> 上一页</a><a href="index.html">首页</a></div>


<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
