<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->


  <div class="lpindex"><a href="index.html">首页</a><a href="112.html"> 上一页</a><a href="114.html"> 下一页</a></div>
  <h2>14．6   更新顺序访问文件</h2>
  <p> 14. 4   节介绍了格式化和写入顺序访问文件的数据修改时会有破坏文件中其他数据的危险。例如，如果要把名字&quot;White&quot;改为&quot;Worthinglon&quot;，则不是简单地重定义旧的名字。White的记录是以如下形式写人文件中的：</p>
  <p> 300 White 0.00 </p>
  <p> 如果用新的名字从文件中相同的起始位置重写该记录，记录的格式就成为： </p>
  <p> 300 Worthington   0.00 </p>
  <p> 因为新的记录长度大于原始记录的长度，所以从“Worthington&quot;的第二个“0”之后的字符将重定义文件中的下一条顺序记录。出现该问题的原因在于：在使用流插入运算符&lt;&lt;和流读取运算符&gt;&gt;的格式化输人，输出模型中，域的大小是不定的，因而记录的大小也是不定的。例如，7、14、-117、2047和27383都是int类型的值，虽然它们的内部存储占用相同的字节数，但是将它们以格式化文本打印到屏幕上或存储在磁盘上时要占用不同大小的域。因此，格式化输入，输出模型通常不用来更新已有的记录。</p>
  <p> 也可以修改上述名字，但比较危险。比如，在300 Whlte 0.00之前的记录要复制到一个新的文件中，然后写入新的记录并把300 White   0.00之后的记录复制到新文件中。这种方法要求在更新一条记录时处理文件中的每一条记录。如果文件中一次要更新许多记录，则可以用这种方法。 </p>
  <h2><a name="14.7" id="14.7"></a>14.7   随机访问文件</h2>
  <p> 前面介绍了生成顺序访问文件和从顺序访问文件搜索特定信息。顺序访问文件不适合快速访问应用程序，即要立即找到特定记录的信息。快速访问应用程序的例子有航空订票系统、银行系统、销售网点系统、自动柜员机和其他要求快速处理特定数据的事务处理系统(transaction   processing system)。银行要面对成千上万的客户，但自动柜员机能在瞬间作出响应。这种快速访问应用程序是用随机访问文件(random access   file)实现的。随机访问文件的各个记录可以直接快速访问，而不需要进行搜索。</p>
  <p> 前面曾介绍过．C++不提供文件结构。因此应用程序要自己生成随机访问文件。虽然实现随机访问文件还有其他方法，但是本书的讨论只限于使用定长记录的这种简洁明了的方法。因为随机访问文件中的每一条记录都有相同的长度，所以能够用记录关键字的函数计算出每一条记录相对于文件起始点的位置。不久就会学到怎样立即访问到文件甚至大型文件中指定的记录。 </p>
  <p> 图14.10   反映了由定长记录组成的随机访问文件的一种观点(每一条记录为100字节)。它就像一列火车，一些车箱是空的，还有一些车箱满载货物，但是火车中的每节车箱具有相同的长度。 </p>
  <p> 可以在不破坏其他数据的情况下把数据插入到随机访问文件中。也能在不重写整个文件的情况下更新和删除以前存储的数据。下面几节要讨论怎样建立随机访问文件、键入数据、顺序和随机地读取数据、更新数据和删除不再需要的数据。 </p>
  <h2><a name="14.8" id="14.8"></a>14．8   建立随机访问文件
    </p>
  </h2>
  <p> ostream成员函数write把从内存中指定位置开始的固定个数的字节送到指定流中，当流与文件关联时，数据写人到“put'’文件位置指针所指示的位置。istream成员函数read把固定个数的字节从指定流输入到内存中指定地址开始的区域。如果流与文件相关联，则该字节从&quot;get&quot;文件位置指针指定的文件地址开始输入。</p>
  <p> 现在，将整型number写入文件时，不是用下列语句： </p>
  <p> outFile   &lt;&lt;   number；</p>
  <p> 对4字节整数打印1位或ll位(10位加一个符号位，各要1字节存储空问)，而改用：</p>
  <pre class="code">outFile.write( reinterpret_cast<const char *>( &number ),

sizeof( number )); </pre>
  <p> 这种方法总是写入4字节(在4字节整数机器上)。write函数要求一个const char   *类型的参数为第一个参数，因此我们用reinterpret_cast&lt;const char*&gt;强制类型转换运算符将number的地址变为const   char   *指针。write的第二个参数是size_t类型的整数，指定写入的字节数。可以看出，istresm函数read可以将4个字节读回到整型变量number中。</p>
  <p> 随机存取文件处理程序很少只把一个域写入文件中，通常会一次写入一个结构或一个类对象。 </p>
  <p> 下面举一个例子。</p>
  <p> 考虑如下的问题描述： </p>
  <p> 建立一个能够存储100个定长记录的借贷处理系统。每一条记录由账号(用作记录关键字)、姓、名和借贷金额组成。程序要能够更新、插入和删除一条记录以及能够以格式化文本形式列出所有的记录。要求使用随机访问文件。 </p>
  <p> 以下几节介绍了建立借贷处理程序所需的技术。图14．11中的程序说明了怎样打开一个随机访问文件、怎样用struct定义—条记录格式(在cIntdata．h头文件中定义)以及怎样把数据写入磁盘。 </p>
  <p> 程序用write函数和空结构初始化了文件&quot;credit．dat&quot;的所有100条记录。每一个空结构中，账号都为0，姓氏和名为NULL，借贷金额为0．0。文件以这种方式初始化后就在磁盘上建立了存储文件的空间，并且能够确定某条记录是否包含数据。</p>
  <p> 在图14.11中，下列语句(第34行到第36行)： </p>
  <pre class="code">outCredit.write(

reinterpret cast <const char*>(&blankClient),</pre>
  <p> 将长度为sizeof(clientData)的blankClient结构写入与ofstream的对象outCredit相关联的文件credit．dat。记住，运算符sizeof返回括号中对象的长度(字节数，见第5章)。注意，第34行函数write的第一个参数应为const   char*类型，但  &amp;blankClient的数据类型为clientData   *。要将&amp;blankClient变为相应指针类型，下列表达式：</p>
  <p> reinterpret cast&lt;const char *&gt;(   &amp;blankClient )</p>
  <p> 用强制类型转换运算符reinterpret_cast将blankClient地址变为const char   *类型，因此调用write能顺利编译，而不产生语法错误。</p>
  <pre class="code">
// Fig. 14.11: clntdata.h
 // Definition of struct clientData used in
 // Figs. 14.11, 14.12, 14.14 and 14.15.
 #ifndef CLNTDATA_H
 #define CLNTDATA_H
 struct clientData {
   int accountNumber;
   char lastName[15];
   char firstName[10];
   float balance;
 } ;
 #endif
 // Fig. 14.11： fig14_11.cpp
 // Creating a randomly accessed file sequentially

 #include &lt;iostream.h&gt;<br /> #include &lt;fstream.h&gt;<br /> #include &lt;stdlib.h&gt;<br /> #include &quot;clntdata.h&quot;
 int main()

 {
   ofstream outCredit( "credit.dat", ios::out );
   if ( !outCredit ) {
     cerr << "File could not be opened." << endl;
     exit( 1 );
   }
   clientData blankClient = { 0, "", "", 0.0 };
       
   for ( int i = 0; i < 100; i++ )
     outCredit.write(
        reinterpret_cast<const char *>( &blankClient ),
        sizeof( clientData ) );
   return 0;
 }
</pre>
  <p> 图14. 11 顺序生成随机访问文件</p>
  <div class="rpindex"><a href="114.html"> 下一页</a><a href="112.html"> 上一页</a><a href="index.html">首页</a></div>


<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
