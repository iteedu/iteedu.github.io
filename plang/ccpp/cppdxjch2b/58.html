<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->


<div class="lpindex"><a href="index.html">首页</a><a href="57.html"> 上一页</a><a href="59.html"> 下一页</a></div>
<h1>第7章_类与数据抽象(二)</h1>


<p>教学目标</p>
<p> ●动态生成与删除对象</p>
<p> ●指定const对象与const成员函数</p>
<p> ●了解友元函数与友元类的用途</p>
<p> ●了解如何使用static数据成员和成员函数</p>
<p> ●了解容器类的概念</p>
<p> ●了解遍历容器类元素的迭代类概念</p>
<p> ●了解this指针的用法</p>

<h2> 7．1 简介</h2>
<p> 本章继续介绍类与数据抽象。我们要介绍更高级的课题并为第8章介绍类与运算符重载奠定基础。第6章到第8章的讨论鼓励程序员使用对象，我们称之为基于对象编程(object-based   programming，OBP)。然后，第9章和第10章介绍继承与多态，这是真正面向对象编程(object-oriented   programming，OOP)的技术。本章和后面几章要使用第5章介绍的C语言式字符串，帮助读者掌握C语言指针的复杂课题．以便在工作中处理近二十年来积累的遗留代码。第19章将介绍新的字符串样式，将字符串作为完全成熟的类对象。这样，读者将熟悉C++中生成和操作字符串的两种最主要方法。</p>

<h2> <a name="7.2" id="7.2"></a>7．2 const(常量)对象与const成员函数</h2>
<p> 我们一直强调，最低权限原则(principle of least   privilege)是良好软件工程的最基本原则之一。下面介绍这个原则如何应用于对象。</p>
<p> 有些对象需要修改，有些不需要。程序员可以用关键字const指定对象不能修改，且修改时会产生语法错误。例如：</p>
<p> const Time   noon(12，O，O)；</p>
<p> 声明Time类对象noon为const，并将其初始化为中午12时。</p>

<h5> 软件工程视点7．1</h5>
<p> 将对象声明为const有助于实现最低权限原则，这样试图修改就会产生编译时错误不是执行时错误。</p>

<h5> 软件工程视点7. 2</h5>
<p> 使用const是正确的类设计、程序设计与编码的关键。</p>

<h5> 性能提示7．1</h5>
<p> 声明变量和对象为const不仅是有效的软件工程做法，而且能提高性能，因为如今复杂的优化编译器能对常量进行某些无法对变量进行的优化。</p>

<p> C++编译器不允许任何成员函数调用const对象，除非该成员函数本身也声明为const，即使get成员函数不修改对象时也是这样。声明const的成员函数不能修改对象，因为编译器不允许其修改对象。</p>
<p> 函数在原型和定义中指定为const，即在函数参数表和函数定义的左花括号之间插入const关键字。例如,下列类A的成员函数：</p>
<p> int   A::getValue() const{ reture   privateDataMember)；只是返回一个对象的数据成员值，可以声明为const。</p>

<h5> 常见编程错误7．1</h5>
<p> 定义修改对象数据成员的const成员函数是个语法错误。</p>

<h5> 常见编程错误7. 2 </h5>
<p> 定义调用同一类实例的非const成员函数的const成员函数是个语法错误。</p>

<h5> 常见编程错误7．1</h5>
<p> 对const对象调用非consc成员函数是个语法借误。</p>

<h5> 软件工程视点7．3</h5>
<p> const成员函数可以用非const版本重载。编译器根据对象是否为const自动选择所用的重载版本。</p>

<p> 这里对构造函数和析构函数产生了一个有趣的问题，两者都经常需要修改对象。const对象的构造函数和析构函数不需要const声明。构造函数应允许修改对象，才能正确地将对象初始化。析构函数应能在对象删除之前进行清理工作。</p>

<h5> 常见编程错误7. 4</h5>
<p> 将构造函数和析构函数声明为const是个语法错误。</p>

<p> 图7．1的程序实例化两个Time对象，一个非const对象和一个const对象。程序想用非const成员函数setHour(第100行)和printStandard(第106行)修改const对象noon。程序还演示了另外三个成员函数调用对象的组合，一个非Const成员函数调用非const对象(第98行)、一个const成员函数调用非const对象(第102行)和一个const成员函数调用const对象(第104与第105行)。输出窗口中显示了一个非const成员函数调用const对象时编译器产生的消息。</p>

<h5> 编程技巧7. 1</h5>
<p> 将所有不需要修改当前对象的成员函数声明为const，以便在需要时调用const对象。</p>

<pre class="code">  // Fig. 7.1: time5.h
 // Declaration of the class Time.
 // Member functions defined in time5.cpp
 #ifndef TIME5_H
 #define TIME5_H
   class Time {
   public:
   Time(int = 0,int = 0,int = 0);   // default constructor
   // set functions
   void setTime( int, int, int );  // set time
   void setHour( int );    // set hour
   void setMinute( int );  // set minut
   void setSecond( int );  // set second
   // get functions (normally declared const)
   int getHour() Const;    // return hour
   int getMinute() const;  // return minute
   int getSecond() const;  // return second
   // print functions (normally declared const)
   void printMilitary() const;  // print military time
   void printStandard();      // print standard time
 private:
   int hour;            // 0 - 23
   int minute;          // 0 - 59
   int second;          // 0 - 59
 };
 #endif
 // Fig. 7.1: time5.cpp
 #include < iostream.h>
 #include "time5.h"
 // Constructor function to initialize private data.
 // Default values are 0 (see class definition).
 Time::Time( int hr, int min, int sec )
   { setTime{ hr, min, sec ); }
 // Set the values of hour, minute, and second.
 void Time::setTime( int h, int m, int s )
 {
   setHour( h );
   setMinute( m );
   setSecond( s );
 }
 // Set the hour value
 void Time::setHour( int h )
   { hour = ( h >= 0 && h < 24 ) ? h : 0; )
 // Set the minute value
 void Time::setMinute( int m )
  { minute = ( m >= 0 && m < 60 ) ? m : 0; }
 // Set the second value
 void Time::setSecond( int s )
{     second = ( s >= 0 && s < 60 ) ? s : 0; }
 
  // Get the hour value
 int Time::getHour() const {return hour;}
 // Get the minute value
  int Time::getMinute() const { return minute;}
 // Get the second value
  int Time::getSecond() const { return second;}
 // Display military format time: HH:MM:
  void Time::printMilitary() const
  {
      cout << ( hour < 10 ? "0": "") << hour <<":"
          << ( minute < 10 ? "0" : "") << minute; ) << minute;
 }
 // Display standard format time: HH:MM:SS AM (or PM)
 void Time::printStandard{)
 {
    cout << ( ( hour == 12 ) ? 12 : hour % 12 ) << ":"
         << ( minute < 10 ? "0" : "" ) << minute << ":"
         << ( second < 10 ? "0" : "" ) << second
         << ( hour < 12 ?  "AM" : "PM" );
 }
 // Fig. 7.1:fig07 01.cpp
 // Attempting to access a const object with
 // non-const member functions.
 #include < iostream.h>
 #include "time5.h"
 int main()
 {
   Time wakeUp{ 6, 45, 0 );      // non-constant object
   const Time noon( 12, 0, 0 );  // constant object
                               // MEMBER FUNCTION  OBJECT
   wakeUp.setHour( 18 );       // non-const       non-const
         noon.setHour( 12 );   // non-const       const
         wakeUp.getHour();     // const           non-const
         noon.getMinute();     // const           const
         noon.p,intMilitary();  // const          const
         noon.printStandard();  // non-const      const
         return 0;
  }
</pre>
<p> 输出结果：</p>
<p> Compiling   Fig07_01.cpp</p>
<p> Fig07_01.cpp(15):error: 'setHour':</p>
<p> cannot convert   'this' pointer from</p>
<p> 'const class Time' to 'class Time &amp;'</p>
<p> Conversion loses qualifiers</p>
<p> Fig07_01.cpp(21) : error: 'printStandazd'   :</p>
<p> cannot convert 'this' pointer from</p>
<p> 'const class Time' to   'class Time &amp;'</p>
<p> Conversion loses   qualifiers</p>

<p> 注意，尽管构造函数应为非const成员函数，但仍然可以对const对象调用构造函数。Time构造函数的定义在第39行和第40行   Tlme:Time( int hr, int min，int sec )</p>
<p> { setTime(hr, min, sec);   }</p>
<p> 其中Time构造函数调用另一个非const成员函数setTime进行Time对象的初始化。在const对象的构造函数调用中调用非const成员函数时是合法的。</p>

<h5> 软件工程视点7．4</h5>
<p> const对象不能用赋值语句修改，因此应初始化。类的数据成员声明为const时．要用成员初始化值向构造函数提供类对象数据成员的初始值。</p>
<p> 另外注意第106行(源文件中第21行)：</p>
<p> noon.printStandard()；// noon—const   const</p>
<p> 尽管Time类的成员函数printStandard不修改所调用的对象，但仍然产生一个编译错误。</p>
<p> 图7．2演示用成员初始化值初始化Increment类的const数据成员increment。Increment的构造函数修改后如下所示：</p>
<pre class="code">Increment::Increment( int c，int i )
：increment( i )
{ count = c；}</pre>
<p> 符号：increment(i)将increment初始化为数值i。如果需要多个成员初始化值，则可以将其放在冒号后面以逗号分隔的列表中。所有数据成员都可以用成员初始化值的语法进行初始化，但const和引用必须用这种方式进行初始化。本章稍后会介绍，成员对象也要用这种方法进行初始化。第9章学习继承时，会介绍派生类的基类部分也要用这种方法进行初始化。</p>

<h5> 测试与调试提示7. 1</h5>
<p> 如果成员函数修改对象，则将其声明为const，这样可以减少许多错误。</p>
<pre class="code"> // Fig. 7.2:fig07 02.cpp
 // Using a member initializer to initialize a
 // constant of a built-in data type.
 #include < iostream.h>
 class Increment {
 public:
   Increment( int c = 0, int i = 1 );
  void addIncrement() { count += increment; }
  void print() const;
 private:
   int count;
   const int increment;
 };
 // Constructor for class Increment
 Increment::Increment( int c, int i )
        : increment( i )  // initializer for const member
 {count = c;}
 // Print the data
 void Increment::print() const
 {
     cout << "count = "<< count
       << ", increment = "<< increment << endl;
 }
 int main()
 {
    Increment value( 10, 5 );
    cout << "Before incrementing: ";
    value.print();
   for ( int j = 0; j < 3; j++ ) {
      value.addIncrement();
      cout << "After increment "<< j << ": ";
      value.print();
   }
    return 0;
</pre>
<p> 输出结果：</p>
<p> Before incrementing: count =   10, increment = 5</p>
<p> After increment 1: count = 15, increment = 5</p>
<p> After   increment 2: count = 20, increment= 5</p>
<p> After increment 3: count =   30,increment = 5</p>

<p> 图7．2 用成员初始化值初始化内部数据类型的常量</p>

<p> 图7．3显示的是用赋值语句而不用成员初始化值初始化increment时C++编译器产生的编译错误。</p>

<pre class="code"> // Fig. 7.3: fig07_03.cpp
 // Atempting to initialize a costant of
 // a built-in data type with an assignment.
 #include &lt;iostream.h&gt;
 class Increment {
 public:
   Increment( int c = 0, int i = 1 );
   void addIncrement() { count += increment; }
  void print() const;
 private:
   int Count;
   const int increment;
 };
 // Constructor for class Increment
 Increment::Increment( int c, int i)
 {  // Constant member ~ncrement'  is not initialized
   count = c;
   increment = i;  // ERROR: Cannot modify a const object
 }
 // Print the data
 void Increment::print() const
 {
   cout << "count =" << count
        << ", increment =" << increment << endl;
 }
 int main{)
 {
   Increment value( 10, 5 );
   cout << "Before incrementing: ";
   value.print();
   for ( int j = 0; j < 3: j++ } {
     value.addIncrement();
     cout << "After increment "<< j << ": ";
     value.print{);
   }
   return 0;
 }
</pre>
<p> 输出结果：</p>
<p> Compiling...</p>
<p> FigT_3.cpp</p>
<p> Fig7_3.cpp(18) :   error: 'increment':</p>
<p> must be initialized in constructor   base/member</p>
<p> initializer list</p>
<p> Fig7 3.cpp(20) : error: 1-value   specifies const object</p>

<p> 图7 3   用赋值语句初始化内部数据类型的常量时产生的编译错误</p>

<h5> 常见编程错误7．5</h5>
<p> 不为const数据成员提供成员初始化值是个语法错误。</p>

<h5> 软件工程视点7 5</h5>
<p> 常量类成员(const对象和const“变量”)要用成员初始化值的语法初始化，而不能用赋值语句。</p>
<p> 注意第24行将print函数声明为const，但不会有const类型的Inerement对象。</p>

<h5> 软件工程视点7. 6</h5>
<p> 如果成员函数不修改对象，最好将其声明const。如果不需要生成该类的const类型对象，则这样做是没有必要的。但将这种成员函数声明为const有一个好处，如果不小心修改了这个成员函数中的对象，则编泽器全产生一个语法错误的消息。</p>
<h5> 测试与调试提示   7．2</h5>
<p> C++之类的语言是不断演变的，新的关键字不断出现。不要用“object'’之类的标识符。尽管”object”目前还不是C++中的关键字，但将来很可能变成关键字，新的编译器可能不能接受现有代码。C++提供了新的关键字mutable，能够对程序中const对象进行处理。第21章将介绍关键字mutable。</p>
<div class="rpindex"><a href="59.html"> 下一页</a><a href="57.html"> 上一页</a><a href="index.html">首页</a></div>


<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
