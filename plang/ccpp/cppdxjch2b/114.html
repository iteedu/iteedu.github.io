<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->


  <div class="lpindex"><a href="index.html">首页</a><a href="113.html"> 上一页</a><a href="115.html"> 下一页</a></div>
  <h2>14．9 向随机访问文件中随机地写入数据
    </p>
  </h2>
  <p> 图14．12   中的程序把数据写到文件“credit   dm”中。ostream的函数seekp和write用来将数据存储在文件中指定的位置。程序先用函数seekp把“put”文件位置指针指向文件中指定的位置，然后用write函数写入数据。执行范例见图14.   13。注意图14. 12的程序包括图14．11中定义的头文件clntdata h。</p>
  <pre class="code">// Fig. 14.12: figl4_12.cpp<br /> // Writing to a random access file<br /> #include &lt;iostream.h&gt;<br /> #include &lt;fstream.h&gt;<br /> #include &lt;stdlib.h&gt;<br /> #include &quot;clntdata.h&quot;<br /> int main()<br /> {<br />   ofstream outCredit( &quot;credit.dat&quot;, ios::ate );<br />   if ( !outCredit ) {<br />     cerr &lt;&lt; &quot;File could not be opened.&quot; &lt;&lt; endl;<br />     exit( 1);<br />   }<br />   cout &lt;&lt; &quot;Enter account number &quot;<br />       &lt;&lt; &quot;(1 to 100, 0 to end input)\n? &quot;;<br />   clientData client;<br />   cin &gt;&gt; client.accountNumber;<br />   while ( client.accountNumber &gt; 0 &amp;&amp;<br />           client.accountNumber &lt;= 100 ) {<br />     cout &lt;&lt; &quot;Enter lastname, firstname, balance\n? &quot;;<br />     cin &gt;&gt; client.lastName&gt;&gt; client.firstName<br />         &gt;&gt; client.balance;<br />     outCredit.seekp( ( client.accountNumber - 1 ) *<br />                   sizeof( clientData ) );<br />     outCredit.write(<br />        reinterpret_cast&lt;const char *&gt;( &amp;client ),<br />        sizeof( clientData ) );<br />     cout &lt;&lt; &quot;Enter account number\n? &quot;;<br />     cin &gt;&gt; client.accountNumber;<br />   }<br />   return 0;<br /> }
</pre>
  图14. 12   把数据随机地写人随机访问文件中
  </p>
  <pre>Enter account number (1 to 100, 0 to end input)
? 37
Enter lastname,firstname,balance
? Barker Doug 0.00
Enter account number
? 29
Enter lastname, firstname, balance
? Barker Nancy -24.54
Enter account number
? 96
Enter lastname, firstname, balance
? Stone Sam 34.98
Enter account number
? 88
Enter lastname, firstname, balance
? Smith Dave 258.34
Enter account number
? 33
Enter lastname, firstname, balance
? Dunn Stacey 314.33
Enter account number
?0</pre>
  图14．13   图14．12中程序的示例输出
  </p>
  <p> 第29行和第30行：</p>
  <pre class="code">outCredit.seekp( ( client.accountNumber - 1 ) *<br />                              sizeof( ciientData ) );</pre>
  <p> 将outCredit对象的“put”文件位置指针放在(client．accountNumber-1)*sizof(clientData)求出的字节位置处。由于账号在1到100之间．因此计算记录的字节位置时要从账号减1。这样，对于记录1，文件位置指针设置为文件的字节0。注意ofstream的对象outCredit用文件打开方式ios::ate打开。“put”文件位置指针最初设置为文件末尾，但数据可以在文件中的任何地方写入。</p>
  <h2><a name="14.10" id="14.10"></a>14．10   从随机访问文件中顺序地读取数据
    </p>
  </h2>
  <p> 上面几节生成了随机访问文件并将数据写入这个文件中。本节要开发一个程序，顺序读取这个文件．只打印包含数据的记录。该程序还有另一好处，将在本节最后说明，读者不妨先猜猜看。</p>
  <p> istream的函数read从指定流的当前位置向对象输入指定字节数。例如，图14．14中下列语句： </p>
  <pre class="code">inCredit．read(reinterpret_cast&lt;char *)(&amp;client),<br />                                 sizeof(clientData));</pre>
  <p> 从与ifstrem的对象inCredit相关联的文件中读取sizeof(clientData)指定的字节数，并将数据存放在结构client中。注意函数read要求第一个参数类型为char*。由于&amp;client的类型为clientData   *，因此&amp;client要用强制类型转换运算符interpret_cast变为char*。注意图14.14中的程序中包括图14.11定义的头文件clntdata.   h。</p>
  <pre class="code">
 // Fig. 14.14: figl4_14.cpp
 // Reading a random access file sequentially
 #include &lt;iostream.h&gt;<br /> #include &lt;iomanip.h&gt;<br /> #include &lt;fstream.h&gt;<br /> #include &lt;stdlib.h&gt;
 #include "clntdata.h"
 void outputLine( ostream&, const clientData & );
 int main()
 {
    ifstream inCredit( "credit.dat", ios::in );
    if ( !inCredit ) {
         cerr << "File could not be opened." << endl;
         exit( 1 );
    }
    cout << setiosflags( ios::left ) << setw( 10 ) << "Account"
         << setw( 16 ) << "Last Name" << setw( 11 )
         << "first Name" << resetiosflags( ios::left )
         << setw( 10 ) << "Balance" << endl;
    clientData client;
    inCredit.read( reinterpret_cast<char *> ( &client ),
                                sizeof( clientData ) );
        while ( inCredit && !inCredit.eof() ) {
             if { client.accountNumber != 0 )
                  outputLine( cout, client );
             inCredit.read( reinterpret_cast<char *>( &client ),
                                         sizeof( clientData ) );
        }
        return 0;
 }
 void outputLine( ostream &output, const clientData &c )
 {
   output << setiosflags( ios::left ) << setw( 10 )
         << c.accountNumber << setw( 16 ) << c.lastName
         << setw( 11 ) << c.firstName << setw( 10 )
         << setprecision( 2 ) << resetiosflags( ios::left )
         << setiosflags( ios::fixed | ios::showpoint )
         << c.balance << '\n';
 }
</pre>
  <pre>输出结果：
Account    Last Name   First Name    Balance
29         Brown       Nancy         -24.54
33         Dunn        Stacey        319.33
37         Barker      Doug            9.00
88         Smith       Dave          258.34
96         Stone       Sam            34.98</pre>
  <h5>图14．14 从随机访问文件中顺序地读取数据
    </p>
  </h5>
  <p> 图14.14   的程序顺序读取&quot;credit．dat&quot;文件中的每个记录，检查每个记录中是否包含数据，并打印包含数据的记录。第30行的下列条件：</p>
  <p> while(inCredit &amp;&amp;   !inCredit．eof(){</p>
  <p> 用ios成员函数eof确定是否到达文件末尾，如果到达文件末尾，则终止执行while结构。如果读取文件时发生错误，则循环终止，因为inCredit值为false。从文件中输入的数据用outputLine输出，outputLine取两个参数，即ostream对象和要输出的clientData结构。osttream参数类型可以支持任何ostream对象(如cont)或ostream的任何派生类对象(如ofstream类型的对象)作为参数。这样，同一函数既可输出到标准输出流，也可输出到文件流，而不必编写另一个函数。</p>
  <p> 这些程序还有另一好处，输出窗口中的记录已经按账号排序列出，这是用直接访问方法将这些记录存放到文件中的结果。试比较第4章介绍的冒泡排序，用直接访问方法排序显然快多了。这个速度是通过生成足够大的文件来保证完成每个记录而实现的。当然，大多数时候文件存储都是稀松的，因此会浪费存储空间。这是另一个以空间换取时间的例子：加大空间可以得到更快的排序算法。</p>
  <div class="rpindex"><a href="115.html"> 下一页</a><a href="113.html"> 上一页</a><a href="index.html">首页</a></div>


<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
