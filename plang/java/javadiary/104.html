<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->


<div class="lpindex"><a href="index.html">首页</a><a href="103.html"> 上一页</a><a href="105.html"> 下一页</a></div>
<h1>Java Gossip: wait()、notify()</h1>
<p>wait()、notify()与notifyAll()是由 Object所提供的方法，您在定&#20041;自己的&#31867;&#21035;&#26102;&#20250;&#32487;承下&#26469;（&#35760;得Java中所有的&#23545;象最&#39030;&#23618;都&#32487;承自Object），wait()、notify()与 notifyAll()都被宣告&#20026;&quot;final&quot;，所以您&#26080;法重新定&#20041;它&#20204;，透&#36807;&#36825;三&#20010;方法您可以控制&#25191;行&#32490;是否&#20026;Runnable&#29366;&#24577;。<br />
<br />
您必&#39035;在同步化的方法或&#21306;&#22359;中呼叫wait()方法，&#24403;&#23545;象的wait()方法被&#35843;用，目前的&#25191;行&#32490;&#20250;被放入&#23545;象的「等待集合」（Wait set）中， &#25191;行&#32490;&#20250;&#37322;放&#23545;象的&#38145;定，其它的&#25191;行&#32490;可以&#31454;&#20105;&#38145;定，取得&#38145;定的&#25191;行&#32490;可以&#25191;行同步化&#21306;&#22359;；被放在等待集中的&#25191;行&#32490;&#23558;不&#21442;与&#25191;行&#32490;的排班，wait()可 以指定等待的&#26102;&#38388;，如果指定&#26102;&#38388;的&#35805;，&#21017;&#26102;&#38388;到之后&#25191;行&#32490;&#20250;再度加入排班，如果指定&#26102;&#38388;0或不指定，&#21017;&#25191;行&#32490;&#20250;持&#32493;等待，直到有被中&#26029;（interrupt）或是被告知（notify）可以&#21442;与排班。<br />
<br />
&#24403;&#23545;象的notify()被&#35843;用，它&#20250;&#20174;&#23545;象的等待集中&#36873;出「一&#20010;」&#25191;行&#32490;加入排班，被&#36873;出的&#25191;行&#32490;是&#38543;机的，被&#36873;出的&#25191;行&#32490;&#20250;与其它正在&#25191;行的&#25191;行&#32490;共 同&#31454;&#20105;&#23545;&#23545;象的&#38145;定；如果您呼叫notifyAll()，&#21017;「所有」在等待集中的&#25191;行&#32490;都&#20250;被&#21796;醒，&#36825;些&#25191;行&#32490;&#20250;与其它正在&#25191;行的&#25191;行&#32490;共同&#31454;&#20105;&#23545;&#23545;象的 &#38145;定。<br />
<br />
&#31616;&#21333;的&#35828;，&#24403;&#25191;行&#32490;呼叫到&#23545;象的wait()方法&#26102;，表示它要先&#35753;出&#23545;象的被同步&#21306;使用&#26435;并等待通知，或是等待一段指定的&#26102;&#38388;，直到被通知或&#26102;&#38388;到&#26102;再&#20174; 等待&#28857;&#24320;始&#25191;行，&#36825;就好比您要叫某人作事，作到一半&#26102;某人叫您等候通知（或等候1分&#38047;之&#31867;的），&#24403;您被通知（或&#26102;&#38388;到&#26102;）某人&#20250;&#32487;承&#20026;您服&#21153;。<br />
<br />
&#35828;明wait()、notify()或notifyAll()的&#24212;用最常&#35265;的一&#20010;例子，就是生&#20135;者（Producer）与消&#36153;者（Consumer）的 例子，如果生&#20135;者&#20250;&#23558;&#20135;品交&#32473;店&#21592;，而消&#36153;者&#20174;店&#21592;&#22788;取走&#20135;品，店&#21592;一次只能持有固定&#25968;量&#20135;品，如果生&#20135;者生&#20135;了&#36807;多的&#20135;品，店&#21592;叫生&#20135;者等一下 （wait），如果店中有空位放&#20135;品了再通知（notify）生&#20135;者&#32487;&#32493;生&#20135;，如果店中&#27809;有&#20135;品了，店&#21592;&#20250;告&#35785;消&#36153;者等一下（wait），如果店中有&#20135;品 了再通知（notify）消&#36153;者&#26469;取走&#20135;品。<br />
<br />

以下&#20030;一&#20010;最&#31616;&#21333;的：生&#20135;者每次生&#20135;一&#20010;int整&#25968;交&#32473;在店&#21592;上，而消&#36153;者&#20174;店&#21592;&#22788;取走整&#25968;，店&#21592;一次只能持有一&#20010;整&#25968;。<br />
<br />
以程序&#23454;例&#26469;看，首先是生&#20135;者： </p>
<h5>Producer.java </h5>
<pre class="code">package onlyfun.caterpillar;
public class Producer implements Runnable {
	private Clerk clerk;
	public Producer(Clerk clerk) {
		this.clerk = clerk;
	}
	public void run() {
		System.out.println(
		"生产者开始生产整数......");
		// 生产1到10的整数
		for(int product = 1; product <= 10; product++) {
			try {
				// 暂停随机时间
				Thread.sleep((int) (Math.random() * 3000));
			}
			catch(InterruptedException e) {
				e.printStackTrace();
			}
			// 将产品交给店员
			clerk.setProduct(product);
		}?
	}
}
</pre>
<p>  再&#26469;是消&#36153;者：</p>
<h5>Consumer.java </h5>
<pre class="code">package onlyfun.caterpillar;
public class Consumer implements Runnable {
	private Clerk clerk;
	public Consumer(Clerk clerk) {
		this.clerk = clerk;
	}
	public void run() {
		System.out.println(
		"消费者开始消耗整数......");
		// 消耗10个整数
		for(int i = 1; i <= 10; i++) {
			try {
				// 等待随机时间
				Thread.sleep((int) (Math.random() * 3000));
			}
			catch(InterruptedException e) {
				e.printStackTrace();
			}
			// 从店员处取走整数
			clerk.getProduct();
		}
	}
}
</pre>
<p>  生&#20135;者&#23558;&#20135;品放至店&#21592;，而消&#36153;者&#20174;店&#21592;&#22788;取走&#20135;品，所以店&#21592;&#26469;&#20915;定&#35841;必&#39035;等待并等候通知。</p>
<h5>Clerk.java </h5>
<pre class="code">package onlyfun.caterpillar;
public class Clerk {
	// -1 表示目前没有产品
	private int product = -1;
	// 这个方法由生产者呼叫
	public synchronized void setProduct(int product) {
		if(this.product != -1) {
			try {
				// 目前店员没有空间收产品，请稍候！
				wait();
			}
			catch(InterruptedException e) {
				e.printStackTrace();
			}
		}
		this.product = product;
		System.out.printf("生产者设定 (%d)%n", this.product);
		// 通知等待区中的一个消费者可以继续工作了
		notify();
	}
	// 这个方法由消费者呼叫
	public synchronized int getProduct() {
		if(this.product == -1) {
			try {
				// 缺货了，请稍候！
				wait();
			}
			catch(InterruptedException e) {
				e.printStackTrace();
			}
		}
		int p = this.product;
		System.out.printf(
		"消费者取走 (%d)%n", this.product);
		this.product = -1;
		// 通知等待区中的一个生产者可以继续工作了
		notify();
		return p;
	}
}
</pre>
<p>  使用&#36825;么一&#20010;程序&#26469;&#27979;&#35797;：</p>
<h5>WaitNotifyDemo.java </h5>
<pre class="code">package onlyfun.caterpillar;
public class WaitNotifyDemo {
	public static void main(String[] args) {
		Clerk clerk = new Clerk();
		Thread producerThread = new Thread(
		new Producer(clerk));
		Thread consumerThread = new Thread(
		new Consumer(clerk));
		producerThread.start();
		consumerThread.start();
	}
}
</pre>
<p>&#25191;行&#32467;果：</p>
<pre class="code">生产者开始生产整数......
消费者开始消耗整数......
生产者设定 (1)
消费者取走 (1)
生产者设定 (2)
消费者取走 (2)
生产者设定 (3)
消费者取走 (3)
生产者设定 (4)
消费者取走 (4)
生产者设定 (5)
消费者取走 (5)
生产者设定 (6)
消费者取走 (6)
生产者设定 (7)
消费者取走 (7)
生产者设定 (8)
消费者取走 (8)
生产者设定 (9)
消费者取走 (9)
生产者设定 (10)
消费者取走 (10)</pre>
<p> 生&#20135;者&#20250;生&#20135;10&#20010;整&#25968;，而消&#36153;者&#20250;消耗10&#20010;整&#25968;，由于店&#21592;&#22788;只能放置一&#20010;整&#25968;，所以每生&#20135;一&#20010;就消耗一&#20010;，其&#32467;果如上所示是&#26080;&#35823;的。<br />
<br />
如果一&#20010;&#25191;行&#32490;&#36827;入&#23545;象的等待集中，您可以中&#26029;它的等待，&#36825;&#26102;&#23558;&#20250;&#21457;生InterruptedException例外&#23545;象，interrupt()方法可用&#26469;&#36827;行&#36825;&#39033;工作。 </p>
<div class="rpindex"><a href="105.html"> 下一页</a><a href="103.html"> 上一页</a><a href="index.html">首页</a></div>



<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
