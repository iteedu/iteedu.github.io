<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->


<h1>linux交换区(swap)的建立</h1>
<p><strong>站长原创，版权所有<a href="http://www.iteedu.com/index.html">ITEEDU</a>，2011-5-8</strong></p>
<h2>第一种方法 ：分区做swap</h2>
<h3>1.通过分区做swap：fdisk /dev/hdc (/dev/sda)</h3>
<p>[root@www ~]# fdisk /dev/hdc<br />
  Command (m for help): n<br />
  First cylinder (2303-5005, default 2303): &lt;==这里按[enter]<br />
  Using default value 2303<br />
  Last cylinder or +size or +sizeM or +sizeK (2303-5005, default 5005): +256M</p>
<p>Command (m for help): p</p>
<p>Device Boot Start End Blocks Id System<br />
  ……<br />
  /dev/hdc6 2053 2302 2008093+ 83 Linux<br />
  /dev/hdc7 2303 2334 257008+ 83 Linux &lt;==新增的项目</p>
<p>Command (m for help): t &lt;==修改系统 ID<br />
  Partition number (1-7): 7 &lt;==从上结果看到的，七号partition<br />
  Hex code (type L to list codes): 82 &lt;==改成 swap 的 ID<br />
  Changed system type of partition 7 to 82 (Linux swap / Solaris)</p>
<p>Command (m for help): p</p>
<p>Device Boot Start End Blocks Id System<br />
  ……<br />
  /dev/hdc6 2053 2302 2008093+ 83 Linux<br />
  /dev/hdc7 2303 2334 257008+ 82 Linux swap / Solaris</p>
<p>Command (m for help): w<br />
  # 此时就将 partition table 更新了！</p>
<p>[root@www ~]# partprobe<br />
  # 不要忘记让核心更新 partition table !</p>
<h3>2. 开始建置 swap 格式</h3>
<p>[root@www ~]# mkswap /dev/hdc7<br />
  Setting up swapspace version 1, size = 263172 kB &lt;==非常快速！<br />
</p>
<h3>3. 开始观察与载入</h3>
<p>[root@www ~]# free<br />
  total used free shared buffers cached<br />
  Mem: 742664 684592 58072 0 43820 497144<br />
  -/+ buffers/cache: 143628 599036<br />
  Swap: 1020088 96 1019992<br />
  # 我有 742664K 的实体记忆体，使用 684592K 剩余 58072K ，使用掉的记忆体有<br />
  # 43820K / 497144K 用在缓冲/快取的用途中。<br />
  # 至于 swap 已经存在了 1020088K ！</p>
<p>[root@www ~]# swapon /dev/hdc7<br />
  [root@www ~]# free<br />
  total used free shared buffers cached<br />
  Mem: 742664 684712 57952 0 43872 497180<br />
  -/+ buffers/cache: 143660 599004<br />
  Swap: 1277088 96 1276992 &lt;==有增加！</p>
<p>[root@www ~]# swapon -s<br />
  Filename Type Size Used Priority<br />
  /dev/hdc5 partition 1020088 96 -1<br />
  /dev/hdc7 partition 257000 0 -2</p>
<h2> 第二种方法：使用档案建置swap</h2>
<p>如果是在实体分割槽无法支援的环境下，此时前一小节提到的 loop 装置建置方法就派的上用场啦！ 与实体分割槽不一样的只是利用 dd 去建置一个大档案而已。多说无益，我们就再透过档案建置的方法建立一个 128 MB 的记忆体置换空间吧！</p>
<h3> 1. dd指令</h3>
<p>使用 dd 这个指令来新增一个 128MB 的档案在 /tmp 底下：</p>
<p>[root@www ~]# dd if=/dev/zero of=/tmp/swap bs=1M count=128<br />
  128+0 records in<br />
  128+0 records out<br />
  134217728 bytes (134 MB) copied, 1.7066 seconds, 78.6 MB/s</p>
<p>[root@www ~]# ls -l /tmp/swap<br />
  -rw-r--r-- 1 root root 128M Oct 28 15:33 /tmp/swap</p>
<p>这样一个 128MB 的档案就建置妥当。</p>
<h3> 2. mkswap指令</h3>
<p>使用 mkswap 将 /tmp/swap 这个档案格式化为 swap 的档案格式：</p>
<p>[root@www ~]# mkswap /tmp/swap<br />
  Setting up swapspace version 1, size = 134213 kB<br />
  # 这个指令下达时请'特别小心'，因为下错字元控制，将可能使您的档案系统挂掉！<br />
</p>
<h3>3. swapon指令</h3>
<p>使用 swapon 来将 /tmp/swap 启动。</p>
<p>[root@www ~]# free<br />
  total used free shared buffers cached<br />
  Mem: 742664 450860 291804 0 45584 261284<br />
  -/+ buffers/cache: 143992 598672<br />
  Swap: 1277088 96 1276992</p>
<p>[root@www ~]# swapon /tmp/swap<br />
  [root@www ~]# free<br />
  total used free shared buffers cached<br />
  Mem: 742664 450860 291804 0 45604 261284<br />
  -/+ buffers/cache: 143972 598692<br />
  Swap: 1408152 96 1408056</p>
<p>[root@www ~]# swapon -s<br />
  Filename Type Size Used Priority<br />
  /dev/hdc5 partition 1020088 96 -1<br />
  /dev/hdc7 partition 257000 0 -2<br />
  /tmp/swap file 131064 0 -3</p>
<h3>4. swapoff指令</h3>
<p>使用 swapoff 关掉 swap file</p>
<p>[root@www ~]# swapoff /tmp/swap<br />
  [root@www ~]# swapoff /dev/hdc7<br />
  [root@www ~]# free<br />
  total used free shared buffers cached<br />
  Mem: 742664 450860 291804 0 45660 261284<br />
  -/+ buffers/cache: 143916 598748<br />
  Swap: 1020088 96 1019992 &lt;==回复成最原始的样子了！</p>
<h2>swap交换区文件建立问题总结</h2>
<p>笔者在安装ubuntu系统之时，本来已经分好了一个专门的交换区，但是后来一不小心，把交换区给重新格式化了，在xp下作为一个2.5G的磁盘使用了。所以目前只能在ubuntu下边建立一个swap交换文件，以当做swap交换区来使用了。</p>
<p>那么，我采用上述的方法二，但是每次已重新启动就通过free一查看，swap交换区就变为0了。哎……</p>
<p>后来，经过摸索，终于搞定了，现在跟大家再次分享出来：</p>
<p>我们需要将swap挂载在/etc/fstab中。<br />
利用命令:sudo gedit  /etc/fatab，打开fatab文件，在其中添加：<br />
# &lt;file system&gt; &lt;mount  point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;</p>
<p>proc            /proc           proc    defaults        0       0</p>
<p>/home/rock/swapfile  none   swap    defaults  0    0<br />
  source /etc/fstab即可即时生效，也可以保证下次重新启动的时候依然生效。呵呵，就这么简单。</p>
<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
