
<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->
<TABLE BORDER="0" WIDTH="100%" HEIGHT="100%" CELLSPACING="0" CELLPADDING="0"><TR><TD COLSPAN="3"><DIV CLASS="NAVHEADER"><TABLE BGCOLOR="#CCCCFF" BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="100%"><TR><TD><TABLE  SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="3" CELLSPACING="0"><TR><TH  COLSPAN="3" ALIGN="center">PHP 手册</TH></TR><TR><TD  WIDTH="10%" ALIGN="left" VALIGN="bottom"><A  HREF="zend.startup-and-shutdown.html" ACCESSKEY="P">后退</A></TD><TD  WIDTH="80%" ALIGN="center" VALIGN="bottom">章 45. Zend API：深入 PHP 内核</TD><TD  WIDTH="10%" ALIGN="right" VALIGN="bottom"><A  HREF="zend.ini-file-support.html" ACCESSKEY="N">前进</A></TD></TR></TABLE></TD></TR><TR BGCOLOR="#333366"><TD><IMG SRC="../spacer.gif" BORDER="0" WIDTH="1" HEIGHT="1"><BR></TD></TR></TABLE></DIV></TD></TR><TR><TD><IMG SRC="../spacer.gif" WIDTH="10" HEIGHT="1"></TD><TD HEIGHT="100%" VALIGN="TOP" WIDTH="100%"><BR><DIV  CLASS="sect1"><H1  CLASS="sect1"><A  NAME="zend.calling-user-functions">Calling User Functions</A></H1><P>&#13;   You can call user functions from your own modules, which is very
   handy when implementing callbacks; for example, for array walking, searching, or
   simply for event-based programs.
  </P><P>&#13;   User functions can be called with the
   function <A  HREF="zend-api.call-user-function-ex.html"><B  CLASS="function">call_user_function_ex()</B></A>. It requires a hash value
   for the function table you want to access, a pointer to an object (if you want
   to call a method), the function name, return value, number of arguments,
   argument array, and a flag indicating whether you want to perform zval separation. 
  </P><TABLE  BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><PRE  CLASS="programlisting">ZEND_API int call_user_function_ex(HashTable *function_table, zval *object,
zval *function_name, zval **retval_ptr_ptr,
int param_count, zval **params[],
int no_separation);</PRE></TD></TR></TABLE><P>&#13;   Note that you don't have to specify both
   <VAR  CLASS="envar">function_table</VAR>  and <VAR  CLASS="envar">object</VAR>; either
   will do. If you want to call a method, you have to supply the
   object that contains this method, in which case
   <A  HREF="zend-api.call-user-function.html"><B  CLASS="function">call_user_function()</B></A>automatically sets the
   function table to this object's function table. Otherwise, you only
   need to specify <VAR  CLASS="envar">function_table</VAR> and can set
   <VAR  CLASS="envar">object</VAR> to <VAR  CLASS="literal">NULL</VAR>.
  </P><P>&#13;   Usually, the default function table is the "root" function table
   containing all function entries. This function table is part of the
   compiler globals and can be accessed using the macro
   <VAR  CLASS="literal">CG</VAR>. To introduce the compiler globals to your
   function, call the macro <VAR  CLASS="literal">TSRMLS_FETCH</VAR> once.
  </P><P>&#13;   The function name is specified in a <VAR  CLASS="envar">zval</VAR>
   container. This might be a bit surprising at first, but is quite a
   logical step, since most of the time you'll accept function names
   as parameters from calling functions within your script, which in
   turn are contained in <VAR  CLASS="envar">zval</VAR> containers again. Thus,
   you only have to pass your arguments through to this function. This
   <VAR  CLASS="envar">zval</VAR> must be of type <VAR  CLASS="literal">IS_STRING</VAR>.
  </P><P>&#13;   The next argument consists of a pointer to the return value. You
   don't have to allocate memory for this container; the function will
   do so by itself. However, you have to destroy this container (using
   <B  CLASS="function">zval_dtor()</B>) afterward!
  </P><P>&#13;   Next is the parameter count as integer and an array containing all
   necessary parameters.  The last argument specifies whether the
   function should perform zval separation - this should always be set
   to <VAR  CLASS="literal">0</VAR>. If set to <VAR  CLASS="literal">1</VAR>, the
   function consumes less memory but fails if any of the parameters
   need separation.
  </P><P>&#13;   <A  HREF="zend.calling-user-functions.html#example.call-user-func">例子 45-15</A> shows a small demonstration of
   calling a user function. The code calls a function that's supplied
   to it as argument and directly passes this function's return value
   through as its own return value. Note the use of the constructor
   and destructor calls at the end - it might not be necessary to do
   it this way here (since they should be separate values, the
   assignment might be safe), but this is bulletproof.
  </P><TABLE  WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0" CLASS="EXAMPLE"><TR><TD><DIV  CLASS="example"><A  NAME="example.call-user-func"></A><P><B>例子 45-15. Calling user functions.</B></P><TABLE  BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><PRE  CLASS="programlisting">zval **function_name;
zval *retval;

if((ZEND_NUM_ARGS() != 1) || (zend_get_parameters_ex(1, &#38;function_name) != SUCCESS))
{
    WRONG_PARAM_COUNT;
}

if((*function_name)-&#62;type != IS_STRING)
{
    zend_error(E_ERROR, "Function requires string argument");
}

TSRMSLS_FETCH();

if(call_user_function_ex(CG(function_table), NULL, *function_name, &#38;retval, 0, NULL, 0) != SUCCESS)
{
    zend_error(E_ERROR, "Function call failed");
}

zend_printf("We have %i as type&#60;br&#62;", retval-&#62;type);

*return_value = *retval;
zval_copy_ctor(return_value);
zval_ptr_dtor(&#38;retval);</PRE></TD></TR></TABLE></DIV></TD></TR></TABLE><P></P><TABLE  BORDER="0" BGCOLOR="#E0E0E0" CELLPADDING="5"><TR><TD><PRE  CLASS="programlisting">&#60;?php

dl("call_userland.so");

function test_function()
{

    print("We are in the test function!&#60;br&#62;");

    return("hello");

}

$return_value = call_userland("test_function");

print("Return value: \"$return_value\"&#60;br&#62;");
?&#62;</PRE></TD></TR></TABLE><P><IMG  SRC="../figures/zend.10-userland.png"></P></DIV><BR></TD><TD><IMG SRC="../spacer.gif" WIDTH="10" HEIGHT="1"></TD></TR><TR><TD COLSPAN="3"><DIV CLASS="NAVFOOTER"><TABLE BGCOLOR="#CCCCFF" BORDER="0" CELLPADDING="0" CELLSPACING="0" WIDTH="100%"><TR BGCOLOR="#333366"><TD><IMG SRC="../spacer.gif" BORDER="0" WIDTH="1" HEIGHT="1"><BR></TD></TR><TR><TD><TABLE  SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="3" CELLSPACING="0"><TR><TD  WIDTH="33%" ALIGN="left" VALIGN="top"><A  HREF="zend.startup-and-shutdown.html" ACCESSKEY="P">后退</A></TD><TD  WIDTH="34%" ALIGN="center" VALIGN="top"><A  HREF="../index.html" ACCESSKEY="H">起点</A></TD><TD  WIDTH="33%" ALIGN="right" VALIGN="top"><A  HREF="zend.ini-file-support.html" ACCESSKEY="N">前进</A></TD></TR><TR><TD  WIDTH="33%" ALIGN="left" VALIGN="top">Startup and Shutdown Functions</TD><TD  WIDTH="34%" ALIGN="center" VALIGN="top"><A  HREF="zend.html" ACCESSKEY="U">上一级</A></TD><TD  WIDTH="33%" ALIGN="right" VALIGN="top">Initialization File Support</TD></TR></TABLE></TD></TR></TABLE></DIV></TD></TR></TABLE>

<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
