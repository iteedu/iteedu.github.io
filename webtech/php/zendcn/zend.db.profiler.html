<!--hmt-->
<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end --><!--end of htmlheader-->

<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->
<!--end of htmlmiddle-->



<div class="sect1" title="15.3. Zend_Db_Profiler">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.db.profiler"></a>15.3. Zend_Db_Profiler</h2></div></div></div>
<div class="sect2" title="15.3.1. Introduction">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.db.profiler.introduction"></a>15.3.1. Introduction</h3></div></div></div>
<p>
            <code class="classname">Zend_Db_Profiler</code> can be enabled to allow profiling of
            queries. Profiles include the queries processed by the adapter as
            well as elapsed time to run the queries, allowing inspection of the
            queries that have been performed without needing to add extra
            debugging code to classes. Advanced usage also allows the
            developer to filter which queries are profiled.
        </p>
<p>
            Enable the profiler by either passing a directive to the adapter
            constructor, or by asking the adapter to enable it later.
        </p>
<pre class="code">
$params = array(
    'host'     =&gt; '127.0.0.1',
    'username' =&gt; 'webuser',
    'password' =&gt; 'xxxxxxxx',
    'dbname'   =&gt; 'test'
    'profiler' =&gt; true  // turn on profiler
                        // set to false to disable (disabled by default)
);

$db = Zend_Db::factory('PDO_MYSQL', $params);

// turn off profiler:
$db-&gt;getProfiler()-&gt;setEnabled(false);

// turn on profiler:
$db-&gt;getProfiler()-&gt;setEnabled(true);
</pre>
<p>
            The value of the '<code>profiler</code>' option is flexible. It is interpreted
            differently depending on its type. Most often, you should use a simple boolean value,
            but other types enable you to customize the profiler behavior.
        </p>
<p>
            A boolean argument sets the profiler to enabled if it is a <code class="constant">TRUE</code>
            value, or disabled if <code class="constant">FALSE</code>. The profiler class is the adapter's
            default profiler class, <code class="classname">Zend_Db_Profiler</code>.
            </p>
<pre class="code">
$params['profiler'] = true;
$db = Zend_Db::factory('PDO_MYSQL', $params);
</pre>
<p>
        </p>
<p>
            An instance of a profiler object makes the adapter use that object. The object type must
            be <code class="classname">Zend_Db_Profiler</code> or a subclass thereof. Enabling the profiler
            is done separately.
            </p>
<pre class="code">
$profiler = MyProject_Db_Profiler();
$profiler-&gt;setEnabled(true);
$params['profiler'] = $profiler;
$db = Zend_Db::factory('PDO_MYSQL', $params);
</pre>
<p>
        </p>
<p>
            The argument can be an associative array containing any or all of the keys
            '<code>enabled</code>', '<code>instance</code>', and '<code>class</code>'. The
            '<code>enabled</code>' and '<code>instance</code>' keys correspond to the boolean and
            instance types documented above. The '<code>class</code>' key is used to name a class to
            use for a custom profiler. The class must be <code class="classname">Zend_Db_Profiler</code> or
            a subclass. The class is instantiated with no constructor arguments. The
            '<code>class</code>' option is ignored when the '<code>instance</code>' option is
            supplied.
            </p>
<pre class="code">
$params['profiler'] = array(
    'enabled' =&gt; true,
    'class'   =&gt; 'MyProject_Db_Profiler'
);
$db = Zend_Db::factory('PDO_MYSQL', $params);
</pre>
<p>
        </p>
<p>
            Finally, the argument can be an object of type <code class="classname">Zend_Config</code>
            containing properties, which are treated as the array keys described above. For example,
            a file "config.ini" might contain the following data:
            </p>
<pre class="code">
[main]
db.profiler.class   = "MyProject_Db_Profiler"
db.profiler.enabled = true
</pre>
<p>

            This configuration can be applied by the following PHP code:

            </p>
<pre class="code">
$config = new Zend_Config_Ini('config.ini', 'main');
$params['profiler'] = $config-&gt;db-&gt;profiler;
$db = Zend_Db::factory('PDO_MYSQL', $params);
</pre>
<p>

            The '<code>instance</code>' property may be used as in the following:
            </p>
<pre class="code">
$profiler = new MyProject_Db_Profiler();
$profiler-&gt;setEnabled(true);
$configData = array(
    'instance' =&gt; $profiler
    );
$config = new Zend_Config($configData);
$params['profiler'] = $config;
$db = Zend_Db::factory('PDO_MYSQL', $params);
</pre>
<p>

        </p>
</div>
<div class="sect2" title="15.3.2. Using the Profiler">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.db.profiler.using"></a>15.3.2. Using the Profiler</h3></div></div></div>
<p>
            At any point, grab the profiler using the adapter's
            <code>getProfiler()</code> method:
        </p>
<pre class="code">
$profiler = $db-&gt;getProfiler();
</pre>
<p>
            This returns a <code class="classname">Zend_Db_Profiler</code> object instance. With
            that instance, the developer can examine your queries using a
            variety of methods:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
                    <code>getTotalNumQueries()</code> returns the total number
                    of queries that have been profiled.
                </p></li>
<li class="listitem"><p>
                    <code>getTotalElapsedSecs()</code> returns the total
                    number of seconds elapsed for all profiled queries.
                </p></li>
<li class="listitem"><p>
                    <code>getQueryProfiles()</code> returns an array of all
                    query profiles.
                </p></li>
<li class="listitem"><p>
                    <code>getLastQueryProfile()</code> returns the last (most
                    recent) query profile, regardless of whether or not the query
                    has finished (if it hasn't, the end time will be null)
                </p></li>
<li class="listitem"><p>
                    <code>clear()</code> clears any past query profiles
                    from the stack.
                </p></li>
</ul></div>
<p>
            The return value of <code>getLastQueryProfile()</code> and the
            individual elements of <code>getQueryProfiles()</code> are
            <code class="classname">Zend_Db_Profiler_Query</code> objects, which provide the
            ability to inspect the individual queries themselves:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
                    <code>getQuery()</code> returns the SQL text of the query.
                    The SQL text of a prepared statement with parameters is the
                    text at the time the query was prepared, so it contains
                    parameter placeholders, not the values used when the
                    statement is executed.
                </p></li>
<li class="listitem"><p>
                    <code>getQueryParams()</code> returns an array of
                    parameter values used when executing a prepared query.
                    This includes both bound parameters and arguments to the
                    statement's <code>execute()</code> method. The keys of
                    the array are the positional (1-based) or named (string)
                    parameter indices.
                </p></li>
<li class="listitem"><p>
                    <code>getElapsedSecs()</code> returns the number of
                    seconds the query ran.
                </p></li>
</ul></div>
<p>
            The information <code class="classname">Zend_Db_Profiler</code> provides is useful for
            profiling bottlenecks in applications, and for debugging queries
            that have been run. For instance, to see the exact query that was
            last run:
        </p>
<pre class="code">
$query = $profiler-&gt;getLastQueryProfile();

echo $query-&gt;getQuery();
</pre>
<p>
            Perhaps a page is generating slowly; use the profiler to determine
            first the total number of seconds of all queries, and then step
            through the queries to find the one that ran longest:
        </p>
<pre class="code">
$totalTime    = $profiler-&gt;getTotalElapsedSecs();
$queryCount   = $profiler-&gt;getTotalNumQueries();
$longestTime  = 0;
$longestQuery = null;

foreach ($profiler-&gt;getQueryProfiles() as $query) {
    if ($query-&gt;getElapsedSecs() &gt; $longestTime) {
        $longestTime  = $query-&gt;getElapsedSecs();
        $longestQuery = $query-&gt;getQuery();
    }
}

echo 'Executed ' . $queryCount . ' queries in ' . $totalTime .
     ' seconds' . "\n";
echo 'Average query length: ' . $totalTime / $queryCount .
     ' seconds' . "\n";
echo 'Queries per second: ' . $queryCount / $totalTime . "\n";
echo 'Longest query length: ' . $longestTime . "\n";
echo "Longest query: \n" . $longestQuery . "\n";
</pre>
</div>
<div class="sect2" title="15.3.3. Advanced Profiler Usage">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.db.profiler.advanced"></a>15.3.3. Advanced Profiler Usage</h3></div></div></div>
<p>
            In addition to query inspection, the profiler also allows the
            developer to filter which queries get profiled. The following
            methods operate on a <code class="classname">Zend_Db_Profiler</code> instance:
        </p>
<div class="sect3" title="15.3.3.1. Filter by query elapsed time">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.db.profiler.advanced.filtertime"></a>15.3.3.1. Filter by query elapsed time</h4></div></div></div>
<p>
                <code>setFilterElapsedSecs()</code> allows the developer to set
                a minimum query time before a query is profiled. To remove the
                filter, pass the method a null value.
            </p>
<pre class="code">
// Only profile queries that take at least 5 seconds:
$profiler-&gt;setFilterElapsedSecs(5);

// Profile all queries regardless of length:
$profiler-&gt;setFilterElapsedSecs(null);
</pre>
</div>
<div class="sect3" title="15.3.3.2. Filter by query type">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.db.profiler.advanced.filtertype"></a>15.3.3.2. Filter by query type</h4></div></div></div>
<p>
                <code>setFilterQueryType()</code> allows the developer to set
                which types of queries should be profiled; to profile multiple
                types, logical OR them. Query types are defined as the following
                <code class="classname">Zend_Db_Profiler</code> constants:
            </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
                        <code class="classname">Zend_Db_Profiler::CONNECT</code>: connection
                        operations, or selecting a database.
                    </p></li>
<li class="listitem"><p>
                        <code class="classname">Zend_Db_Profiler::QUERY</code>: general database
                        queries that do not match other types.
                    </p></li>
<li class="listitem"><p>
                        <code class="classname">Zend_Db_Profiler::INSERT</code>: any query that
                        adds new data to the database, generally SQL INSERT.
                    </p></li>
<li class="listitem"><p>
                        <code class="classname">Zend_Db_Profiler::UPDATE</code>: any query that
                        updates existing data, usually SQL UPDATE.
                    </p></li>
<li class="listitem"><p>
                        <code class="classname">Zend_Db_Profiler::DELETE</code>: any query that
                        deletes existing data, usually SQL DELETE.
                    </p></li>
<li class="listitem"><p>
                        <code class="classname">Zend_Db_Profiler::SELECT</code>: any query that
                        retrieves existing data, usually SQL SELECT.
                    </p></li>
<li class="listitem"><p>
                        <code class="classname">Zend_Db_Profiler::TRANSACTION</code>: any
                        transactional operation, such as start transaction, commit,
                        or rollback.
                    </p></li>
</ul></div>
<p>
                As with <code>setFilterElapsedSecs()</code>, you can remove any
                existing filters by passing <code class="constant">NULL</code> as the sole
                argument.
            </p>
<pre class="code">
// profile only SELECT queries
$profiler-&gt;setFilterQueryType(Zend_Db_Profiler::SELECT);

// profile SELECT, INSERT, and UPDATE queries
$profiler-&gt;setFilterQueryType(Zend_Db_Profiler::SELECT |
                              Zend_Db_Profiler::INSERT |
                              Zend_Db_Profiler::UPDATE);

// profile DELETE queries
$profiler-&gt;setFilterQueryType(Zend_Db_Profiler::DELETE);

// Remove all filters
$profiler-&gt;setFilterQueryType(null);
</pre>
</div>
<div class="sect3" title="15.3.3.3. Retrieve profiles by query type">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.db.profiler.advanced.getbytype"></a>15.3.3.3. Retrieve profiles by query type</h4></div></div></div>
<p>
                Using <code>setFilterQueryType()</code> can cut down on the
                profiles generated. However, sometimes it can be more useful to
                keep all profiles, but view only those you need at a given
                moment. Another feature of <code>getQueryProfiles()</code> is
                that it can do this filtering on-the-fly, by passing a query
                type (or logical combination of query types) as its first
                argument; see <a class="xref" href="zend.db.profiler.html#zend.db.profiler.advanced.filtertype" title="15.3.3.2. Filter by query type">第 15.3.3.2 节 “Filter by query type”</a>
                for a list of the query type constants.
            </p>
<pre class="code">
// Retrieve only SELECT query profiles
$profiles = $profiler-&gt;getQueryProfiles(Zend_Db_Profiler::SELECT);

// Retrieve only SELECT, INSERT, and UPDATE query profiles
$profiles = $profiler-&gt;getQueryProfiles(Zend_Db_Profiler::SELECT |
                                        Zend_Db_Profiler::INSERT |
                                        Zend_Db_Profiler::UPDATE);

// Retrieve DELETE query profiles
$profiles = $profiler-&gt;getQueryProfiles(Zend_Db_Profiler::DELETE);
</pre>
</div>
</div>
<div class="sect2" title="15.3.4. Specialized Profilers">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.db.profiler.profilers"></a>15.3.4. Specialized Profilers</h3></div></div></div>
<p>
            A Specialized Profiler is an object that inherits from
            <code class="classname">Zend_Db_Profiler</code>. Specialized Profilers treat
            profiling information in specific ways.
        </p>
<div class="sect3" title="15.3.4.1. Profiling with Firebug">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.db.profiler.profilers.firebug"></a>15.3.4.1. Profiling with Firebug</h4></div></div></div>
<p>
        <code class="classname">Zend_Db_Profiler_Firebug</code> sends profiling infomation to the
        Firebug Console.
    </p>
<p>
        All data is sent via the <code class="classname">Zend_Wildfire_Channel_HttpHeaders</code>
        component which uses HTTP headers to ensure the page content is not
        disturbed. Debugging AJAX requests that require clean JSON and XML
        responses is possible with this approach.
    </p>
<p>
        Requirements:
    </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
            Firefox Browser ideally version 3 but version 2 is also supported.
        </p></li>
<li class="listitem"><p>
            Firebug Firefox Extension which you can download from <a class="ulink" href="" target="_top">https://addons.mozilla.org/en-US/firefox/addon/1843</a>.
        </p></li>
<li class="listitem"><p>
            FirePHP Firefox Extension which you can download from <a class="ulink" href="" target="_top">https://addons.mozilla.org/en-US/firefox/addon/6149</a>.
        </p></li>
</ul></div>
<div class="example">
<a name="zend.db.profiler.profilers.firebug.example.with_front_controller"></a><p class="title"><b>例 15.10. DB Profiling with Zend_Controller_Front</b></p>
<div class="example-contents"><pre class="code">
// In your bootstrap file

$profiler = new Zend_Db_Profiler_Firebug('All DB Queries');
$profiler-&gt;setEnabled(true);

// Attach the profiler to your db adapter
$db-&gt;setProfiler($profiler)

// Dispatch your front controller

// All DB queries in your model, view and controller
// files will now be profiled and sent to Firebug
</pre></div>
</div>
<br class="example-break"><div class="example">
<a name="zend.db.profiler.profilers.firebug.example.without_front_controller"></a><p class="title"><b>例 15.11. DB Profiling without Zend_Controller_Front</b></p>
<div class="example-contents"><pre class="code">
$profiler = new Zend_Db_Profiler_Firebug('All DB Queries');
$profiler-&gt;setEnabled(true);

// Attach the profiler to your db adapter
$db-&gt;setProfiler($profiler)

$request  = new Zend_Controller_Request_Http();
$response = new Zend_Controller_Response_Http();
$channel  = Zend_Wildfire_Channel_HttpHeaders::getInstance();
$channel-&gt;setRequest($request);
$channel-&gt;setResponse($response);

// Start output buffering
ob_start();

// Now you can run your DB queries to be profiled

// Flush profiling data to browser
$channel-&gt;flush();
$response-&gt;sendHeaders();
</pre></div>
</div>
<br class="example-break">
</div>
</div>
</div>
<div class="revinfo"></div>


<!--start of htmlend-->

<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->