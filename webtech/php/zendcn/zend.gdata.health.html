<!--hmt-->
<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end --><!--end of htmlheader-->

<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->
<!--end of htmlmiddle-->



<div class="sect1" title="24.7. Using Google Health">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.gdata.health"></a>24.7. Using Google Health</h2></div></div></div>
<p>
        The Google Health Data API is designed to enable developers to do two things:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
                    Read a user's Google Health profile or query for medical records that match particular criteria and then
                    use the results to provide personalized functionality based on the data.
                </p></li>
<li class="listitem"><p>
                    Add new medical records to a user's profile by including CCR data when sending a notice to a user's profile. Note: The CCR data is stored as an XML blob
                    within the &lt;atom&gt; entry. The library does not provide direct accessors to the object model but it does have helpers for extracting specific fields.
                </p></li>
</ul></div>
<p>
    </p>
<p>
        There are three main feeds, each of which requires authentication. Unlike other Google Data APIs, each Google Health feed has a limited set of
        HTTP operations you can perform on it, depending on which authentication method you are using (ClientLogin or AuthSub/OAuth).
        For a list of permitted operations, see http://code.google.com/apis/health/reference.html#Authentication.
        </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
                  <em class="firstterm">Profile Feed</em>
                  use the profile feed to query a user's health profile for specific information.
                </p></li>
<li class="listitem"><p>
                  <em class="firstterm">Register Feed</em>
                  use the register feed to reconcile new CCR data into a profile.
                </p></li>
<li class="listitem"><p>
                  <em class="firstterm">Profile List Feed</em>
                    the profile list feed should be used to determine which of the user's Health profiles to interact with.
                    This feed is only available when using ClientLogin.
                </p></li>
</ul></div>
<p>
    </p>
<p>
        See http://code.google.com/apis/health
        for more information about the Google Health API.
    </p>
<div class="sect2" title="24.7.1. Connect To The Health Service">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.gdata.health.connect"></a>24.7.1. Connect To The Health Service</h3></div></div></div>
<p>
            The Google Health API, like all Google Data APIs, is based off of the Atom Publishing Protocol (APP), an XML based format for managing web-based resources.
            Traffic between a client and the Google Health servers occurs over HTTP and allows for authenticated connections.
        </p>
<p>
            Before any transactions can occur, a connection needs to be made. Creating a connection to the Health servers involves two steps: creating an HTTP client
            and binding a <code class="classname">Zend_Gdata_Health</code> service instance to that client.
        </p>
<div class="sect3" title="24.7.1.1. Authentication">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.gdata.health.connect.authentication"></a>24.7.1.1. Authentication</h4></div></div></div>
<p>
                The Google Health API allows programmatic access to a user's Health profile. There are three authentication schemes that are supported by Google Health:
            </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
                        <em class="firstterm">ClientLogin</em>
                        provides direct username/password authentication to the Health servers. Since this method requires that users provide your application
                        with their password, this authentication scheme is only recommended for installed/desktop applications.
                    </p></li>
<li class="listitem"><p>
                        <em class="firstterm">AuthSub</em>
                        allows a user to authorize the sharing of their private data. This provides the same level of convenience as ClientLogin but without the
                        security risk, making it an ideal choice for web-based applications. For Google Health, AuthSub must be used
                        in registered and secure mode--meaning that all requests to the API must be digitally signed.
                    </p></li>
<li class="listitem"><p>
                        <em class="firstterm">OAuth</em>
                        is an alternative to AuthSub. Although this authentication scheme is not discussed in this document, more information can
                        be found in the Health Data API Developer's Guide.
                    </p></li>
</ul></div>
<p>
                See
                Authentication Overview in the Google Data API documentation for more
                information on each authentication method.
            </p>
</div>
<div class="sect3" title="24.7.1.2. Create A Health Service Instance">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.gdata.health.connect.service"></a>24.7.1.2. Create A Health Service Instance</h4></div></div></div>
<p>
                In order to interact with Google Health, the client library provides the
                <code class="classname">Zend_Gdata_Health</code>
                service class. This class provides a common interface to the Google Data and Atom Publishing Protocol models and assists in marshaling
                requests to and from the Health API.
            </p>
<p>
                Once you've decided on an authentication scheme, the next step is to create an instance of
                <code class="classname">Zend_Gdata_Health</code>
                . This class should be passed an instance of
                <code class="classname">Zend_Gdata_HttpClient</code>. This provides an interface for AuthSub/OAuth and ClientLogin to create a special
                authenticated HTTP client.
            </p>
<p>
                To test against the H9 Developer's (/h9) instead of Google Health (/health), the
                <code class="classname">Zend_Gdata_Health</code> constructor takes an optional third argument for you to specify the H9 service name 'weaver'.
            </p>
<p>
                The example below shows how to create a Health service class using ClientLogin authentication:
            </p>
<pre class="code">
// Parameters for ClientLogin authentication
$healthServiceName = Zend_Gdata_Health::HEALTH_SERVICE_NAME;
//$h9ServiceName = Zend_Gdata_Health::H9_SANDBOX_SERVICE_NAME;
$user = "user@gmail.com";
$pass = "pa$$w0rd";

// Create an authenticated HTTP client
$client = Zend_Gdata_ClientLogin::getHttpClient($user,
                                                $pass,
                                                $healthServiceName);

// Create an instance of the Health service
$service = new Zend_Gdata_Health($client);
</pre>
<p>
              A Health service using AuthSub can be created in a similar, though slightly more lengthy fashion. AuthSub is the
              recommend interface to communicate with Google Health because each token is directly linked to a specific profile in
              the user's account. Unlike other Google Data APIs, it is required that all requests from your application be digitally signed.
            </p>
<pre class="code">
/*
 * Retrieve the current URL so that the AuthSub server knows where to
 * redirect the user after authentication is complete.
 */
function getCurrentUrl() {
    $phpRequestUri = htmlentities(substr($_SERVER['REQUEST_URI'],
                                         0,
                                         strcspn($_SERVER['REQUEST_URI'],
                                                 "\n\r")),
                                  ENT_QUOTES);

    if (isset($_SERVER['HTTPS']) &amp;&amp; strtolower($_SERVER['HTTPS']) == 'on') {
        $protocol = 'https://';
    } else {
        $protocol = 'http://';
    }
    $host = $_SERVER['HTTP_HOST'];
    if ($_SERVER['SERVER_PORT'] != '' &amp;&amp;
       (($protocol == 'http://' &amp;&amp; $_SERVER['SERVER_PORT'] != '80') ||
       ($protocol == 'https://' &amp;&amp; $_SERVER['SERVER_PORT'] != '443'))) {
        $port = ':' . $_SERVER['SERVER_PORT'];
    } else {
        $port = '';
    }
    return $protocol . $host . $port . $phpRequestUri;
}

/*
 * Redirect a user to AuthSub if they do not have a valid session token.
 * If they're coming back from AuthSub with a single-use token, instantiate
 * a new HTTP client and exchange the token for a long-lived session token
 * instead.
 */
function setupClient($singleUseToken = null) {
    $client = null;

    // Fetch a new AuthSub token?
    if (!$singleUseToken) {
        $next = getCurrentUrl();
        $scope = 'https://www.google.com/health/feeds';
        $authSubHandler = 'https://www.google.com/health/authsub';
        $secure = 1;
        $session = 1;
        $authSubURL =  Zend_Gdata_AuthSub::getAuthSubTokenUri($next,
                                                              $scope,
                                                              $secure,
                                                              $session,
                                                              $authSubHandler);

         // 1 - allows posting notices &amp;&amp; allows reading profile data
        $permission = 1;
        $authSubURL .= '&amp;permission=' . $permission;

        echo '&lt;a href="' . $authSubURL . '"&gt;Your Google Health Account&lt;/a&gt;';
    } else {
        $client = new Zend_Gdata_HttpClient();

        // This sets your private key to be used to sign subsequent requests
        $client-&gt;setAuthSubPrivateKeyFile('/path/to/your/rsa_private_key.pem',
                                          null,
                                          true);

        $sessionToken =
            Zend_Gdata_AuthSub::getAuthSubSessionToken(trim($singleUseToken),
                                                       $client);

        // Set the long-lived session token for subsequent requests
        $client-&gt;setAuthSubToken($sessionToken);
    }
    return $client;
}

// -&gt; Script execution begins here &lt;-

session_start();

$client = setupClient(@$_GET['token']);

// Create an instance of the Health service
$userH9Sandbox = false;
$healthService = new Zend_Gdata_Health($client,
                                       'googleInc-MyTestAppName-v1.0',
                                       $userH9Sandbox);
</pre>
<p>NOTE: the remainder of this document will assume you are using AuthSub for authentication.</p>
</div>
</div>
<div class="sect2" title="24.7.2. Profile Feed">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.gdata.health.profilefeed"></a>24.7.2. Profile Feed</h3></div></div></div>
<p>
            To query the user's profile feed, make sure your initial AuthSub token was requested with the <code>permission=1</code> parameter set.
            The process of extracting data from the profile requires two steps, sending a query and iterating through the resulting feed.
        </p>
<div class="sect3" title="24.7.2.1. Send a Structured Query">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.gdata.health.profilefeed.query"></a>24.7.2.1. Send a Structured Query</h4></div></div></div>
<p>
                You can send structured queries to retrieve specific records from a user's profile.
            </p>
<p>
                When retrieving the profile using the Health API, specifically constructed query URLs are used to describe what (CCR) data
                should be returned. The <code class="classname">Zend_Gdata_Health_Query</code> class helps simplify this task by automatically constructing a query
                URL based on the parameters you set.
            </p>
<div class="sect4" title="24.7.2.1.1. Query The Feed">
<div class="titlepage"><div><div><h5 class="title">
<a name="zend.gdata.health.profilefeed.query.construct"></a>24.7.2.1.1. Query The Feed</h5></div></div></div>
<p>
                    To execute a query against the profile feed, invoke a new instance of an <code class="classname">Zend_Gdata_Health_Query</code> and
                    call the service's <code>getHealthProfileFeed()</code> method:
                </p>
<pre class="code">
$healthService = new Zend_Gdata_Health($client);

// example query for the top 10 medications with 2 items each
$query = new Zend_Gdata_Health_Query();
$query-&gt;setDigest("true");
$query-&gt;setGrouped("true");
$query-&gt;setMaxResultsGroup(10);
$query-&gt;setMaxResultsInGroup(2);
$query-&gt;setCategory("medication");

$profileFeed = $healthService-&gt;getHealthProfileFeed($query);
</pre>
<p>Using <code>setDigest("true")</code> returns all of user's CCR data in a single Atom <code>&lt;entry&gt;</code>.</p>
<p>The <code>setCategory()</code> helper can be passed an additional parameter to return more specific CCR
                information. For example, to return just the medication Lipitor, use <code>setCategory("medication", "Lipitor")</code>. The same
                methodology can be applied to other categories such as conditions, allergies, lab results, etc.</p>
<p>
                    A full list of supported query parameters is available in the query parameters section
                    of the Health API Reference Guide.
                </p>
</div>
</div>
<div class="sect3" title="24.7.2.2. Iterate Through The Profile Entries">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.gdata.health.profilefeed.iterate"></a>24.7.2.2. Iterate Through The Profile Entries</h4></div></div></div>
<p>
                Each Google Health entry contains CCR data, however, using the <code>digest=true</code> query parameter will
                consolidate all of the CCR elements (that match your query) into a single Atom <code>&lt;entry&gt;</code>.
            </p>
<p>
                To retrieve the full CCR information from an entry, make a call to the <code class="classname">Zend_Gdata_Health_ProfileEntry</code> class's <code>getCcr()</code> method.
                That returns a <code class="classname">Zend_Gdata_Health_Extension_CCR</code>:
            </p>
<pre class="code">
$entries = $profileFeed-&gt;getEntries();
foreach ($entries as $entry) {
    $medications = $entry-&gt;getCcr()-&gt;getMedications();
    //$conditions = $entry-&gt;getCcr()-&gt;getConditions();
    //$immunizations = $entry-&gt;getCcr()-&gt;getImmunizations();

    // print the CCR xml (this will just be the entry's medications)
    foreach ($medications as $med) {
        $xmlStr = $med-&gt;ownerDocument-&gt;saveXML($med);
        echo "&lt;pre&gt;" . $xmlStr . "&lt;/pre&gt;";
    }
}
</pre>
<p>
              Here, the <code>getCcr()</code> method is used in conjunction with a magic helper to drill down and extract just the
              medication data from the entry's CCR. The formentioned magic helper takes the form <code>getCATEGORYNAME()</code>, where
              <code>CATEGORYNAME</code> is a supported Google Health category. See the
              Google Health reference Guide for the possible categories.
            </p>
<p>
               To be more efficient, you can also use category queries to only return the necessary CCR from the Google Health servers. Then, iterate through those results:
            </p>
<pre class="code">
$query = new Zend_Gdata_Health_Query();
$query-&gt;setDigest("true");
$query-&gt;setCategory("condition");
$profileFeed = $healthService-&gt;getHealthProfileFeed($query);

// Since the query contained digest=true, only one Atom entry is returned
$entry = $profileFeed-&gt;entry[0];
$conditions = $entry-&gt;getCcr()-&gt;getConditions();

// print the CCR xml (this will just be the profile's conditions)
foreach ($conditions as $cond) {
    $xmlStr = $cond-&gt;ownerDocument-&gt;saveXML($cond);
    echo "&lt;pre&gt;" . $xmlStr . "&lt;/pre&gt;";
}
</pre>
</div>
</div>
<div class="sect2" title="24.7.3. Profile List Feed">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.gdata.health.profilelist"></a>24.7.3. Profile List Feed</h3></div></div></div>
<p>NOTE: This feed is only available when using ClientLogin</p>
<p>
            Since ClientLogin requires a profile ID with each of its feeds, applications will likely want to query this feed first in order
            to select the appropriate profile. The profile list feed returns Atom entries corresponding each profile in the user's
            Google Health account. The profile ID is returned in the Atom <code>&lt;content&gt;</code> and the profile name in the
            <code>&lt;title&gt;</code> element.
        </p>
<div class="sect3" title="24.7.3.1. Query The Feed">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.gdata.health.profilelist.query"></a>24.7.3.1. Query The Feed</h4></div></div></div>
<p>
                To execute a query against the profile list feed, call the service's <code>getHealthProfileListFeed()</code> method:
            </p>
<pre class="code">
$client = Zend_Gdata_ClientLogin::getHttpClient('user@gmail.com',
                                                'pa$$word',
                                                'health');
$healthService = new Zend_Gdata_Health($client);
$feed = $healthService-&gt;getHealthProfileListFeed();

// print each profile's name and id
$entries = $feed-&gt;getEntries();
foreach ($entries as $entry) {
    echo '&lt;p&gt;Profile name: ' . $entry-&gt;getProfileName() . '&lt;br&gt;';
    echo 'profile ID: ' . $entry-&gt;getProfileID() . '&lt;/p&gt;';
}
</pre>
<p>
              Once you've determined which profile to use, call <code>setProfileID()</code> with the profileID as an argument.
              This will restrict subsequent API requests to be against that particular profile:
            </p>
<pre class="code">
// use the first profile
$profileID = $feed-&gt;entry[0]-&gt;getProfileID();
$healthService-&gt;setProfileID($profileID);

$profileFeed = $healthService-&gt;getHealthProfileFeed();

$profileID = $healthService-&gt;getProfileID();
echo '&lt;p&gt;&lt;b&gt;Queried profileID&lt;/b&gt;: ' . $profileID . '&lt;/p&gt;';
</pre>
</div>
</div>
<div class="sect2" title="24.7.4. Sending Notices to the Register Feed">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.gdata.health.notice"></a>24.7.4. Sending Notices to the Register Feed</h3></div></div></div>
<p>
            Individual posts to the register feed are known as notices. Notice are sent from third-party applications to inform the user
            of a new event. With AuthSub/OAuth, notices are the single means by which your application can add new CCR information
            into a user's profile. Notices can contain plain text (including certain XHTML elements), a CCR document, or both. As an example,
            notices might be sent to remind users to pick up a prescription, or they might contain lab results in the CCR format.
        </p>
<div class="sect3" title="24.7.4.1. Sending a notice">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.gdata.health.notice.send"></a>24.7.4.1. Sending a notice</h4></div></div></div>
<p>
              Notices can be sent by using the <code>sendHealthNotice()</code> method for the Health service:
          </p>
<pre class="code">
$healthService = new Zend_Gdata_Health($client);

$subject = "Title of your notice goes here";
$body = "Notice body can contain &lt;b&gt;html&lt;/b&gt; entities";
$ccr = '&lt;ContinuityOfCareRecord xmlns="urn:astm-org:CCR"&gt;
  &lt;Body&gt;
   &lt;Problems&gt;
    &lt;Problem&gt;
      &lt;DateTime&gt;
        &lt;Type&gt;&lt;Text&gt;Start date&lt;/Text&gt;&lt;/Type&gt;
        &lt;ExactDateTime&gt;2007-04-04T07:00:00Z&lt;/ExactDateTime&gt;
      &lt;/DateTime&gt;
      &lt;Description&gt;
        &lt;Text&gt;Aortic valve disorders&lt;/Text&gt;
        &lt;Code&gt;
          &lt;Value&gt;410.10&lt;/Value&gt;
          &lt;CodingSystem&gt;ICD9&lt;/CodingSystem&gt;
          &lt;Version&gt;2004&lt;/Version&gt;
        &lt;/Code&gt;
      &lt;/Description&gt;
      &lt;Status&gt;&lt;Text&gt;Active&lt;/Text&gt;&lt;/Status&gt;
    &lt;/Problem&gt;
  &lt;/Problems&gt;
  &lt;/Body&gt;
&lt;/ContinuityOfCareRecord&gt;';

$responseEntry = $healthService-&gt;sendHealthNotice($subject,
                                                  $body,
                                                  "html",
                                                  $ccr);
</pre>
</div>
</div>
</div>
<div class="revinfo"></div>


<!--start of htmlend-->

<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->