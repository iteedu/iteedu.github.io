<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->
  
    <div class="lpindex"><a href="index.html">首页</a><a href="1.html"> 上一页</a><a href="3.html"> 下一页</a></div>
    <h1><a href="index.html">Struts Gossip: 第一个 Struts 程序</a></h1>
    使用Struts来撰写一个基于 MVC 架构的Web程序是简单的，以下用一个简单的实例来示范如何使用Struts，您也可以从中了解到具体的MVC工作流程。<br />
    <br />
    首先请至 <a href="http://struts.apache.org/">Struts 官方网站</a> 下载Struts，这边下载的是jakarta-struts-1.2.4.zip，解开后您可以在lib目录下找到struts.jar以及一些相依的
    jar文件 ，对于第一个Struts程序来说，您需要以下的jar档，请将这些档案复制至您的Web应用程序的/WEB-INF/lib目录下：<br />
    <ul>
<li>struts.jar</li>
<li>commons-beanutils.jar</li>
<li>commons-digester.jar</li>
<li>commons-collections.jar</li>
<li>commons-logging.jar</li>
    </ul>
  值得一提的是，在Struts的下载档案中，/webapps目录是一些Struts的范例，将来您可以参考这些范例中的一些设定与设计方式来开发程序，
    其中struts-blank.war是一个开发Struts的基础，具备了Struts的基础设定档案及设定，您可以用它来开速开发Web应用程序。<br />
    <br />
    在Struts中，担任Controller角色的是ActionServlet，理想上所有客户端请求都透过它来完成转发，必须在/WEB- INF/web.xml中设定： <br />
<h5>web.xml</h5>
    <pre class="code">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;<br />&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/j2ee&quot; <br />    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; <br />    xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/j2ee <br />    http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot; <br />    version=&quot;2.4&quot;&gt;<br /> &lt;!-- 注意，xsi那行是沒換行的，排版關係才作了換行 --&gt;<br /> &lt;!-- 如果您是直接拷貝這個設定，請自行接上該行 --&gt;<br />    &lt;description&gt; <br />        Struts Web Application<br />    &lt;/description&gt;<br /><br />    &lt;display-name&gt;Struts Web Application&lt;/display-name&gt;<br /><br />    &lt;!-- Standard Action Servlet Configuration --&gt; <br />    &lt;servlet&gt; <br />        &lt;servlet-name&gt;action&lt;/servlet-name&gt; <br />        &lt;servlet-class&gt;<br />            org.apache.struts.action.ActionServlet<br />        &lt;/servlet-class&gt; <br />        &lt;init-param&gt; <br />            &lt;param-name&gt;config&lt;/param-name&gt; <br />            &lt;param-value&gt;<br />                /WEB-INF/conf/struts-config.xml<br />            &lt;/param-value&gt; <br />        &lt;/init-param&gt; <br />        &lt;load-on-startup&gt;2&lt;/load-on-startup&gt; <br />    &lt;/servlet&gt; <br /><br />    &lt;!-- Standard Action Servlet Mapping --&gt; <br />    &lt;servlet-mapping&gt; <br />        &lt;servlet-name&gt;action&lt;/servlet-name&gt; <br />        &lt;url-pattern&gt;*.do&lt;/url-pattern&gt; <br />    &lt;/servlet-mapping&gt;<br /><br />&lt;/web-app&gt;</pre>
    org.apache.struts.action.ActionServlet的设定中，设定config参数的作用是设定struts-config.xml的档案来源，struts-config.xml中包括了所有Struts的相关请求转发，以及一些资源设定。<br />
    <br />
    在ActionServlet的servlet-mapping设定中，将所有以*.do结尾的请求交给ActionServlet来处理。<br />
    <br />
    接下来看看struts-config.xml的设定：<br />
<h5>struts-config.xml</h5>
    <pre class="code">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot; ?&gt;<br /><br />&lt;!DOCTYPE struts-config PUBLIC<br /> &quot;-//Apache Software Foundation//DTD Struts Configuration 1.2//EN&quot;<br /> &quot;http://jakarta.apache.org/struts/dtds/struts-config_1_2.dtd&quot;&gt;<br /> &lt;struts-config&gt; <br />    &lt;action-mappings&gt; <br />        &lt;action <br />            path=&quot;/hello&quot; <br />            type=&quot;onlyfun.caterpillar.HelloAction&quot;&gt; <br />            &lt;forward<br />                name=&quot;helloUser&quot; <br />                path=&quot;/WEB-INF/pages/hello.jsp&quot;/&gt; <br />        &lt;/action&gt; <br />    &lt;/action-mappings&gt; <br />&lt;/struts-config&gt;</pre>
    在struts-config.xml中，定义了&lt;action-mappings&gt;，这当中关系到请求与资源的转发设定对应，&lt;
    action&gt;中设定了path为/hello，这表示请求的资源若是/hello.do，则会呼叫HelloAction
    来处理这个请求（type属性设定的），&lt;forward&gt;设定则是HelloAction处理完毕之后的转发对象，一个&lt;
    action&gt;中可以有多个
    &lt;forward&gt;，在Action对象中将根据&lt;forward&gt;上的name来查找并返回对应的ActionForward
    对象，ActionServlet会根据 <a href="5.html">Action</a> 传回的ActionForward来将请求转发至指定的对象。<br />
    <br />
    来看看HelloAction，在Struts中，一个Action对象必须继承org.apache.struts.action.Action，并覆写其execute()方法，看看HelloAction是如何撰写的：<br />
<h5>HelloAction.java</h5>
    <pre class="code">package onlyfun.caterpillar;<br /><br />import java.util.*;<br />import javax.servlet.http.*;<br />import org.apache.struts.action.*; <br /><br />public class HelloAction extends Action {<br />    public ActionForward execute(<br />                             ActionMapping mapping, <br />                             ActionForm form, <br />                             HttpServletRequest request, <br />                             HttpServletResponse response) <br />                                  throws Exception {<br /><br />        // get information from request object<br />        String username = request.getParameter(&quot;user&quot;);<br /><br />        // prepare model<br />        Map model = new HashMap();<br />        if(username != null)<br />            model.put(&quot;username&quot;, username);<br />        else<br />            model.put(&quot;username&quot;, &quot;nobody&quot;);<br /><br />        // pass information to View by using reqeust object<br />        request.setAttribute(&quot;userInfo&quot;, model);<br /><br />        return mapping.findForward(&quot;helloUser&quot;);<br />    }<br />}</pre>
    这边先关心一些execute()中传入的request与response，而暂不理会另两个参数，request与
    response是HttpServletRequest及HttpServletResponse的实例，就如何在一个简单的Servlet一样，您可
    以使用这两个对象来分别取得请求与响应的相关资源。<br />
    <br />
    Action对象是Controller的一部份，如您在程序中所看到的，在Action对象中，您所要作的是：<br />
    <ul>
<li>取得请求中的相关参数</li>
<li>验证数据的逻辑正确性</li>
<li>将请求参数复制给商务对象</li>
<li>取得执行结果并准备结果</li>
<li>转发给View物件</li>
    </ul>
    <br />
    第一个Struts程序很简单，所以暂且没有使用到商务对象，在真正的程序中，您会使用到业务对象（Model）来处理业务，而您的Action中之逻辑应该只包括请求信息的收集、转交业务请求给业务对象、准备View所需要的数据等有关。<br />
    <br />
    在View所需要的对象准备上，程序中使用了Map对象，在实际的程序中，您可以设计自己的数据Model对象。您可以看到，Struts会使用标准
    JSP/Servlet相关对象的setAttribute()与getAttribute()方法来向View传递Model，在程序中使用的是
    request物件的setAttribute()。<br />
    <br />
    在Web
    MVC中，使用者的请求相关信息就到Action中就要结束了，所有的相关讯息必须复制为数据传输对象再设定给业务对象，而不是直接将请求相关对象或讯息
    直接传递至业务层，这样作可以使得Web层不会与接下来的业务层紧密耦合。另一方面，View层的数据要透过数据Model对象来取得，而不是直接从使用
    者的请求物件中获得。<br />
    <br />
    在execute()方法中传入的ActionMapping对象，代表了struts-config.xml中&lt;action-
    mappings&gt;的设定对象，findForward()方法会寻找指定的forward资源name名称，如果找到，就传回一个
    ActionForward对象，当中包括了转发的目的对象，目的地即path属性设定的路径。<br />
    <br />
    回顾一下struts-config.xml，注意到&quot;helloUser&quot;的forward目的地是/WEB-
    INF/pages/hello.jsp，将资源放在/WEB-INF目录下，使用者就只能透过Controller的转发来取得资源，这是一个较具安全
    性的作法。<br />
    <br />
    hello.jsp如下：<br />
<h5>hello.jsp</h5>
    <pre class="code">&lt;html&gt; <br />&lt;head&gt; <br />&lt;title&gt;Hello, ${userInfo[&quot;username&quot;]} !&lt;/title&gt; <br />&lt;/head&gt; <br />&lt;body&gt;<br />    &lt;H1&gt;Hello, ${userInfo[&quot;username&quot;]} !&lt;/H1&gt;<br />&lt;/body&gt; <br />&lt;/html&gt;</pre>
    在这边先使用JSP 2.0所提供的Express Language新功能来取得设定于request中的Model对象之数据，Struts提供有一组可以与其配合的标签库（Tag Library），如果您的View层技术使用的是JSP资源，也可以善加利用。<br />
    <br />
    来检验一下第一个Struts的成果，启动您的Servlet Container，并在浏览器输入：<br />
    <pre class="code">http://localhost:8080/strutsapp/hello.do?user=Justin</pre>
    您将会得到以下的内容：<br />
    <pre class="code">&lt;html&gt; 
&lt;head&gt; 
&lt;title&gt;Hello, Justin !&lt;/title&gt; 
&lt;/head&gt; 
&lt;body&gt;
&nbsp;&nbsp;&nbsp; &lt;H1&gt;Hello, Justin !&lt;/H1&gt;&lt;/body&gt; 
&lt;/html&gt;</pre>
    <div class="rpindex"><a href="3.html"> 下一页</a><a href="1.html"> 上一页</a><a href="index.html">首页</a></div>
<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
