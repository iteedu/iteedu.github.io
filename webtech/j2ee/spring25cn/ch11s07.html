<!--hmt-->
<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end --><!--end of htmlheader-->

<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->
<!--end of htmlmiddle-->


<div class="section" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="jdbc-parameter-handling"></a>11.7.&#160;参数和数据处理的基本原则</h2></div></div></div>
<p>在Spring的JDBC框架的所有工作模式中贯彻了一些与参数和数据处理相关的基本原则。</p>
<div class="section" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="jdbc-type-information"></a>11.7.1.&#160;为参数设置SQL类型信息</h3></div></div></div>
<p>多数情况下，Spring会根据传入的参数值来设定相应的SQL类型。有时，我们有必要明确指定传入参数所代表的SQL类型，这一点对于正确设置NULL值的时候可能比较有用。</p>
<p>另外还有一些其他的不同方面的作用:</p>
<div class="itemizedlist"><ul type="disc"><li><p>多数<code class="classname">JdbcTemplate</code>的update或者query方法会接收一个额外的int数组构成的参数。
          这个数组需要提供的是使用<code class="classname">java.sql.Types</code>中所定义的SQL类型。而这个数组中定义的类型需要与每个传入的参数所对应。
          </p></li></ul></div>
<div class="itemizedlist"><ul type="disc"><li><p>你可以使用<code class="classname">SqlParameterValue</code>对参数进行额外的封装从而包装更多的参数信息。通过传入参数值和对应的SQL类型作为构造函数的参数，你可以创建这个类的一个实例。
          你也可以为numeric的值提供一些额外的精度要求。
          </p></li></ul></div>
<div class="itemizedlist"><ul type="disc"><li><p>对于那些使用命名参数的情况，你可以使用<code class="classname">SqlParameterSource</code>、<code class="classname">BeanPropertySqlParameterSource</code>或者<code class="classname">MapSqlParameterSource</code>类。
         他们都具备了为命名参数注册SQL类型的功能。
         </p></li></ul></div>
</div>
<div class="section" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="jdbc-lob"></a>11.7.2.&#160;处理BLOB 和 CLOB对象</h3></div></div></div>
<p>你可以在数据库中存储图像、二进制对象或者大文本等对象。这些较大的二进制对象被称之为BLOB类型，而对应的大文本对象被称之为CLOB对象。
			Spring允许你使用JdbcTemplate、更高层次封装的RDBMS对象和SimpleJdbc类对这些大对象进行操作。 所有的这些操作方式都实现了<code class="classname">LobHandler</code>接口来处理LOB类型的数据。
			<code class="classname">LobHandler</code>接口提供了访问<code class="classname">LobCreator</code>的方法，通过调用<code class="classname">getLobCreator</code>，你可以创建一个新的LOB类型的数据。
		</p>
<p><code class="classname">LobCreator/LobHandler</code>接口针对LOB类型的数据操作提供了下列支持：</p>
<p>
      </p>
<div class="itemizedlist"><ul type="disc"><li>
<p>BLOB</p>
<div class="itemizedlist"><ul type="circle">
<li>
<p>byte[] – getBlobAsBytes and setBlobAsBytes</p>
<p>byte[] – getBlobAsBytes 和 setBlobAsBytes</p>
</li>
<li>
<p>InputStream – getBlobAsBinaryStream and
                setBlobAsBinaryStream</p>
<p>InputStream – getBlobAsBinaryStream和setBlobAsBinaryStream</p>
</li>
</ul></div>
</li></ul></div>
<div class="itemizedlist"><ul type="disc"><li>
<p>CLOB</p>
<div class="itemizedlist"><ul type="circle">
<li>
<p>String – getClobAsString and setClobAsString</p>
<p>String – getClobAsString和setClobAsString</p>
</li>
<li>
<p>InputStream – getClobAsAsciiStream and
                setClobAsAsciiStream</p>
<p>InputStream – getClobAsAsciiStream和setClobAsAsciiStream</p>
</li>
<li>
<p>Reader – getClobAsCharacterStream and
                setClobAsCharacterStream</p>
<p>Reader – getClobAsCharacterStream和setClobAsCharacterStream</p>
</li>
</ul></div>
</li></ul></div>
<p>
        </p>
<p>现在我们通过一个示例来展示如何创建一个BLOB数据并插入数据库。稍后的例子，我们将展示如何从数据库中将BLOB数据读取出来。</p>
<p>这个例子使用JdbcTemplate和一个AbstractLobCreatingPreparedStatementCallback的实现类。
			这里唯一需要实现的方法就是"setValues"。在这个方法中，将提供一个LobCreator接口，被用作在你的插入语句中设置LOB字段的值。
		</p>
<p>我们假设有一个变量叫做“lobHandler”已经被设置到<code class="classname">DefaultLobHandler</code>的实例中。当然，这是由注入完成的。
		</p>
<div class="programlistingco">
<pre class="code">final File blobIn = new File("spring2004.jpg");
final InputStream blobIs = new FileInputStream(blobIn);
final File clobIn = new File("large.txt");
final InputStream clobIs = new FileInputStream(clobIn);
final InputStreamReader clobReader = new InputStreamReader(clobIs);
jdbcTemplate.execute(
  "INSERT INTO lob_table (id, a_clob, a_blob) VALUES (?, ?, ?)",
  new AbstractLobCreatingPreparedStatementCallback(lobhandler) {
      protected void setValues(PreparedStatement ps, LobCreator lobCreator) 
          throws SQLException {
        ps.setLong(1, 1L);
        lobCreator.setClobAsCharacterStream(ps, 2, clobReader, (int)clobIn.length());
        lobCreator.setBlobAsBinaryStream(ps, 3, blobIs, (int)blobIn.length());
      }
  }
);
blobIs.close();
clobReader.close();</pre>
<div class="calloutlist"><table border="0" summary="Callout list">
<tr>
<td width="5%" valign="top" align="left">&nbsp;</td>
<td valign="top" align="left"><p>我们在这里使用的lobHandler实现类是一个普通的<code class="classname">DefaultLobHandler</code></p></td>
</tr>
<tr>
<td width="5%" valign="top" align="left">&nbsp;</td>
<td valign="top" align="left"><p>使用<code class="classname">setClobAsCharacterStream</code>，我们传入CLOB的内容</p></td>
</tr>
<tr>
<td width="5%" valign="top" align="left">&nbsp;</td>
<td valign="top" align="left"><p>使用<code class="classname">setBlobAsBinartStream</code>，我们传入BLOB的内容</p></td>
</tr>
</table></div>
</div>
<p>现在我们来示范从数据库中读取LOB数据。我们这里再次使用JdbcTempate并使用相同的<code class="classname">DefaultLobHandler</code>实例。
		</p>
<div class="programlistingco">
<pre class="code">List l = jdbcTemplate.query("select id, a_clob, a_blob from lob_table",
    new RowMapper() {
      public Object mapRow(ResultSet rs, int i) throws SQLException {
        Map results = new HashMap();
        String clobText = lobHandler.getClobAsString(rs, "a_clob");
        results.put("CLOB", clobText);
        byte[] blobBytes = lobHandler.getBlobAsBytes(rs, "a_blob");
        results.put("BLOB", blobBytes);
        return results;
      }
    });
</pre>
<div class="calloutlist"><table border="0" summary="Callout list">
<tr>
<td width="5%" valign="top" align="left">&nbsp;</td>
<td valign="top" align="left"><p>使用<code class="classname">getClobAsString </code>获取CLOB内容</p></td>
</tr>
<tr>
<td width="5%" valign="top" align="left">&nbsp;</td>
<td valign="top" align="left"><p>使用<code class="classname">getBlobAsBytes</code>获取BLOB内容</p></td>
</tr>
</table></div>
</div>
</div>
<div class="section" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="jdbc-in-clause"></a>11.7.3.&#160;在IN语句中传入一组参数值</h3></div></div></div>
<p>SQL标准允许基于一个带参数列表的表达式进行查询。一个典型的例子可能像这样："select * from T_ACTOR where id in (1, 2, 3)"。
			不过这种参数列表的方式并不能直接被JDBC标准所支持 - 因为并不存在这种声明一个列表参数作为占位符的方式。
			你不得不为此写多个占位符来表示多个参数，或者当你知道占位符的数量时，你可以动态构建SQL字符串。
      <code class="classname">NamedParameterJdbcTemplate</code>和<code class="classname">SimpleJdbcTemplate</code>中所提供的命名参数的特性，采用的是后面一种做法。
      当你传入参数时，你需要传入一个<code class="classname">java.util.List</code>类型，支持基本类型。而这个list将会在SQL执行时替换占位符并传入参数。
      </p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">注意</h3>
<p>在使用IN语句时，当你传入大批量的值时要小心，JDBC标准并不确保超过100个元素在IN语句中。
        有不少数据库可以超出这个值的限制，但是不同的数据库会有不同的数量限制，比如Oracle的限制数量是1000个。
        </p>
</div>
<p>除了基本类型之外，你还可以创建一个<code class="classname">java.util.List</code>的对象数组，这可以让你支持在IN表达式中编写多重表达式，例如"select * from T_ACTOR where (id, last_name) in ((1,
      'Johnson'), (2, 'Harrop'))". 当然，这样做的前提是数据库底层的语法支持。
      </p>
</div>
<div class="section" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="jdbc-complex-types"></a>11.7.4.&#160;处理复杂类型的存储过程调用</h3></div></div></div>
<p>当调用存储过程时，有时需要使用数据库特定的复杂类型。为了适应这些类型，Spring提供了<code class="classname">SqlReturnType</code>类来处理存储过程的返回值，而使用<code class="classname">SqlTypeValue</code>来处理传入的参数。
		</p>
<p>下面这个例子，将Oracle的STRUCT对象作为返回值，这是一个由用户自定义的“ITEM_TYPE”。
		<code class="classname">SqlReturnType</code>接口有唯一的方法“<code class="classname">getTypeValue</code>”需要被实现。而这个接口的实现将被用作<code class="classname">SqlOutParameter</code>声明的一部分。
		</p>
<p>
      </p>
<pre class="code">declareParameter(new SqlOutParameter("item", OracleTypes.STRUCT, "ITEM_TYPE",
    new SqlReturnType() {
      public Object getTypeValue(CallableStatement cs, int colIndx, int sqlType, String typeName) 
          throws SQLException {
        STRUCT struct = (STRUCT)cs.getObject(colIndx);
        Object[] attr = struct.getAttributes();
        TestItem item = new TestItem();
        item.setId(((Number) attr[0]).longValue());
        item.setDescription((String)attr[1]);
        item.setExpirationDate((java.util.Date)attr[2]);
        return item;
      }
    }));</pre>
<p>
			通过Java代码调用存储过程使用<code class="classname">SqlTypeValue</code>来传入一个<code class="classname">TestItem</code>作为参数。
			<code class="classname">SqlTypeValue</code>接口有一个方法"<code class="classname">createTypeValue</code>"需要被实现。
			一个活动的数据库连接也同时被传入，它将被用作创建数据库特定的对象，类似<code class="classname">StructDescriptor</code>和<code class="classname">ArrayDescriptor</code> 
			</p>
<p>
      </p>
<pre class="code">SqlTypeValue value = new AbstractSqlTypeValue() {
  protected Object createTypeValue(Connection conn, int sqlType, String typeName) throws SQLException {
    StructDescriptor itemDescriptor = new StructDescriptor(typeName, conn);
    Struct item = new STRUCT(itemDescriptor, conn,
        new Object[] {
            testItem.getId(),
            testItem.getDescription(),
            new java.sql.Date(testItem.getExpirationDate().getTime())
        });
    return item;
  }
};</pre>
<p>
		这里的<code class="classname">SqlTypeValue</code> 现在可以被加入到作为参数的Map中去，从而可以执行相应的存储过程。
	</p>
</div>
</div>

<!--start of htmlend-->

<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->