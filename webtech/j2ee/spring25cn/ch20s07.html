<!--hmt-->
<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end --><!--end of htmlheader-->

<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->
<!--end of htmlmiddle-->


<div class="section" lang="zh-cn">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="jmx-notifications"></a>20.7.&#160;通知</h2></div></div></div>
<p>
    Spring提供的JMX对JMX通知包含了全面的支持。
    </p>
<div class="section" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="jmx-notifications-listeners"></a>20.7.1.&#160;为通知注册监听器</h3></div></div></div>
<p>
      Spring的JMX支持使得用任意数量MBean注册任意数量的 <code class="classname">NotificationListeners</code> 监听器（包括由Spring的 <code class="classname">MBeanExporter</code> 输出和其他机制注册的MBean）都非常容易。
	  通过例子，考虑当目标MBean发生了变化都想得到通知（通过 <code class="classname">Notification</code>）的场景。
	  </p>
<pre class="code">package com.example;

import javax.management.AttributeChangeNotification;
import javax.management.Notification;
import javax.management.NotificationFilter;
import javax.management.NotificationListener;

public class ConsoleLoggingNotificationListener
               implements NotificationListener, NotificationFilter {

    public void handleNotification(Notification notification, Object handback) {
        System.out.println(notification);
        System.out.println(handback);
    }

    public boolean isNotificationEnabled(Notification notification) {
        return AttributeChangeNotification.class.isAssignableFrom(notification.getClass());
    }
}</pre>
<pre class="code">&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="notificationListenerMappings"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1"&gt;
          &lt;bean class="com.example.ConsoleLoggingNotificationListener"/&gt;
        &lt;/entry&gt;
      &lt;/map&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre>
<p>
		上述配置就绪后，每当目标MBean（<code class="literal">bean:name=testBean1</code>）广播一个JMX <code class="classname">Notification</code> 时，
		通过 <code class="literal">notificationListenerMappings</code> 属性注册的 <code class="classname">ConsoleLoggingNotificationListener</code> 都能得到通知。
		<code class="classname">ConsoleLoggingNotificationListener</code> 就可以采取任何它认为合适的行为来响应 <code class="classname">Notification</code>。
		</p>
<p>
		你也可以直接使用Bean名作为输出的Bean和监听器直接的链接。
		</p>
<pre class="code">&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="notificationListenerMappings"&gt;
      &lt;map&gt;
        &lt;entry key="<span class="bold"><strong>testBean</strong></span>"&gt;
          &lt;bean class="com.example.ConsoleLoggingNotificationListener"/&gt;
        &lt;/entry&gt;
      &lt;/map&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="<span class="bold"><strong>testBean</strong></span>" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre>
<p>
		如果有人想为所有通过 <code class="classname">MBeanExporter</code> 输出的Bean注册单个 <code class="classname">NotificationListener</code>实例，可以使用通配符'*'（没有引号）作为 <code class="literal">notificationListenerMappings</code> 属性映射中一个实体的键值；如下：
		
		</p>
<pre class="code">&lt;property name="notificationListenerMappings"&gt;
  &lt;map&gt;
    &lt;entry key="*"&gt;
      &lt;bean class="com.example.ConsoleLoggingNotificationListener"/&gt;
    &lt;/entry&gt;
  &lt;/map&gt;
&lt;/property&gt;</pre>
<p>
      如果想做相反的事情（也就是，为一个MBean注册多个不同的监听器），那么他就要使用 <code class="literal">notificationListeners</code> 列表属性来替代（优先于 <code class="literal">notificationListenerMappings</code> 属性）。
      这时就要配置多个 <code class="classname">NotificationListenerBean</code> 实例，而不仅仅是一个了……
      一个 <code class="classname">NotificationListenerBean</code> 不但封装了一个或者多个 <code class="classname">NotificationListener</code> 和已注册到一个 <code class="interfacename">MBeanServer</code> 的 <code class="classname">ObjectName</code>，它也封装了许多其他属性，例如一个 <code class="classname">NotificationFilter</code> 和一个可以用于JMX高级通知场景的回传对象。
      </p>
<p>
      当使用多个 <code class="classname">NotificationListenerBean</code> 实例时，这个配置与前面展示的并没有太大的不同。
      </p>
<pre class="code">&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1" value-ref="testBean"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="notificationListeners"&gt;
        &lt;list&gt;
            &lt;bean class="org.springframework.jmx.export.NotificationListenerBean"&gt;
                &lt;constructor-arg&gt;
                    &lt;bean class="com.example.ConsoleLoggingNotificationListener"/&gt;
                &lt;/constructor-arg&gt;
                &lt;property name="mappedObjectNames"&gt;
                    &lt;list&gt;
                        &lt;value&gt;bean:name=testBean1&lt;/value&gt;
                    &lt;/list&gt;
                &lt;/property&gt;
            &lt;/bean&gt;
        &lt;/list&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre>
<p>
      上面例子等同与第一个通知示例。假设每次 <code class="classname">Notification</code> 发生时，我们想得到一个回传对象，
      且想通过提供一个 <code class="classname">NotificationFilter</code> 过滤出无关的 <code class="classname">Notifications</code>。
      至于什么是一个回传对象，<code class="classname">NotificationFilter</code> 到底又是什么的全面的探讨，请参考JMX规范（1.2）<code class="literal">'The JMX Notification Model'</code> 章节。
      </p>
<pre class="code">&lt;beans&gt;

  &lt;bean id="exporter" class="org.springframework.jmx.export.MBeanExporter"&gt;
    &lt;property name="beans"&gt;
      &lt;map&gt;
        &lt;entry key="bean:name=testBean1" value-ref="testBean1"/&gt;
        &lt;entry key="bean:name=testBean2" value-ref="testBean2"/&gt;
      &lt;/map&gt;
    &lt;/property&gt;
    &lt;property name="notificationListeners"&gt;
        &lt;list&gt;
            &lt;bean class="org.springframework.jmx.export.NotificationListenerBean"&gt;
                &lt;constructor-arg ref="customerNotificationListener"/&gt;
                &lt;property name="mappedObjectNames"&gt;
                    &lt;list&gt;
                        <em class="lineannotation"><span class="lineannotation">&lt;!-- handles notifications from two distinct MBeans --&gt;</span></em>
                        &lt;value&gt;bean:name=testBean1&lt;/value&gt;
                        &lt;value&gt;bean:name=testBean2&lt;/value&gt;
                    &lt;/list&gt;
                &lt;/property&gt;
                &lt;property name="handback"&gt;
                    &lt;bean class="java.lang.String"&gt;
                        &lt;constructor-arg value="This could be anything..."/&gt;
                    &lt;/bean&gt;
                &lt;/property&gt;
                &lt;property name="notificationFilter" ref="customerNotificationListener"/&gt;
            &lt;/bean&gt;
        &lt;/list&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
  
  <em class="lineannotation"><span class="lineannotation">
  &lt;!-- 实现了<code class="interfacename">NotificationListener</code> 和 <code class="interfacename">NotificationFilter</code>接口 --&gt;
  </span></em>
  &lt;bean id="customerNotificationListener" class="com.example.ConsoleLoggingNotificationListener"/&gt;

  &lt;bean id="testBean1" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="TEST"/&gt;
    &lt;property name="age" value="100"/&gt;
  &lt;/bean&gt;

  &lt;bean id="testBean2" class="org.springframework.jmx.JmxTestBean"&gt;
    &lt;property name="name" value="ANOTHER TEST"/&gt;
    &lt;property name="age" value="200"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre>
</div>
<div class="section" lang="zh-cn">
<div class="titlepage"><div><div><h3 class="title">
<a name="jmx-notifications-publishing"></a>20.7.2.&#160;发布通知</h3></div></div></div>
<p>
      Spring不但提供了注册接收通知的支持，也提供了对发布通知的支持。
      </p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">注意</h3>
<p>
        要注意的是，本章节仅仅与通过 <code class="classname">MBeanExporter</code> 暴露的，被Spring管理的Bean相关。
        任何现存的，用户定义的MBean应当使用标准JMX API来做通知发布。
        </p>
</div>
<p>
      Spring的JMX通知发布支持中的关键接口是 <code class="classname">NotificationPublisher</code>（定义于 <code class="literal">org.springframework.jmx.export.notification</code> 包中）。
      任意要通过 <code class="classname">MBeanExporter</code> 实例输出为MBean的Bean都可以实现
      <code class="classname">NotificationPublisherAware</code> 接口来获得对 <code class="classname">NotificationPublisher</code> 实例的访问。
      <code class="classname">NotificationPublisherAware</code> 仅仅提供通过一个简单的setter方法给实现了这个接口的Bean注入一个
      <code class="classname">NotificationPublisher</code> 实例，那些Bean就因此可以发布 <code class="classname">Notification</code> 了。
      </p>
<p>
      就如 <code class="classname">NotificationPublisher</code> 类的Javadoc描述的一样，通过 <code class="classname">NotificationPublisher</code> 机制发布事件的受控Bean是 <span class="emphasis"><em>不</em></span> 需要对任何通知的监听器或者其他诸如此类的监听器的状态管理负责的。Spring的JMX支持将处理与JMX架构相关的所有问题。
      作为一个应用程序开发者，他所需要做的只是实现 <code class="classname">NotificationPublisherAware</code> 接口，然后利用注入的 <code class="classname">NotificationPublisher</code> 实例发布事件。要注意，受控Bean注册到一个 <code class="interfacename">MBeanServer</code> 后，<code class="classname">NotificationPublisher</code> 才被设置。
      </p>
<p>
      使用 <code class="classname">NotificationPublisher</code> 实例的方法很直观，人们只要构建一个 <code class="classname">Notification</code> 实例（或者一个合适的 <code class="classname">Notification</code> 子类的实例），接着填充与将要发布的事件相关的数据到通知里，然后传入 <code class="classname">Notification</code>，调用<code class="classname">NotificationPublisher</code>实例的方法 <code class="methodname">sendNotification(Notification)</code> 就可以了。
      </p>
<p>
      让我们来看一个简单的例子，在这个场景里，输出 <code class="classname">JmxTestBean</code> 实例在每次 <code class="literal">add(int, int)</code> 操作调用时都会发布 <code class="classname">NotificationEvent</code>。
      </p>
<pre class="code">package org.springframework.jmx;
			
import org.springframework.jmx.export.notification.NotificationPublisherAware;
import org.springframework.jmx.export.notification.NotificationPublisher;
import javax.management.Notification;

public class JmxTestBean implements IJmxTestBean, NotificationPublisherAware {

    private String name;
    private int age;
    private boolean isSuperman;
    private NotificationPublisher publisher;

    <em class="lineannotation"><span class="lineannotation">// 清晰起见，忽略了其他getter和setter</span></em>

    public int add(int x, int y) {
        int answer = x + y;
        this.publisher.sendNotification(new Notification("add", this, 0));
        return answer;
    }

    public void dontExposeMe() {
        throw new RuntimeException();
    }
    
    public void setNotificationPublisher(NotificationPublisher notificationPublisher) {
        this.publisher = notificationPublisher;
    }
}</pre>
<p><code class="classname">NotificationPublisher</code> 接口和一套使之运作的机制是Spring JMX支持的优良特性之一。
	  它带来的代价确实是使你的类与Spring，JMX紧耦合了；与以往一样，我们的建议也是很实际的……如果你需要 <code class="classname">NotificationPublisher</code> 提供的功能，并且接受与Spring，JMX的紧耦合，那么就行动吧。
	  </p>
</div>
</div>

<!--start of htmlend-->

<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->