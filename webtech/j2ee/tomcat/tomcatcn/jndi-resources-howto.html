<!--hmt-->
<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end --><!--end of htmlheader-->

<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->
<!--end of htmlmiddle-->


<table border="0" width="100%" cellspacing="4"><!--HEADER SEPARATOR--><tr><!--LEFT SIDE NAVIGATION--><td width="20%" valign="top" nowrap="true"><p><strong>链接</strong></p><ul><li><a href="index.html" tppabs="http://tomcat.jaxwiki.org/index.html">文档首页</a></li></ul><p><strong>用户手册</strong></p><ul><li><a href="introduction.html" tppabs="http://tomcat.jaxwiki.org/introduction.html">1) 介绍</a></li><li><a href="setup.html" tppabs="http://tomcat.jaxwiki.org/setup.html">2) 安装</a></li><li><a href="appdev/index.html" tppabs="http://tomcat.jaxwiki.org/appdev/index.html">3) 第一个web应用</a></li><li><a href="deployer-howto.html" tppabs="http://tomcat.jaxwiki.org/deployer-howto.html">4) 部署</a></li><li><a href="manager-howto.html" tppabs="http://tomcat.jaxwiki.org/manager-howto.html">5) 管理</a></li><li><a href="realm-howto.html" tppabs="http://tomcat.jaxwiki.org/realm-howto.html">6) 权限管理 - 域(Realms)</a></li><li><a href="security-manager-howto.html" tppabs="http://tomcat.jaxwiki.org/security-manager-howto.html">7) 安全管理器</a></li><li><a href="jndi-resources-howto.html" tppabs="http://tomcat.jaxwiki.org/jndi-resources-howto.html">8) JNDI 资源</a></li><li><a href="jndi-datasource-examples-howto.html" tppabs="http://tomcat.jaxwiki.org/jndi-datasource-examples-howto.html">9) JDBC 数据源</a></li><li><a href="class-loader-howto.html" tppabs="http://tomcat.jaxwiki.org/class-loader-howto.html">10) 类加载</a></li><li><a href="jasper-howto.html" tppabs="http://tomcat.jaxwiki.org/jasper-howto.html">11) JSPs</a></li><li><a href="ssl-howto.html" tppabs="http://tomcat.jaxwiki.org/ssl-howto.html">12) SSL</a></li><li><a href="ssi-howto.html" tppabs="http://tomcat.jaxwiki.org/ssi-howto.html">13) SSI</a></li><li><a href="cgi-howto.html" tppabs="http://tomcat.jaxwiki.org/cgi-howto.html">14) CGI</a></li><li><a href="proxy-howto.html" tppabs="http://tomcat.jaxwiki.org/proxy-howto.html">15) 与代理器整合</a></li><li><a href="mbeans-descriptor-howto.html" tppabs="http://tomcat.jaxwiki.org/mbeans-descriptor-howto.html">16) MBean 描述</a></li><li><a href="default-servlet.html" tppabs="http://tomcat.jaxwiki.org/default-servlet.html">17) 默认 Servlet</a></li><li><a href="cluster-howto.html" tppabs="http://tomcat.jaxwiki.org/cluster-howto.html">18) 集群</a></li><li><a href="balancer-howto.html" tppabs="http://tomcat.jaxwiki.org/balancer-howto.html">19) 负载均衡</a></li><li><a href="connectors.html" tppabs="http://tomcat.jaxwiki.org/connectors.html">20) 连接器</a></li><li><a href="monitoring.html" tppabs="http://tomcat.jaxwiki.org/monitoring.html">21) 监控 与 管理</a></li><li><a href="logging.html" tppabs="http://tomcat.jaxwiki.org/logging.html">22) 日志</a></li><li><a href="apr.html" tppabs="http://tomcat.jaxwiki.org/apr.html">23) APR</a></li></ul><p><strong>参考</strong></p><ul><li><a href="config/index.html" tppabs="http://tomcat.jaxwiki.org/config/index.html">Apache Tomcat 配置</a></li></ul><p><strong>Apache Tomcat 开发</strong></p><ul><li><a href="building.html" tppabs="http://tomcat.jaxwiki.org/building.html">构建</a></li><li><a href="balancer-howto.html" tppabs="http://tomcat.jaxwiki.org/changelog.html">修订记录</a></li><li><a href="status.html" tppabs="http://tomcat.jaxwiki.org/status.html">状态</a></li><li><a href="developers.html" tppabs="http://tomcat.jaxwiki.org/developers.html">开发者</a></li><li><a href="catalina/funcspecs/index.html" tppabs="http://tomcat.jaxwiki.org/catalina/funcspecs/index.html">性能说明.</a></li><li><a href="catalina/docs/api/index.html" tppabs="http://tomcat.jaxwiki.org/catalina/docs/api/index.html">Apache Tomcat Javadocs</a></li><li><a href="jasper/docs/api/index.html" tppabs="http://tomcat.jaxwiki.org/jasper/docs/api/index.html">Apache Jasper Javadocs</a></li><li><a href="architecture/index.html" tppabs="http://tomcat.jaxwiki.org/architecture/index.html">体系架构</a></li></ul></td><!--RIGHT SIDE MAIN BODY--><td width="80%" valign="top" align="left"><table border="0" width="100%" cellspacing="4"><tr><td align="left" valign="top"><h1>Apache Tomcat 5.5 Servlet/JSP 容器</h1><h2>JNDI Resources HOW-TO</h2></td></tr></table><table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#525D76"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Introduction"><strong>Introduction</strong></a></font></td></tr><tr><td><blockquote>

<p>Tomcat 5以一个可与<a href="" tppabs="http://java.sun.com/j2ee">Java2企业版(J2EE)</a>应用服务器相容的方式，提供给每个在它里面运行的网络程序一个JNDI <strong>InitialContext</strong>执行实例。J2EE标准在<code>/WEB-INF/web.xml</code>文件里提供了一系列标准元素，可用来查询资源；被这些元素索引的资源还需要根据不同的应用服务器来配置。</p>

<p>对Tomcat 5来说，每个网络应用的<code>InitialContext</code>是在<code><strong>&lt;Context&gt;</strong></code>元素中被配置的，而<code><strong>&lt;Context&gt;</strong></code>元素最好在该网络应用的上下文XML文件(或<code>META-INF/context.xml</code>)中被指定，或者在$CATALINA_HOME/conf/server.xml文件中被指定。</p>

<p>Tomcat 5还为整个服务器所使用的全球性资源提供一个单独的命名空间(namespace)。这些资源配置在$CATALINA_HOME/conf/server.xml文件的<a href="config/globalresources.html" tppabs="http://tomcat.jaxwiki.org/config/globalresources.html">
<code><strong>&lt;GlobalNameingResources&gt;</strong></code></a>元素中。你可以通过<code><strong>&lt;ResourceLink&gt;</strong></code>元素把这些资源提供给各个网络程序。 </p>

<p>在这些元素内定义的资源可以被你的程序部署描述符( <code>/WEB-INF/web.xml</code> )里的下列这些元素引用：</p>
<ul>
<li><code><strong>&lt;env-entry&gt;</strong></code> - 环境变量输入，这个单个值参数(single-value parameter)可以用来配置网络程序如何运行。</li>
<li><code><strong>&lt;resource-ref&gt;</strong></code> - 资源引用名，它通常指向该资源的对象(object)工厂，如JDBC <code>数据源</code>, a JavaMail <code>Session</code>，或者作为自己编写(custom)的对象工厂配置在Tomcat 5里边。</li>
<li><code><strong>&lt;resource-env-ref&gt;</strong></code> - 资源环境索引，这是Servlet 2.4版本里新加入的资源引用(<code>resource-ref</code>)变量，对那些不要求用户认证的资源来说，这个变量比较容易配置。</li>
</ul>

<p><code>InitialContext</code>是在网络程序最初被部署到服务器上时配置的，并且所有的网络程序可以使用它(仅供只读访问)。所有配置的条目和资源都被放置在JNDI的<code>java:comp/env</code> 命名空间中。以下是以JDBC <code>DataSource</code>(数据源)为例来说明如何访问一个资源——它看起来象这样：</p>

<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>// Obtain our environment naming context 
Context initCtx = new InitialContext(); 
Context envCtx = (Context) initCtx.lookup("java:comp/env"); 

// Look up our data source 
DataSource ds = (DataSource) 
envCtx.lookup("jdbc/EmployeeDB"); 

// Allocate and use a connection from the pool 
Connection conn = ds.getConnection(); 
... use this connection to access the database ... 
conn.close();</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

<p>参看下面两个规范，了解更多关于编码JNDI APIs的信息，以及Java2 企业版(J2EE)服务器所支持的相关性能：</p>
<ul>


</ul>

</blockquote></td></tr></table><table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#525D76"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Configuring JNDI Resources"><strong>Configuring JNDI Resources</strong></a></font></td></tr><tr><td><blockquote>

<p>Each available JNDI Resource is configured based on inclusion of the
following elements in the <code><strong>&lt;Context&gt;</strong></code>
element:</p>

<ul>
<li><a href="config/context.html#Environment Entries" tppabs="http://tomcat.jaxwiki.org/config/context.html#Environment Entries">&lt;Environment&gt;</a> - 配置环境变量的名字和值,网络程序可通过JNDI 
<code>InitialContext</code> 来查询(相当于在网络程序部署描述符中包括一个<code>&lt;env-entry&gt;</code>元素)。</li>
<li><a href="config/context.html#Resource Definitions" tppabs="http://tomcat.jaxwiki.org/config/context.html#Resource Definitions">&lt;Resource&gt;</a> - 配置程序可以使用的资源名字和数据类型(相当于
在网络程序部署描述符中包括一个<code>&lt;resource-ref&gt;</code>元素)。</li>
<li><a href="config/context.html#Resource Links" tppabs="http://tomcat.jaxwiki.org/config/context.html#Resource Links">&lt;ResourceLink&gt;</a> - 为定义在全球性JNDI context内的资源加上一个链连。让网络程序可以使用这个链连访问定义在<a href="config/globalresources.html" tppabs="http://tomcat.jaxwiki.org/config/globalresources.html">&lt;GlobalNamingResources&gt;</a>里的资源，这个<a href="config/globalresources.html" tppabs="http://tomcat.jaxwiki.org/config/globalresources.html">&lt;GlobalNamingResources&gt;</a>是<a href="config/server.html" tppabs="http://tomcat.jaxwiki.org/config/server.html">&lt;Server&gt;</a>的子元素。</li>
<li><a href="config/context.html#Transaction" tppabs="http://tomcat.jaxwiki.org/config/context.html#Transaction">&lt;Transaction&gt;</a> -
    Add a resource factory for instantiating the UserTransaction object 
    instance that is available at <code>java:comp/UserTransaction</code>.</li>

</ul>

<p>任何数目的上述元素都可以套嵌在<a href="config/context.html" tppabs="http://tomcat.jaxwiki.org/config/context.html">&lt;Context&gt;</a>元素里（这些元素必须是和某个特定的网络应用程序相关的）。</p>

<p>另外，包含在程序部署描述符(<code>/WEB-INF/web.xml</code>)里的所有<code>&lt;env-entry&gt;</code>元素的
名字和值也都会加入到initial context中，只有<code>&lt;Environment&gt;</code>元素
允许(通过把<code>override</code>属性设置为"true")的情况下，<code>&lt;env-entry&gt;</code>元素中
的值才会覆盖<code>conf/server.xml</code> 中相应的值。</p>

<p>全球性资源可以定义在全服务器的JNDI context，把上面描述的资源元素加到<a href="config/server.html" tppabs="http://tomcat.jaxwiki.org/config/server.html">&lt;Server&gt;</a>的子元素<a href="config/globalresources.html" tppabs="http://tomcat.jaxwiki.org/config/globalresources.html">&lt;GlobalNamingResources&gt;</a>中，并且用<a href="config/context.html#Resource Links" tppabs="http://tomcat.jaxwiki.org/config/context.html#Resource Links">&lt;ResourceLink&gt;</a>把它包括在每个网络程序的(per-web-application)上下文中。</p>

</blockquote></td></tr></table><table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#525D76"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Tomcat Standard Resource Factories"><strong>Tomcat Standard Resource Factories</strong></a></font></td></tr><tr><td><blockquote>

  <p>Tomcat 5包含了一系列标准资源工厂来为你的网络程序服务，但又给你配置适度的弹性(在 $CATALINA_HOME/conf/server.xml 里)而不需要修改网络程序或部署描述符。下列章节详细描述了如何配置和使用这些标准资源工厂。 </p>

  <p>关于怎样产生，安装，配置和使用你自己编写的资源工厂类，参看Adding Custom Resource Factories。</p>

  <p><em>注意</em>——在标准资源工厂当中，只有"JDBC Data Source" 和 "User Transaction" 是必须让所有执行Java2企业版(J2EE)规范的平台使用。其他的标准资源工厂，以及你自己写的资源工厂只对Tomcat有效，而不能假设可让其他容器使用。</p>

  <table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#828DA6"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Generic JavaBean Resources"><strong>Generic JavaBean Resources</strong></a></font></td></tr><tr><td><blockquote>

    <h3>简介</h3>

    <p>这个资源工厂可以用来产生<em>任何</em>遵守标准JavaBeans命名习惯的Java类的对象(例如，它具有一个没有变量的构造式，具有遵守setFoo()命名模式的属性设置方法)。每次<code>lookup()</code>输入，这个资源工厂就会产生一个新的相称的bean class实例。</p>

    <p>使用这一设施的必需步骤如下：</p>

    <h3>产生你的JavaBean类</h3>

    <p>产生JavaBean类，让它每一次要查找资源工厂时就被实例化(instantiated)。在这个例子中，假设你产生一个叫做<code>com.mycompany.MyBean</code>的类，它看起来象这样：</p>

<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>package com.mycompany; 

public class MyBean { 

private String foo = "Default Foo"; 

public String getFoo() { 
return (this.foo); 
} 

public void setFoo(String foo) { 
this.foo = foo; 
} 

private int bar = 0; 

public int getBar() { 
return (this.bar); 
} 

public void setBar(int bar) { 
this.bar = bar; 
} 


}</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

  <h3>声明你的资源要求</h3>

  <p>下一步，修改你的网络程序部署描述符( <code>/WEB-INF/web.xml</code> ) 来声明JNDI名字，你将要求产生这个bean的新的实例在其名下。最简单的方法是象这样来使用<code>&lt;resource-env-ref&gt;</code>元素：</p>

<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>&amp;lt;resource-env-ref&amp;gt; 
&amp;lt;description&amp;gt; 
Object factory for MyBean instances. 
&amp;lt;/description&amp;gt; 
&amp;lt;resource-env-ref-name&amp;gt; 
bean/MyBeanFactory 
&amp;lt;/resource-env-ref-name&amp;gt; 
&amp;lt;resource-env-ref-type&amp;gt; 
com.mycompany.MyBean 
&amp;lt;/resource-env-ref-type&amp;gt; 
&amp;lt;/resource-env-ref&amp;gt;</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

    <p><strong>警告</strong>——一定要尊重元素的排列顺序，这是网络程序部署描述符DTD所要求的。详细信息请参看Servlet 规范 。</p>

  <h3>编写使用这个资源的程序</h3>

  <p>典型的使用这个资源环境索引的编码看起来象这样：</p>

<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>Context initCtx = new InitialContext(); 
Context envCtx = (Context) initCtx.lookup("java:comp/env"); 
MyBean bean = (MyBean) envCtx.lookup("bean/MyBeanFactory"); 

writer.println("foo = " + bean.getFoo() + ", bar = " + 
bean.getBar());</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

    <h3>配置Tomcat的资源工厂</h3>

    <p>要配置Tomcat的资源工厂，把象下面这样的一个元素添加到$CATALINA_HOME/conf/server.xml文件中，并把它套嵌在这个网络应用程序的<code>Context</code>元素里。</p>
<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>
&lt;Context ...&gt;
  ...
  &lt;Resource name="bean/MyBeanFactory" auth="Container"
            type="com.mycompany.MyBean"
            factory="org.apache.naming.factory.BeanFactory"
            bar="23"/&gt;
  ...
&lt;/Context&gt;
</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

    <p>注意资源名称(这里是<code>bean/MyBeanFactory</code>)必须与网络程序部署描述符里指定的值相对映。我们也还要初始化<code>bar</code> property的值，这会在返回新的bean之前引起调用<code>setBar(23)</code>。因为我们没有初始化<code>foo</code> property(尽管我们也可以这样做)，bean会包含它的构造器设置的任何默认值。</p>

  </blockquote></td></tr></table>


  <table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#828DA6"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="JavaMail Sessions"><strong>JavaMail Sessions</strong></a></font></td></tr><tr><td><blockquote>

    <h3>简介</h3>

    <p>在许多网络应用中，发送电子邮件是系统功能必须的一部分。<a href="" tppabs="http://java.sun.com/products/javamail">Java Mail</a> API 使得这一处理过程相对直截了当，但是客户的应用程序必须要了解许多配置的详细情况(包括用来发送消息的SMTP主机名字)。</p>

    <p>Tomcat 5包括一个产生<code>javax.mail.Session</code>实例的标准资源工厂，它已经与被<code>server.xml</code>配置过的SMTP服务器连接好了。通过这种办法，程序完全和电子邮件服务器配置环境中的变化分隔开了——在任何需要的时候，只要请求和接受一个预先配置过的session就行了。</p>

    <p>这个过程必需的步骤概括如下：</p>

    <h3>声明你的资源要求</h3>

    <p>你要做的第一件事就是修改网络程序部署描述符(<code>/WEB-INF/<code>web.xml</code></code>)来声明JNDI名称，你可在其名下查看预先配置过的sessions。根据习惯性，所有这样的名称都必须围绕着<code>邮件</code>的subcontext而派生(与标准的<code>java:comp/env</code> naming context 相关，这个naming context是所有的资源工厂的根)。  一个典型的web.xml看起来象这样：</p>
<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>&amp;lt;resource-ref&amp;gt; 
&amp;lt;description&amp;gt; 
Resource reference to a factory for javax.mail.Session 
instances that may be used for sending electronic mail 
messages, preconfigured to connect to the appropriate 
SMTP server. 
&amp;lt;/description&amp;gt; 
&amp;lt;res-ref-name&amp;gt; 
mail/Session 
&amp;lt;/res-ref-name&amp;gt; 
&amp;lt;res-type&amp;gt; 
javax.mail.Session 
&amp;lt;/res-type&amp;gt; 
&amp;lt;res-auth&amp;gt; 
Container 
&amp;lt;/res-auth&amp;gt; 
&amp;lt;/resource-ref&amp;gt;</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

    <p><strong>警告</strong>——一定要尊重元素的排列顺序，这是网络程序部署描述符DTD所要求的。详细信息请参看Servlet 规范 。</p>

    <h3>编写使用这个资源的程序</h3>

    <p>一个典型的使用这个资源索引的例子看起来象这样：</p>
<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>Context initCtx = new InitialContext(); 
Context envCtx = (Context) initCtx.lookup("java:comp/env"); 
Session session = (Session) envCtx.lookup("mail/Session"); 

Message message = new MimeMessage(session); 
message.setFrom(new InternetAddress(request.getParameter("from")); 
InternetAddress to[] = new InternetAddress[1]; 
to[0] = new InternetAddress(request.getParameter("to")); 
message.setRecipients(Message.RecipientType.TO, to); 
message.setSubject(request.getParameter("subject")); 
message.setContent(request.getParameter("content"), "text/plain"); 
Transport.send(message);</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

    <p>注意，这个程序使用的是与网络程序部署描述符里声明的资源索引相同的名字。这是与在$CATALINA_HOME/conf/server.xml 里配置的资源工厂相映射的，描述如下：</p>

    <h3>配置Tomcat的资源工厂</h3>

    <p>要配置Tomcat的资源工厂，把象下面这样的一个元素添加到$CATALINA_HOME/conf/server.xml文件中，并把它套嵌在这个网络应用程序的<code>Context</code>元素里。</p>
<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>
&lt;Context ...&gt;
  ...
  &lt;Resource name="mail/Session" auth="Container"
            type="javax.mail.Session"
            mail.smtp.host="localhost"/&gt;
  ...
&lt;/Context&gt;
</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

    <p>注意，资源的名字(这里是<code>mail/Session</code>)必须与网络程序部署描述符里指定的值相映射。客户化(自己指定)<code>mail.smtp.host</code>参数值，让它指向为你的网络(network)提供SMTP服务的服务器那里。</p>

    <h3>安装JavaMail libraries</h3>

    <p><a href="" tppabs="http://java.sun.com/products/javamail/downloads/index.html">
    Download the JavaMail API</a>.  The JavaMail API requires the Java Activation
    Framework (JAF) API as well.  The Java Activation Framework can be downloaded
    from <a href="" tppabs="http://java.sun.com/products/javabeans/glasgow/jaf.html">Sun's site</a>.
    </p>

    <p>This download includes 2 vital libraries for the configuration; 
    activation.jar and mail.jar. Unpackage both distributions and place 
    them into $CATALINA_HOME/common/lib so that they are available to
    Tomcat during the initialization of the mail Session Resource.
    <strong>Note:</strong> placing these jars in both common/lib and a 
    web application's lib folder will cause an error, so ensure you have
    them in the $CATALINA_HOME/common/lib location only.
    </p>

    <h3>应用程序示例(Example Application)</h3>

    <p>这个Tomcat包含的<code>/examples</code> 程序里有一个利用这一资源工厂的例子。你可通过"JSP Examples"链连来访问。实际上发送邮件的这个servlet的源代码是在<code>/WEB-INF/classes/SendMailServlet.java</code>里面。</p>

    <p><strong>警告</strong>——默认的配置假设在<code>局部主机</code>的端口25(port 25)有一个SMTP服务器的列单。如果不是这样，去编辑一下$CATALINA_HOME/conf/server.xml文件，把<code>mail.smtp.host</code>的参数值修改成你的网络SMTP服务器的主机名字。</p>

  </blockquote></td></tr></table>

  <table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#828DA6"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="JDBC Data Sources"><strong>JDBC Data Sources</strong></a></font></td></tr><tr><td><blockquote>

    <h3>简介</h3>

    <p>许多网络程序需要通过JDBC驱动来访问数据库，从而来支持这个程序必需的功能。J2EE Platform Specification 要求J2EE应用服务器让数据源实施(<em>DataSource</em> implementation) 成为可能(那就是，让数据源实施作为JDBC连接的连接池)。Tomcat 5提供完全一样的支持，这样你在Tomcat上开发的基于数据库的(database-based)程序，要使用这个服务，可以在任何J2EE服务器上运行而不需任何更改。</p>

    <p>关于JDBC的信息，你应该去参考下列链连：</p>
    <ul>
    
    
    
    
    </ul>

    <p><strong>注意</strong>——Tomcat里支持的默认数据源是基于<a href="" tppabs="http://jakarta.apache.org/commons">Jakarta Commons</a>分项目的<strong>DBCP</strong>连接池的。然而，也有可能通过使用其他实施<code>javax.sql.DataSource</code>的连接池来编写你自己的资源工厂，描述<a href="#Adding Custom Resource Factories">如下</a>：</p>

    <h3>安装你的JDBC驱动</h3>

    <p>要使用<em>JDBC Data Sources</em> JNDI 资源工厂，你必须让适当的JDBC驱动既能被Tomcat内部的类使用，又能被你的网络程序使用。最容易的办法是在$CATALINA_HOME/common/lib目录里边安装驱动的JAR文件，这样就让这个驱动既能被资源工厂使用，又能被你的程序使用。</p>

    <h3>声明你的资源要求</h3>

    <p>下一步，修改网络程序部署描述符(<code>/WEB-INF/<code>web.xml</code></code>)来声明JNDI名称。根据习惯性，所有这样的名称都必须围绕着<code>jdbc</code> subcontext 而派生(与标准的<code>java:comp/env</code> naming context 相关，这个naming context是所有的资源工厂的根)。 一个典型的web.xml看起来象这样：</p>
<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>&amp;lt;resource-ref&amp;gt; 
&amp;lt;description&amp;gt; 
Resource reference to a factory for java.sql.Connection 
instances that may be used for talking to a particular 
database that is configured in the server.xml file. 
&amp;lt;/description&amp;gt; 
&amp;lt;res-ref-name&amp;gt; 
jdbc/EmployeeDB 
&amp;lt;/res-ref-name&amp;gt; 
&amp;lt;res-type&amp;gt; 
javax.sql.DataSource 
&amp;lt;/res-type&amp;gt; 
&amp;lt;res-auth&amp;gt; 
Container 
&amp;lt;/res-auth&amp;gt; 
&amp;lt;/resource-ref&amp;gt;</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

    <p><strong>警告</strong>——一定要尊重元素的排列顺序，这是网络程序部署描述符DTD所要求的。详细信息请参看Servlet 规范 。</p>

    <h3>编写使用这个资源的程序</h3>

    <p>一个典型的使用这个资源索引的例子看起来象这样：</p>
<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>Context initCtx = new InitialContext(); 
Context envCtx = (Context) initCtx.lookup("java:comp/env"); 
DataSource ds = (DataSource) 
envCtx.lookup("jdbc/EmployeeDB"); 

Connection conn = ds.getConnection(); 
... use this connection to access the database ... 
conn.close();</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

    <p>注意，这个程序使用的是与网络程序部署描述符里声明的资源索引相同的名字。这是与在$CATALINA_HOME/conf/server.xml 里配置的资源工厂相映射的，描述如下：</p>

    <h3>配置Tomcat的资源工厂</h3>

    <p>要配置Tomcat的资源工厂，把象下面这样的一个元素添加到网络应用程序的<code>/META-INF/context.xml</code> 文件中。</p>
<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>
&lt;Context ...&gt;
  ...
  &lt;Resource name="jdbc/EmployeeDB" auth="Container"
            type="javax.sql.DataSource" username="dbusername" password="dbpassword"
            driverClassName="org.hsql.jdbcDriver" url="jdbc:HypersonicSQL:database"
            maxActive="8" maxIdle="4"/&gt;
  ...
&lt;/Context&gt;
</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

    <p>注意，这个资源的名字(这里是<code>jdbc/EmployeeDB</code> )必须与网络程序部署描述符里指定的值相映射。</p>

    <p>这个例子假设你使用HypersonicSQL数据库JDBC驱动。客户化(自己指定)<code>driverClassName</code> 和 <code>driverName</code>这两个参数，让它们与你实际使用的JDBC驱动和连接URL相映射。</p>

    <p>Tomcat标准数据资源工厂(<code>org.apache.tomcat.dbcp.dbcp.BasicDataSourceFactory</code>)的配置属性如下：</p>
    <ul>
    <li><strong>driverClassName</strong> - 被使用的JDBC驱动的完全合格的Java类名。</li>
    <li><strong>maxActive</strong> - 可以同时从这个pool被分配的最大active实例数目。</li>
    <li><strong>maxIdle</strong> - 可以同时在这个pool闲滞的最大连接数目。</li>
    <li><strong>maxWait</strong> - 这个pool在抛出异常之前可以等待连接返回的最长milliseconds 。</li>
    <li><strong>password</strong> - 将要传递给JDBC驱动的数据库密码。</li>
    <li><strong>url</strong> - 将要传递给JDBC驱动的连接URL(因为向后兼容性，属性的<code>driverName</code>也被认可)。</li>
    <li><strong>user</strong> - 将要传递给JDBC驱动的数据库用户名。</li>
    <li><strong>validationQuery</strong> - 在连接被返回到程序之前，可以被这个pool用来验证连接用的SQL query 。 如被指定，这个query必须是一个SQL SELECT 指令，它至少有一行的返回说明。</li>
    </ul>
    <p>更多详细信息，请参看commons-dbcp文档资料。</p>

  </blockquote></td></tr></table>

</blockquote></td></tr></table><table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#525D76"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Adding Custom Resource Factories"><strong>Adding Custom Resource Factories</strong></a></font></td></tr><tr><td><blockquote>

  <p>如果任何标准资源工厂都不能满足你的要求，你可以编写你自己的资源工厂，并把它整合到Tomcat 5里面，再在<code>conf/server.xml</code> configuration文件里配置怎样使用它。在下面的例子里，你将要产生一个资源工厂，这个工厂仅仅知道怎样产生上面所描述的<a href="#Generic JavaBean Resources">Generic JavaBean Resources</a>例子里的<code>com.mycompany.MyBean</code> beans 。</p>

  <h3>编写一个资源工厂类</h3>

  <p>你必须编写一个实施JNDI服务供给者
<code>javax.naming.spi.ObjectFactory</code> 界面的类。每次你的程序在这个工厂绑定的context entry上调用<code>lookup()</code> ，这个<code>getObjectInstance()</code>方法就会被叫到，有以下这些参数：</p>
  <ul>
  <li><strong>Object obj</strong> - 包含地址或索引信息的对象(很可能是空值)，它可用于制造一个对象(object)。对Tomcat来说，这总是一个<code>javax.naming.Reference</code>类型的对象，它包括这个工厂类的类名，以及用来产生返回对象的配置属性(来自<code>conf/server.xml</code>)。</li>
  <li><strong>Name name</strong> - 这个工厂绑定的与<code>nameCtx</code>有关联的名字,如果没有名字被指定,它就是<code>空值</code>。</li>
  <li><strong>Context <code>name</code>Ctx</strong> - 名称参数相对于这个context被指定，如果名称是相对于默认的初始context，它就是<code>空值</code>。</li>
  <li><strong>Hashtable environment</strong> - 用来产生这个对象的环境(很可能是空值)。这通常在Tomcat对象工厂被忽略。</li>
  </ul>

  <p>要制造一个知道怎样产生<code>MyBean</code>实例的资源工厂，你可能会产生一个象这样的类：</p>

<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>package com.mycompany;

import java.util.Enumeration;
import java.util.Hashtable;
import javax.naming.Context;
import javax.naming.Name;
import javax.naming.NamingException;
import javax.naming.RefAddr;
import javax.naming.Reference;
import javax.naming.spi.ObjectFactory;

public class MyBeanFactory implements ObjectFactory {

  public Object getObjectInstance(Object obj,
      Name name, Context nameCtx, Hashtable environment)
      throws NamingException {

      // Acquire an instance of our specified bean class
      MyBean bean = new MyBean();

      // Customize the bean properties from our attributes
      Reference ref = (Reference) obj;
      Enumeration addrs = ref.getAll();
      while (addrs.hasMoreElements()) {
          RefAddr addr = (RefAddr) addrs.nextElement();
          String name = addr.getType();
          String value = (String) addr.getContent();
          if (name.equals("foo")) {
              bean.setFoo(value);
          } else if (name.equals("bar")) {
              try {
                  bean.setBar(Integer.parseInt(value));
              } catch (NumberFormatException e) {
                  throw new NamingException("Invalid 'bar' value " + value);
              }
          }
      }

      // Return the customized instance
      return (bean);

  }

}</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

  <p>在这个例子里，我们无条件地产生一个新的<code>com.mycompany.MyBean</code>类的实例，并且在&amp;lt;ResourceParams&amp;gt;元素所包含的参数基础上populating它的属性，而这个&amp;lt;ResourceParams&amp;gt;元素是配置这个工厂用的(参见下面)。你应该注意，必须跳过所有名字叫工厂的参数——这个参数是用来指定工厂类自身的名字(在这里的情况下是<code>com.mycompany.MyBeanFactory</code>)，而不是用来指定要被配置的bean的属性。</p>

  <p>关于<code>ObjectFactory</code>的更多信息，请参看JNDI 1.2 Service 
Provider Interface (SPI) Specification 。 </p>

  <p>你需要对照一个包括所有$CATALINA_HOME/common/lib 和$CATALINA_HOME/server/lib目录里的JAR文件的class path来编译这个类。当你完成以后，把这个工厂类(以及相关的bean类)以未包装形式放在<code>$CATALINA_HOME/common/classes</code>下面，或者放在$CATALINA_HOME/common/lib里的一个JAR文件里。通过这种方式，所需要的类文件既可以被Catalina内部资源又可以被你的网络程序使用。</p>

  <h3>声明你的资源要求</h3>

  <p>下一步，修改你的网络程序部署描述符( <code>/WEB-INF/web.xml</code> ) 来声明JNDI名字，你将要求产生这个bean的新的实例在其名下。最简单的方法是象这样来使用<code>&lt;resource-env-ref&gt;</code>元素：</p>

<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>&amp;lt;resource-env-ref&amp;gt; 
&amp;lt;description&amp;gt; 
Object factory for MyBean instances. 
&amp;lt;/description&amp;gt; 
&amp;lt;resource-env-ref-name&amp;gt; 
bean/MyBeanFactory 
&amp;lt;/resource-env-ref-name&amp;gt; 
&amp;lt;resource-env-ref-type&amp;gt; 
com.mycompany.MyBean 
&amp;lt;/resource-env-ref-type&amp;gt; 
&amp;lt;/resource-env-ref&amp;gt;</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

    <p><strong>警告</strong>——一定要尊重元素的排列顺序，这是网络程序部署描述符DTD所要求的。详细信息请参看Servlet 规范 。</p>

  <h3>编写使用这个资源的程序</h3>

  <p>典型的使用这个资源环境索引的编码看起来象这样：</p>

<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>Context initCtx = new InitialContext(); 
Context envCtx = (Context) initCtx.lookup("java:comp/env"); 
MyBean bean = (MyBean) envCtx.lookup("bean/MyBeanFactory"); 

writer.println("foo = " + bean.getFoo() + ", bar = " + 
bean.getBar());</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

    <h3>配置Tomcat的资源工厂</h3>

    <p>要配置Tomcat的资源工厂，把象下面这样的一个元素添加到$CATALINA_HOME/conf/server.xml文件中，并把它套嵌在这个网络应用程序的<code>Context</code>元素里。</p>
<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>
&lt;Context ...&gt;
  ...
  &lt;Resource name="bean/MyBeanFactory" auth="Container"
            type="com.mycompany.MyBean"
            factory="com.mycompany.MyBeanFactory"
            bar="23"/&gt;
  ...
&lt;/Context&gt;
</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

    <p>注意资源名称(这里是<code>bean/MyBeanFactory</code>)必须与网络程序部署描述符里指定的值相对映。我们也还要初始化<code>bar</code> property的值，这会在返回新的bean之前引起调用<code>setBar(23)</code>。因为我们没有初始化<code>foo</code> property(尽管我们也可以这样做)，bean会包含它的构造器设置的任何默认值。</p>

    <p>你会注意到，从程序开发员的角度来看，对资源环境索引的声明，和用于请求新实例的编程，与<em>Generic JavaBean Resources</em>例子里使用的方法完全一样。这里举例说明了使用JNDI资源来封装功能(functionality)的一个优点——那就是，只要你保持相兼容的APIs，你可以改变下面的实施(underlying implementation)而不需要使用资源来修改程序。</p>

</blockquote></td></tr></table></td></tr><!--FOOTER SEPARATOR--><!--PAGE FOOTER--><tr><td colspan="2"><div align="center"><font color="#525D76" size="-1"><em>
        
        </em></font></div></td></tr></table>

<!--start of htmlend-->

<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->