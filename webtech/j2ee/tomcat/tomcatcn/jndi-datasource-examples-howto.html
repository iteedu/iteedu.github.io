<!--hmt-->
<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end --><!--end of htmlheader-->

<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->
<!--end of htmlmiddle-->


<table border="0" width="100%" cellspacing="4"><!--HEADER SEPARATOR--><tr><!--LEFT SIDE NAVIGATION--><td width="20%" valign="top" nowrap="true"><p><strong>链接</strong></p><ul><li><a href="index.html" tppabs="http://tomcat.jaxwiki.org/index.html">文档首页</a></li></ul><p><strong>用户手册</strong></p><ul><li><a href="introduction.html" tppabs="http://tomcat.jaxwiki.org/introduction.html">1) 介绍</a></li><li><a href="setup.html" tppabs="http://tomcat.jaxwiki.org/setup.html">2) 安装</a></li><li><a href="appdev/index.html" tppabs="http://tomcat.jaxwiki.org/appdev/index.html">3) 第一个web应用</a></li><li><a href="deployer-howto.html" tppabs="http://tomcat.jaxwiki.org/deployer-howto.html">4) 部署</a></li><li><a href="manager-howto.html" tppabs="http://tomcat.jaxwiki.org/manager-howto.html">5) 管理</a></li><li><a href="realm-howto.html" tppabs="http://tomcat.jaxwiki.org/realm-howto.html">6) 权限管理 - 域(Realms)</a></li><li><a href="security-manager-howto.html" tppabs="http://tomcat.jaxwiki.org/security-manager-howto.html">7) 安全管理器</a></li><li><a href="jndi-resources-howto.html" tppabs="http://tomcat.jaxwiki.org/jndi-resources-howto.html">8) JNDI 资源</a></li><li><a href="jndi-datasource-examples-howto.html" tppabs="http://tomcat.jaxwiki.org/jndi-datasource-examples-howto.html">9) JDBC 数据源</a></li><li><a href="class-loader-howto.html" tppabs="http://tomcat.jaxwiki.org/class-loader-howto.html">10) 类加载</a></li><li><a href="jasper-howto.html" tppabs="http://tomcat.jaxwiki.org/jasper-howto.html">11) JSPs</a></li><li><a href="ssl-howto.html" tppabs="http://tomcat.jaxwiki.org/ssl-howto.html">12) SSL</a></li><li><a href="ssi-howto.html" tppabs="http://tomcat.jaxwiki.org/ssi-howto.html">13) SSI</a></li><li><a href="cgi-howto.html" tppabs="http://tomcat.jaxwiki.org/cgi-howto.html">14) CGI</a></li><li><a href="proxy-howto.html" tppabs="http://tomcat.jaxwiki.org/proxy-howto.html">15) 与代理器整合</a></li><li><a href="mbeans-descriptor-howto.html" tppabs="http://tomcat.jaxwiki.org/mbeans-descriptor-howto.html">16) MBean 描述</a></li><li><a href="default-servlet.html" tppabs="http://tomcat.jaxwiki.org/default-servlet.html">17) 默认 Servlet</a></li><li><a href="cluster-howto.html" tppabs="http://tomcat.jaxwiki.org/cluster-howto.html">18) 集群</a></li><li><a href="balancer-howto.html" tppabs="http://tomcat.jaxwiki.org/balancer-howto.html">19) 负载均衡</a></li><li><a href="connectors.html" tppabs="http://tomcat.jaxwiki.org/connectors.html">20) 连接器</a></li><li><a href="monitoring.html" tppabs="http://tomcat.jaxwiki.org/monitoring.html">21) 监控 与 管理</a></li><li><a href="logging.html" tppabs="http://tomcat.jaxwiki.org/logging.html">22) 日志</a></li><li><a href="apr.html" tppabs="http://tomcat.jaxwiki.org/apr.html">23) APR</a></li></ul><p><strong>参考</strong></p><ul><li><a href="config/index.html" tppabs="http://tomcat.jaxwiki.org/config/index.html">Apache Tomcat 配置</a></li></ul><p><strong>Apache Tomcat 开发</strong></p><ul><li><a href="building.html" tppabs="http://tomcat.jaxwiki.org/building.html">构建</a></li><li><a href="balancer-howto.html" tppabs="http://tomcat.jaxwiki.org/changelog.html">修订记录</a></li><li><a href="status.html" tppabs="http://tomcat.jaxwiki.org/status.html">状态</a></li><li><a href="developers.html" tppabs="http://tomcat.jaxwiki.org/developers.html">开发者</a></li><li><a href="catalina/funcspecs/index.html" tppabs="http://tomcat.jaxwiki.org/catalina/funcspecs/index.html">性能说明.</a></li><li><a href="catalina/docs/api/index.html" tppabs="http://tomcat.jaxwiki.org/catalina/docs/api/index.html">Apache Tomcat Javadocs</a></li><li><a href="jasper/docs/api/index.html" tppabs="http://tomcat.jaxwiki.org/jasper/docs/api/index.html">Apache Jasper Javadocs</a></li><li><a href="architecture/index.html" tppabs="http://tomcat.jaxwiki.org/architecture/index.html">体系架构</a></li></ul></td><!--RIGHT SIDE MAIN BODY--><td width="80%" valign="top" align="left"><table border="0" width="100%" cellspacing="4"><tr><td align="left" valign="top"><h1>Apache Tomcat 5.5 Servlet/JSP 容器</h1><h2>JNDI Datasource HOW-TO</h2></td></tr></table><table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#525D76"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Table of Contents"><strong>Table of Contents</strong></a></font></td></tr><tr><td><blockquote>
<p><a href="#Introduction">简介</a><br><a href="#Database Connection Pool (DBCP) Configurations">数据库连接池(DBCP)配置</a><br><a href="class-loader-howto.html">非DBCP解决办法</a><br>
<a href="#Oracle 8i with OCI client">Oracle 8i with OCI client</a><br><a href="#Common Problems">常见问题</a><br>
</p>
</blockquote></td></tr></table><table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#525D76"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Introduction"><strong>Introduction</strong></a></font></td></tr><tr><td><blockquote>

<p>JNDI数据源配置在JNDI-Resources-HOWTO里面有详尽的说明，tomcat用户反馈回来的信息显示个别的特殊配置可能会很易出错。</p>

<p>这里为tomcat用户展示了一些通用数据库配置的例子，以及数据库使用的一些通常的提示。</p>

<p>因为这些注解是从tomcat用户反馈的配置信息派生而来，所以如果你有其他测试过的配置并且觉得能对更多其他用户会有用处，或者你觉得我们可以对这一部分有所改进，请让我们知道。</p>

<p>
<b>Please note that JNDI resource configuration has changed somewhat between
Tomcat 5.0.x and Tomcat 5.5.x.</b>  You will most likely need to modify your JNDI
resource configurations to match the syntax in the example below in order
to make them work in Tomcat 5.5.x.
</p>

<p>
Also, please note that JNDI DataSource configuration in general, and this 
tutorial in particular, assumes that you have read and understood the 
<a href="config/context.html" tppabs="http://tomcat.jaxwiki.org/config/context.html">Context</a> and 
<a href="config/host.html" tppabs="http://tomcat.jaxwiki.org/config/host.html">Host</a> configuration references, including
the section about Automatic Application Deployment in the latter reference.
</p>
</blockquote></td></tr></table><table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#525D76"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Database Connection Pool (DBCP) Configurations"><strong>Database Connection Pool (DBCP) Configurations</strong></a></font></td></tr><tr><td><blockquote>

<p>DBCP对JDBC 2.0提供支持。 使用1.4 JVM DBCP的系统会支持JDBC 3.0。如果你已经使用过1.4 JVM DBCP以及JDBC 3.0特性，请让我们知道。</p>

<p>See the <a href="" tppabs="http://jakarta.apache.org/commons/dbcp/configuration.html">
DBCP documentation</a> for a complete list of configuration parameters.
</p>

<table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#828DA6"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Installation"><strong>Installation</strong></a></font></td></tr><tr><td><blockquote>
<p>DBCP uses the Jakarta-Commons Database Connection Pool. It relies on
number of Jakarta-Commons components:
<ul>
<li>Jakarta-Commons DBCP 1.0</li>
<li>Jakarta-Commons Collections</li>
<li>Jakarta-Commons Pool</li>
</ul>
These libraries are located in a single JAR at 
<code>$CATALINA_HOME/common/lib/naming-factory-dbcp.jar</code>. However,
only the classes needed for connection pooling have been included, and the
packages have been renamed to avoid interfering with applications.
</p>

</blockquote></td></tr></table>

<table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#828DA6"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Preventing dB connection pool leaks"><strong>Preventing dB connection pool leaks</strong></a></font></td></tr><tr><td><blockquote>

<p>一个数据库连接池产生并管理一系列与数据库的连接。再回收和再利用现存的数据库连接比打开一个新的连接要有效率的多。</p>

<p>连接池也有一个问题。那就是网络程序必须专门关闭ResultSet's, Statement's, 和 Connection's 。 网络程序若没有关闭这些资源，会造成这些资源再也不能被重新使用，产生数据库连接池&ldquo;泄露&rdquo;的后果。如果没有别的连接可被使用，最终会造成你的网络程序数据库连接失败。</p>

<p>对于这个问题有一个解决办法。Jakarta-Commons DBCP可以被配置来追踪和修复这些被遗弃的数据库连接。它不仅可以修复它们，而且可以对那些打开这些资源但又从来没有关闭它们的代码展开一层层追踪。</p>

<p>
To configure a DBCP DataSource so that abandoned dB connections are
removed and recycled add the following attribute to the
<code>Resource</code> configuration for your DBCP DataSource:
<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>
            removeAbandoned="true"
</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>当可被利用的数据库连接降到很低，DBCP会修复并回收它能发现的被放弃的数据库连接。默认值是<code>false</code> 。</p>

<p>
Use the <code>removeAbandonedTimeout</code> attribute to set the number
of seconds a dB connection has been idle before it is considered abandoned.
<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>
            removeAbandonedTimeout="60"
</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>删除被放弃的连接的默认时间是300秒。</p>

<p>
The <code>logAbandoned</code> attribute can be set to <code>true</code>
if you want DBCP to log a stack trace of the code which abandoned the
dB connection resources.
<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>
            logAbandoned="true"
</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>默认值是<code>false</code> 。</p>

</blockquote></td></tr></table>

<table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#828DA6"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="MySQL DBCP Example"><strong>MySQL DBCP Example</strong></a></font></td></tr><tr><td><blockquote>

<h3>简介</h3>
<p>下面这些的<a href="" tppabs="http://www.mysql.com/products/mysql/index.html">MySQL</a>和JDBC驱动的版本可以运作：<ul>
<li>MySQL 3.23.47, MySQL 3.23.47 using InnoDB,, MySQL 3.23.58,  MySQL 4.0.1alpha</li>


</ul>
</p>

<p>在你开始之前，别忘记复制一份JDBC驱动的jar文件到$CATALINA_HOME/common/lib里面。</p>

<h3>MySQL 配置</h3>
<p>你一定要遵循这些指导说明，因为变动会产生问题。</p>

<p>产生一个新的测试用户，一个新的数据库和一个测试表格。你的MySQL用户<strong>必须</strong>要有个指派的密码。如果你试图用空密码连接，驱动会失败。<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>mysql&amp;gt; GRANT ALL PRIVILEGES ON *.* TO javauser@localhost 
-&amp;gt; IDENTIFIED BY 'javadude' WITH GRANT OPTION; 
mysql&amp;gt; create database javatest; 
mysql&amp;gt; use javatest; 
mysql&amp;gt; create table testdata ( 
-&amp;gt; id int not null auto_increment primary key, 
-&amp;gt; foo varchar(25), 
-&amp;gt; bar int);</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>
<blockquote><strong>注意</strong>：当测试完成以后，上面的用户应该被删除掉。</blockquote>
</p>

<p>下一步，在testdata表格中加入一些测试数据。<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>mysql&amp;gt; insert into testdata values(null, 'hello', 12345); 
Query OK, 1 row affected (0.00 sec) 

mysql&amp;gt; select * from testdata; 
+----+-------+-------+ 
| ID | FOO | BAR | 
+----+-------+-------+ 
| 1 | hello | 12345 | 
+----+-------+-------+ 
1 row in set (0.00 sec) 

mysql&amp;gt;</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>
</p>

<h3>server.xml 配置</h3>
<p>通过向$CATALINA_HOME/conf/server.xml里面加入一个声明来在Tomcat里配置JNDI DataSource。</p>
<p>Add this in between the <code>&lt;/Context&gt;</code> tag of the examples
context and the <code>&lt;/Host&gt;</code> tag closing the localhost definition.
If there is no such tag, you can add one as illustrated in the 
<a href="config/context.html" tppabs="http://tomcat.jaxwiki.org/config/context.html">Context</a> and
<a href="config/host.html" tppabs="http://tomcat.jaxwiki.org/config/host.html">Host</a> configuration references, and repeated below
for your convenience.

<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>
&lt;Context path="/DBTest" docBase="DBTest"
        debug="5" reloadable="true" crossContext="true"&gt;

    &lt;!-- maxActive: Maximum number of dB connections in pool. Make sure you
         configure your mysqld max_connections large enough to handle
         all of your db connections. Set to 0 for no limit.
         --&gt;

    &lt;!-- maxIdle: Maximum number of idle dB connections to retain in pool.
         Set to -1 for no limit.  See also the DBCP documentation on this
         and the minEvictableIdleTimeMillis configuration parameter.
         --&gt;

    &lt;!-- maxWait: Maximum time to wait for a dB connection to become available
         in ms, in this example 10 seconds. An Exception is thrown if
         this timeout is exceeded.  Set to -1 to wait indefinitely.
         --&gt;

    &lt;!-- username and password: MySQL dB username and password for dB connections  --&gt;

    &lt;!-- driverClassName: Class name for the old mm.mysql JDBC driver is
         org.gjt.mm.mysql.Driver - we recommend using Connector/J though.
         Class name for the official MySQL Connector/J driver is com.mysql.jdbc.Driver.
         --&gt;
    
    &lt;!-- url: The JDBC connection url for connecting to your MySQL dB.
         The autoReconnect=true argument to the url makes sure that the
         mm.mysql JDBC Driver will automatically reconnect if mysqld closed the
         connection.  mysqld by default closes idle connections after 8 hours.
         --&gt;

  &lt;Resource name="jdbc/TestDB" auth="Container" type="javax.sql.DataSource"
               maxActive="100" maxIdle="30" maxWait="10000"
               username="javauser" password="javadude" driverClassName="com.mysql.jdbc.Driver"
               url="jdbc:mysql://localhost:3306/javatest?autoReconnect=true"/&gt;

&lt;/Context&gt;
</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>
</p>

<h3>web.xml 配置</h3>

<p>现在为这个测试程序产生一个<code>WEB-INF/web.xml</code> 文件。<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>
&lt;web-app xmlns="http://java.sun.com/xml/ns/j2ee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee
http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"
    version="2.4"&gt;
  &lt;description&gt;MySQL Test App&lt;/description&gt;
  &lt;resource-ref&gt;
      &lt;description&gt;DB Connection&lt;/description&gt;
      &lt;res-ref-name&gt;jdbc/TestDB&lt;/res-ref-name&gt;
      &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
      &lt;res-auth&gt;Container&lt;/res-auth&gt;
  &lt;/resource-ref&gt;
&lt;/web-app&gt;
</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>
</p>

<h3>测试代码</h3>
<p>现在产生一个简单的<code>test.jsp</code>页面供以后使用。<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>&amp;lt;%@ taglib uri="http://java.sun.com/jsp/jstl/sql" prefix="sql" %&amp;gt; 
&amp;lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&amp;gt; 

&amp;lt;sql:query var="rs" dataSource="jdbc/TestDB"&amp;gt; 
select id, foo, bar from testdata 
&amp;lt;/sql:query&amp;gt; 

&amp;lt;html&amp;gt; 
&amp;lt;head&amp;gt; 
&amp;lt;title&amp;gt;DB Test&amp;lt;/title&amp;gt; 
&amp;lt;/head&amp;gt; 
&amp;lt;body&amp;gt; 

&amp;lt;h2&amp;gt;Results&amp;lt;/h2&amp;gt; 

&amp;lt;c:forEach var="row" items="${rs.rows}"&amp;gt; 
Foo ${row.foo}&amp;lt;br/&amp;gt; 
Bar ${row.bar}&amp;lt;br/&amp;gt; 
&amp;lt;/c:forEach&amp;gt; 

&amp;lt;/body&amp;gt; 
&amp;lt;/html&amp;gt;</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>
</p>

<p>JSP页面利用<a href="" tppabs="http://java.sun.com/products/jsp/jstl">JSTL</a> 's SQL 和 Core taglibs 。你可以从Sun's <a href="" tppabs="http://java.sun.com/webservices/downloads/webservicespack.html">Java Web Services Developer Pack</a> 得到它，或者从<a href="" tppabs="http://jakarta.apache.org/taglibs/doc/standard-doc/intro.html">Jakarta Taglib Standard 1.1</a> project 得到它——确保你拿到的是1.1.x发行版。当你有了JSTL以后，把<code>jstl.jar</code>和<code>standard.jar</code>复制到你的网络程序的<code>WEB-INF/lib</code>目录里。</p>

<p>最后把你的网络程序作为<code><code>DBTest</code>.war</code>的warfile形式，或以名叫DBTest的子目录形式部署到<code>$CATALINA_HOME/webapps</code> 里面。</p>
<p>当部署完成后，在一个浏览器里指向<code>http://localhost:8080/DBTest/test.jsp</code>就可以看到你辛勤劳动的成果了。</p>

</blockquote></td></tr></table>

<table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#828DA6"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Oracle 8i, 9i & 10g"><strong>Oracle 8i, 9i &amp; 10g</strong></a></font></td></tr><tr><td><blockquote>
<h3>简介</h3>

<p>Oracle requires minimal changes from the MySQL configuration except for the
usual gotchas :-)</p>
<p>Drivers for older Oracle versions may be distributed as *.zip files rather
than *.jar files. Tomcat will only use <code>*.jar</code> files installed in
<code>$CATALINA_HOME/common/lib</code>. Therefore <code>classes111.zip</code>
or <code>classes12.zip</code> will need to be renamed with a <code>.jar</code>
extension. Since jarfiles are zipfiles, there is no need to unzip and jar these
files - a simple rename will suffice.</p>

<p>Some early versions of Tomcat 4.0 when used with JDK 1.4 will not load
classes12.zip unless you unzip the file, remove the <code>javax.sql.*</code>
class heirarchy and rejar.</p>

<p>For Oracle 9i onwards you should use <code>oracle.jdbc.OracleDriver</code>
rather than <code>oracle.jdbc.driver.OracleDriver</code> as Oracle have stated
that <code>oracle.jdbc.driver.OracleDriver</code> is deprecated and support
for this driver class will be discontinued in the next major release.
</p>

<h3>server.xml 配置</h3>
<p>In a similar manner to the mysql config above, you will need to define your
Datasource in your server.xml file. Here we define a Datasource called myoracle
using the thin driver to connect as user scott, password tiger to the sid
called mysid. (Note: with the thin driver this sid is not the same as the
tnsname). The schema used will be the default schema for the user scott.</p>

<p>使用OCI驱动只需要在URL字串里简单地把thin改变成oci 。<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>
&lt;Resource name="jdbc/myoracle" auth="Container"
              type="javax.sql.DataSource" driverClassName="oracle.jdbc.OracleDriver"
              url="jdbc:oracle:thin:@127.0.0.1:1521:mysid"
              username="scott" password="tiger" maxActive="20" maxIdle="10"
              maxWait="-1"/&gt; 
</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>
</p>

<h3>web.xml 配置</h3>
<p>你应该确保在产生web.xml文件时，尊重DTD定义的元素排列顺序。</p>
<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>&amp;lt;resource-ref&amp;gt; 
&amp;lt;description&amp;gt;Oracle Datasource example&amp;lt;/description&amp;gt; 
&amp;lt;res-ref-name&amp;gt;jdbc/myoracle&amp;lt;/res-ref-name&amp;gt; 
&amp;lt;res-type&amp;gt;javax.sql.DataSource&amp;lt;/res-type&amp;gt; 
&amp;lt;res-auth&amp;gt;Container&amp;lt;/res-auth&amp;gt; 
&amp;lt;/resource-ref&amp;gt;</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>
<h3>代码示例</h3>
<p>你可以使用与上面相同的程序例子(假设你产生了必需的数据库实例，表格等)来代替Datasource代码，它可能象这样：</p>
<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>Context initContext = new InitialContext(); 
Context envContext = (Context)initContext.lookup("java:/comp/env"); 
DataSource ds = (DataSource)envContext.lookup("jdbc/myoracle"); 
Connection conn = ds.getConnection(); 
//etc.</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>
</blockquote></td></tr></table>


<table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#828DA6"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="PostgreSQL"><strong>PostgreSQL</strong></a></font></td></tr><tr><td><blockquote>
<h3>简介</h3>
<p>PostgreSQL is configured in a similar manner to Oracle.</p>

<h3>1. Required files </h3>
<p>
Copy the Postgres JDBC jar to $CATALINA_HOME/common/lib. As with Oracle, the
jars need to be in this directory in order for DBCP's Classloader to find
them. This has to be done regardless of which configuration step you take next.
</p>

<h3>2. Resource configuration</h3>

<p>
You have two choices here: define a datasource that is shared across all Tomcat
applications, or define a datasource specifically for one application.
</p>

<h4>2a. Shared resource configuration</h4>
<p>
Use this option if you wish to define a datasource that is shared across
multiple Tomcat applications, or if you just prefer defining your datasource
in this file.
</p>
<p><i>This author has not had success here, although others have reported so.
Clarification would be appreciated here.</i></p>

<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>
&lt;Resource name="jdbc/postgres" auth="Container"
          type="javax.sql.DataSource" driverClassName="org.postgresql.Driver"
          url="jdbc:postgresql://127.0.0.1:5432/mydb"
          username="myuser" password="mypasswd" maxActive="20" maxIdle="10" maxWait="-1"/&gt;
</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>
<h4>2b. Application-specific resource configuration</h4>

<p>
Use this option if you wish to define a datasource specific to your application,
not visible to other Tomcat applications. This method is less invasive to your
Tomcat installation.
</p>

<p>
Create a resource definition file for your application defining the
datasource. This file must have the same name as your application, so if
your application deploys as <code>someApp.war</code>, this filename must
be <code>someApp.xml</code>. This file should look something like the following.
</p>

<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>
&lt;Context path="/someApp" docBase="someApp"
   crossContext="true" reloadable="true" debug="1"&gt;

&lt;Resource name="jdbc/postgres" auth="Container"
          type="javax.sql.DataSource" driverClassName="org.postgresql.Driver"
          url="jdbc:postgresql://127.0.0.1:5432/mydb"
          username="myuser" password="mypasswd" maxActive="20" maxIdle="10"
maxWait="-1"/&gt;
&lt;/Context&gt;
</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

<h3>web.xml 配置</h3>
<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>&amp;lt;resource-ref&amp;gt; 
&amp;lt;description&amp;gt;postgreSQL Datasource example&amp;lt;/description&amp;gt; 
&amp;lt;res-ref-name&amp;gt;jdbc/postgres&amp;lt;/res-ref-name&amp;gt; 
&amp;lt;res-type&amp;gt;javax.sql.DataSource&amp;lt;/res-type&amp;gt; 
&amp;lt;res-auth&amp;gt;Container&amp;lt;/res-auth&amp;gt; 
&amp;lt;/resource-ref&amp;gt;</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

<h4>4. Accessing the datasource</h4>
<p>
When accessing the datasource programmatically, remember to prepend
<code>java:/comp/env</code> to your JNDI lookup, as in the following snippet of
code. Note also that "jdbc/postgres" can be replaced with any value you prefer, provided
you change it in the above resource definition file as well.
</p>

<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>
InitialContext cxt = new InitialContext();
if ( cxt == null ) {
   throw new Exception("Uh oh -- no context!");
}

DataSource ds = (DataSource) cxt.lookup( "java:/comp/env/jdbc/postgres" );

if ( ds == null ) {
   throw new Exception("Data source not found!");
}
</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>

</blockquote></td></tr></table>
</blockquote></td></tr></table><table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#525D76"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Non-DBCP Solutions"><strong>Non-DBCP Solutions</strong></a></font></td></tr><tr><td><blockquote>
<p>这些办法要么是利用单个数据库连接(建议仅作测试用，而不要作其它用处)，要么是其他pooling技术。</p>
</blockquote></td></tr></table><table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#525D76"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Oracle 8i with OCI client"><strong>Oracle 8i with OCI client</strong></a></font></td></tr><tr><td><blockquote>
<table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#828DA6"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Introduction"><strong>Introduction</strong></a></font></td></tr><tr><td><blockquote>
<p>虽然没有严格强调使用OCI client来产生JNDI DataSource，这里的这些注解可以和上面所讲的Oracle and DBCP方法合在一起。</p>
<p>为了使用OCI驱动，你必须要安装一个Oracle client。你应该从cd安装Oracle8i(8.1.7) client ，然后再从<a href="" tppabs="http://otn.oracle.com/">otn.oracle.com</a>下载相适宜的JDBC/OCI 
driver(Oracle8i 8.1.7.1 JDBC/OCI Driver)。</p>
<p>在把<code>classes12.zip</code>文件重新命名为<code>classes12.jar</code>以后，把它复制到Tomcat的$CATALINA_HOME/common/lib里面。根据你使用的Tomcat和JDK 版本，你还可能必须从这个文件删除<code>javax.sql.*</code> 类。</p>
</blockquote></td></tr></table>

<table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#828DA6"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Putting it all together"><strong>Putting it all together</strong></a></font></td></tr><tr><td><blockquote>
<p>确保在你的$PATH or <code>LD_LIBRARY_PATH</code> 
(possibly in $ORAHOME\bin ) 有<code>ocijdbc8.dll</code> or <code>.so</code> ，并且确定使用一个简单的测试程序<code>System.loadLibrary("ocijdbc8")</code>可以装载native library。</p>
<p>你下一步应该产生一个简单的测试servlet或jsp，要有下面这些<strong>关键行</strong>：</p>
<div align="left"><table cellspacing="4" cellpadding="0" border="0"><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#ffffff" height="1"><pre>DriverManager.registerDriver(new 
oracle.jdbc.driver.OracleDriver()); 
conn = 
DriverManager.getConnection("jdbc:oracle:oci8:@database","username","password");</pre></td><td bgcolor="#023264" width="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr><tr><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td><td bgcolor="#023264" width="1" height="1"><img src="images/void.gif" tppabs="http://tomcat.jaxwiki.org/images/void.gif" width="1" height="1" vspace="0" hspace="0" border="0"></td></tr></table></div>
<p>这里数据库是<code>host:port:SID</code>的形式。现在如果你想试图访问你测试的servlet/jsp 的URL，你得到的是一个<code>ServletException</code>，造成它的根本原因在于<code>java.lang.UnsatisfiedLinkError:get_env_handle</code> 。</p>
<p>首先，这个<code>UnsatisfiedLinkError</code>表明你有下列问题：<ul>
<li>JDBC类文件和Oracle client版本不相配。发给你的消息会说明是因为一个必须的library不能被找到。例如，你可能把Oracle Version 8.1.6里边的一个classes12.zip文件与与Version 8.1.5 Oracle client 一起使用。classeXXXs.zip文件与Oracle client软件的版本必须相配。</li>
<li>一个$PATH , <code>LD_LIBRARY_PATH</code> 问题。</li>
<li>据报道，忽略你从otn下载的驱动，使用$ORAHOME\jdbc\lib目录里的classes12.zip文件也行得通。</li>
</ul>
</p>
<p>下一步，你可能会遇到错误<code>ORA-06401 NETCMN: invalid driver designator</code></p>
<p>Oracle文件说明会说："Cause: The login (connect) string contains an invalid driver designator. Action: Correct the string and re-submit."  把数据库的连接字串( <code>host:port:SID</code> 的形式)改变成这个样：<code>(description=(address=(host=myhost)(protocol=tcp)(port=1521))(connect_data=(sid=orcl)))</code></p>
<p>
<i>Ed. Hmm, I don't think this is really needed if you sort out your TNSNames - but I'm not an Oracle DBA :-)</i>
</p>
</blockquote></td></tr></table>
</blockquote></td></tr></table><table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#525D76"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Common Problems"><strong>Common Problems</strong></a></font></td></tr><tr><td><blockquote>
<p>这里是一些网络程序中使用数据库常常遇到的问题，以及怎样解决它们的提示。</p>

<table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#828DA6"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Intermittent dB Connection Failures"><strong>Intermittent dB Connection Failures</strong></a></font></td></tr><tr><td><blockquote>
<p>Tomcat在一个JVM里运行。JVM定期地执行垃圾收集工作(GC)来删除不再被使用的对象。当JVM执行GC时，Tomcat暂停。如果配置的连接数据库的最长时间少于垃圾收集所花费的时间，你就可能得到一个数据库连接失败。</p>

<p>要收集关于垃圾收集所花费的时间，在启动Tomcat时，把<code>-verbose:gc</code>加入到你的<code>CATALINA_OPTS</code>环境变量中。当垃圾收集(gc)工作时，你的$CATALINA_BASE/logs/catalina.out日志文件会记录所有的关于垃圾收集的数据，包括垃圾收集需要多长时间。</p>

<p>当你的JVM调试正确率为99%时，垃圾收集工作花费的时间比一秒钟还少。收尾工作仅仅花几秒钟。垃圾收集很少用10秒钟以上的时间。</p>

<p>确保数据库连接时间设置为10-15秒。对于DBCP来说，用<code>maxWait</code>参数来设置。</p>

</blockquote></td></tr></table>

<table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#828DA6"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Random Connection Closed Exceptions"><strong>Random Connection Closed Exceptions</strong></a></font></td></tr><tr><td><blockquote>
<p>当一个请求从连接池得到一个数据库连接，然后关闭它两次，就会产生这些异常。当使用一个连接池时，关闭连接仅仅是把它返回到池中再被另外的请求使用，而不时把这个连接断掉。Tomcat使用多线程来处理同时发生的请求。这里的例子是关于事件(events)顺序怎样在Tomcat里造成这类错误：<pre>Request 1 running in Thread 1 gets a db connection. 

Request 1 closes the db connection. 

The JVM switches the running thread to Thread 2 

Request 2 running in Thread 2 gets a db connection 
(the same db connection just closed by Request 1). 

The JVM switches the running thread back to Thread 1 

Request 1 closes the db connection a second time in a finally block. 

The JVM switches the running thread back to Thread 2 

Request 2 Thread 2 tries to use the db connection but fails 
because Request 1 closed it.</pre>这里的例子是一个写得不错的关于使用从连接池获得的数据库连接的代码。<pre>Connection conn = null; 
Statement stmt = null; // Or PreparedStatement if needed 
ResultSet rs = null; 
try { 
conn = ... get connection from connection pool ... 
stmt = conn.createStatement("select ..."); 
rs = stmt.executeQuery(); 
... iterate through the result set ... 
rs.close(); 
rs = null; 
stmt.close(); 
stmt = null; 
conn.close(); // Return to connection pool 
conn = null; // Make sure we don't close it twice 
} catch (SQLException e) { 
... deal with errors ... 
} finally { 
// Always make sure result sets and statements are closed, 
// and the connection is returned to the pool 
if (rs != null) { 
try { rs.close(); } catch (SQLException e) { ; } 
rs = null; 
} 
if (stmt != null) { 
try { stmt.close(); } catch (SQLException e) { ; } 
stmt = null; 
} 
if (conn != null) { 
try { conn.close(); } catch (SQLException e) { ; } 
conn = null; 
} 
}</pre>
</p>

</blockquote></td></tr></table>

<table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#828DA6"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="Context versus GlobalNamingResources"><strong>Context versus GlobalNamingResources</strong></a></font></td></tr><tr><td><blockquote>
<p>请注意虽然在上面的说明中把JNDI声明放在一个Context元素里面，有可能，而且有时更需要把这些声明放在服务器配置文件的<a href="config/globalresources.html" tppabs="http://tomcat.jaxwiki.org/config/globalresources.html">GlobalNamingResources</a>区域。被放置在GlobalNamingResources区域的资源将会被服务器的Contexts共享。</p>
</blockquote></td></tr></table>

<table border="0" cellspacing="0" cellpadding="2" width="100%"><tr><td bgcolor="#828DA6"><font color="#ffffff" face="arial,helvetica.sanserif"><a name="JNDI Resource Naming and Realm Interaction"><strong>JNDI Resource Naming and Realm Interaction</strong></a></font></td></tr><tr><td><blockquote>
<p>为了让Realms能运作，这个realm必须按照&amp;lt;GlobalNamingResources&amp;gt; 或 &amp;lt;Context&amp;gt; 章节定义的那样指向数据源，而不是指向用&amp;lt;ResourceLink&amp;gt;重新命名的数据源。</p>
</blockquote></td></tr></table> 

</blockquote></td></tr></table></td></tr><!--FOOTER SEPARATOR--><!--PAGE FOOTER--><tr><td colspan="2"><div align="center"><font color="#525D76" size="-1"><em>
        
        </em></font></div></td></tr></table>

<!--start of htmlend-->

<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->