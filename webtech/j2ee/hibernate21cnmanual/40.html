<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->



<div class="lpindex"><a href="index.html">首页</a><a href="39.html"> 上一页</a><a href="41.html"> 下一页</a></div>
<h2>Chapter 13. 理解集合类的性能（Understanding Collection   Performance）</h2>
<p>我们已经在集合类(collections)上面花了很多口舌了。这一章，我们要着重关注集合类在运行时的一些问题。 </p>
<h2>13.1. 分类（Taxonomy）</h2>
<p>Hibernate定义了三种不同的基本集合类</p>
<ul type="disc">
  <li>
    <p>值集合</p>
  </li>
  <li>
    <p>一对多关联</p>
  </li>
  <li>
    <p>多对多关联</p>
  </li>
</ul>
<p>这个分类方法是根据不同的表和外键关系来区分的，但是没有确切的告诉我们关系模型。要完整的了解关系结构和性能的区别，我们必须考虑Hibernate再更新或者删除集合类记录时的主键结构。这样的话，我们会得到如下的分类： </p>
<ul type="disc">
  <li>
    <p>有序集合类</p>
  </li>
  <li>
    <p>集合（sets）</p>
  </li>
  <li>
    <p>包（bags）</p>
  </li>
</ul>
<p>所有的有序集合类（map,list,array)都有一个由&lt;key&gt;和&lt;index&gt;组合的主键字段。这种集合类的更新非常高效——主键有效地排了序，Hibernate要更新或者删除一个元素的时候可以很高效的找到它。 </p>
<p>集合(Sets)有一个由&lt;key&gt;和某个元素字段组成的主键。对于某些元素类型，特别是组合元素以及大本文、二进制字段，效率会来的比较低；数据库无法对复杂的主键有效索引。另一方面，对一对多关系或者多对多关系来说，特别是使用“人造”的标识符的时候，它的性能同样出色。（注：如果你希望SchemaExport为你创建一个&lt;set&gt;的主键，你必须把所有的字段都声明成non-null=&quot;true&quot;。） </p>
<p>包(Bags)是最差劲的。因为包允许元素值重复，也没有索引字段，所以无法定义主键。Hibernate没有办法来区分重复的行。Hibernate的处理方法是，每当更改的时候，完全删除（用一个DELETE),再重新创建这个集合类。这可能是效率极低的。 </p>
<p>请注意，对于一对多关联，&quot;主键&quot;可能不是数据库表的物理主键——当时就算考虑这种情况，上面分类描述仍然是正确的。(反映了Hibernate是如何在不同的集合类中“定位”某条记录的。) </p>
<h2><a name="13-2" id="13-2"></a>13.2. Lists, maps   和sets用于更新效率最高</h2>
<p>根据我们上面的讨论，显然有序类型和大多数set可以在增加/删除/修改元素的时候得到最好的性能。 </p>
<p>但是，在多对多关联，或者对值元素而言，有序集合类比集合(set)有一个好处。因为Set的结构，如果“改变”了一个元素,Hibernate并不会UPDATE这一行。对Set来说，只有INSERT和DELETE才有效。注意这一段描述对一对多关联并不适用。 </p>
<p>注意到数组无法延迟转载，我们可以得出结论，list, map和set是最高效的集合类型。（当然，我们警告过了，由于集合中的值的关系，set可能性能下降。） </p>
<p>Set可以被看作是Hibernate程序中最普遍的集合类型。 </p>
<p><em>这个版本的Hibernate有一个没有写在文档中的功能。&lt;idbag&gt;可以对值集合和多对多关联实现bag语义，并且性能比上面任何类型都高！</em> </p>
<h2><a name="13-3" id="13-3"></a>13.3. Bag和list是反向集合类中效率最高的</h2>
<p>好了，在你把bag扔到水沟里面再踩上一只脚之前，有一种情况下bag(包括list)要比set性能高得多。对于指明了inverse=&quot;true&quot;的集合类（比如说，标准的双向一对多关联），我们可以在不初始化(fetch)包元素的情况下就增加新元素！这是因为Collection.add()或者Collection.addAll()对bag或者List总是返回true的（与Set不同）。对于下面的代码来说，速度会快得多。 </p>
<pre class="code">Parent p = (Parent) sess.load(Parent.class, id);
Child c = new Child();
c.setParent(p);
p.getChildren().add(c);  //no need to fetch the collection!
sess.flush();</pre>
<h2><a name="13-4" id="13-4"></a>13.4. 一次性删除(One shot   delete)</h2>
<p>有时候，一个一个的删除集合类中的元素是极度低效的。Hibernate没那么笨，如果你想要把整个集合都删除（比如说调用list.clear()），Hibernate只需要一个DELETE就搞定了。 </p>
<p>假设我们在一个长度为20的集合类中新增加了一个元素，然后删除了两个。Hibernate会安排一个INSERT语句和两条DELETE语句（除非集合类是一个bag)。这当然是可以想见的。 </p>
<p>但是，如果假设我们删除了18个元素，只剩下2个，然后新增3个。有两种处理方式： </p>
<ul type="disc">
  <li>
    <p>把这18个元素一个一个的干掉，再新增三个</p>
  </li>
  <li>
    <p>把整个集合类都咔嚓掉（只用一句DELETE语句），然后增加5个元素。 </p>
  </li>
</ul>
<p>Hibernate还没那么聪明，知道第二种选择可能会比较快。（也许让Hibernate不要这么聪明也是好事，否则可能会引发意外的数据库触发器什么的。） </p>
<p>幸运的是，你可以强制使用第二种策略。你需要把原来的整个集合类都取消（取消其引用），然后返回一个新实例化的集合类，只包含需要的元素。有些时候这是非常有用的。 </p>
<div class="rpindex"><a href="41.html"> 下一页</a><a href="39.html"> 上一页</a><a href="index.html">首页</a></div>


<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
