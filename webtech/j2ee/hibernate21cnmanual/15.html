<!-- header-start -->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="/include/js/jquery.min.js" language="javascript"></script>
<script src="/include/js/jquery-ui.min.js" language="javascript"></script>
<link href="/include/css/jquery-ui.min.css" rel="stylesheet" type="text/css" />
<link href="/include/css/main.css" rel="stylesheet" type="text/css" />

<SCRIPT>
	$(document).ready(function() {
		$( "#menu" ).menu({ position: { my: "left top", at: "right-100 top+35" } });
	});
</SCRIPT>

<!-- header-end -->
<!-- middle-start -->
﻿
<base target="_blank" />
</head>
<body>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- topmenu-start -->
<header>
    <section id="global-nav">
        <nav>
            <ul class="projects">
                    <li><a href="/">ITeedu.com</a></li>
            </ul>
            <ul class="links">
                    <li><a>快捷导航</a>
                        <ul>
                            <li><a href="/plang/">编程语言</a></li>
                            <li><a href="/webtech/">WEB开发</a></li>
                            <li><a href="/handset/">手机开发</a></li>
                            <li><a href="/database/">数据库</a></li>
                            <li><a href="/os/">操作系统</a></li>
                            <li><a href="/embed/">嵌入式</a></li>
                            <li><a href="/opensource/">开源软件</a></li>
                            <li><a href="/works/">作品</a></li>

                        </ul>
                    </li>
                    <li><a href="/plang/asm/">编辑语言</a>
                        <ul>
                                <li><a href="/plang/asm/">汇编</a></li>
                                <li><a href="/plang/ccpp/">C/C++</a> </li>
                                <li><a href="/plang/java/">JAVA</a> </li>
                                <li><a href="/plang/python/">Python</a> </li>
                                <li><a href="/plang/ruby/">Ruby</a></li>
                        </ul>
                    </li>
                    <li><a href="/webtech/">WEB开发</a>
                        <ul>
                            <li><a href="/webtech/javascript/">javascript</a> </li>
                            <li><a href="/webtech/j2ee/">J2EE</a> </li>
                            <li><a href="/webtech/php/">PHP</a> </li>
                            <li><a href="/webtech/python/djangocn2/">Django</a> </li>
                        </ul>
                    </li>
					<li><a href="/me/contactme.htm">关于</a></li>
            </ul>
        </nav>
    </section>
</header>
<!-- topmenu-end -->

<div id="container" style="margin: 35px 120px 0px 120px;">
	<div id="logo-wapper">
		<div style="float:left;width:150px;" ><h1 class="logo">ITEEDU</h1></div>
		<div style="float:right;width:760px">

		</div>
		<div style="clear:both;"></div>
	</div>
<nav id="main-nav">
<!-- menunav-start -->
<div id="menu">
    <li><a href="/plang/">编程语言</a>
        <ul>
            <LI><a href="/plang/asm/">汇编</a></LI>
            <LI><a href="/plang/ccpp/">C/C++</a> </LI>
            <LI><a href="/plang/java/">JAVA</a> </LI>
            <LI><a href="/plang/python/">Python</a> </LI>
            <LI><a href="/plang/ruby/">Ruby</a></LI>
        </ul>
    </li>
    <li><a href="/webtech/index.php">WEB开发</a>
        <ul>
            <LI><a href="/webtech/j2ee/">J2EE</a></LI>
            <LI><a href="/webtech/php/">PHP</a> </LI>
            <LI><a href="/webtech/python/djangocn2/">djangocn2</a> </LI>
        </ul>
    </li>
    <li><a href="/handset/index.php">手机开发</a>
        <ul>
            <LI><a href="/handset/android/">android</a></LI>
            <LI><a href="/handset/iphone/">iphone</a> </LI>
        </ul>
    </li>
    <li><a href="/database/index.php">数据库</a>
        <ul>
            <LI><a href="/database/mysql/">MYSQL</a></LI>
            <LI><a href="/database/sqlite/">sqlite</a></LI>
    	</ul>
    </li>
    <li><a href="/os/">操作系统</a>
        <ul>
        	<LI><a href="/os/linux/">Linux</a></LI>
        	<LI><a href="/os/grub/">GRUB</a></LI>
    	</ul>
     </li>
     <li><a href="/embed/">嵌入式</a></li>
     <li><a href="/opensource/">开源软件</a></li>
</div>
<!-- menunav-end -->
</nav>
<div id="content-wrapper">
<div id="file-wrapper">


<!-- middle-end -->



<div class="lpindex"><a href="index.html">首页</a><a href="14.html"> 上一页</a><a href="16.html"> 下一页</a></div>
<h2>Chapter 5. O/R Mapping基础</h2>
<h2>5.1. 映射声明(Mapping   declaration)</h2>
<p>对象和关系数据库之间的映射是用一个XML文档(XML   document)来定义的。这个映射文档被设计为易读的，并且可以手工修改。映射语言是以Java为中心的，意味着映射是按照持久化类的定义来创建的，而非表的定义。 </p>
<p>请注意，虽然很多Hibernate用户选择手工定义XML映射文档，也有一些工具来生成映射文档，包括XDoclet,Middlegen和AndroMDA. </p>
<p>让我们从一个映射的例子开始： </p>
<pre class="code">&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE hibernate-mapping PUBLIC
        &quot;-//Hibernate/Hibernate Mapping DTD 2.0//EN&quot;
        &quot;http://hibernate.sourceforge.net/hibernate-mapping-2.0.dtd&quot;&gt;

&lt;hibernate-mapping package=&quot;eg&quot;&gt;

        &lt;class name=&quot;Cat&quot; table=&quot;CATS&quot; discriminator-value=&quot;C&quot;&gt;
                &lt;id name=&quot;id&quot; column=&quot;uid&quot; type=&quot;long&quot;&gt;
                        &lt;generator class=&quot;hilo&quot;/&gt;
                &lt;/id&gt;
                &lt;discriminator column=&quot;subclass&quot; type=&quot;character&quot;/&gt;
                &lt;property name=&quot;birthdate&quot; type=&quot;date&quot;/&gt;
                &lt;property name=&quot;color&quot; not-null=&quot;true&quot;/&gt;
                &lt;property name=&quot;sex&quot; not-null=&quot;true&quot; update=&quot;false&quot;/&gt;
                &lt;property name=&quot;weight&quot;/&gt;
                &lt;many-to-one name=&quot;mate&quot; column=&quot;mate_id&quot;/&gt;
                &lt;set name=&quot;kittens&quot;&gt;
                        &lt;key column=&quot;mother_id&quot;/&gt;
                        &lt;one-to-many class=&quot;Cat&quot;/&gt;
                &lt;/set&gt;
                &lt;subclass name=&quot;DomesticCat&quot; discriminator-value=&quot;D&quot;&gt;
                        &lt;property name=&quot;name&quot; type=&quot;string&quot;/&gt;
                &lt;/subclass&gt;
        &lt;/class&gt;

        &lt;class name=&quot;Dog&quot;&gt;
                &lt;!-- mapping for Dog could go here --&gt;
        &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre>
<p>我们现在开始讨论映射文档的内容。我们只描述Hibernate在运行时用到的文档元素和属性。映射文档还包括一些额外的可选属性和元素，它们在使用schema导出工具的时候会影响导出的数据库schema结果。（比如， not-null 属性。） </p>
<h3><a name="5-1-1" id="5-1-1"></a>5.1.1. Doctype</h3>
<p>所有的XML映射都需要定义如上所示的doctype。DTD可以从上述URL中获取，或者在hibernate-x.x.x/src/net/sf/hibernate目录中，或hibernate.jar文件中找到。Hibernate总是会在它的classptah中首先搜索DTD文件。 </p>
<h3><a name="5-1-2" id="5-1-2"></a>5.1.2. hibernate-mapping</h3>
<p>这个元素包括三个可选的属性。schema属性，指明了这个映射所引用的表所在的schema名称。假若指定了这个属性，表名会加上所指定的schema的名字扩展为全限定名。假若没有指定，表名就不会使用全限定名。default-cascade指定了未明确注明cascade属性的Java属性和集合类Java会采取什么样的默认级联风格。auto-import属性默认让我们在查询语言中可以使用非全限定名的类名。 </p>
<pre class="code">&lt;hibernate-mapping
         schema=&quot;schemaName&quot;                          <span class="co"><img src="images/callouts/1.png" alt="(1)" /></span>
         default-cascade=&quot;none|save-update&quot;           <span class="co"><img src="images/callouts/2.png" alt="(2)" /></span>
         auto-import=&quot;true|false&quot;                     <span class="co"><img src="images/callouts/3.png" alt="(3)" /></span>
         package=&quot;package.name&quot;                       <span class="co"><img src="images/callouts/4.png" alt="(4)" /></span>
 /&gt;</pre>
<table summary="Callout list" border="0">
  <tbody>
    <tr>
      <td valign="top" align="left" width="5%"><img alt="1" src="images/callouts/1.png" border="0" /></td>
      <td valign="top" align="left"><p>schema (可选): 数据库schema名称。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%"><img alt="2" src="images/callouts/2.png" border="0" /></td>
      <td valign="top" align="left"><p>default-cascade (可选 - 默认为 none): 默认的级联风格。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%"><img alt="3" src="images/callouts/3.png" border="0" /></td>
      <td valign="top" align="left"><p>auto-import (可选 - 默认为 true):   指定是否我们可以在查询语言中使用非全限定的类名（仅限于本映射文件中的类）。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%"><img alt="4" src="images/callouts/4.png" border="0" /></td>
      <td valign="top" align="left"><p>package (可选): 指定一个包前缀，如果在映射文档中没有指定全限定名，就使用这个包名。 </p></td>
    </tr>
  </tbody>
</table>
<p>假若你有两个持久化类，它们的非全限定名是一样的（就是在不同的包里面--译者注），你应该设置auto-import=&quot;false&quot;。假若说你把一个“import过”的名字同时对应两个类，   Hibernate会抛出一个异常。 </p>
<h3><a name="5-1-3" id="5-1-3"></a>5.1.3. class</h3>
<p>你可以使用class元素来定义一个持久化类： </p>
<pre class="code">&lt;class
        name=&quot;ClassName&quot;                              <span class="co"><img src="images/callouts/1.png" alt="(1)" /></span>
        table=&quot;tableName&quot;                             <span class="co"><img src="images/callouts/2.png" alt="(2)" /></span>
        discriminator-value=&quot;discriminator_value&quot;     <span class="co"><img src="images/callouts/3.png" alt="(3)" /></span>
        mutable=&quot;true|false&quot;                          <span class="co"><img src="images/callouts/4.png" alt="(4)" /></span>
        schema=&quot;owner&quot;                                <span class="co"><img src="images/callouts/5.png" alt="(5)" /></span>
        proxy=&quot;ProxyInterface&quot;                        <span class="co"><img src="images/callouts/6.png" alt="(6)" /></span>
        dynamic-update=&quot;true|false&quot;                   <span class="co"><img src="images/callouts/7.png" alt="(7)" /></span>
        dynamic-insert=&quot;true|false&quot;                   <span class="co"><img src="images/callouts/8.png" alt="(8)" /></span>
        select-before-update=&quot;true|false&quot;             <span class="co"><img src="images/callouts/9.png" alt="(9)" /></span>
        polymorphism=&quot;implicit|explicit&quot;              <span class="co"><img src="images/callouts/10.png" alt="(10)" /></span>
        where=&quot;arbitrary sql where condition&quot;         <span class="co">(11)</span>
        persister=&quot;PersisterClass&quot;                    <span class="co">(12)</span>
        batch-size=&quot;N&quot;                                <span class="co">(13)</span>
        optimistic-lock=&quot;none|version|dirty|all&quot;      <span class="co">(14)</span>
        lazy=&quot;true|false&quot;                             <span class="co">(15)</span>
/&gt;</pre>
<table summary="Callout list" border="0">
  <tbody>
    <tr>
      <td valign="top" align="left" width="5%"><img alt="1" src="images/callouts/1.png" border="0" /></td>
      <td valign="top" align="left"><p>name: 持久化类（或者接口）的Java全限定名。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%"><img alt="2" src="images/callouts/2.png" border="0" /></td>
      <td valign="top" align="left"><p>table: 对应的数据库表名。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%"><img alt="3" src="images/callouts/3.png" border="0" /></td>
      <td valign="top" align="left"><p>discriminator-value（辨别值） （可选 -   默认和类名一样）：一个用于区分不同的子类的值，在多态行为时使用。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%"><img alt="4" src="images/callouts/4.png" border="0" /></td>
      <td valign="top" align="left"><p>mutable（可变） (可选, 默认值为 true):   表明该类的实例可变（不可变）。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%"><img alt="5" src="images/callouts/5.png" border="0" /></td>
      <td valign="top" align="left"><p>schema (可选): 覆盖在根&lt;hibernate-mapping&gt;元素中指定的schema名字。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%"><img alt="6" src="images/callouts/6.png" border="0" /></td>
      <td valign="top" align="left"><p>proxy (可选): 指定一个接口，在延迟装载时作为代理使用。你可以在这里使用该类自己的名字。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%"><img alt="7" src="images/callouts/7.png" border="0" /></td>
      <td valign="top" align="left"><p>dynamic-update（动态更新） (可选，默认为false): 指定用于UPDATE   的SQL将会在运行时动态生成，并且只更新那些改变过的字段。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%"><img alt="8" src="images/callouts/8.png" border="0" /></td>
      <td valign="top" align="left"><p>dynamic-insert（动态插入） (可选, 默认为false): 指定用于INSERT的 SQL   将会在运行时动态生成，并且只包含那些非空值字段。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%"><img alt="9" src="images/callouts/9.png" border="0" /></td>
      <td valign="top" align="left"><p>select-before-update (可选，默认值为false): 指定Hibernate除非确定对象的确被修改了，<em>不会</em>执行SQL UPDATE操作。在特定场合（实际上，只会发生在一个临时对象关联到一个新的session中去，执行update()的时候），这说明Hibernate会在UPDATE之前执行一次额外的SQL SELECT操作，来决定是否应该进行UPDATE。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%"><img alt="10" src="images/callouts/10.png" border="0" /></td>
      <td valign="top" align="left"><p>polymorphism（多形，多态） (可选, 默认值为 implicit (隐式)): 界定是隐式还是显式的使用查询多态。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%">(11)</td>
      <td valign="top" align="left"><p>where (可选) 指定一个附加的SQLWHERE   条件，在抓取这个类的对象时会一直增加这个条件。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%">(12)</td>
      <td valign="top" align="left"><p>persister (可选): 指定一个定制的ClassPersister。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%">(13)</td>
      <td valign="top" align="left"><p>batch-size (可选,默认是1)   指定一个用于根据标识符抓取实例时使用的&quot;batch size&quot;（批次抓取数量）。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%">(14)</td>
      <td valign="top" align="left"><p>optimistic-lock（乐观锁定） (可选，默认是version): 决定乐观锁定的策略。 </p></td>
    </tr>
    <tr>
      <td valign="top" align="left" width="5%">(15)</td>
      <td valign="top" align="left"><p>lazy（延迟） (可选): 假若设置 lazy=&quot;true&quot;，就是设置这个类自己的名字作为proxy接口的一种等价快捷形式。 </p></td>
    </tr>
  </tbody>
</table>
<p>若指明的持久化类实际上是一个接口，也可以被完美地接受。其后你可以用&lt;subclass&gt;来指定该接口的实际实现类名。你可以持久化任何<em>static</em>（静态的）内部类。记得应该使用标准的类名格式，就是说比如：Foo$Bar。 </p>
<p>不可变类，mutable=&quot;false&quot;不可以被应用程序更新或者删除。这可以让Hibernate做一些小小的性能优化。 </p>
<p>可选的proxy属性可以允许延迟加载类的持久化实例。Hibernate开始会返回实现了这个命名接口的CGLIB代理。当代理的某个方法被实际调用的时候，真实的持久化对象才会被装载。参见下面的“用于延迟装载的代理”。 </p>
<p><em>Implicit</em> (隐式)的多态是指，如果查询中给出的是任何超类、该类实现的接口或者该类的名字，都会返回这个类的实例；如果查询中给出的是子类的名字，则会返回子类的实例。 <em>Explicit</em> （显式）的多态是指，只有在查询中给出的明确是该类的名字时才会返回这个类的实例；同时只有当在这个&lt;class&gt;的定义中作为&lt;subclass&gt;或者&lt;joined-subclass&gt;出现的子类，才会可能返回。 大多数情况下，默认的polymorphism=&quot;implicit&quot;都是合适的。   显式的多态在有两个不同的类映射到同一个表的时候很有用。（允许一个“轻型”的类，只包含部分表字段）。 </p>
<p>persister属性可以让你定制这个类使用的持久化策略。你可以指定你自己实现的net.sf.hibernate.persister.EntityPersister的子类，你甚至可以完全从头开始编写一个net.sf.hibernate.persister.ClassPersister接口的实现，可能是用储存过程调用、序列化到文件或者LDAP数据库来实现的。参阅net.sf.hibernate.test.CustomPersister，这是一个简单的例子（“持久化”到一个Hashtable）。 </p>
<p>请注意dynamic-update和dynamic-insert的设置并不会继承到子类，所以在&lt;subclass&gt;或者&lt;joined-subclass&gt;元素中可能需要再次设置。这些设置是否能够提高效率要视情形而定。请用你的智慧决定是否使用。 </p>
<p>使用select-before-update通常会降低性能.当是在防止数据库不必要的触发update触发器，这就很有用了。 </p>
<p>如果你打开了dynamic-update，你可以选择几种乐观锁定的策略： </p>
<ul type="disc">
  <li>
    <p>version（版本检查） 检查version/timestamp字段 </p>
  </li>
  <li>
    <p>all（全部） 检查全部字段 </p>
  </li>
  <li>
    <p>dirty（脏检查）只检察修改过的字段 </p>
  </li>
  <li>
    <p>none（不检查）不使用乐观锁定 </p>
  </li>
</ul>
<p>我们<em>非常</em>强烈建议你在Hibernate中使用version/timestamp字段来进行乐观锁定。对性能来说，这是最好的选择，并且这也是唯一能够处理在session外进行操作的策略（就是说，当使用Session.update()的时候）。 </p>
<div class="rpindex"><a href="16.html"> 下一页</a><a href="14.html"> 上一页</a><a href="index.html">首页</a></div>


<!-- tail-start -->
﻿
<div style="clear:both;"></div>

</div>
<!--end of file-wrpper-->
</div>
<!--end of content-wrapper-->
</div>
<!--end of container-->


<footer>
<p class="copyright">版权所有 2014 <a href="http://www.iteedu.com">ITEEDU</a>, 京ICP备16069454号</p>
</footer>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>

<!--百度统计js-->
<p style="display:none">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fa5213b08a76d4fc6b8a80eb382490e0b' type='text/javascript'%3E%3C/script%3E"));
</script>
</p>

</body>

</html>


<!-- tail-end -->
